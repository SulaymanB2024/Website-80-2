<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sulayman Bowles – Financial Analyst & Developer</title>
    <meta name="description" content="UT Austin student and equity research analyst who builds valuation models and interactive web experiences. View projects and download résumé.">
    
    <!-- SEO Meta Tags -->
    <meta name="author" content="Sulayman Bowles">
    <meta name="keywords" content="Sulayman Bowles, portfolio, financial analysis, equity research, software development, AI agent, Austin, web3, blockchain, fintech, Point72, digital portfolio, analyst, developer">
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    <link rel="canonical" href="https://sulayman-bowles.dev/">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#030303">
    <meta name="msapplication-TileColor" content="#030303">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">

    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://sulaymanbowles.com/">
    <meta property="og:site_name" content="Sulayman Bowles Portfolio">
    <meta property="og:title" content="SULAYMAN BOWLES | Digital Alchemy">
    <meta property="og:description" content="Finance. Code. Entropy. A system of evidence.">
    <meta property="og:image" content="https://sulaymanbowles.com/og-image.png">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="Sulayman Bowles - Digital Portfolio">
    <meta property="og:locale" content="en_US">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://sulaymanbowles.com/">
    <meta property="twitter:title" content="SULAYMAN BOWLES | Digital Alchemy">
    <meta property="twitter:description" content="Finance. Code. Entropy. A system of evidence.">
    <meta property="twitter:image" content="https://sulaymanbowles.com/og-image.png">
    <meta property="twitter:image:alt" content="Sulayman Bowles - Digital Portfolio">
    <meta name="twitter:creator" content="@sulaymanbowles">
    <meta name="twitter:site" content="@sulaymanbowles">

    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Sulayman Bowles",
      "url": "https://sulaymanbowles.com",
      "image": "https://sulaymanbowles.com/og-image.png",
      "jobTitle": "Financial Analyst & Software Developer",
      "description": "Co-Founder, Analyst, and Digital Alchemist specializing in financial analysis, equity research, and software development.",
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "Austin",
        "addressRegion": "TX",
        "addressCountry": "US"
      },
      "alumniOf": [
        {
          "@type": "Organization",
          "name": "Point72"
        }
      ],
      "knowsAbout": ["Financial Analysis", "Equity Research", "Software Development", "Blockchain", "AI", "Web3", "Valuation Models"]
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Sulayman Bowles Portfolio",
      "url": "https://sulaymanbowles.com",
      "description": "Digital portfolio showcasing financial analysis, software development projects, and research work.",
      "author": {
        "@type": "Person",
        "name": "Sulayman Bowles"
      },
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://sulaymanbowles.com/#work?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
    </script>

    <!-- Preload critical resources -->
    <link rel="preload" href="https://cdn.tailwindcss.com" as="script">
    <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Lora:ital,wght@0,400;0,500;0,600;1,400&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Space+Grotesk:wght@300;400;500;700&family=Space+Mono:wght@400;700&display=swap">
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    <link rel="dns-prefetch" href="https://unpkg.com">

    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- TradingView Widget Script -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Lora:ital,wght@0,400;0,500;0,600;1,400&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Space+Grotesk:wght@300;400;500;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Space Grotesk', 'sans-serif'],
                        mono: ['Space Mono', 'monospace'],
                        serif: ['Lora', 'serif'],
                        playfair: ['Playfair Display', 'serif'],
                    },
                    colors: {
                        'off-white': '#EAEAEA',
                        'off-black': '#030303', /* Deepened black */
                        'charcoal': '#0F0F0F',
                        'mid-gray': '#2A2A2A',
                        'dim-gray': '#666666',
                        'light-gray': '#A0A0A0',
                    },
                    animation: {
                        'marquee': 'marquee 40s linear infinite', /* Slowed down */
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        marquee: {
                            '0%': { transform: 'translateX(0%)' },
                            '100%': { transform: 'translateX(-100%)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Leaflet Dark Theme Overrides */
        .leaflet-popup-content-wrapper, .leaflet-popup-tip {
            background: #0A0A0A;
            color: #EAEAEA;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        .leaflet-popup-content {
            margin: 12px;
            font-family: 'Space Mono', monospace;
        }
        .leaflet-container a.leaflet-popup-close-button {
            color: #666;
            padding: 4px;
        }
        .leaflet-container a.leaflet-popup-close-button:hover {
            color: #fff;
        }

        /* --- CORE SETTINGS --- */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #030303; }
        ::-webkit-scrollbar-thumb { background: #2A2A2A; border-radius: 2px; }
        ::-webkit-scrollbar-thumb:hover { background: #666666; }

        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            overflow-x: hidden;
        }

        body {
            background-color: #030303;
            color: #EAEAEA;
            font-feature-settings: "ss01", "ss02", "salt"; 
            transition: background-color 0.5s ease;
        }

        /* Enhanced focus states for accessibility */
        a:focus-visible, button:focus-visible, [role="button"]:focus-visible {
            outline: 2px solid #EAEAEA;
            outline-offset: 4px;
        }
        
        input:focus-visible, textarea:focus-visible, select:focus-visible {
            outline: 2px solid #EAEAEA;
            outline-offset: 2px;
        }
        
        /* Ensure minimum touch target sizes on mobile */
        @media (max-width: 768px) {
            button, a, [role="button"], input[type="submit"] {
                min-height: 44px;
                min-width: 44px;
            }
        }
        
        /* Improve form field error states */
        input:invalid:not(:placeholder-shown),
        textarea:invalid:not(:placeholder-shown) {
            border-color: rgba(239, 68, 68, 0.5);
        }
        
        input:valid:not(:placeholder-shown),
        textarea:valid:not(:placeholder-shown) {
            border-color: rgba(255, 255, 255, 0.3);
        }
        @media (min-width: 768px) {
            body {
                cursor: none;
            }
        }

        /* --- GLOBAL REFINEMENTS --- */
        html {
            scroll-behavior: smooth;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #030303;
        }
        ::-webkit-scrollbar-thumb {
            background: #2A2A2A;
            border-radius: 4px;
            border: 2px solid #030303;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #666666;
        }

        /* Selection Style */
        ::selection {
            background: rgba(255, 255, 255, 0.9);
            color: #030303;
            text-shadow: none;
        }

        /* Link Underline Animation */
        .hover-underline {
            position: relative;
            text-decoration: none;
        }
        .hover-underline::after {
            content: '';
            position: absolute;
            width: 100%;
            transform: scaleX(0);
            height: 1px;
            bottom: -2px;
            left: 0;
            background-color: currentColor;
            transform-origin: bottom right;
            transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .hover-underline:hover::after {
            transform: scaleX(1);
            transform-origin: bottom left;
        }

        /* --- DEPTH EFFECT CONTAINER --- */
        #app-container {
            position: relative;
            transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1), 
                        filter 0.5s cubic-bezier(0.16, 1, 0.3, 1),
                        border-radius 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            transform-origin: center top;
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            min-height: 100vh;
            background-color: #030303;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
            background-size: 120px 120px;
            will-change: transform, filter;
        }

        body.modal-open {
            overflow: hidden;
            background-color: #030303; /* Darker background behind the scaled content */
        }

        body.modal-open #app-container {
            transform: scale(0.95) translate3d(0, 15px, 0);
            filter: brightness(0.35) blur(2px);
            border-radius: 16px;
            pointer-events: none;
            will-change: transform, filter;
            backface-visibility: hidden;
        }

        ::selection {
            background: #EAEAEA;
            color: #030303;
        }

        /* --- PAPER MODE (WRITING) --- */
        .modal-content.paper-mode {
            background-color: #EAEAEA;
            color: #0F0F0F;
            border: none;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            transition: background-color 0.4s ease, color 0.4s ease, box-shadow 0.4s ease;
        }
        .modal-content.paper-mode ::selection {
            background: #0F0F0F;
            color: #EAEAEA;
        }
        .modal-content.paper-mode #reading-progress {
            background-color: #0F0F0F;
            transition: background-color 0.3s ease;
        }
        .modal-content.paper-mode #close-modal i {
            color: #0F0F0F;
        }
        .modal-content.paper-mode .drop-cap::first-letter {
            color: #0F0F0F;
        }
        .modal-content.paper-mode .pull-quote {
            border-left-color: #0F0F0F;
            color: #2A2A2A;
        }

        /* --- INTERACTIVE TERMS (FOOTNOTES) --- */
        .interactive-term {
            border-bottom: 1px dotted #666666;
            cursor: help;
            position: relative;
            transition: all 0.2s;
            display: inline-block;
        }
        .interactive-term:hover {
            background-color: rgba(0,0,0,0.05);
            border-bottom-style: solid;
            border-bottom-color: #030303;
        }
        .term-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(10px);
            background: #0F0F0F;
            color: #EAEAEA;
            padding: 0.75rem 1rem;
            font-family: 'Inter', sans-serif;
            font-size: 0.75rem;
            line-height: 1.4;
            width: max-content;
            max-width: 250px;
            opacity: 0;
            pointer-events: none;
            transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
            z-index: 100;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border-radius: 4px;
            font-weight: 400;
            text-align: center;
        }
        .term-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #0F0F0F transparent transparent transparent;
        }
        .interactive-term:hover .term-tooltip {
            opacity: 1;
            transform: translateX(-50%) translateY(-8px);
        }

        /* --- SPARKLINES --- */
        .sparkline {
            display: inline-block;
            vertical-align: middle;
            margin: 0 4px;
        }
        .sparkline path {
            fill: none;
            stroke: #0F0F0F;
            stroke-width: 1.5;
        }

        /* --- TYPING ANIMATION --- */
        @keyframes typing {
            from { width: 0; }
            to { width: 100%; }
        }
        @keyframes blink {
            0%, 49% { border-color: #EAEAEA; }
            50%, 100% { border-color: transparent; }
        }
        @keyframes gridPulse {
            0%, 100% { opacity: 0.1; }
            50% { opacity: 0.2; }
        }
        @keyframes cursorBlink {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0; }
        }
        .typing-text {
            overflow: hidden;
            border-right: 2px solid #EAEAEA;
            white-space: nowrap;
            animation: typing 1.8s steps(40, end) cubic-bezier(0.16, 1, 0.3, 1), blink 0.7s step-end infinite;
            display: inline-block;
            will-change: width;
        }
        .typing-text.complete {
            border-right: none;
            animation: none;
            will-change: auto;
        }

        /* --- DESIGN SYSTEM ANIMATIONS --- */
        @keyframes fadeInDesign {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .design-content {
            display: block;
        }

        .design-content.hidden {
            display: none;
        }
        
        .design-content.show-animate {
            animation: fadeInDesign 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes fadeInDesign {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .design-tab.active {
            background: rgba(255, 255, 255, 0.1) !important;
            border-color: rgba(255, 255, 255, 0.2) !important;
            color: #EAEAEA !important;
        }

        /* Motion Demos */
        .motion-demo-ease-out {
            animation: slideDemo 2s cubic-bezier(0, 0, 0.2, 1) infinite;
        }

        .motion-demo-ease-in-out {
            animation: slideDemo 2s cubic-bezier(0.4, 0, 0.2, 1) infinite;
        }

        .motion-demo-spring {
            animation: slideDemo 2s cubic-bezier(0.16, 1, 0.3, 1) infinite;
        }

        @keyframes slideDemo {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(calc(100% - 3rem)); }
        }

        /* --- TICKER ANIMATION --- */
        @keyframes flash {
            0% { color: #FFFFFF; text-shadow: 0 0 8px rgba(255,255,255,0.8); }
            100% { color: inherit; text-shadow: none; }
        }
        .animate-flash {
            animation: flash 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        /* --- ROW FADE IN ANIMATION --- */
        @keyframes fadeInRow {
            from {
                opacity: 0;
                transform: translateY(2px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- STATEMENT TABS --- */
        .statement-tab {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .statement-tab.active {
            background: rgba(255, 255, 255, 0.1) !important;
            border-color: rgba(255, 255, 255, 0.2) !important;
            color: #EAEAEA !important;
        }

        .statement-content {
            transition: opacity 0.6s cubic-bezier(0.4, 0, 0.2, 1), transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: opacity, transform;
        }

        .statement-content.hidden {
            opacity: 0;
            transform: translateX(-30px);
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            pointer-events: none;
            visibility: hidden;
        }

        .statement-content.active {
            opacity: 1;
            transform: translateX(0);
            position: relative;
            visibility: visible;
        }

        /* --- CUSTOM CURSOR --- */
        .cursor-dot {
            position: fixed;
            top: 0; left: 0;
            width: 6px; height: 6px;
            background-color: #EAEAEA;
            border-radius: 50%;
            z-index: 9999;
            pointer-events: none;
            will-change: transform;
            mix-blend-mode: exclusion;
        }
        
        .cursor-outline {
            position: fixed;
            top: 0; left: 0;
            width: 32px; height: 32px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            z-index: 9998;
            pointer-events: none;
            will-change: transform, width, height;
            transition: width 0.25s cubic-bezier(0.19, 1, 0.22, 1), 
                        height 0.25s cubic-bezier(0.19, 1, 0.22, 1), 
                        background-color 0.25s ease-out,
                        border-color 0.25s ease-out;
            display: flex;
            justify-content: center;
            align-items: center;
            mix-blend-mode: difference;
        }
        
        body.hovering .cursor-outline {
            width: 60px !important; height: 60px !important;
            background-color: rgba(255, 255, 255, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.5) !important;
        }
        body.hovering .cursor-dot { opacity: 0; }

        body.viewing-project .cursor-outline {
            width: 90px !important; height: 90px !important;
            background-color: #EAEAEA;
            border-color: transparent !important;
            mix-blend-mode: normal;
        }
        body.viewing-project .cursor-outline::after {
            content: 'OPEN';
            font-family: 'Space Grotesk', sans-serif;
            font-size: 11px;
            font-weight: 700;
            color: #030303;
            letter-spacing: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        body.viewing-project .cursor-dot { opacity: 0; }

        /* --- SPREADSHEET CURSOR --- */
        .cursor-cell {
            cursor: cell;
        }
        
        #virtual-cursor {
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        #cell-selection {
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(255, 255, 255, 0.05);
        }

        /* --- NOISE OVERLAY --- */
        .noise-overlay {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 40;
            opacity: 0.05;
            background: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }

        /* --- MODAL SYSTEM --- */
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(3, 3, 3, 0.85);
            backdrop-filter: blur(0px);
            -webkit-backdrop-filter: blur(0px);
            z-index: 90;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1),
                        backdrop-filter 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            will-change: opacity, backdrop-filter;
        }
        .modal-backdrop.active {
            opacity: 1;
            pointer-events: auto;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        .modal-content {
            background: #0F0F0F;
            border: 1px solid rgba(255,255,255,0.1);
            width: 100%;
            max-width: 900px;
            max-height: 95vh;
            overflow-y: auto;
            overflow-x: hidden;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            transform: translate3d(0, 25px, 0) scale(0.97);
            transition: transform 0.55s cubic-bezier(0.16, 1, 0.3, 1),
                        opacity 0.45s cubic-bezier(0.16, 1, 0.3, 1);
            opacity: 0;
            position: relative;
            will-change: transform, opacity;
            backface-visibility: hidden;
            -webkit-font-smoothing: antialiased;
        }
        
        @media (min-width: 1024px) {
            .modal-content {
                max-width: 1600px;
            }
        }
        .modal-backdrop.active .modal-content {
            transform: translate3d(0, 0, 0) scale(1);
            opacity: 1;
        }

        /* Modal Content Animation Stagger */
        .modal-stagger {
            opacity: 0;
            transform: translate3d(0, 15px, 0);
            transition: opacity 0.5s cubic-bezier(0.16, 1, 0.3, 1),
                        transform 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            will-change: opacity, transform;
            backface-visibility: hidden;
        }
        .modal-backdrop.active .modal-stagger {
            opacity: 1;
            transform: translate3d(0, 0, 0);
        }
        
        /* Financial Analysis Portfolio Styles */
        .portfolio-view {
            transition: opacity 0.3s ease;
        }
        .portfolio-view.hidden {
            display: none;
            opacity: 0;
        }
        .tab-nav {
            display: flex;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 2rem;
            overflow-x: auto;
            gap: 0;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        .tab-nav::-webkit-scrollbar {
            display: none;
        }
        .tab-btn {
            padding: 1rem 1.5rem;
            font-family: 'Inter', sans-serif;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #666666;
            border: none;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
            white-space: nowrap;
            background: none;
            cursor: pointer;
            position: relative;
        }
        .tab-btn:hover {
            color: #EAEAEA;
            background: rgba(255,255,255,0.02);
        }
        .tab-btn.active {
            color: #EAEAEA;
            border-bottom-color: #EAEAEA;
        }
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        .tab-content.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .tv-widget-container {
            width: 100%;
            height: 100%;
        }
        
        /* Stock Card Styles - Monochrome */
        .stock-card {
            position: relative;
            border: 1px solid rgba(255,255,255,0.1);
            background: #0F0F0F;
            transition: all 0.3s ease;
            overflow: hidden;
        }
        .stock-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: transparent;
            transition: background 0.3s;
        }
        .stock-card.sell::before {
            background: rgba(255,255,255,0.3);
        }
        .stock-card.buy::before {
            background: rgba(255,255,255,0.3);
        }
        .stock-card:hover {
            border-color: rgba(255,255,255,0.3);
            background: #0F0F0F;
        }
        .stock-card:hover .stock-arrow {
            transform: translateX(4px);
            opacity: 1;
        }
        .stock-arrow {
            opacity: 0.5;
            transition: all 0.3s;
        }
        
        /* Simplified animations - performance optimized */
        @keyframes fadeInUp {
            from { 
                opacity: 0; 
                transform: translateY(8px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }
        
        /* Slide In Animation */
        @keyframes slideIn {
            from { transform: scaleX(0); transform-origin: left; }
            to { transform: scaleX(1); transform-origin: left; }
        }
        
        /* Pulse Animation for Traffic Markers */
        @keyframes pulse-marker {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
        }
        
        .pulse-marker {
            animation: pulse-marker 2s ease-in-out infinite;
        }
        
        /* Map Layer Buttons */
        .map-layer-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .map-layer-btn.active {
            background: rgba(255, 255, 255, 0.1);
            color: #EAEAEA;
        }
        
        /* Rating Badge - Monochrome */
        .rating-badge {
            font-family: 'Inter', sans-serif;
            font-size: 10px;
            font-weight: 600;
            letter-spacing: 0.15em;
            padding: 6px 12px;
            border-radius: 0px;
            background: transparent;
            border: 1px solid rgba(255,255,255,0.3);
            color: #EAEAEA;
        }
        .rating-badge.sell {
            border-color: rgba(255,255,255,0.3);
        }
        .rating-badge.buy {
            border-color: rgba(255,255,255,0.3);
        }
        
        /* Metric Display - Monochrome */
        .metric-block {
            padding: 1.25rem;
            background: rgba(0,0,0,0.4);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .metric-label {
            font-family: 'Inter', sans-serif;
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: #666666;
            margin-bottom: 0.5rem;
        }
        .metric-value {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.5rem;
            font-weight: 500;
        }
        
        /* TradingView Widget Wrappers */
        .widget-wrapper {
            position: relative;
            background: #0F0F0F;
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 4px;
            overflow: hidden;
        }
        .widget-wrapper::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(180deg, rgba(255,255,255,0.02) 0%, transparent 100%);
            pointer-events: none;
            z-index: 1;
        }
        .widget-header {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            font-family: 'Inter', sans-serif;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #666666;
            background: rgba(0,0,0,0.3);
        }
        .widget-body {
            position: relative;
            z-index: 0;
        }

        /* --- UTILITY ANIMATIONS --- */
        .reveal-text {
            opacity: 0;
            transform: translate3d(0, 15px, 0);
            transition: opacity 0.7s cubic-bezier(0.16, 1, 0.3, 1), 
                        transform 0.7s cubic-bezier(0.16, 1, 0.3, 1),
                        filter 0.7s cubic-bezier(0.16, 1, 0.3, 1);
            filter: blur(3px);
            will-change: opacity, transform, filter;
            backface-visibility: hidden;
        }
        .reveal-text.active {
            opacity: 1;
            transform: translate3d(0, 0, 0);
            filter: blur(0);
            will-change: auto;
        }
        
        /* Hero content should be visible immediately */
        section:first-of-type .reveal-text {
            opacity: 1;
            transform: translateY(0);
            filter: blur(0);
        }

        .magnetic-wrap {
            display: inline-block;
            position: relative;
            z-index: 50;
        }
        .magnetic-wrap:focus-visible {
            outline: 2px solid rgba(255, 255, 255, 0.8);
            outline-offset: 4px;
            border-radius: 4px;
        }
        .magnetic-area {
            position: absolute;
            top: -30px; left: -30px; right: -30px; bottom: -30px;
            z-index: 1;
            border-radius: 50%;
        }

        .project-img-container { 
            overflow: hidden;
            backface-visibility: hidden;
        }
        .project-img {
            will-change: transform;
            transform: scale(1.01);
            transition: transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            backface-visibility: hidden;
        }
        .group:hover .project-img {
            transform: scale(1.08);
        }

        /* Service Card Special Effects */
        .service-card {
            position: relative;
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1),
                        border-color 0.4s cubic-bezier(0.16, 1, 0.3, 1),
                        box-shadow 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            will-change: transform;
            backface-visibility: hidden;
        }
        .service-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, transparent 50%);
            opacity: 0;
            transition: opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            pointer-events: none;
            z-index: 1;
            will-change: opacity;
        }
        .service-card:hover::before {
            opacity: 1;
        }
        .service-card:hover {
            transform: translate3d(0, -8px, 0);
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }
        .service-card:hover .gen-canvas {
            filter: brightness(1.3) saturate(1.2);
            transition: filter 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        
        /* Service image container parallax effect */
        .service-img-container {
            overflow: hidden;
            position: relative;
        }
        .service-card:hover .service-img-container canvas {
            transform: scale3d(1.15, 1.15, 1);
        }
        .service-img-container canvas {
            transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            will-change: transform;
            backface-visibility: hidden;
        }

        /* Loader */
        #loader {
            position: fixed;
            inset: 0;
            background: #030303;
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            transition: transform 0.5s cubic-bezier(0.7, 0, 0.3, 1),
                        opacity 0.3s ease-out;
        }
        .loader-hidden { 
            transform: translateY(-100%); 
            opacity: 0;
        }
        
        /* Canvas */
        #canvas-container {
            position: absolute;
            top: 0; right: 0;
            width: 55%; height: 100vh;
            z-index: 1;
            opacity: 1;
            pointer-events: none;
        }
        #canvas-container::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120%;
            height: 120%;
            background: radial-gradient(
                circle at center,
                rgba(255, 255, 255, 0.03) 0%,
                rgba(150, 150, 150, 0.015) 25%,
                rgba(100, 100, 100, 0.008) 40%,
                transparent 65%
            );
            pointer-events: none;
            z-index: 2;
        }
        @media (max-width: 768px) {
            #canvas-container { width: 100%; opacity: 0.5; z-index: 0; }
        }

        .writing-item { 
            transition: all 0.3s ease;
        }
        .writing-item:focus-visible {
            outline: 2px solid #0F0F0F;
            outline-offset: 4px;
            border-radius: 4px;
        }
        .writing-arrow { 
            opacity: 0; 
            transform: translateX(-10px); 
            transition: all 0.3s ease;
        }
        .writing-item:hover .writing-arrow,
        .writing-item:focus-visible .writing-arrow {
            opacity: 1;
            transform: translateX(0);
        }

        /* --- SPOTLIGHT GRID EFFECT --- */
        .grid-spotlight-container {
            --mouse-x: 0px;
            --mouse-y: 0px;
        }
        .grid-spotlight-tile {
            position: relative;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }
        .grid-spotlight-tile::before {
            content: "";
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(
                800px circle at var(--mouse-x) var(--mouse-y),
                rgba(255, 255, 255, 0.06),
                transparent 40%
            );
            opacity: 0;
            transition: opacity 0.5s;
            pointer-events: none;
            z-index: 1;
        }
        .grid-spotlight-container:hover .grid-spotlight-tile::before {
            opacity: 1;
        }
        .grid-spotlight-tile::after {
            content: "";
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(
                600px circle at var(--mouse-x) var(--mouse-y),
                rgba(255, 255, 255, 0.4),
                transparent 40%
            );
            opacity: 0;
            z-index: 3;
            pointer-events: none;
            mix-blend-mode: overlay;
        }
        .grid-spotlight-container:hover .grid-spotlight-tile::after {
            opacity: 1;
        }

        /* --- WRITING LIST FOCUS --- */
        .writing-list:hover .writing-item {
            opacity: 0.3;
            filter: blur(1px);
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .writing-list:hover .writing-item:hover {
            opacity: 1;
            filter: blur(0);
            transform: translateX(10px);
        }
        
        /* --- MAGNETIC CURSOR TWEAK --- */
        .magnetic-wrap {
            display: inline-block;
            position: relative;
        }
        .magnetic-area {
            position: absolute;
            top: -20px; left: -20px; right: -20px; bottom: -20px;
            z-index: 10;
        }

        /* --- HERO LOADER REFINEMENT --- */
        #loader {
            /* ... existing styles ... */
            background: #030303; /* Ensure deep black */
        }
        .loader-hidden {
            transform: translateY(-100%);
            opacity: 0;
            pointer-events: none;
        }
        
        /* --- TYPOGRAPHY & READING --- */
        .drop-cap::first-letter {
            float: left;
            font-family: 'Space Grotesk', sans-serif;
            font-size: 4.5rem;
            line-height: 0.8;
            font-weight: 700;
            margin-right: 1rem;
            margin-top: 0.5rem;
            color: #EAEAEA;
        }
        
        .pull-quote {
            border-left: 2px solid #EAEAEA;
            padding-left: 1.5rem;
            margin: 2rem 0;
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.5rem;
            font-style: italic;
            color: #A0A0A0;
        }

        /* --- GENERATIVE COVERS --- */
        .gen-canvas {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            opacity: 0.6;
            transition: opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1),
                        filter 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            will-change: opacity, filter;
            backface-visibility: hidden;
        }
        .group:hover .gen-canvas { opacity: 1; }

        /* --- LIVE TICKER --- */
        .live-ticker {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            color: #666666;
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        .live-val { color: #EAEAEA; }

        /* --- WRITING SECTION --- */
        .writing-list {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .writing-list:hover .writing-item {
            filter: blur(3px);
            opacity: 0.4;
            transform: scale(0.99);
        }
        .writing-list .writing-item:hover {
            filter: blur(0);
            opacity: 1;
            transform: scale(1);
            z-index: 10;
            border-color: #0F0F0F;
        }
        .writing-item {
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            will-change: transform, filter, opacity;
        }
        
        /* Filter Buttons */
        .filter-btn {
            position: relative;
            transition: color 0.3s ease;
        }
        .filter-btn::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 100%;
            height: 1px;
            background-color: currentColor;
            transform: scaleX(0);
            transform-origin: right;
            transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .filter-btn.active::after,
        .filter-btn:hover::after {
            transform: scaleX(1);
            transform-origin: left;
        }
        .filter-btn.active {
            color: #0F0F0F;
        }

        /* --- UI IMPROVEMENTS --- */
        .glass-nav {
            background: rgba(3, 3, 3, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        /* Tech Corners */
        .tech-corner {
            position: relative;
        }
        .tech-corner::before, .tech-corner::after {
            content: '';
            position: absolute;
            width: 6px;
            height: 6px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            pointer-events: none;
        }
        .tech-corner::before { top: 0; left: 0; border-right: none; border-bottom: none; }
        .tech-corner::after { bottom: 0; right: 0; border-left: none; border-top: none; }
        
        .tech-corner:hover::before, .tech-corner:hover::after {
            width: 100%;
            height: 100%;
            border-color: rgba(255, 255, 255, 0.05);
        }

        /* Typography Refinements */
        h1, h2, h3, .font-display {
            letter-spacing: -0.02em;
        }
        p {
            letter-spacing: 0.01em;
        }
        
        /* Button Tech Style */
        .btn-tech {
            position: relative;
            overflow: hidden;
            background: transparent;
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }
        .btn-tech:hover {
            border-color: #EAEAEA;
            background: rgba(255,255,255,0.05);
        }

        /* Screen reader only class */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
        .focus\\:not-sr-only:focus {
            position: absolute;
            width: auto;
            height: auto;
            padding: 0;
            margin: 0;
            overflow: visible;
            clip: auto;
            white-space: normal;
        }

        /* Shadow Order Book Mask */
        .mask-gradient-left {
            mask-image: linear-gradient(to right, transparent, black 40%);
            -webkit-mask-image: linear-gradient(to right, transparent, black 40%);
        }

        @media (prefers-reduced-motion: reduce) {
            *, ::before, ::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
            .animate-marquee { animation: none !important; }
            #canvas-container, .gen-canvas, #oscilloscope, #order-book-visual { display: none !important; }
        }

    </style>
    <!-- Vercel Web Analytics -->
    <script defer src="https://va.vercel-analytics.com/jsr" data-attribution="vercel"></script>
</head>
<body class="antialiased">

    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:bg-off-white focus:text-black focus:px-4 focus:py-2">Skip to main content</a>

    <!-- Cursor -->
    <div class="cursor-dot hidden md:block" aria-hidden="true"></div>
    <div class="cursor-outline hidden md:block" aria-hidden="true"></div>

    <!-- Noise -->
    <div class="noise-overlay"></div>

    <!-- Loading Screen -->
    <div id="loader">
        <div class="flex flex-col items-center gap-6">
            <div class="font-mono text-[10px] text-neutral-400 tracking-[0.5em] uppercase">Sulayman Bowles</div>
            <div class="font-display text-5xl font-bold tracking-tight scramble-text" data-final="OBLIVION">INIT</div>
            <div class="w-24 h-[1px] bg-neutral-800 mt-4 relative overflow-hidden">
                <div class="absolute inset-0 bg-off-white w-full -translate-x-full animate-[marquee_1.5s_ease-in-out_forwards]"></div>
            </div>
        </div>
    </div>

    <!-- MODAL CONTAINER -->
    <div id="project-modal" class="modal-backdrop">
        <div class="modal-content p-8 md:p-12 relative">
            <!-- Reading Progress Bar -->
            <div id="reading-progress" class="absolute top-0 left-0 h-1 bg-off-white w-0 z-50" style="transition: width 0.1s ease-out; will-change: width;"></div>
            
            <button id="close-modal" class="sticky top-6 float-right mr-6 z-50 p-2 rounded-full bg-black/20 backdrop-blur-md border border-white/5 hover:bg-white/10 transition-all duration-300 group hover:rotate-90 hover:scale-105" style="will-change: transform; margin-bottom: -44px;" aria-label="Close modal">
                <i data-lucide="x" class="w-6 h-6 text-neutral-400 group-hover:text-off-white transition-colors duration-200"></i>
            </button>
            
            <!-- Content Injection Area -->
            <div id="modal-body"></div>
        </div>
    </div>



    <!-- MAIN APP CONTAINER (For Depth Effect) -->
    <main id="app-container">

    <!-- Navigation -->
    <nav class="fixed w-full top-0 z-40 px-8 py-8 glass-nav text-off-white transition-transform duration-500" id="navbar">
        <div class="max-w-[1600px] mx-auto flex justify-between items-center">
            <a href="#" class="hover-target magnetic-wrap font-display font-bold text-xl tracking-tighter">
                <span class="magnetic-content block">S. BOWLES</span>
                <span class="magnetic-area"></span>
            </a>
            
            <!-- Desktop Menu -->
            <div class="hidden md:flex gap-12 text-[11px] font-medium tracking-[0.2em] uppercase">
                <a href="#section-services" class="hover-target magnetic-wrap group">
                    <span class="magnetic-content block group-hover:text-gray-200 transition-colors">Finance</span>
                    <span class="magnetic-area"></span>
                </a>
                <a href="#section-services" class="hover-target magnetic-wrap group">
                    <span class="magnetic-content block group-hover:text-gray-200 transition-colors">Consulting</span>
                    <span class="magnetic-area"></span>
                </a>
                <a href="#section-work" class="hover-target magnetic-wrap group">
                    <span class="magnetic-content block group-hover:text-gray-200 transition-colors">Work</span>
                    <span class="magnetic-area"></span>
                </a>
                <a href="#section-writing" class="hover-target magnetic-wrap group">
                    <span class="magnetic-content block group-hover:text-gray-200 transition-colors">Writing</span>
                    <span class="magnetic-area"></span>
                </a>
                <a href="#section-contact" class="hover-target magnetic-wrap group">
                    <span class="magnetic-content block group-hover:text-gray-200 transition-colors">Contact</span>
                    <span class="magnetic-area"></span>
                </a>
            </div>

            <!-- Mobile Menu Button -->
            <button id="menu-btn" class="hover-target md:hidden group p-3" aria-label="Open navigation menu" aria-expanded="false">
                <i data-lucide="menu" class="w-6 h-6"></i>
            </button>
        </div>
    </nav>

    <!-- Mobile Menu -->
    <div id="mobile-menu" class="fixed inset-0 bg-off-black z-30 transform translate-x-full flex flex-col justify-center items-center space-y-10" style="transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1); will-change: transform; backface-visibility: hidden;" role="dialog" aria-modal="true" aria-label="Navigation menu">
        <a href="#section-services" class="font-display text-5xl hover:text-gray-500 mobile-link transition-colors">FINANCE</a>
        <a href="#section-services" class="font-display text-5xl hover:text-gray-500 mobile-link transition-colors">CONSULTING</a>
        <a href="#section-work" class="font-display text-5xl hover:text-gray-500 mobile-link transition-colors">WORK</a>
        <a href="#section-writing" class="font-display text-5xl hover:text-gray-500 mobile-link transition-colors">WRITING</a>
        <a href="#section-contact" class="font-display text-5xl hover:text-gray-500 mobile-link transition-colors">CONTACT</a>
        <button id="close-menu-btn" class="absolute top-8 right-8 p-4 hover:rotate-90 transition-transform duration-300" aria-label="Close navigation menu">
            <i data-lucide="x" class="w-8 h-8 text-off-white"></i>
        </button>
    </div>

    <!-- Main Content -->
    <main id="main-content" role="main">

    <!-- Hero Section -->
    <section id="hero" class="relative min-h-screen flex flex-col justify-center px-6 md:px-12 overflow-hidden border-b border-off-white/10" aria-label="Hero section">
        <div id="canvas-container"></div>

        <div class="max-w-[1600px] w-full mx-auto z-10 relative pointer-events-none">
            <!-- Main Title -->
            <div class="pointer-events-auto relative select-none">
                <h1 class="font-display text-[8vw] leading-[0.9] font-bold tracking-tighter text-off-white reveal-text" style="transition-delay: 100ms;">
                    <span class="scramble-hover" data-final="FINANCIAL ANALYST">FINANCIAL ANALYST</span><br>
                    <span class="text-transparent bg-clip-text bg-gradient-to-r from-off-white via-neutral-400 to-neutral-900 scramble-hover" data-final="& BUILDER">& BUILDER</span>
                </h1>
            </div>
            
            <!-- Bio / Details -->
            <div class="mt-20 max-w-6xl pointer-events-auto relative">
                <div class="max-w-[650px] relative z-10">
                    <p class="font-sans text-xl md:text-2xl text-neutral-200 leading-[1.7] reveal-text mb-12" style="transition-delay: 500ms;">
                        I turn complex markets into clear, actionable models and lead teams to deliver results—equities, crypto, and beyond.
                    </p>
                    
                    <div class="reveal-text mb-8 flex flex-wrap gap-4" style="transition-delay: 600ms;">
                        <a href="#section-work" class="magnetic-wrap hover-target btn-tech inline-flex items-center gap-3 px-8 py-4 group text-off-white text-base font-medium rounded-sm backdrop-blur-sm" style="transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1); will-change: transform, border-color, background-color, box-shadow;">
                            <span class="magnetic-content inline-flex items-center gap-2">
                                See Valuation Work <i data-lucide="arrow-down-right" class="w-5 h-5" style="transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1); will-change: transform;" class="group-hover:translate-x-1 group-hover:translate-y-1"></i>
                            </span>
                            <span class="magnetic-area"></span>
                        </a>
                        <a href="Sulayman_Bowles_Resume_2025.pdf" target="_blank" class="magnetic-wrap hover-target btn-tech inline-flex items-center gap-3 px-8 py-4 group text-off-white text-base font-medium rounded-sm backdrop-blur-sm" style="transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1); will-change: transform, border-color, background-color, box-shadow;">
                            <span class="magnetic-content inline-flex items-center gap-2">
                                Download Résumé <i data-lucide="download" class="w-5 h-5" style="transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1); will-change: transform;" class="group-hover:translate-x-1 group-hover:translate-y-1"></i>
                            </span>
                            <span class="magnetic-area"></span>
                        </a>
                    </div>
                    
                    <div class="flex flex-wrap gap-6 font-mono text-[11px] text-neutral-300 uppercase tracking-wider reveal-text" style="transition-delay: 700ms;">
                        <span class="opacity-80">Austin, TX</span>
                        <span class="opacity-80">UT Austin '28</span>
                    </div>
                </div>
                <!-- Gradient overlay behind copy block -->
                <div class="absolute top-0 left-0 w-[120%] h-full pointer-events-none z-0" style="background: linear-gradient(to right, rgba(0, 0, 0, 0.4) 0%, rgba(0, 0, 0, 0.15) 50%, transparent 100%);"></div>
            </div>
        </div>
    </section>

    <!-- Infinite Marquee -->
    <div class="py-8 border-y border-off-white/15 bg-charcoal overflow-hidden flex relative z-20 pointer-events-none select-none">
        <div class="animate-marquee whitespace-nowrap flex gap-16 text-4xl md:text-6xl font-display font-bold text-[#A0A0A0]">
            <span>FINANCIAL MODELING</span> <span class="text-[#666666]">///</span>
            <span>FULL STACK</span> <span class="text-[#666666]">///</span>
            <span>WEB3 SYSTEMS</span> <span class="text-[#666666]">///</span>
            <span>DATA SCIENCE</span> <span class="text-[#666666]">///</span>
            <span>FINANCIAL MODELING</span> <span class="text-[#666666]">///</span>
            <span>FULL STACK</span> <span class="text-[#666666]">///</span>
            <span>WEB3 SYSTEMS</span> <span class="text-[#666666]">///</span>
            <span>DATA SCIENCE</span> <span class="text-[#666666]">///</span>
        </div>
        <div class="animate-marquee whitespace-nowrap flex gap-16 text-4xl md:text-6xl font-display font-bold text-[#A0A0A0]" aria-hidden="true">
            <span>FINANCIAL MODELING</span> <span class="text-[#666666]">///</span>
            <span>FULL STACK</span> <span class="text-[#666666]">///</span>
            <span>WEB3 SYSTEMS</span> <span class="text-[#666666]">///</span>
            <span>DATA SCIENCE</span> <span class="text-[#666666]">///</span>
            <span>FINANCIAL MODELING</span> <span class="text-[#666666]">///</span>
            <span>FULL STACK</span> <span class="text-[#666666]">///</span>
            <span>WEB3 SYSTEMS</span> <span class="text-[#666666]">///</span>
            <span>DATA SCIENCE</span> <span class="text-[#666666]">///</span>
        </div>
    </div>

    <!-- Services Section -->
    <section id="section-services" class="py-40 px-6 md:px-12 relative border-b border-off-white/10" aria-labelledby="services-heading">
        <div class="max-w-[1600px] mx-auto">
            <div class="flex flex-col md:flex-row justify-between items-end mb-20 border-b border-off-white/10 pb-8 reveal-text">
                <h2 id="services-heading" class="font-display text-6xl md:text-8xl font-bold tracking-tight text-off-white">SERVICES</h2>
                <div class="flex flex-col items-end mt-6 md:mt-0">
                    <span class="font-mono text-xs text-neutral-400 mb-2 tracking-widest uppercase">Available Now</span>
                    <span class="font-mono text-xs text-off-white tracking-widest">RETAINER / PROJECT</span>
                </div>
            </div>

            <!-- Services Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 reveal-text">
                
                <!-- Service 1: Financial Consulting -->
                <div class="group service-card tech-corner cursor-pointer border border-off-white/15 bg-charcoal hover:border-off-white/30 transition-all duration-500 overflow-hidden" data-service="financial">
                    <div class="service-img-container relative w-full h-[50vh] bg-[#0F0F0F] overflow-hidden">
                        <canvas id="canvas-financial" class="gen-canvas"></canvas>
                        <div class="absolute inset-0 bg-black/20 group-hover:bg-black/0 transition-colors duration-700"></div>
                    </div>
                    <div class="p-8 border-t border-off-white/20">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="font-display text-3xl md:text-4xl font-medium mb-2 group-hover:translate-x-2 transition-transform duration-500">FINANCIAL CONSULTING</h3>
                                <p class="font-sans text-neutral-400 text-sm group-hover:translate-x-2 transition-transform duration-500 delay-75">Strategic Analysis / Modeling / Decision Architecture</p>
                            </div>
                            <span class="font-mono text-xs border border-off-white/20 px-3 py-1 rounded-full group-hover:bg-off-white group-hover:text-black transition-colors">01</span>
                        </div>
                        <p class="font-sans text-neutral-300 text-sm leading-relaxed mb-6">
                            Transform organizational complexity into executable clarity. From DCF models to strategic scenario planning-I diagnose friction points, quantify uncertainty, and architect decision frameworks that drive measurable ROI.
                        </p>
                        <div class="flex flex-wrap gap-2">
                            <span class="px-2 py-1 bg-off-white/10 text-[10px] font-mono uppercase text-neutral-300 tracking-widest">DCF Models</span>
                            <span class="px-2 py-1 bg-off-white/10 text-[10px] font-mono uppercase text-neutral-300 tracking-widest">Valuation</span>
                            <span class="px-2 py-1 bg-off-white/10 text-[10px] font-mono uppercase text-neutral-300 tracking-widest">Risk Analysis</span>
                            <span class="px-2 py-1 bg-off-white/10 text-[10px] font-mono uppercase text-neutral-300 tracking-widest">Strategy</span>
                        </div>
                    </div>
                </div>

                <!-- Service 2: Website Design -->
                <div class="group service-card tech-corner cursor-pointer border border-off-white/15 bg-charcoal hover:border-off-white/30 transition-all duration-500 overflow-hidden" data-service="website">
                    <div class="service-img-container relative w-full h-[50vh] bg-[#0F0F0F] overflow-hidden">
                        <canvas id="canvas-website" class="gen-canvas"></canvas>
                        <div class="absolute inset-0 bg-black/20 group-hover:bg-black/0 transition-colors duration-700"></div>
                    </div>
                    <div class="p-8 border-t border-off-white/20">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="font-display text-3xl md:text-4xl font-medium mb-2 group-hover:translate-x-2 transition-transform duration-500">WEBSITE DESIGN</h3>
                                <p class="font-sans text-neutral-400 text-sm group-hover:translate-x-2 transition-transform duration-500 delay-75">Bespoke Development / Interactive Experiences / Conversion-Focused</p>
                            </div>
                            <span class="font-mono text-xs border border-off-white/20 px-3 py-1 rounded-full group-hover:bg-off-white group-hover:text-black transition-colors">02</span>
                        </div>
                        <p class="font-sans text-neutral-300 text-sm leading-relaxed mb-6">
                            Digital experiences that convert attention into revenue. Generative art, kinetic typography, and pixel-perfect execution-built with conversion metrics embedded from day one, not added as an afterthought.
                        </p>
                        <div class="flex flex-wrap gap-2">
                            <span class="px-2 py-1 bg-off-white/10 text-[10px] font-mono uppercase text-neutral-300 tracking-widest">React/Next.js</span>
                            <span class="px-2 py-1 bg-off-white/10 text-[10px] font-mono uppercase text-neutral-300 tracking-widest">Three.js</span>
                            <span class="px-2 py-1 bg-off-white/10 text-[10px] font-mono uppercase text-neutral-300 tracking-widest">Tailwind</span>
                            <span class="px-2 py-1 bg-off-white/10 text-[10px] font-mono uppercase text-neutral-300 tracking-widest">Generative</span>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <!-- Selected Work Section -->
    <section id="section-work" class="py-40 px-6 md:px-12 relative" aria-labelledby="work-heading">
        <div class="max-w-[1600px] mx-auto">
            <div class="flex flex-col md:flex-row justify-between items-end mb-32 border-b border-off-white/10 pb-8 reveal-text">
                <h2 id="work-heading" class="font-display text-6xl md:text-8xl font-bold tracking-tight mix-blend-difference">SELECTED<br>WORKS</h2>
                <div class="flex flex-col items-end mt-6 md:mt-0">
                    <span class="font-mono text-xs text-neutral-400 mb-2 tracking-widest uppercase">Archive</span>
                    <span class="font-mono text-xs text-off-white tracking-widest">(2023 - 2025)</span>
                </div>
            </div>

            <!-- Project 1: Crypto Research -->
            <div class="group project-card tech-corner mb-40 w-full cursor-pointer reveal-text view-project-target" data-project="bittensor" onclick="openModal('bittensor', 'project')">
                <div class="project-img-container relative w-full h-[70vh] bg-charcoal mb-8 overflow-hidden border border-off-white/10">
                    <div class="project-img absolute inset-0 w-full h-full bg-[#0F0F0F]">
                        <canvas id="canvas-bittensor" class="gen-canvas"></canvas>
                    </div>
                    <div class="absolute inset-0 bg-black/10 group-hover:bg-black/0 transition-colors duration-700 pointer-events-none"></div>
                </div>
                <div class="flex justify-between items-start border-t border-off-white/20 pt-6">
                    <div>
                        <h3 class="font-display text-4xl font-medium mb-2 group-hover:translate-x-4 transition-transform duration-500">CRYPTO RESEARCH</h3>
                        <p class="font-sans text-neutral-400 group-hover:translate-x-4 transition-transform duration-500 delay-75">Long/Short Theses / On-Chain Analysis / Market Structure</p>
                    </div>
                    <span class="font-mono text-xs border border-off-white/20 px-3 py-1 rounded-full group-hover:bg-off-white group-hover:text-black transition-colors">01</span>
                </div>
            </div>

            <!-- Project 2: Web3 Payroll -->
            <div class="group project-card tech-corner mb-40 w-full md:w-4/5 md:ml-auto cursor-pointer reveal-text view-project-target" data-project="payroll" onclick="openModal('payroll', 'project')">
                <div class="project-img-container relative w-full h-[70vh] bg-charcoal mb-8 overflow-hidden border border-off-white/10">
                     <div class="project-img absolute inset-0 w-full h-full bg-[#0F0F0F]">
                        <canvas id="canvas-payroll" class="gen-canvas"></canvas>
                    </div>
                </div>
                <div class="flex justify-between items-start border-t border-off-white/20 pt-6">
                    <div>
                        <h3 class="font-display text-4xl font-medium mb-2 group-hover:translate-x-4 transition-transform duration-500">CHAIN PAYROLL</h3>
                        <p class="font-sans text-neutral-400 group-hover:translate-x-4 transition-transform duration-500 delay-75">1st Place Winner / Team Lead / Smart Contracts</p>
                    </div>
                    <span class="font-mono text-xs border border-off-white/20 px-3 py-1 rounded-full group-hover:bg-off-white group-hover:text-black transition-colors">02</span>
                </div>
            </div>

             <!-- Project 3: Point72 -->
             <div class="group project-card tech-corner mb-40 w-full md:w-3/4 cursor-pointer reveal-text view-project-target" data-project="point72" onclick="openModal('point72', 'project')">
                <div class="project-img-container relative w-full h-[70vh] bg-charcoal mb-8 overflow-hidden border border-off-white/10">
                     <div class="project-img absolute inset-0 w-full h-full bg-[#0F0F0F]">
                        <canvas id="canvas-point72" class="gen-canvas"></canvas>
                    </div>
                </div>
                <div class="flex justify-between items-start border-t border-off-white/20 pt-6">
                    <div>
                        <h3 class="font-display text-4xl font-medium mb-2 group-hover:translate-x-4 transition-transform duration-500">FINANCIAL ANALYSIS PORTFOLIO</h3>
                        <p class="font-sans text-neutral-400 group-hover:translate-x-4 transition-transform duration-500 delay-75">Equity Research / Valuation Models / Sector Analysis</p>
                    </div>
                    <span class="font-mono text-xs border border-off-white/20 px-3 py-1 rounded-full group-hover:bg-off-white group-hover:text-black transition-colors">03</span>
                </div>
            </div>

            <!-- Project 4: Consulting (TaskFormer) -->
            <div class="group project-card tech-corner w-full md:w-4/5 md:ml-auto cursor-pointer reveal-text view-project-target" data-project="taskformer" onclick="openModal('taskformer', 'project')">
                <div class="project-img-container relative w-full h-[70vh] bg-charcoal mb-8 overflow-hidden border border-off-white/10">
                     <div class="project-img absolute inset-0 w-full h-full bg-[#0F0F0F]">
                        <canvas id="canvas-taskformer" class="gen-canvas"></canvas>
                    </div>
                </div>
                <div class="flex justify-between items-start border-t border-off-white/20 pt-6">
                    <div>
                        <h3 class="font-display text-4xl font-medium mb-2 group-hover:translate-x-4 transition-transform duration-500">CONSULTING PRACTICE</h3>
                        <p class="font-sans text-neutral-400 group-hover:translate-x-4 transition-transform duration-500 delay-75">Financial Strategy / M&A Advisory / Operational Excellence</p>
                    </div>
                    <span class="font-mono text-xs border border-off-white/20 px-3 py-1 rounded-full group-hover:bg-off-white group-hover:text-black transition-colors">04</span>
                </div>
            </div>

            <!-- Project 5: Austin Real Estate -->
            <div class="group project-card tech-corner w-full md:w-4/5 mr-auto cursor-pointer reveal-text view-project-target mt-32" data-project="austin_re" onclick="openModal('austin_re', 'project')">
                <div class="project-img-container relative w-full h-[70vh] bg-charcoal mb-8 overflow-hidden border border-off-white/10">
                     <div class="project-img absolute inset-0 w-full h-full bg-[#0F0F0F]">
                        <canvas id="canvas-austin" class="gen-canvas"></canvas>
                    </div>
                </div>
                <div class="flex justify-between items-start border-t border-off-white/20 pt-6">
                    <div>
                        <h3 class="font-display text-4xl font-medium mb-2 group-hover:translate-x-4 transition-transform duration-500">AUSTIN REAL ESTATE</h3>
                        <p class="font-sans text-neutral-400 group-hover:translate-x-4 transition-transform duration-500 delay-75">Macro / Demographics / Alpha</p>
                    </div>
                    <span class="font-mono text-xs border border-off-white/20 px-3 py-1 rounded-full group-hover:bg-off-white group-hover:text-black transition-colors">05</span>
                </div>
            </div>
            
            <div class="mt-32 text-center reveal-text">
                <a href="Sulayman_Bowles_Resume_2025.pdf" target="_blank" class="magnetic-wrap hover-target inline-block font-display text-lg border border-off-white/20 px-10 py-5 hover:bg-off-white hover:text-black transition-colors duration-500">
                    <span class="magnetic-content block tracking-widest uppercase">View Full Resume</span>
                    <span class="magnetic-area"></span>
                </a>
            </div>
        </div>
    </section>

    <!-- Writing / Thoughts Section -->
    <section id="section-writing" class="py-40 px-6 md:px-12 bg-off-white text-off-black relative">
        <div class="max-w-[1200px] mx-auto">
            <div class="flex flex-col md:flex-row md:items-end justify-between mb-20 reveal-text gap-8">
                <div class="flex items-center gap-4">
                    <div class="w-2 h-2 bg-off-black rounded-full animate-pulse-slow"></div>
                    <h2 class="font-mono text-xs font-bold tracking-[0.2em] uppercase text-neutral-400">Writing & Thoughts</h2>
                </div>
                
                <!-- Filter Controls -->
                <div class="flex gap-8 font-mono text-xs tracking-widest uppercase text-neutral-400" id="writing-filters">
                    <button class="filter-btn active" data-filter="all">All</button>
                    <button class="filter-btn" data-filter="consulting">Consulting</button>
                    <button class="filter-btn" data-filter="finance">Finance</button>
                    <button class="filter-btn" data-filter="engineering">Engineering</button>
                </div>
            </div>

            <div class="space-y-8 writing-list" id="writing-grid">
                
                <!-- Consulting: Wind Down -->
                <div data-category="consulting" data-writing="legacy" class="writing-item block border-b border-neutral-300 pb-8 reveal-text group cursor-none hover-target cursor-pointer" tabindex="0" role="button">
                    <div class="flex flex-col md:flex-row md:items-baseline justify-between gap-4">
                        <div class="flex items-center gap-4">
                             <i data-lucide="arrow-right" class="writing-arrow w-6 h-6 text-neutral-800"></i>
                             <h3 class="font-display text-3xl md:text-5xl font-medium group-hover:text-neutral-800">Legacy Systems & The Art of the Exit</h3>
                        </div>
                        <span class="font-mono text-xs text-neutral-400">CONSULTING</span>
                    </div>
                    <p class="mt-4 font-sans text-neutral-600 max-w-2xl pl-0 md:pl-10">Navigating the technical and operational complexities of winding down a mid-sized logistics firm. How we managed 15TB of legacy database archives, ensured regulatory compliance, and executed a graceful systematic shutdown.</p>
                </div>

                <!-- Consulting: Web3 Migration -->
                <div data-category="consulting" data-writing="web3_migration" class="writing-item block border-b border-neutral-300 pb-8 reveal-text group cursor-none hover-target cursor-pointer" tabindex="0" role="button">
                    <div class="flex flex-col md:flex-row md:items-baseline justify-between gap-4">
                        <div class="flex items-center gap-4">
                             <i data-lucide="arrow-right" class="writing-arrow w-6 h-6 text-neutral-800"></i>
                             <h3 class="font-display text-3xl md:text-5xl font-medium group-hover:text-neutral-800">Bridging the Gap: Web2 to Web3</h3>
                        </div>
                        <span class="font-mono text-xs text-neutral-400">CONSULTING</span>
                    </div>
                    <p class="mt-4 font-sans text-neutral-600 max-w-2xl pl-0 md:pl-10">A case study on helping a traditional fintech client integrate on-chain settlement layers. Overcoming custody challenges, smart contract auditing, and the cultural shift from centralized databases to distributed ledgers.</p>
                </div>

                <!-- Engineering: AI Agents -->
                <div data-category="engineering" data-writing="automating_alpha" class="writing-item block border-b border-neutral-300 pb-8 reveal-text group cursor-none hover-target cursor-pointer" tabindex="0" role="button">
                    <div class="flex flex-col md:flex-row md:items-baseline justify-between gap-4">
                        <div class="flex items-center gap-4">
                             <i data-lucide="arrow-right" class="writing-arrow w-6 h-6 text-neutral-800"></i>
                             <h3 class="font-display text-3xl md:text-5xl font-medium group-hover:text-neutral-800">Automating Alpha</h3>
                        </div>
                        <span class="font-mono text-xs text-neutral-400">ENGINEERING</span>
                    </div>
                    <p class="mt-4 font-sans text-neutral-600 max-w-2xl pl-0 md:pl-10">Building autonomous research agents that parse 10-Ks and earnings call transcripts. Using LLMs to extract structured sentiment data and detect divergence from consensus estimates.</p>
                </div>

                <!-- Finance: Convexity -->
                <div data-category="finance" data-writing="convexity" class="writing-item block border-b border-neutral-300 pb-8 reveal-text group cursor-none hover-target cursor-pointer" tabindex="0" role="button">
                    <div class="flex flex-col md:flex-row md:items-baseline justify-between gap-4">
                        <div class="flex items-center gap-4">
                             <i data-lucide="arrow-right" class="writing-arrow w-6 h-6 text-neutral-800"></i>
                             <h3 class="font-display text-3xl md:text-5xl font-medium group-hover:text-neutral-800">The Convexity Trap</h3>
                        </div>
                        <span class="font-mono text-xs text-neutral-400">FINANCE</span>
                    </div>
                    <p class="mt-4 font-sans text-neutral-600 max-w-2xl pl-0 md:pl-10">Why negative convexity in MBS portfolios destroyed hedge funds in 2022. A technical autopsy of duration extension and gamma hedging failures.</p>
                </div>

                <!-- Finance: Terminal Value -->
                <div data-category="finance" data-writing="terminal" class="writing-item block border-b border-neutral-300 pb-8 reveal-text group cursor-none hover-target cursor-pointer" tabindex="0" role="button">
                    <div class="flex flex-col md:flex-row md:items-baseline justify-between gap-4">
                        <div class="flex items-center gap-4">
                             <i data-lucide="arrow-right" class="writing-arrow w-6 h-6 text-neutral-800"></i>
                             <h3 class="font-display text-3xl md:text-5xl font-medium group-hover:text-neutral-800">Terminal Value Deconstructed</h3>
                        </div>
                        <span class="font-mono text-xs text-neutral-400">FINANCE</span>
                    </div>
                    <p class="mt-4 font-sans text-neutral-600 max-w-2xl pl-0 md:pl-10">The 80% problem in DCF models. Why perpetuity growth assumptions mask value creation and how to build defensible exit multiples.</p>
                </div>

                <!-- Engineering: Web3 Systems -->
                <div data-category="engineering" data-writing="fintech_future" class="writing-item block border-b border-neutral-300 pb-8 reveal-text group cursor-none hover-target cursor-pointer" tabindex="0" role="button">
                    <div class="flex flex-col md:flex-row md:items-baseline justify-between gap-4">
                        <div class="flex items-center gap-4">
                             <i data-lucide="arrow-right" class="writing-arrow w-6 h-6 text-neutral-800"></i>
                             <h3 class="font-display text-3xl md:text-5xl font-medium group-hover:text-neutral-800">The Future of Fintech</h3>
                        </div>
                        <span class="font-mono text-xs text-neutral-400">ENGINEERING</span>
                    </div>
                    <p class="mt-4 font-sans text-neutral-600 max-w-2xl pl-0 md:pl-10">Designing resilient financial systems on public blockchains. Exploring the intersection of zero-knowledge proofs and regulatory compliance in DeFi.</p>
                </div>

                 <!-- Finance: Variance -->
                <div data-category="finance" data-writing="variance" class="writing-item block border-b border-neutral-300 pb-8 reveal-text group cursor-none hover-target cursor-pointer" tabindex="0" role="button">
                    <div class="flex flex-col md:flex-row md:items-baseline justify-between gap-4">
                        <div class="flex items-center gap-4">
                             <i data-lucide="arrow-right" class="writing-arrow w-6 h-6 text-neutral-800"></i>
                             <h3 class="font-display text-3xl md:text-5xl font-medium group-hover:text-neutral-800">Variance Risk Premium</h3>
                        </div>
                        <span class="font-mono text-xs text-neutral-400">FINANCE</span>
                    </div>
                    <p class="mt-4 font-sans text-neutral-600 max-w-2xl pl-0 md:pl-10">Decomposing realized vs. implied volatility spreads. Statistical arbitrage strategies in VIX futures term structure and variance swap mechanics.</p>
                </div>

                <!-- Finance: Bootstrapping (NEW) -->
                <div data-category="finance" data-writing="bootstrap" class="writing-item block border-b border-neutral-300 pb-8 reveal-text group cursor-none hover-target cursor-pointer" tabindex="0" role="button">
                    <div class="flex flex-col md:flex-row md:items-baseline justify-between gap-4">
                        <div class="flex items-center gap-4">
                             <i data-lucide="arrow-right" class="writing-arrow w-6 h-6 text-neutral-800"></i>
                             <h3 class="font-display text-3xl md:text-5xl font-medium group-hover:text-neutral-800">Bootstrapping the Yield Curve</h3>
                        </div>
                        <span class="font-mono text-xs text-neutral-400">FINANCE</span>
                    </div>
                    <p class="mt-4 font-sans text-neutral-600 max-w-2xl pl-0 md:pl-10">From SOFR swaps to zero-coupon rates. The mechanics of curve construction, interpolation methods, and cross-currency basis adjustments.</p>
                </div>

                <!-- Finance: Credit (NEW) -->
                <div data-category="finance" data-writing="credit" class="writing-item block border-b border-neutral-300 pb-8 reveal-text group cursor-none hover-target cursor-pointer" tabindex="0" role="button">
                    <div class="flex flex-col md:flex-row md:items-baseline justify-between gap-4">
                        <div class="flex items-center gap-4">
                             <i data-lucide="arrow-right" class="writing-arrow w-6 h-6 text-neutral-800"></i>
                             <h3 class="font-display text-3xl md:text-5xl font-medium group-hover:text-neutral-800">Credit Spread Decomposition</h3>
                        </div>
                        <span class="font-mono text-xs text-neutral-400">FINANCE</span>
                    </div>
                    <p class="mt-4 font-sans text-neutral-600 max-w-2xl pl-0 md:pl-10">Separating default probability from recovery rates in corporate bonds. Structural models vs. reduced-form approaches in distressed debt.</p>
                </div>

                <!-- Finance: Leverage (NEW) -->
                <div data-category="finance" data-writing="leverage" class="writing-item block border-b border-neutral-300 pb-8 reveal-text group cursor-none hover-target cursor-pointer" tabindex="0" role="button">
                    <div class="flex flex-col md:flex-row md:items-baseline justify-between gap-4">
                        <div class="flex items-center gap-4">
                             <i data-lucide="arrow-right" class="writing-arrow w-6 h-6 text-neutral-800"></i>
                             <h3 class="font-display text-3xl md:text-5xl font-medium group-hover:text-neutral-800">The Leverage Ratchet</h3>
                        </div>
                        <span class="font-mono text-xs text-neutral-400">FINANCE</span>
                    </div>
                    <p class="mt-4 font-sans text-neutral-600 max-w-2xl pl-0 md:pl-10">LBO modeling beyond the template. Optimal capital structure, covenant design, and the hidden costs of financial engineering in leveraged buyouts.</p>
                </div>

            </div>
        </div>
    </section>

    <!-- Philosophy Section -->
    <section id="philosophy" class="py-40 px-6 md:px-12 bg-[#030303] relative overflow-hidden border-t border-off-white/10">
        <!-- Oscilloscope Canvas -->
        <canvas id="oscilloscope" class="absolute inset-0 w-full h-full opacity-20 pointer-events-none"></canvas>

        <div class="max-w-[1600px] mx-auto relative z-10">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-20 items-start">
                
                <!-- Left: The Narrative -->
                <div class="reveal-text">
                    <div class="flex items-center gap-4 mb-12">
                        <div class="w-2 h-2 bg-off-white rounded-full"></div>
                        <h2 class="font-mono text-xs font-bold tracking-[0.2em] uppercase text-neutral-400">The Philosophy</h2>
                    </div>
                    
                    <div class="font-display text-3xl md:text-5xl leading-[1.2] font-light space-y-12 text-neutral-300">
                        <p>
                            Whether in code, markets, or music, I search for the dissonance. I believe in the "unpleasant details"—the friction points others ignore. 
                        </p>
                        <p>
                           My work is a study in dualities: spreadsheet precision meeting startup chaos. Classical structure meeting market volatility. Pattern recognition meeting creative intuition.
                        </p>
                    </div>
                </div>

                <!-- Right: The Alchemist's Stack (Technical Manifest) -->
                <div class="reveal-text md:pt-20">
                    <div class="font-mono text-sm text-neutral-400 border-l border-off-white/20 pl-8 space-y-12">
                        
                        <!-- Stack Item 1 -->
                        <div class="group">
                            <h4 class="text-off-white mb-4 tracking-widest uppercase text-xs opacity-50 group-hover:opacity-100 transition-opacity">[ LANGUAGES ]</h4>
                            <ul class="space-y-2">
                                <li class="philosophy-item flex justify-between items-center border-b border-off-white/10 pb-2 hover:border-off-white/40 transition-all duration-300 cursor-crosshair hover:pl-4" data-bg-text="LOGIC" data-wave="sine">
                                    <span class="text-neutral-300 transition-colors duration-300 group-hover/item:text-off-white"><span class="opacity-0 group-hover/item:opacity-100 mr-2 text-off-white">></span>Python</span>
                                    <span class="text-neutral-600 font-mono text-xs">/// Data Science</span>
                                </li>
                                <li class="philosophy-item flex justify-between items-center border-b border-off-white/10 pb-2 hover:border-off-white/40 transition-all duration-300 cursor-crosshair hover:pl-4" data-bg-text="TRUST" data-wave="square">
                                    <span class="text-neutral-300 transition-colors duration-300 group-hover/item:text-off-white"><span class="opacity-0 group-hover/item:opacity-100 mr-2 text-off-white">></span>Solidity</span>
                                    <span class="text-neutral-600 font-mono text-xs">/// Smart Contracts</span>
                                </li>
                                <li class="philosophy-item flex justify-between items-center border-b border-off-white/10 pb-2 hover:border-off-white/40 transition-all duration-300 cursor-crosshair hover:pl-4" data-bg-text="SCALE" data-wave="sine">
                                    <span class="text-neutral-300 transition-colors duration-300 group-hover/item:text-off-white"><span class="opacity-0 group-hover/item:opacity-100 mr-2 text-off-white">></span>TypeScript</span>
                                    <span class="text-neutral-600 font-mono text-xs">/// Full Stack</span>
                                </li>
                            </ul>
                        </div>

                        <!-- Stack Item 2 -->
                        <div class="group">
                            <h4 class="text-off-white mb-4 tracking-widest uppercase text-xs opacity-50 group-hover:opacity-100 transition-opacity">[ DISCIPLINES ]</h4>
                            <ul class="space-y-2">
                                <li class="philosophy-item flex justify-between items-center border-b border-off-white/10 pb-2 hover:border-off-white/40 transition-all duration-300 cursor-crosshair hover:pl-4" data-bg-text="VALUE" data-wave="jagged">
                                    <span class="text-neutral-300 transition-colors duration-300 group-hover/item:text-off-white"><span class="opacity-0 group-hover/item:opacity-100 mr-2 text-off-white">></span>Financial Modeling</span>
                                    <span class="text-neutral-600 font-mono text-xs">/// Valuation</span>
                                </li>
                                <li class="philosophy-item flex justify-between items-center border-b border-off-white/10 pb-2 hover:border-off-white/40 transition-all duration-300 cursor-crosshair hover:pl-4" data-bg-text="NASH" data-wave="jagged">
                                    <span class="text-neutral-300 transition-colors duration-300 group-hover/item:text-off-white"><span class="opacity-0 group-hover/item:opacity-100 mr-2 text-off-white">></span>Game Theory</span>
                                    <span class="text-neutral-600 font-mono text-xs">/// Strategy</span>
                                </li>
                                <li class="philosophy-item flex justify-between items-center border-b border-off-white/10 pb-2 hover:border-off-white/40 transition-all duration-300 cursor-crosshair hover:pl-4" data-bg-text="FLOW" data-wave="sine">
                                    <span class="text-neutral-300 transition-colors duration-300 group-hover/item:text-off-white"><span class="opacity-0 group-hover/item:opacity-100 mr-2 text-off-white">></span>System Architecture</span>
                                    <span class="text-neutral-600 font-mono text-xs">/// Design</span>
                                </li>
                            </ul>
                        </div>

                        <!-- Stack Item 3 -->
                        <div class="group">
                            <h4 class="text-off-white mb-4 tracking-widest uppercase text-xs opacity-50 group-hover:opacity-100 transition-opacity">[ CORE ]</h4>
                            <div class="flex flex-wrap gap-3">
                                <span class="philosophy-item px-3 py-1 border border-off-white/20 text-xs text-neutral-300 hover:bg-off-white hover:text-black transition-colors cursor-crosshair" data-bg-text="CHAOS" data-wave="noise">ENTROPY</span>
                                <span class="philosophy-item px-3 py-1 border border-off-white/20 text-xs text-neutral-300 hover:bg-off-white hover:text-black transition-colors cursor-crosshair" data-bg-text="ALPHA" data-wave="jagged">CONVEXITY</span>
                                <span class="philosophy-item px-3 py-1 border border-off-white/20 text-xs text-neutral-300 hover:bg-off-white hover:text-black transition-colors cursor-crosshair" data-bg-text="VERITAS" data-wave="sine">TRUTH</span>
                            </div>
                        </div>

                    </div>
                </div>

            </div>
        </div>
        
        <!-- Background Typography -->
        <div id="philosophy-bg-text" class="absolute -bottom-[2vw] -right-[2vw] font-display font-bold text-[15vw] text-off-white pointer-events-none select-none opacity-[0.03] leading-none transition-opacity duration-300">
            TRUTH
        </div>
    </section>

    <!-- Contact Section -->
    <section id="section-contact" class="py-20 px-6 md:px-12 min-h-screen flex flex-col justify-between bg-[#030303] text-off-white border-t border-off-white/10 relative overflow-hidden" aria-labelledby="contact-heading">
        <!-- Shadow Order Book Visual -->
        <div id="order-book-visual" class="absolute top-0 right-0 w-[40%] h-full pointer-events-none z-0 mix-blend-plus-lighter opacity-30 mask-gradient-left">
            <canvas id="ob-canvas" class="w-full h-full"></canvas>
        </div>

        <!-- Subtle Grid Background for Contact -->
        <div class="absolute inset-0 pointer-events-none opacity-[0.03]" style="background-image: linear-gradient(#EAEAEA 1px, transparent 1px), linear-gradient(90deg, #EAEAEA 1px, transparent 1px); background-size: 40px 40px;"></div>
        
        <div class="max-w-[1600px] mx-auto w-full h-full flex flex-col justify-center flex-grow relative z-10">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center w-full">
                <div class="w-full md:w-1/2 reveal-text">
                    <div class="flex items-center gap-3 mb-12">
                        <span class="w-1.5 h-1.5 bg-off-white rounded-full animate-pulse"></span>
                        <span class="font-mono text-[10px] text-neutral-500 uppercase tracking-[0.2em]">Open for New Ventures</span>
                    </div>
                    
                    <div class="space-y-12">
                        <p class="font-sans text-xl md:text-2xl text-neutral-500 max-w-md leading-relaxed">
                            Have a project? Building something that requires precision? Let's discuss how strategic clarity can transform complexity into competitive advantage.
                        </p>
                        
                        <h2 id="contact-heading" onclick="this.querySelector('a').click()" class="font-display text-5xl md:text-7xl lg:text-8xl font-bold tracking-tighter hover:text-neutral-300 transition-all duration-300 cursor-pointer hover-target magnetic-wrap group inline-block">
                            <a href="mailto:sulayman.bowles@gmail.com" class="magnetic-content block underline decoration-off-white/20 decoration-1 underline-offset-8 hover:decoration-off-white/60 transition-all duration-300 relative z-10">
                                SULAYMAN.BOWLES<br>@GMAIL.COM
                            </a>
                            <span class="magnetic-area"></span>
                        </h2>

                        <!-- Calendly & Forms -->
                        <div class="flex flex-wrap gap-6 mt-8">
                            <!-- Calendly -->
                            <link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet">
                            <script src="https://assets.calendly.com/assets/external/widget.js" type="text/javascript" async></script>
                            <a href="" onclick="Calendly.initPopupWidget({url: 'https://calendly.com/sulayman-bowles/30min'});return false;" class="magnetic-wrap hover-target btn-tech inline-flex items-center gap-3 px-8 py-4 group text-off-white text-base font-medium rounded-sm backdrop-blur-sm">
                                <span class="magnetic-content inline-flex items-center gap-2">
                                    Schedule Call <i data-lucide="calendar" class="w-5 h-5"></i>
                                </span>
                                <span class="magnetic-area"></span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="max-w-[1600px] mx-auto w-full flex flex-col md:flex-row justify-between items-end md:items-center border-t border-off-white/10 pt-10 mt-20 reveal-text relative z-10" role="contentinfo">
            <div class="flex gap-8 mb-8 md:mb-0">
                <a href="https://www.linkedin.com/in/sulayman-bowles" target="_blank" rel="noopener noreferrer" class="hover-target hover-underline text-neutral-400 hover:text-off-white transition-colors uppercase text-xs tracking-widest pb-1" aria-label="Visit LinkedIn profile">LinkedIn</a>
                <a href="https://github.com/sulaymanb2024" target="_blank" rel="noopener noreferrer" class="hover-target hover-underline text-neutral-400 hover:text-off-white transition-colors uppercase text-xs tracking-widest pb-1" aria-label="Visit GitHub profile">GitHub</a>
                <a href="Sulayman_Bowles_Resume_2025.pdf" target="_blank" class="hover-target hover-underline text-neutral-400 hover:text-off-white transition-colors uppercase text-xs tracking-widest pb-1" aria-label="Download resume">Resume</a>
            </div>
            <div class="text-neutral-400 text-xs font-mono flex flex-col md:flex-row gap-4 md:gap-6 text-right md:text-left uppercase items-center">
                <div id="live-ticker" class="contents"></div>
                <time id="clock" class="tabular-nums">00:00:00 CST</time>
                <span class="hidden md:inline">&copy; <span id="year"></span> S. BOWLES</span>
            </div>
        </footer>
    </section>
    </main> <!-- End of main content -->

    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        // --- 1. DATA: PROJECT CONTENT ---
        // --- FINANCIAL PORTFOLIO LOGIC ---
        window.currentSymbol = 'NYSE:SG';
        window.widgetsPreloaded = false;
        
        // Preload TradingView widgets on modal open
        window.preloadPortfolioWidgets = function() {
            if (window.widgetsPreloaded) return;
            window.widgetsPreloaded = true;
            
            // Preload for default symbol
            setTimeout(function() {
                window.initTradingViewWidgets('NYSE:SG');
            }, 500);
        };
        
        // Company-specific data for the detail view
        window.companyData = {
            'NYSE:SG': {
                name: 'SWEETGREEN',
                ticker: 'SG',
                sector: 'RESTAURANTS',
                cap: 'SMID CAP',
                region: 'US',
                rating: 'SELL',
                target: '$18.00',
                returnPct: '-48%',
                thesis: [
                    'Infinite Kitchen capex intensity exceeds margin improvement timeline',
                    'Customer acquisition costs inflating faster than LTV growth',
                    'Same-store sales momentum decelerating beneath headline growth',
                    'Tech premium valuation for capital-intensive restaurant model',
                    'Path to profitability pushed further into future each quarter'
                ],
                catalysts: [
                    'Q4 earnings: watch for SSS deceleration confirmation',
                    'Infinite Kitchen rollout pace vs. capex burn',
                    'Labor cost trends in key urban markets',
                    'Insider selling patterns post-lockup'
                ],
                scenarios: { bear: '-65%', base: '-48%', bull: '-15%' }
            },
            'NASDAQ:SEZL': {
                name: 'SEZZLE',
                ticker: 'SEZL',
                sector: 'FINTECH / BNPL',
                cap: 'SMALL CAP',
                region: 'US',
                rating: 'SELL',
                target: '$95.00',
                returnPct: '-53%',
                thesis: [
                    'BNPL structurally challenged in rising rate environment',
                    'Merchant fee compression accelerating as competition intensifies',
                    'Credit losses inflecting higher as consumer leverage peaks',
                    'Scale disadvantages vs. Affirm/Klarna insurmountable',
                    'Regulatory overhang creates multiple compression risk'
                ],
                catalysts: [
                    'CFPB regulatory action timeline',
                    'Credit loss ratio trends in subprime cohorts',
                    'Merchant retention rates amid fee pressure',
                    'Funding cost trajectory as rates stay higher'
                ],
                scenarios: { bear: '-70%', base: '-53%', bull: '-20%' }
            },
            'NASDAQ:RIVN': {
                name: 'RIVIAN',
                ticker: 'RIVN',
                sector: 'AUTOMOTIVE / EV',
                cap: 'MID CAP',
                region: 'US',
                rating: 'BUY',
                target: '$28.00',
                returnPct: '+110%',
                thesis: [
                    'Production inflection meets gross margin expansion',
                    'R2 platform economics superior to R1 at scale',
                    'Amazon EDV contract provides stable revenue floor',
                    'Technology differentiation is real and defensible',
                    'This is Tesla 2018, not Fisker 2023'
                ],
                catalysts: [
                    'Q1 production ramp and gross margin trajectory',
                    'R2 reservation conversion rates',
                    'VW partnership operational milestones',
                    'Cash runway extension through cost discipline'
                ],
                scenarios: { bear: '+25%', base: '+110%', bull: '+180%' }
            },
            'AMEX:KULR': {
                name: 'KULR TECHNOLOGY',
                ticker: 'KULR',
                sector: 'ENERGY STORAGE',
                cap: 'MICRO CAP',
                region: 'US',
                rating: 'SELL',
                target: '$0.80',
                returnPct: '-68%',
                thesis: [
                    'NASA validation does not equal commercial viability',
                    'Thermal management IP faces commoditization risk',
                    'OEMs developing in-house solutions erodes TAM',
                    'Customer concentration risk with limited pipeline',
                    'Cash burn trajectory unsustainable at current revenue'
                ],
                catalysts: [
                    'Contract renewal rates with key customers',
                    'Cash runway and dilution risk from raises',
                    'Competitive announcements from battery OEMs',
                    'NASA contract follow-on pipeline clarity'
                ],
                scenarios: { bear: '-85%', base: '-68%', bull: '-30%' }
            }
        };
        
        window.showCompanyDetail = function(symbol) {
            window.currentSymbol = symbol;
            const dashboard = document.getElementById('portfolio-dashboard');
            const detailView = document.getElementById('company-detail-view');
            const data = window.companyData[symbol];
            
            if(dashboard && detailView && data) {
                dashboard.classList.add('hidden');
                detailView.classList.remove('hidden');
                
                // Update Header
                document.getElementById('detail-company-name').innerText = data.name;
                document.getElementById('detail-ticker').innerText = '$' + data.ticker;
                document.getElementById('detail-sector').innerText = data.sector;
                document.getElementById('detail-cap').innerText = data.cap;
                
                // Update Rating Badge
                const ratingBadge = document.getElementById('detail-rating');
                ratingBadge.innerText = data.rating;
                ratingBadge.className = 'rating-badge ' + data.rating.toLowerCase();
                
                // Update Thesis with simple styling
                const thesisList = document.getElementById('detail-thesis-list');
                thesisList.innerHTML = data.thesis.map(t => `<li>${t}</li>`).join('');
                
                // Update Catalysts with simple styling
                const catalystList = document.getElementById('detail-catalyst-list');
                catalystList.innerHTML = data.catalysts.map(c => `<li>${c}</li>`).join('');
                
                // Update Scenarios
                document.getElementById('scenario-bear').innerText = data.scenarios.bear;
                document.getElementById('scenario-base').innerText = data.scenarios.base;
                document.getElementById('scenario-bull').innerText = data.scenarios.bull;
                
                // Color scenarios with enhanced classes
                const bearEl = document.getElementById('scenario-bear');
                const baseEl = document.getElementById('scenario-base');
                const bullEl = document.getElementById('scenario-bull');
                
                bearEl.className = 'text-off-white font-display font-bold text-2xl';
                baseEl.className = 'text-off-white font-display font-bold text-2xl';
                bullEl.className = 'text-off-white font-display font-bold text-2xl';
                
                // Initialize Widgets
                window.initTradingViewWidgets(symbol);
                
                // Default Tab
                window.switchTab('overview');
                
                // Re-init Lucide icons
                if(typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }
            }
        };

        window.hideCompanyDetail = function() {
            const dashboard = document.getElementById('portfolio-dashboard');
            const detailView = document.getElementById('company-detail-view');
            
            if(dashboard && detailView) {
                detailView.classList.add('hidden');
                dashboard.classList.remove('hidden');
            }
        };

        window.switchTab = function(tabId) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
                if(btn.dataset.tab === tabId) btn.classList.add('active');
            });
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
                if(content.id === 'tab-' + tabId) content.classList.add('active');
            });
        };

        window.createWidget = function(containerId, config, scriptSrc) {
            const container = document.getElementById(containerId);
            if(!container) return;
            
            // Clear existing content
            container.innerHTML = ''; 
            
            // Create widget container
            const widgetDiv = document.createElement('div');
            widgetDiv.className = 'tradingview-widget-container';
            widgetDiv.style.height = '100%';
            widgetDiv.style.width = '100%';
            
            const innerDiv = document.createElement('div');
            innerDiv.className = 'tradingview-widget-container__widget';
            innerDiv.style.height = '100%';
            innerDiv.style.width = '100%';
            widgetDiv.appendChild(innerDiv);
            
            container.appendChild(widgetDiv);
            
            // Create and append script
            const script = document.createElement('script');
            script.type = 'text/javascript';
            script.src = scriptSrc;
            script.async = true;
            script.innerHTML = JSON.stringify(config);
            widgetDiv.appendChild(script);
        };

        window.initTradingViewWidgets = function(symbol) {
            // Small delay to ensure DOM is ready
            setTimeout(function() {
                // Overview Tab - Symbol Overview (Main Chart)
                window.createWidget('tv-overview-chart', {
                    "symbols": [[symbol]],
                    "chartOnly": false,
                    "width": "100%",
                    "height": "100%",
                    "locale": "en",
                    "colorTheme": "dark",
                    "autosize": true,
                    "showVolume": true,
                    "showMA": false,
                    "hideDateRanges": false,
                    "hideMarketStatus": false,
                    "hideSymbolLogo": false,
                    "scalePosition": "right",
                    "scaleMode": "Normal",
                    "fontFamily": "Inter, sans-serif",
                    "fontSize": "10",
                    "noTimeScale": false,
                    "valuesTracking": "1",
                    "changeMode": "price-and-percent",
                    "chartType": "area",
                    "lineWidth": 2,
                    "lineType": 0,
                    "dateRanges": ["1d|1", "1m|30", "3m|60", "12m|1D", "60m|1W", "all|1M"]
                }, 'https://s3.tradingview.com/external-embedding/embed-widget-symbol-overview.js');

                // Symbol Info (Quote Ticker)
                window.createWidget('tv-symbol-info', {
                    "symbol": symbol,
                    "width": "100%",
                    "locale": "en",
                    "colorTheme": "dark",
                    "isTransparent": true
                }, 'https://s3.tradingview.com/external-embedding/embed-widget-symbol-info.js');

                // Company Profile
                window.createWidget('tv-company-profile', {
                    "symbol": symbol,
                    "width": "100%",
                    "height": "100%",
                    "colorTheme": "dark",
                    "isTransparent": true,
                    "locale": "en"
                }, 'https://s3.tradingview.com/external-embedding/embed-widget-symbol-profile.js');

                // Financials Tab
                window.createWidget('tv-financials', {
                    "symbol": symbol,
                    "colorTheme": "dark",
                    "isTransparent": true,
                    "largeChartUrl": "",
                    "displayMode": "regular",
                    "width": "100%",
                    "height": "100%",
                    "locale": "en"
                }, 'https://s3.tradingview.com/external-embedding/embed-widget-financials.js');

                // Technicals Tab - Technical Analysis
                window.createWidget('tv-technicals', {
                    "interval": "1D",
                    "width": "100%",
                    "isTransparent": true,
                    "height": "100%",
                    "symbol": symbol,
                    "showIntervalTabs": true,
                    "displayMode": "single",
                    "locale": "en",
                    "colorTheme": "dark"
                }, 'https://s3.tradingview.com/external-embedding/embed-widget-technical-analysis.js');

                // Mini Chart / Advanced Chart
                window.createWidget('tv-mini-chart', {
                    "symbol": symbol,
                    "width": "100%",
                    "height": "100%",
                    "locale": "en",
                    "dateRange": "12M",
                    "colorTheme": "dark",
                    "isTransparent": true,
                    "autosize": true,
                    "largeChartUrl": ""
                }, 'https://s3.tradingview.com/external-embedding/embed-widget-mini-symbol-overview.js');

                // News Tab - Timeline
                window.createWidget('tv-news', {
                    "feedMode": "symbol",
                    "symbol": symbol,
                    "colorTheme": "dark",
                    "isTransparent": true,
                    "displayMode": "regular",
                    "width": "100%",
                    "height": "100%",
                    "locale": "en"
                }, 'https://s3.tradingview.com/external-embedding/embed-widget-timeline.js');

                // Economic Calendar
                window.createWidget('tv-calendar', {
                    "colorTheme": "dark",
                    "isTransparent": true,
                    "width": "100%",
                    "height": "100%",
                    "locale": "en",
                    "importanceFilter": "-1,0,1"
                }, 'https://s3.tradingview.com/external-embedding/embed-widget-events.js');

                // Peers Tab - Screener
                window.createWidget('tv-screener', {
                    "width": "100%",
                    "height": "100%",
                    "defaultColumn": "overview",
                    "defaultScreen": "general",
                    "market": "america",
                    "showToolbar": true,
                    "colorTheme": "dark",
                    "locale": "en",
                    "isTransparent": true
                }, 'https://s3.tradingview.com/external-embedding/embed-widget-screener.js');
                
                // Market Overview
                window.createWidget('tv-market', {
                    "colorTheme": "dark",
                    "dateRange": "12M",
                    "showChart": true,
                    "locale": "en",
                    "width": "100%",
                    "height": "100%",
                    "largeChartUrl": "",
                    "isTransparent": true,
                    "showSymbolLogo": true,
                    "showFloatingTooltip": false,
                    "plotLineColorGrowing": "rgba(41, 98, 255, 1)",
                    "plotLineColorFalling": "rgba(41, 98, 255, 1)",
                    "gridLineColor": "rgba(42, 46, 57, 0)",
                    "scaleFontColor": "rgba(134, 137, 147, 1)",
                    "belowLineFillColorGrowing": "rgba(41, 98, 255, 0.12)",
                    "belowLineFillColorFalling": "rgba(41, 98, 255, 0.12)",
                    "belowLineFillColorGrowingBottom": "rgba(41, 98, 255, 0)",
                    "belowLineFillColorFallingBottom": "rgba(41, 98, 255, 0)",
                    "symbolActiveColor": "rgba(41, 98, 255, 0.12)"
                }, 'https://s3.tradingview.com/external-embedding/embed-widget-market-overview.js');
            }, 100);
        };

        const projectData = {
            bittensor: {
                title: "CRYPTO RESEARCH THESES",
                subtitle: "Market Structure & Asymmetric Opportunities",
                tags: ["DeFi", "Governance", "Tokenomics", "On-Chain Data"],
                description: "A collection of high-conviction research theses focused on market inefficiencies. Leveraging on-chain data endpoints and real-time market feeds to identify mispriced assets in the DeFi and governance sectors.",
                details: `
                    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 mt-8">
                        <!-- LEFT COLUMN: THESES (8 cols) -->
                        <div class="lg:col-span-8 space-y-8">
                            
                            <!-- SYRUP -->
                            <div class="group relative bg-charcoal border border-mid-gray hover:border-off-white/30 transition-colors duration-500 overflow-hidden cursor-pointer" onclick="openModal('syrup')">
                                <div class="absolute top-0 left-0 w-1 h-full bg-off-white/50"></div>
                                <div class="p-6 md:p-8">
                                    <div class="flex justify-between items-start mb-6">
                                        <div>
                                            <div class="flex items-center gap-3 mb-2">
                                                <h3 class="font-display text-3xl text-off-white group-hover:underline decoration-1 underline-offset-4">SYRUP</h3>
                                                <span class="px-2 py-1 bg-off-white/10 text-off-white text-[10px] font-mono uppercase tracking-wider border border-off-white/20">LONG</span>
                                            </div>
                                            <p class="font-mono text-xs text-dim-gray uppercase tracking-widest">Institutional Yield // Maple Finance</p>
                                        </div>
                                        <div class="text-right">
                                            <div class="font-mono text-2xl text-off-white tracking-tight" id="price-syrup">--</div>
                                            <div class="font-mono text-xs text-neutral-400" id="change-syrup">--</div>
                                        </div>
                                    </div>
                                    
                                    <div class="prose prose-invert max-w-none mb-8">
                                        <p class="font-serif text-light-gray leading-relaxed text-lg">
                                            Syrup bridges the gap between permissioned institutional lending and permissionless DeFi yield. By wrapping Maple Finance's secured lending pools, it offers a sustainable yield that is uncorrelated to crypto volatility.
                                        </p>
                                    </div>

                                    <!-- Data Grid -->
                                    <div class="grid grid-cols-3 gap-4 border-t border-mid-gray pt-6">
                                        <div>
                                            <div class="text-[10px] font-mono text-dim-gray uppercase mb-1">TVL</div>
                                            <div class="text-sm text-off-white font-mono" id="tvl-syrup">Loading...</div>
                                            <div class="w-full h-1 bg-mid-gray mt-2"><div class="h-full bg-off-white w-[75%]"></div></div>
                                        </div>
                                        <div>
                                            <div class="text-[10px] font-mono text-dim-gray uppercase mb-1">APY</div>
                                            <div class="text-sm text-off-white font-mono" id="apy-syrup">Loading...</div>
                                            <div class="w-full h-1 bg-mid-gray mt-2"><div class="h-full bg-off-white w-[90%]"></div></div>
                                        </div>
                                        <div>
                                            <div class="text-[10px] font-mono text-dim-gray uppercase mb-1">FDV</div>
                                            <div class="text-sm text-off-white font-mono" id="fdv-syrup">Loading...</div>
                                            <div class="w-full h-1 bg-mid-gray mt-2"><div class="h-full bg-off-white/40 w-[88%]"></div></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- METADAO -->
                            <div class="group relative bg-charcoal border border-mid-gray hover:border-off-white/30 transition-colors duration-500 overflow-hidden cursor-pointer" onclick="openModal('metadao')">
                                <div class="absolute top-0 left-0 w-1 h-full bg-off-white/50"></div>
                                <div class="p-6 md:p-8">
                                    <div class="flex justify-between items-start mb-6">
                                        <div>
                                            <div class="flex items-center gap-3 mb-2">
                                                <h3 class="font-display text-3xl text-off-white group-hover:underline decoration-1 underline-offset-4">MetaDAO</h3>
                                                <span class="px-2 py-1 bg-off-white/10 text-off-white text-[10px] font-mono uppercase tracking-wider border border-off-white/20">LONG</span>
                                            </div>
                                            <p class="font-mono text-xs text-dim-gray uppercase tracking-widest">Governance Arb // Treasury Value</p>
                                        </div>
                                        <div class="text-right">
                                            <div class="font-mono text-2xl text-off-white tracking-tight" id="price-metdao">--</div>
                                            <div class="font-mono text-xs text-neutral-400" id="change-metdao">--</div>
                                        </div>
                                    </div>
                                    
                                    <div class="prose prose-invert max-w-none mb-8">
                                        <p class="font-serif text-light-gray leading-relaxed text-lg">
                                            Trading at a discount to NAV. The proposal to enable treasury buybacks creates a mathematical floor price, offering an asymmetric risk/reward profile.
                                        </p>
                                    </div>

                                    <!-- Data Grid -->
                                    <div class="grid grid-cols-3 gap-4 border-t border-mid-gray pt-6">
                                        <div>
                                            <div class="text-[10px] font-mono text-dim-gray uppercase mb-1">Liquidity</div>
                                            <div class="text-sm text-off-white font-mono" id="liquidity-metdao">Loading...</div>
                                            <div class="w-full h-1 bg-mid-gray mt-2"><div class="h-full bg-off-white w-[35%]"></div></div>
                                        </div>
                                        <div>
                                            <div class="text-[10px] font-mono text-dim-gray uppercase mb-1">FDV</div>
                                            <div class="text-sm text-off-white font-mono" id="fdv-metdao">Loading...</div>
                                            <div class="w-full h-1 bg-mid-gray mt-2"><div class="h-full bg-off-white/40 w-[60%]"></div></div>
                                        </div>
                                        <div>
                                            <div class="text-[10px] font-mono text-dim-gray uppercase mb-1">Volume (24h)</div>
                                            <div class="text-sm text-off-white font-mono" id="volume-metdao">Loading...</div>
                                            <div class="w-full h-1 bg-mid-gray mt-2"><div class="h-full bg-off-white w-[100%] animate-pulse"></div></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- MYX -->
                            <div class="group relative bg-charcoal border border-mid-gray hover:border-off-white/30 transition-colors duration-500 overflow-hidden cursor-pointer" onclick="openModal('myx')">
                                <div class="absolute top-0 left-0 w-1 h-full bg-off-white/50"></div>
                                <div class="p-6 md:p-8">
                                    <div class="flex justify-between items-start mb-6">
                                        <div>
                                            <div class="flex items-center gap-3 mb-2">
                                                <h3 class="font-display text-3xl text-off-white group-hover:underline decoration-1 underline-offset-4">MYX</h3>
                                                <span class="px-2 py-1 bg-off-white/10 text-off-white text-[10px] font-mono uppercase tracking-wider border border-off-white/20">SHORT</span>
                                            </div>
                                            <p class="font-mono text-xs text-dim-gray uppercase tracking-widest">Perp DEX // Inflationary</p>
                                        </div>
                                        <div class="text-right">
                                            <div class="font-mono text-2xl text-off-white tracking-tight" id="price-myx">--</div>
                                            <div class="font-mono text-xs text-neutral-400" id="change-myx">--</div>
                                        </div>
                                    </div>
                                    
                                    <div class="prose prose-invert max-w-none mb-8">
                                        <p class="font-serif text-light-gray leading-relaxed text-lg">
                                            Aggressive token unlocks coincide with stagnating volume. Competitors are capturing market share while MYX's FDV/Revenue ratio remains high.
                                        </p>
                                    </div>

                                    <!-- Data Grid -->
                                    <div class="grid grid-cols-3 gap-4 border-t border-mid-gray pt-6">
                                        <div>
                                            <div class="text-[10px] font-mono text-dim-gray uppercase mb-1">FDV</div>
                                            <div class="text-sm text-off-white font-mono" id="fdv-myx">Loading...</div>
                                            <div class="w-full h-1 bg-mid-gray mt-2"><div class="h-full bg-off-white w-[95%]"></div></div>
                                        </div>
                                        <div>
                                            <div class="text-[10px] font-mono text-dim-gray uppercase mb-1">Volume (24h)</div>
                                            <div class="text-sm text-off-white font-mono" id="volume-myx">Loading...</div>
                                            <div class="w-full h-1 bg-mid-gray mt-2"><div class="h-full bg-off-white/20 w-[10%]"></div></div>
                                        </div>
                                        <div>
                                            <div class="text-[10px] font-mono text-dim-gray uppercase mb-1">Liquidity</div>
                                            <div class="text-sm text-off-white font-mono" id="liquidity-myx">Loading...</div>
                                            <div class="w-full h-1 bg-mid-gray mt-2"><div class="h-full bg-off-white/40 w-[100%]"></div></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <!-- RIGHT COLUMN: TERMINAL & INFO (4 cols) -->
                        <div class="lg:col-span-4 space-y-8">
                            
                            <!-- Live Terminal -->
                            <div class="border border-mid-gray bg-off-black font-mono text-xs h-[400px] flex flex-col">
                                <div class="flex items-center justify-between px-4 py-3 border-b border-mid-gray bg-charcoal">
                                    <div class="flex items-center gap-2">
                                        <div class="w-2 h-2 rounded-full bg-off-white animate-pulse"></div>
                                        <span class="text-light-gray">RESEARCH_NODE_v1</span>
                                    </div>
                                    <span class="text-dim-gray">LIVE</span>
                                </div>
                                <div class="p-4 overflow-y-auto flex-grow space-y-2" id="crypto-terminal-log">
                                    <div class="text-dim-gray">Initializing stream...</div>
                                </div>

                                <div class="p-2 border-t border-white/10 bg-neutral-900/30">
                                    <div class="flex gap-2 text-neutral-500">
                                        <span>></span>
                                        <span class="animate-pulse">_</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Portfolio Stats -->
                            <div class="border border-white/10 bg-neutral-900/20 p-6 hover:border-off-white/30 transition-colors duration-300 group">
                                <h4 class="font-mono text-xs text-neutral-500 uppercase tracking-widest mb-6 group-hover:text-neutral-400 transition-colors">Portfolio Exposure</h4>
                                
                                <div class="space-y-6">
                                    <div>
                                        <div class="flex justify-between text-xs font-mono mb-2">
                                            <span class="text-neutral-300">LONG EXPOSURE</span>
                                            <span class="text-off-white">65%</span>
                                        </div>
                                        <div class="w-full h-1 bg-white/10">
                                            <div class="h-full bg-off-white w-[65%]"></div>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <div class="flex justify-between text-xs font-mono mb-2">
                                            <span class="text-neutral-300">SHORT EXPOSURE</span>
                                            <span class="text-off-white">35%</span>
                                        </div>
                                        <div class="w-full h-1 bg-white/10">
                                            <div class="h-full bg-neutral-500 w-[35%]"></div>
                                        </div>
                                    </div>

                                    <div class="pt-4 border-t border-white/5">
                                        <div class="flex justify-between items-center">
                                            <span class="text-xs font-mono text-neutral-500">NET DELTA</span>
                                            <span class="text-sm font-mono text-off-white">BETA NEUTRAL</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                `
            },
            syrup: {
                title: "SYRUP",
                subtitle: "Institutional Yield // Maple Finance",
                tags: ["DeFi", "Yield", "Institutional", "Lending"],
                contract: "0x643C4E15d7d62Ad0aBeC4a9BD4b001aA3Ef52d66",
                links: { website: "https://syrup.fi", x: "https://x.com/SyrupFi" },
                description: "Syrup bridges the gap between permissioned institutional lending and permissionless DeFi yield. By wrapping Maple Finance's secured lending pools, it offers a sustainable yield that is uncorrelated to crypto volatility.",
                details: `
                    <div class="space-y-16 mt-12">
                        <!-- Chart Section -->
                        <div class="h-[500px] w-full bg-charcoal border border-mid-gray relative overflow-hidden modal-stagger" style="transition-delay: 0.4s">
                            <!-- Chart Container -->
                            <div id="tv-chart-syrup" style="height:100%;width:100%"></div>
                        </div>

                        <!-- Deep Dive Metrics -->
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-px bg-mid-gray border border-mid-gray modal-stagger" style="transition-delay: 0.5s">
                            <div class="p-6 bg-charcoal hover:bg-[#151515] transition-colors duration-300 group">
                                <div class="text-[10px] font-mono text-dim-gray uppercase tracking-widest mb-2 group-hover:text-neutral-400 transition-colors">TVL</div>
                                <div class="text-2xl font-mono text-off-white" id="detail-tvl-syrup">--</div>
                            </div>
                            <div class="p-6 bg-charcoal hover:bg-[#151515] transition-colors duration-300 group">
                                <div class="text-[10px] font-mono text-dim-gray uppercase tracking-widest mb-2 group-hover:text-neutral-400 transition-colors">APY</div>
                                <div class="text-2xl font-mono text-off-white" id="detail-apy-syrup">--</div>
                            </div>
                            <div class="p-6 bg-charcoal hover:bg-[#151515] transition-colors duration-300 group">
                                <div class="text-[10px] font-mono text-dim-gray uppercase tracking-widest mb-2 group-hover:text-neutral-400 transition-colors">FDV</div>
                                <div class="text-2xl font-mono text-off-white" id="detail-fdv-syrup">--</div>
                            </div>
                            <div class="p-6 bg-charcoal hover:bg-[#151515] transition-colors duration-300 group">
                                <div class="text-[10px] font-mono text-dim-gray uppercase tracking-widest mb-2 group-hover:text-neutral-400 transition-colors">Risk Score</div>
                                <div class="flex items-center gap-2">
                                    <div class="text-2xl font-mono text-off-white">LOW</div>
                                    <div class="flex gap-1 h-2">
                                        <div class="w-2 bg-green-500 rounded-sm"></div>
                                        <div class="w-2 bg-green-500/30 rounded-sm"></div>
                                        <div class="w-2 bg-green-500/30 rounded-sm"></div>
                                        <div class="w-2 bg-green-500/30 rounded-sm"></div>
                                        <div class="w-2 bg-green-500/30 rounded-sm"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Thesis Content -->
                        <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 modal-stagger" style="transition-delay: 0.6s">
                            <!-- Main Analysis -->
                            <div class="lg:col-span-8 space-y-16">
                                <section>
                                    <h3 class="font-display text-3xl text-off-white mb-6">The Convergence of TradFi and DeFi</h3>
                                    <div class="prose prose-invert max-w-none">
                                        <p class="font-serif text-light-gray leading-relaxed text-lg">
                                            Syrup represents a critical infrastructure layer for the maturation of DeFi, bridging the gap between permissioned institutional lending and permissionless yield. Unlike inflationary yield farming, Syrup's yield is derived from real-world lending activity to institutional borrowers. This creates a "real yield" narrative that becomes increasingly attractive as risk-free rates in TradFi begin to compress.
                                        </p>
                                        <p class="font-serif text-light-gray leading-relaxed text-lg mt-4">
                                            The protocol's architecture allows for permissionless deposits while maintaining strict KYC/AML compliance on the borrower side, effectively solving the "identity gap" that has historically prevented large-scale capital migration on-chain. By wrapping Maple Finance's secured lending pools, Syrup offers a product that is both compliant for institutions and accessible for retail.
                                        </p>
                                    </div>
                                </section>

                                <section>
                                    <h3 class="font-display text-3xl text-off-white mb-6">Sustainable Yield Mechanics</h3>
                                    <div class="prose prose-invert max-w-none">
                                        <p class="font-serif text-light-gray leading-relaxed text-lg">
                                            The yield generated by Syrup is not a function of token emissions but rather interest paid by borrowers. These borrowers are typically market makers (e.g., Wintermute, Auros) or crypto-native funds who require working capital. This creates a sustainable economic loop where yield is backed by actual cash flow rather than speculative token printing.
                                        </p>
                                        <p class="font-serif text-light-gray leading-relaxed text-lg mt-4">
                                            Because the loans are short-term and over-collateralized, the yield is highly responsive to market demand for leverage. In a bull market, as demand for borrowing increases, Syrup's APY naturally rises, creating a perfect hedge against the "risk-on" rotation where stablecoin yields typically lag. This dynamic makes Syrup a unique portfolio component that performs well in both high-volatility and sideways markets.
                                        </p>
                                    </div>
                                </section>

                                <section>
                                    <h3 class="font-display text-3xl text-off-white mb-6">Market Structure & Correlation</h3>
                                    <div class="prose prose-invert max-w-none">
                                        <p class="font-serif text-light-gray leading-relaxed text-lg">
                                            Current market structure suggests a rotation from high-beta altcoins into sustainable yield products. Syrup's correlation to ETH is currently 0.12, making it an ideal portfolio hedge. The token acts as a proxy for the health of the institutional crypto credit market, which is currently in a recovery phase following the deleveraging events of the previous cycle.
                                        </p>
                                        <ul class="list-disc pl-5 mt-4 space-y-2 text-light-gray font-serif">
                                            <li><strong>Supply Dynamics:</strong> 85% of supply is locked in governance or lending pools, creating a supply shock scenario as demand increases.</li>
                                            <li><strong>Demand Drivers:</strong> Integration with Base and Solana will open access to retail users previously priced out by ETH gas fees, significantly expanding the Total Addressable Market (TAM).</li>
                                        </ul>
                                    </div>
                                </section>

                                <section>
                                    <h3 class="font-display text-3xl text-off-white mb-6">Competitive Moat & The 'Drip'</h3>
                                    <div class="prose prose-invert max-w-none">
                                        <p class="font-serif text-light-gray leading-relaxed text-lg">
                                            While other RWA (Real World Asset) protocols exist, Syrup benefits from Maple Finance's established reputation and 3-year track record. The "Drip" mechanism, which allows for instant liquidity on deposits (unlike the lock-up periods of competitors), is a significant UX improvement that positions Syrup as a superior "savings account" for on-chain capital.
                                        </p>
                                        <p class="font-serif text-light-gray leading-relaxed text-lg mt-4">
                                            This instant liquidity feature is powered by a buffer pool and algorithmic rebalancing, a technical moat that is difficult for newer competitors to replicate without significant capital inefficiency. This positions Syrup to capture the majority of the "lazy capital" seeking yield on-chain.
                                        </p>
                                    </div>
                                </section>

                                <section>
                                    <h3 class="font-display text-3xl text-off-white mb-6">Risk Stratification</h3>
                                    <div class="prose prose-invert max-w-none">
                                        <p class="font-serif text-light-gray leading-relaxed text-lg">
                                            The primary risk in Syrup is not code, but credit. If a borrower defaults, the pool takes a loss. However, Syrup mitigates this through a multi-tranche structure where "First Loss Capital" provided by pool delegates absorbs the initial impact of any default. This aligns the incentives of the underwriters with the depositors.
                                        </p>
                                        <p class="font-serif text-light-gray leading-relaxed text-lg mt-4">
                                            From a smart contract perspective, the protocol has undergone audits from Spearbit and Cantina. The codebase is relatively lean, reducing the surface area for exploits compared to more complex DeFi primitives. The protocol also maintains an active bug bounty program, further hardening its security posture.
                                        </p>
                                    </div>
                                </section>
                            </div>

                            <!-- Sidebar Info -->
                            <div class="lg:col-span-4 space-y-8">
                                <div class="bg-neutral-900/30 border border-mid-gray p-6">
                                    <h4 class="font-mono text-xs text-dim-gray uppercase tracking-widest mb-4">Key Catalysts</h4>
                                    <ul class="space-y-2">
                                        <li class="flex gap-3 items-start hover:bg-white/5 p-2 -mx-2 rounded transition-colors cursor-default group">
                                            <span class="text-off-white font-mono text-xs mt-1 group-hover:text-white transition-colors">01</span>
                                            <p class="text-sm text-neutral-400 group-hover:text-neutral-300 transition-colors">Expansion to Base and Solana chains (Q1 2026)</p>
                                        </li>
                                        <li class="flex gap-3 items-start hover:bg-white/5 p-2 -mx-2 rounded transition-colors cursor-default group">
                                            <span class="text-off-white font-mono text-xs mt-1 group-hover:text-white transition-colors">02</span>
                                            <p class="text-sm text-neutral-400 group-hover:text-neutral-300 transition-colors">Launch of "Syrup Pro" for institutional allocators</p>
                                        </li>
                                        <li class="flex gap-3 items-start hover:bg-white/5 p-2 -mx-2 rounded transition-colors cursor-default group">
                                            <span class="text-off-white font-mono text-xs mt-1 group-hover:text-white transition-colors">03</span>
                                            <p class="text-sm text-neutral-400 group-hover:text-neutral-300 transition-colors">Potential "Fee Switch" activation for token holders</p>
                                        </li>
                                    </ul>
                                </div>

                                <div class="bg-neutral-900/30 border border-mid-gray p-6">
                                    <h4 class="font-mono text-xs text-dim-gray uppercase tracking-widest mb-4">Risk Factors</h4>
                                    <ul class="space-y-2">
                                        <li class="flex gap-3 items-start hover:bg-white/5 p-2 -mx-2 rounded transition-colors cursor-default group">
                                            <span class="text-neutral-500 font-mono text-xs mt-1 group-hover:text-red-400 transition-colors">!!</span>
                                            <p class="text-sm text-neutral-400 group-hover:text-neutral-300 transition-colors">Borrower default risk (mitigated by pool delegates)</p>
                                        </li>
                                        <li class="flex gap-3 items-start hover:bg-white/5 p-2 -mx-2 rounded transition-colors cursor-default group">
                                            <span class="text-neutral-500 font-mono text-xs mt-1 group-hover:text-red-400 transition-colors">!!</span>
                                            <p class="text-sm text-neutral-400 group-hover:text-neutral-300 transition-colors">Smart contract risk in new chain deployments</p>
                                        </li>
                                        <li class="flex gap-3 items-start hover:bg-white/5 p-2 -mx-2 rounded transition-colors cursor-default group">
                                            <span class="text-neutral-500 font-mono text-xs mt-1 group-hover:text-red-400 transition-colors">!!</span>
                                            <p class="text-sm text-neutral-400 group-hover:text-neutral-300 transition-colors">Regulatory uncertainty regarding "securities" classification</p>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            },
            metadao: {
                title: "MetaDAO",
                subtitle: "Governance Arb // Treasury Value",
                tags: ["DeFi", "Governance", "Futarchy", "Solana"],
                contract: "METAwkXcqyXKy1AtsSgJ8JiUHwGCafnZL38n3vYmeta",
                links: { website: "https://www.metadao.fi", x: "https://x.com/MetaDAOProject" },
                description: "MetaDAO is pioneering 'Futarchy', a governance model where markets decide policy. The current thesis is based on a significant discount to Net Asset Value (NAV) and upcoming proposals to unlock treasury value.",
                details: `
                    <div class="space-y-16 mt-12">
                        <!-- Chart Section -->
                        <div class="h-[500px] w-full bg-charcoal border border-mid-gray relative overflow-hidden modal-stagger" style="transition-delay: 0.4s">
                            <!-- Chart Container -->
                            <div id="tv-chart-metadao" style="height:100%;width:100%"></div>
                        </div>

                        <!-- Deep Dive Metrics -->
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-px bg-mid-gray border border-mid-gray modal-stagger" style="transition-delay: 0.5s">
                            <div class="p-6 bg-charcoal hover:bg-[#151515] transition-colors duration-300 group">
                                <div class="text-[10px] font-mono text-dim-gray uppercase tracking-widest mb-2 group-hover:text-neutral-400 transition-colors">Liquidity</div>
                                <div class="text-2xl font-mono text-off-white" id="detail-liquidity-metadao">--</div>
                            </div>
                            <div class="p-6 bg-charcoal hover:bg-[#151515] transition-colors duration-300 group">
                                <div class="text-[10px] font-mono text-dim-gray uppercase tracking-widest mb-2 group-hover:text-neutral-400 transition-colors">Volume</div>
                                <div class="text-2xl font-mono text-off-white" id="detail-volume-metadao">--</div>
                            </div>
                            <div class="p-6 bg-charcoal hover:bg-[#151515] transition-colors duration-300 group">
                                <div class="text-[10px] font-mono text-dim-gray uppercase tracking-widest mb-2 group-hover:text-neutral-400 transition-colors">FDV</div>
                                <div class="text-2xl font-mono text-off-white" id="detail-fdv-metadao">--</div>
                            </div>
                            <div class="p-6 bg-charcoal hover:bg-[#151515] transition-colors duration-300 group">
                                <div class="text-[10px] font-mono text-dim-gray uppercase tracking-widest mb-2 group-hover:text-neutral-400 transition-colors">NAV Discount</div>
                                <div class="flex items-center gap-2">
                                    <div class="text-2xl font-mono text-off-white">35%</div>
                                    <div class="flex gap-1 h-2">
                                        <div class="w-2 bg-yellow-500 rounded-sm"></div>
                                        <div class="w-2 bg-yellow-500 rounded-sm"></div>
                                        <div class="w-2 bg-yellow-500/30 rounded-sm"></div>
                                        <div class="w-2 bg-yellow-500/30 rounded-sm"></div>
                                        <div class="w-2 bg-yellow-500/30 rounded-sm"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Thesis Content -->
                        <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 modal-stagger" style="transition-delay: 0.6s">
                            <!-- Main Analysis -->
                            <div class="lg:col-span-8 space-y-16">
                                <section>
                                    <h3 class="font-display text-3xl text-off-white mb-6">Futarchy: Replacing Politics with Markets</h3>
                                    <div class="prose prose-invert max-w-none">
                                        <p class="font-serif text-light-gray leading-relaxed text-lg">
                                            MetaDAO replaces political voting with market speculation, a concept known as "Futarchy". Proposals are passed only if the market predicts they will increase the token's value. This aligns incentives perfectly but is currently misunderstood by the broader market, leading to a mispricing of the governance token relative to its treasury assets.
                                        </p>
                                        <p class="font-serif text-light-gray leading-relaxed text-lg mt-4">
                                            The "Futarchy" model is gaining traction as DAOs struggle with voter apathy and bad decision-making. MetaDAO is the first working implementation on Solana, positioning it as the standard-bearer for this new governance paradigm. By forcing participants to "put their money where their mouth is," MetaDAO filters out noise and ensures that only value-accretive decisions are made.
                                        </p>
                                    </div>
                                </section>

                                <section>
                                    <h3 class="font-display text-3xl text-off-white mb-6">Mechanism Design: Conditional Markets</h3>
                                    <div class="prose prose-invert max-w-none">
                                        <p class="font-serif text-light-gray leading-relaxed text-lg">
                                            In MetaDAO, every proposal creates two conditional markets: "Pass" and "Fail". Traders speculate on the future price of the META token in both scenarios. If the Time-Weighted Average Price (TWAP) of the "Pass" market is higher than the "Fail" market after a set period, the proposal executes automatically.
                                        </p>
                                        <p class="font-serif text-light-gray leading-relaxed text-lg mt-4">
                                            This mechanism eliminates the "principal-agent problem" inherent in representative governance. There are no politicians to bribe; you must put capital at risk to influence the outcome. This creates a Darwinian governance structure where the most accurate predictors of value are rewarded, and poor predictors are taxed by the market.
                                        </p>
                                    </div>
                                </section>

                                <section>
                                    <h3 class="font-display text-3xl text-off-white mb-6">Deep Value: The NAV Discount Thesis</h3>
                                    <div class="prose prose-invert max-w-none">
                                        <p class="font-serif text-light-gray leading-relaxed text-lg">
                                            The DAO treasury holds significant assets in USDC and SOL. At current prices, META is trading at a 35% discount to the book value of these assets. This is a classic "Benjamin Graham" value play in a sector dominated by meme coins. The market is effectively pricing the governance layer as a liability rather than an asset.
                                        </p>
                                        <p class="font-serif text-light-gray leading-relaxed text-lg mt-4">
                                            Proposal MIP-12 aims to utilize a portion of this treasury to buy back META tokens if the price remains below NAV for 30 days. This creates a "soft floor" for the price and an asymmetric upside opportunity. If passed, this mechanism would mechanically close the valuation gap, providing a clear catalyst for price appreciation.
                                        </p>
                                    </div>
                                </section>

                                <section>
                                    <h3 class="font-display text-3xl text-off-white mb-6">Security Model: Mitigating Manipulation</h3>
                                    <div class="prose prose-invert max-w-none">
                                        <p class="font-serif text-light-gray leading-relaxed text-lg">
                                            Critics of Futarchy often point to market manipulation as a potential attack vector. A wealthy attacker could theoretically short the "Pass" market to tank a proposal. However, in doing so, they would be selling the token at a discount to rational buyers who see the proposal's value. This creates a "subsidy" for honest actors.
                                        </p>
                                        <p class="font-serif text-light-gray leading-relaxed text-lg mt-4">
                                            MetaDAO's implementation uses a Time-Weighted Average Price (TWAP) over several days to make such attacks prohibitively expensive. The cost to manipulate the market for a sustained period would likely exceed the potential gain from sabotaging the proposal. Furthermore, the open nature of the order book allows for "white knight" arbitrageurs to counter-trade any manipulation attempts.
                                        </p>
                                    </div>
                                </section>
                            </div>

                            <!-- Sidebar Info -->
                            <div class="lg:col-span-4 space-y-8">
                                <div class="bg-neutral-900/30 border border-mid-gray p-6">
                                    <h4 class="font-mono text-xs text-dim-gray uppercase tracking-widest mb-4">Key Catalysts</h4>
                                    <ul class="space-y-2">
                                        <li class="flex gap-3 items-start hover:bg-white/5 p-2 -mx-2 rounded transition-colors cursor-default group">
                                            <span class="text-off-white font-mono text-xs mt-1 group-hover:text-white transition-colors">01</span>
                                            <p class="text-sm text-neutral-400 group-hover:text-neutral-300 transition-colors">MIP-12 Proposal: Treasury buyback activation</p>
                                        </li>
                                        <li class="flex gap-3 items-start hover:bg-white/5 p-2 -mx-2 rounded transition-colors cursor-default group">
                                            <span class="text-off-white font-mono text-xs mt-1 group-hover:text-white transition-colors">02</span>
                                            <p class="text-sm text-neutral-400 group-hover:text-neutral-300 transition-colors">Integration with major Solana lending protocols</p>
                                        </li>
                                        <li class="flex gap-3 items-start hover:bg-white/5 p-2 -mx-2 rounded transition-colors cursor-default group">
                                            <span class="text-off-white font-mono text-xs mt-1 group-hover:text-white transition-colors">03</span>
                                            <p class="text-sm text-neutral-400 group-hover:text-neutral-300 transition-colors">Launch of V2 Conditional Markets (lower friction)</p>
                                        </li>
                                    </ul>
                                </div>

                                <div class="bg-neutral-900/30 border border-mid-gray p-6">
                                    <h4 class="font-mono text-xs text-dim-gray uppercase tracking-widest mb-4">Risk Factors</h4>
                                    <ul class="space-y-2">
                                        <li class="flex gap-3 items-start hover:bg-white/5 p-2 -mx-2 rounded transition-colors cursor-default group">
                                            <span class="text-neutral-500 font-mono text-xs mt-1 group-hover:text-red-400 transition-colors">!!</span>
                                            <p class="text-sm text-neutral-400 group-hover:text-neutral-300 transition-colors">Low liquidity on Solana DEXs</p>
                                        </li>
                                        <li class="flex gap-3 items-start hover:bg-white/5 p-2 -mx-2 rounded transition-colors cursor-default group">
                                            <span class="text-neutral-500 font-mono text-xs mt-1 group-hover:text-red-400 transition-colors">!!</span>
                                            <p class="text-sm text-neutral-400 group-hover:text-neutral-300 transition-colors">Complexity of Futarchy mechanism may deter retail</p>
                                        </li>
                                        <li class="flex gap-3 items-start hover:bg-white/5 p-2 -mx-2 rounded transition-colors cursor-default group">
                                            <span class="text-neutral-500 font-mono text-xs mt-1 group-hover:text-red-400 transition-colors">!!</span>
                                            <p class="text-sm text-neutral-400 group-hover:text-neutral-300 transition-colors">Oracle manipulation risks in conditional markets</p>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            },
            myx: {
                title: "MYX",
                subtitle: "Perp DEX // Inflationary",
                tags: ["DeFi", "Perps", "Short", "BSC"],
                contract: "0xD82544bf0dfe8385eF8FA34D67e6e4940CC63e16",
                links: { website: "https://myx.finance", x: "https://x.com/MYX_Finance" },
                description: "MYX is a perpetual DEX facing significant headwinds. A combination of aggressive token unlocks and stagnating volume growth presents a compelling short opportunity.",
                details: `
                    <div class="space-y-16 mt-12">
                        <!-- Chart Section -->
                        <div class="h-[500px] w-full bg-charcoal border border-mid-gray relative overflow-hidden modal-stagger" style="transition-delay: 0.4s">
                            <!-- Chart Container -->
                            <div id="tv-chart-myx" style="height:100%;width:100%"></div>
                        </div>

                        <!-- Deep Dive Metrics -->
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-px bg-mid-gray border border-mid-gray modal-stagger" style="transition-delay: 0.5s">
                            <div class="p-6 bg-charcoal hover:bg-[#151515] transition-colors duration-300 group">
                                <div class="text-[10px] font-mono text-dim-gray uppercase tracking-widest mb-2 group-hover:text-neutral-400 transition-colors">Liquidity</div>
                                <div class="text-2xl font-mono text-off-white" id="detail-liquidity-myx">--</div>
                            </div>
                            <div class="p-6 bg-charcoal hover:bg-[#151515] transition-colors duration-300 group">
                                <div class="text-[10px] font-mono text-dim-gray uppercase tracking-widest mb-2 group-hover:text-neutral-400 transition-colors">Volume</div>
                                <div class="text-2xl font-mono text-off-white" id="detail-volume-myx">--</div>
                            </div>
                            <div class="p-6 bg-charcoal hover:bg-[#151515] transition-colors duration-300 group">
                                <div class="text-[10px] font-mono text-dim-gray uppercase tracking-widest mb-2 group-hover:text-neutral-400 transition-colors">FDV</div>
                                <div class="text-2xl font-mono text-off-white" id="detail-fdv-myx">--</div>
                            </div>
                            <div class="p-6 bg-charcoal hover:bg-[#151515] transition-colors duration-300 group">
                                <div class="text-[10px] font-mono text-dim-gray uppercase tracking-widest mb-2 group-hover:text-neutral-400 transition-colors">Inflation Rate</div>
                                <div class="flex items-center gap-2">
                                    <div class="text-2xl font-mono text-off-white">HIGH</div>
                                    <div class="flex gap-1 h-2">
                                        <div class="w-2 bg-red-500 rounded-sm"></div>
                                        <div class="w-2 bg-red-500 rounded-sm"></div>
                                        <div class="w-2 bg-red-500 rounded-sm"></div>
                                        <div class="w-2 bg-red-500 rounded-sm"></div>
                                        <div class="w-2 bg-red-500/30 rounded-sm"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Thesis Content -->
                        <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 modal-stagger" style="transition-delay: 0.6s">
                            <!-- Main Analysis -->
                            <div class="lg:col-span-8 space-y-16">
                                <section>
                                    <h3 class="font-display text-3xl text-off-white mb-6">The Great Unlock: A Supply Shock Event</h3>
                                    <div class="prose prose-invert max-w-none">
                                        <p class="font-serif text-light-gray leading-relaxed text-lg">
                                            The fundamental thesis for shorting MYX is anchored in an impending supply shock. On January 15th, the protocol is scheduled to unlock 12% of its total supply—approximately 15 million tokens—to early venture capital investors and the founding team. This represents a 40% increase in the current circulating supply overnight.
                                        </p>
                                        <p class="font-serif text-light-gray leading-relaxed text-lg mt-4">
                                            Historically, "cliff unlocks" of this magnitude act as a massive dampener on price action. Early investors, sitting on paper gains from seed rounds priced significantly lower than the current market value, have a strong incentive to realize liquidity. The market is currently front-running this event, but the sheer volume of tokens hitting the order books is likely to overwhelm existing buy-side liquidity.
                                        </p>
                                    </div>
                                </section>

                                <section>
                                    <h3 class="font-display text-3xl text-off-white mb-6">Broken Tokenomics: The Inflationary Spiral</h3>
                                    <div class="prose prose-invert max-w-none">
                                        <p class="font-serif text-light-gray leading-relaxed text-lg">
                                            MYX utilizes a "Vote Escrow" (ve) model similar to Curve, but it lacks the critical bribe revenue ecosystem that makes the Curve model sustainable. The protocol is currently emitting 450,000 MYX per week to incentivize liquidity providers. This aggressive emission schedule is diluting existing holders at an annualized rate of over 22%.
                                        </p>
                                        <p class="font-serif text-light-gray leading-relaxed text-lg mt-4">
                                            With trading fees declining by 15% month-over-month, the "Real Yield" paid to stakers is compressing rapidly. This creates a negative feedback loop: Price drops -> Staking Yield drops -> Stakers unlock and sell -> Price drops further. We are witnessing the early stages of this "death spiral" as the total value locked (TVL) in the staking contract begins to bleed.
                                        </p>
                                    </div>
                                </section>

                                <section>
                                    <h3 class="font-display text-3xl text-off-white mb-6">Competitive Obsolescence</h3>
                                    <div class="prose prose-invert max-w-none">
                                        <p class="font-serif text-light-gray leading-relaxed text-lg">
                                            The perpetual DEX landscape has evolved rapidly, leaving MYX behind. Competitors like Hyperliquid and dYdX v4 offer superior latency, deeper liquidity, and better user experiences. MYX, built on BSC, suffers from the chain's declining relevance in the high-frequency trading sector.
                                        </p>
                                        <p class="font-serif text-light-gray leading-relaxed text-lg mt-4">
                                            MYX's fee structure is uncompetitive, and its "trade-to-earn" incentives have attracted mercenary capital that washes volume rather than sticky, organic users. Once these incentives dry up, we expect volume to collapse by 60-70%, revealing the protocol's lack of genuine product-market fit.
                                        </p>
                                    </div>
                                </section>

                                <section>
                                    <h3 class="font-display text-3xl text-off-white mb-6">Valuation Disconnect</h3>
                                    <div class="prose prose-invert max-w-none">
                                        <p class="font-serif text-light-gray leading-relaxed text-lg">
                                            Despite these headwinds, MYX trades at a Fully Diluted Valuation (FDV) to Revenue ratio of 85x. The sector average for mature perp DEXs is closer to 25x. This implies that MYX is overvalued by a factor of 3 relative to its peers, even before accounting for the upcoming supply shock.
                                        </p>
                                        <p class="font-serif text-light-gray leading-relaxed text-lg mt-4">
                                            The market is effectively pricing MYX as a high-growth tech stock, while its fundamentals resemble a declining utility. This mispricing presents a high-conviction short opportunity with a clear catalyst (the unlock) and a fundamental backstop (valuation compression).
                                        </p>
                                    </div>
                                </section>
                            </div>

                            <!-- Sidebar Info -->
                            <div class="lg:col-span-4 space-y-8">
                                <div class="bg-neutral-900/30 border border-mid-gray p-6">
                                    <h4 class="font-mono text-xs text-dim-gray uppercase tracking-widest mb-4">Key Catalysts</h4>
                                    <ul class="space-y-2">
                                        <li class="flex gap-3 items-start hover:bg-white/5 p-2 -mx-2 rounded transition-colors cursor-default group">
                                            <span class="text-off-white font-mono text-xs mt-1 group-hover:text-white transition-colors">01</span>
                                            <p class="text-sm text-neutral-400 group-hover:text-neutral-300 transition-colors">January 15th Token Unlock (~15M tokens)</p>
                                        </li>
                                        <li class="flex gap-3 items-start hover:bg-white/5 p-2 -mx-2 rounded transition-colors cursor-default group">
                                            <span class="text-off-white font-mono text-xs mt-1 group-hover:text-white transition-colors">02</span>
                                            <p class="text-sm text-neutral-400 group-hover:text-neutral-300 transition-colors">End of current trading incentive program</p>
                                        </li>
                                        <li class="flex gap-3 items-start hover:bg-white/5 p-2 -mx-2 rounded transition-colors cursor-default group">
                                            <span class="text-off-white font-mono text-xs mt-1 group-hover:text-white transition-colors">03</span>
                                            <p class="text-sm text-neutral-400 group-hover:text-neutral-300 transition-colors">Competitor Hyperliquid launching mainnet</p>
                                        </li>
                                    </ul>
                                </div>

                                <div class="bg-neutral-900/30 border border-mid-gray p-6">
                                    <h4 class="font-mono text-xs text-dim-gray uppercase tracking-widest mb-4">Risk Factors</h4>
                                    <ul class="space-y-2">
                                        <li class="flex gap-3 items-start hover:bg-white/5 p-2 -mx-2 rounded transition-colors cursor-default group">
                                            <span class="text-neutral-500 font-mono text-xs mt-1 group-hover:text-red-400 transition-colors">!!</span>
                                            <p class="text-sm text-neutral-400 group-hover:text-neutral-300 transition-colors">Short squeeze risk on major partnership news</p>
                                        </li>
                                        <li class="flex gap-3 items-start hover:bg-white/5 p-2 -mx-2 rounded transition-colors cursor-default group">
                                            <span class="text-neutral-500 font-mono text-xs mt-1 group-hover:text-red-400 transition-colors">!!</span>
                                            <p class="text-sm text-neutral-400 group-hover:text-neutral-300 transition-colors">Potential for team to delay unlock (low probability)</p>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            },
            austin_re: {
                title: "AUSTIN REAL ESTATE",
                subtitle: "Macro // Demographics // Alpha",
                tags: ["Real Estate", "Macro", "Data Science", "Geospatial"],
                description: "A granular analysis of the Austin housing market, dissecting the 'Great Migration' thesis against a backdrop of rising rates and supply-side constraints. Interactive geospatial data reveals the divergence between neighborhood-level alpha and aggregate market beta.",
                details: `
                    <div class="space-y-16 mt-12">
                        
                        <!-- INTERACTIVE MAP - HERO SECTION -->
                        <div id="map-container" class="border border-white/10 bg-[#0A0A0A] relative overflow-hidden modal-stagger transition-all duration-500" style="transition-delay: 0.3s; height: 700px;">
                            
                            <!-- Interactive Side Panel -->\n                            <div id="map-info-panel" class="absolute top-0 right-0 w-[380px] h-full bg-[#030303]/98 backdrop-blur-md border-l border-white/10 z-[1002] transform translate-x-full transition-transform duration-500">
                                <div class="h-full flex flex-col">
                                    <div class="p-6 border-b border-white/10 flex items-center justify-between">
                                        <h3 class="font-display text-lg text-off-white">Location Details</h3>
                                        <button onclick="closeSidePanel()" class="text-neutral-500 hover:text-off-white transition-colors">
                                            <i data-lucide="x" class="w-5 h-5"></i>
                                        </button>
                                    </div>
                                    <div id="panel-content" class="flex-1 overflow-y-auto p-6 space-y-6">
                                        <div class="text-center text-neutral-500 text-sm mt-20">
                                            Click on any map marker<br/>to view detailed information
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Expand/Collapse Button -->
                            <div class="absolute top-4 right-4 md:top-6 md:right-6 z-[1001] flex items-center gap-2">
                                <button onclick="toggleMapExpand()" class="flex items-center gap-2 px-3 py-2 md:px-4 md:py-2.5 bg-[#030303]/95 backdrop-blur-md border border-white/10 hover:border-white/30 transition-all group touch-manipulation" title="Expand Map">
                                    <i data-lucide="maximize-2" class="w-4 h-4 text-off-white group-hover:scale-110 transition-transform" id="expand-icon"></i>
                                    <span class="font-mono text-[9px] md:text-[10px] text-off-white uppercase tracking-widest hidden sm:inline">Expand</span>
                                </button>
                            </div>

                            <!-- Map Layer Controls -->
                            <div class="absolute top-4 left-4 md:top-6 md:left-6 z-[1000] flex flex-col gap-3 max-w-[220px] md:max-w-[280px]">
                                <div class="bg-[#030303]/95 backdrop-blur-md border border-white/10 p-3 md:p-4">
                                    <h3 class="font-display text-base md:text-lg text-off-white mb-1">AUSTIN METRO</h3>
                                    <p class="font-mono text-[8px] md:text-[9px] text-neutral-500 uppercase tracking-wider mb-2 md:mb-3">Real Estate Intelligence</p>
                                    <div class="flex items-center gap-2 text-[9px] md:text-[10px]">
                                        <div class="w-2 h-2 bg-off-white rounded-full animate-pulse"></div>
                                        <span class="font-mono text-neutral-400 uppercase tracking-widest">Live Data</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Layer Controls - Right Side -->
                            <div class="absolute bottom-4 right-4 md:bottom-6 md:right-6 z-[1000] flex flex-col gap-2">
                                <div class="bg-[#030303]/95 backdrop-blur-md border border-white/10">
                                    <div class="px-4 py-3 border-b border-white/10">
                                        <div class="font-mono text-[9px] text-neutral-500 uppercase tracking-widest">Data Layers</div>
                                    </div>
                                    <div class="p-2 grid grid-cols-2 gap-1">
                                        <button onclick="toggleLayer('permits')" class="map-layer-btn group px-3 py-3 text-[9px] font-mono uppercase tracking-widest transition-all text-neutral-500 hover:bg-white/5" id="btn-permits" title="Construction Permits">
                                            <i data-lucide="hammer" class="w-3.5 h-3.5 mx-auto mb-1 group-hover:scale-110 transition-transform"></i>
                                            <div>Permits</div>
                                        </button>
                                        <button onclick="toggleLayer('traffic')" class="map-layer-btn group px-3 py-3 text-[9px] font-mono uppercase tracking-widest transition-all text-neutral-500 hover:bg-white/5" id="btn-traffic" title="Live Traffic">
                                            <i data-lucide="alert-triangle" class="w-3.5 h-3.5 mx-auto mb-1 group-hover:scale-110 transition-transform"></i>
                                            <div>Traffic</div>
                                        </button>
                                        <button onclick="toggleLayer('cameras')" class="map-layer-btn group px-3 py-3 text-[9px] font-mono uppercase tracking-widest transition-all text-neutral-500 hover:bg-white/5" id="btn-cameras" title="Live Camera Feeds">
                                            <i data-lucide="video" class="w-3.5 h-3.5 mx-auto mb-1 group-hover:scale-110 transition-transform"></i>
                                            <div>Cameras</div>
                                        </button>
                                        <button onclick="toggleLayer('schools')" class="map-layer-btn group px-3 py-3 text-[9px] font-mono uppercase tracking-widest transition-all text-neutral-500 hover:bg-white/5" id="btn-schools" title="School Districts">
                                            <i data-lucide="graduation-cap" class="w-3.5 h-3.5 mx-auto mb-1 group-hover:scale-110 transition-transform"></i>
                                            <div>Schools</div>
                                        </button>
                                        <button onclick="toggleLayer('parks')" class="map-layer-btn group px-3 py-3 text-[9px] font-mono uppercase tracking-widest transition-all text-neutral-500 hover:bg-white/5" id="btn-parks" title="Parks & Green Space">
                                            <i data-lucide="tree-pine" class="w-3.5 h-3.5 mx-auto mb-1 group-hover:scale-110 transition-transform"></i>
                                            <div>Parks</div>
                                        </button>
                                        <button onclick="toggleLayer('str')" class="map-layer-btn group px-3 py-3 text-[9px] font-mono uppercase tracking-widest transition-all text-neutral-500 hover:bg-white/5" id="btn-str" title="Rental Properties">
                                            <i data-lucide="home" class="w-3.5 h-3.5 mx-auto mb-1 group-hover:scale-110 transition-transform"></i>
                                            <div>STRs</div>
                                        </button>
                                        <button onclick="toggleLayer('zoning')" class="map-layer-btn group px-3 py-3 text-[9px] font-mono uppercase tracking-widest transition-all text-neutral-500 hover:bg-white/5" id="btn-zoning" title="Development Plans">
                                            <i data-lucide="map-pin" class="w-3.5 h-3.5 mx-auto mb-1 group-hover:scale-110 transition-transform"></i>
                                            <div>Zoning</div>
                                        </button>
                                        <button onclick="toggleLayer('bikes')" class="map-layer-btn group px-3 py-3 text-[9px] font-mono uppercase tracking-widest transition-all text-neutral-500 hover:bg-white/5" id="btn-bikes" title="Cycling Infrastructure">
                                            <i data-lucide="bike" class="w-3.5 h-3.5 mx-auto mb-1 group-hover:scale-110 transition-transform"></i>
                                            <div>Bikes</div>
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Advanced Tools -->
                                <div class="border-t border-white/10 pt-3">
                                    <div class="font-mono text-[8px] text-neutral-600 uppercase tracking-widest mb-2 px-3">Analysis Tools</div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <button onclick="addHeatmapLayer()" class="map-layer-btn group px-3 py-2.5 text-[9px] font-mono uppercase tracking-widest transition-all text-neutral-500 hover:bg-white/5" id="btn-heatmap" title="Value Density Heatmap">
                                            <i data-lucide="activity" class="w-3.5 h-3.5 mx-auto mb-1 group-hover:scale-110 transition-transform"></i>
                                            <div>Heatmap</div>
                                        </button>
                                        <button onclick="toggleMeasureTool()" class="map-layer-btn group px-3 py-2.5 text-[9px] font-mono uppercase tracking-widest transition-all text-neutral-500 hover:bg-white/5" id="btn-measure" title="Distance Measurement">
                                            <i data-lucide="ruler" class="w-3.5 h-3.5 mx-auto mb-1 group-hover:scale-110 transition-transform"></i>
                                            <div>Measure</div>
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Base Layer Toggle -->
                                <button onclick="toggleBaseLayer()" class="bg-[#030303]/95 backdrop-blur-md border border-white/10 px-4 py-2.5 text-[9px] font-mono uppercase tracking-widest hover:bg-white/5 transition-all text-neutral-500 flex items-center justify-between gap-3" id="btn-satellite">
                                    <span class="text-off-white">Satellite View</span>
                                    <i data-lucide="globe" class="w-3 h-3"></i>
                                </button>
                            </div>

                            <!-- Map Legend -->
                            <div class="absolute bottom-6 left-6 z-[1000] bg-[#030303]/95 backdrop-blur-md border border-white/10 p-4 max-w-[240px]" id="map-legend">
                                <div class="font-mono text-[9px] text-neutral-500 uppercase tracking-widest mb-3">Active Layers</div>
                                <div class="space-y-2 text-[10px] font-mono" id="legend-items">
                                    <div class="text-neutral-600">No layers selected</div>
                                </div>
                            </div>
                            
                            <!-- Leaflet Map -->
                            <div id="austin-map" class="w-full h-full z-0 transition-opacity duration-500"></div>
                            
                            <!-- Loading Overlay -->
                            <div id="map-loading" class="absolute inset-0 bg-[#030303]/90 backdrop-blur-sm flex items-center justify-center z-[999] transition-opacity duration-300">
                                <div class="text-center">
                                    <div class="w-10 h-10 border-2 border-off-white/30 border-t-off-white rounded-full animate-spin mb-4 mx-auto"></div>
                                    <div class="font-mono text-xs text-off-white uppercase tracking-widest">Loading Map Data</div>
                                    <div class="font-mono text-[10px] text-neutral-500 mt-2">Fetching 8 data layers</div>
                                </div>
                            </div>
                        </div>

                        <!-- LIVE MARKET FEED -->
                        <div class="w-full border-y border-white/10 overflow-hidden relative h-10 flex items-center group bg-[#0A0A0A] modal-stagger" style="transition-delay: 0.4s">
                            <div class="flex items-center gap-4 px-6 border-r border-white/10 z-20 bg-[#0A0A0A] h-full shrink-0">
                                <div class="w-1.5 h-1.5 bg-off-white rounded-full animate-pulse"></div>
                                <span class="font-mono text-[10px] text-neutral-500 uppercase tracking-widest">Market Feed</span>
                            </div>

                            <div class="flex items-center gap-12 whitespace-nowrap animate-marquee" id="market-ticker">
                                <!-- Ticker items injected via JS -->
                            </div>
                        </div>

                        <!-- QUICK STATS GRID -->
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-px bg-white/10 border border-white/10 modal-stagger" style="transition-delay: 0.45s">
                            <div class="p-6 bg-charcoal hover:bg-[#151515] transition-colors duration-300 group">
                                <div class="text-[10px] font-mono text-dim-gray uppercase tracking-widest mb-2 group-hover:text-neutral-400 transition-colors">Active Permits (30d)</div>
                                <div class="text-2xl font-mono text-off-white" id="stat-permits">--</div>
                            </div>
                            <div class="p-6 bg-charcoal hover:bg-[#151515] transition-colors duration-300 group">
                                <div class="text-[10px] font-mono text-dim-gray uppercase tracking-widest mb-2 group-hover:text-neutral-400 transition-colors">Traffic Incidents</div>
                                <div class="text-2xl font-mono text-off-white" id="stat-traffic">--</div>
                            </div>
                            <div class="p-6 bg-charcoal hover:bg-[#151515] transition-colors duration-300 group">
                                <div class="text-[10px] font-mono text-dim-gray uppercase tracking-widest mb-2 group-hover:text-neutral-400 transition-colors">Active Cameras</div>
                                <div class="text-2xl font-mono text-off-white" id="stat-cameras">--</div>
                            </div>
                            <div class="p-6 bg-charcoal hover:bg-[#151515] transition-colors duration-300 group">
                                <div class="text-[10px] font-mono text-dim-gray uppercase tracking-widest mb-2 group-hover:text-neutral-400 transition-colors">Public Schools</div>
                                <div class="text-2xl font-mono text-off-white" id="stat-schools">--</div>
                            </div>
                        </div>

                        <!-- PRICE TRENDS CHART -->
                        <div class="modal-stagger" style="transition-delay: 0.35s">
                            <div class="border border-mid-gray bg-charcoal overflow-hidden">
                                <div class="p-8 border-b border-mid-gray">
                                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                                        <div>
                                            <h3 class="font-display text-xl text-off-white mb-2">Median Home Price Trends</h3>
                                            <p class="font-mono text-xs text-dim-gray">Historical median sale prices by quarter (Austin Metro)</p>
                                        </div>
                                        <div class="flex gap-2">
                                            <span class="px-3 py-1 bg-white/5 border border-white/10 text-[10px] font-mono text-neutral-400 uppercase">2020-2025</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="p-8 h-[400px]">
                                    <canvas id="price-trends-chart"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- DEMOGRAPHICS & MARKET INSIGHTS -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 modal-stagger" style="transition-delay: 0.37s">
                            <div class="border border-mid-gray bg-charcoal p-6 hover:bg-[#151515] transition-colors">
                                <div class="flex items-start justify-between mb-4">
                                    <div class="text-[10px] font-mono text-dim-gray uppercase tracking-widest">Population Growth</div>
                                    <i data-lucide="trending-up" class="w-4 h-4 text-green-500"></i>
                                </div>
                                <div class="text-3xl font-display text-off-white mb-2" id="pop-growth">+2.8%</div>
                                <div class="text-xs text-light-gray">YoY (2024 vs 2023)</div>
                                <div class="mt-4 pt-4 border-t border-mid-gray text-xs text-dim-gray">
                                    Austin remains one of the fastest-growing metros in the US
                                </div>
                            </div>
                            <div class="border border-mid-gray bg-charcoal p-6 hover:bg-[#151515] transition-colors">
                                <div class="flex items-start justify-between mb-4">
                                    <div class="text-[10px] font-mono text-dim-gray uppercase tracking-widest">Tech Employment</div>
                                    <i data-lucide="briefcase" class="w-4 h-4 text-blue-400"></i>
                                </div>
                                <div class="text-3xl font-display text-off-white mb-2">28.4%</div>
                                <div class="text-xs text-light-gray">Of total workforce</div>
                                <div class="mt-4 pt-4 border-t border-mid-gray text-xs text-dim-gray">
                                    Highest concentration in the Southwest
                                </div>
                            </div>
                            <div class="border border-mid-gray bg-charcoal p-6 hover:bg-[#151515] transition-colors">
                                <div class="flex items-start justify-between mb-4">
                                    <div class="text-[10px] font-mono text-dim-gray uppercase tracking-widest">Median HH Income</div>
                                    <i data-lucide="dollar-sign" class="w-4 h-4 text-yellow-400"></i>
                                </div>
                                <div class="text-3xl font-display text-off-white mb-2">$91,500</div>
                                <div class="text-xs text-light-gray">Austin Metro (2024)</div>
                                <div class="mt-4 pt-4 border-t border-mid-gray text-xs text-dim-gray">
                                    16% above national median
                                </div>
                            </div>
                        </div>

                        <!-- PROPERTY INVENTORY METRICS -->
                        <div class="modal-stagger" style="transition-delay: 0.39s">
                            <div class="border border-mid-gray bg-charcoal overflow-hidden">
                                <div class="p-8 border-b border-mid-gray">
                                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                                        <div>
                                            <h3 class="font-display text-xl text-off-white mb-2">Housing Market Inventory</h3>
                                            <p class="font-mono text-xs text-dim-gray">Active listings and days on market trends</p>
                                        </div>
                                        <div class="flex gap-2">
                                            <span class="px-3 py-1 bg-white/5 border border-white/10 text-[10px] font-mono text-neutral-400 uppercase">Live Data</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-4 divide-y md:divide-y-0 md:divide-x divide-mid-gray">
                                    <div class="p-8 hover:bg-white/5 transition-colors">
                                        <div class="text-xs font-mono text-dim-gray uppercase mb-3">Active Listings</div>
                                        <div class="text-4xl font-display text-off-white mb-2">4,287</div>
                                        <div class="flex items-center gap-2 text-xs">
                                            <span class="text-red-400">↓ 8.3%</span>
                                            <span class="text-dim-gray">vs last quarter</span>
                                        </div>
                                    </div>
                                    <div class="p-8 hover:bg-white/5 transition-colors">
                                        <div class="text-xs font-mono text-dim-gray uppercase mb-3">Days on Market</div>
                                        <div class="text-4xl font-display text-off-white mb-2">42</div>
                                        <div class="flex items-center gap-2 text-xs">
                                            <span class="text-green-400">↓ 12 days</span>
                                            <span class="text-dim-gray">vs 2024 avg</span>
                                        </div>
                                    </div>
                                    <div class="p-8 hover:bg-white/5 transition-colors">
                                        <div class="text-xs font-mono text-dim-gray uppercase mb-3">Sold Properties</div>
                                        <div class="text-4xl font-display text-off-white mb-2">3,921</div>
                                        <div class="flex items-center gap-2 text-xs">
                                            <span class="text-green-400">↑ 5.7%</span>
                                            <span class="text-dim-gray">last 90 days</span>
                                        </div>
                                    </div>
                                    <div class="p-8 hover:bg-white/5 transition-colors">
                                        <div class="text-xs font-mono text-dim-gray uppercase mb-3">Absorption Rate</div>
                                        <div class="text-4xl font-display text-off-white mb-2">3.2</div>
                                        <div class="flex items-center gap-2 text-xs">
                                            <span class="text-yellow-400">Balanced</span>
                                            <span class="text-dim-gray">months supply</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="p-8 bg-[#0A0A0A] border-t border-mid-gray">
                                    <div class="font-mono text-xs text-dim-gray leading-relaxed">
                                        <strong class="text-neutral-300">Market Analysis:</strong> Austin's inventory remains constrained at 3.2 months supply (balanced market: 4-6 months). Days on market decreasing indicates strong buyer demand. Permits data shows 8,500+ new construction starts—pipeline will ease inventory pressure in 12-18 months.
                                    </div>
                                </div>
                            </div>
                        </div>


                        <!-- SENSITIVITY MODEL (Custom Section) -->
                        <div class="modal-stagger" style="transition-delay: 0.55s">
                            <div class="border border-mid-gray bg-charcoal overflow-hidden">
                                <div class="p-8 border-b border-mid-gray flex flex-col md:flex-row justify-between items-end gap-6">
                                    <div>
                                        <div class="flex items-center gap-3 mb-2">
                                            <h3 class="font-display text-xl text-off-white">Rate Sensitivity Model</h3>
                                        </div>
                                        <p class="font-mono text-xs text-dim-gray">Adjust 30Y Fixed Rate to model buying power impact</p>
                                    </div>
                                    <div class="flex items-center gap-4">
                                        <span class="text-xs font-mono text-dim-gray uppercase">Current Rate</span>
                                        <span class="font-display text-4xl text-off-white" id="rate-display">6.8%</span>
                                    </div>
                                </div>
                                
                                <div class="p-8">
                                    <input type="range" min="4.0" max="9.0" step="0.1" value="6.8" 
                                        class="w-full h-1 bg-mid-gray rounded-none appearance-none cursor-pointer accent-off-white hover:accent-white transition-all" 
                                        id="rate-slider">
                                    <div class="flex justify-between mt-4 font-mono text-[10px] text-dim-gray uppercase">
                                        <span>4.0% (Historic Lows)</span>
                                        <span>9.0% (Stress Test)</span>
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-3 divide-y md:divide-y-0 md:divide-x divide-mid-gray">
                                    <div class="p-8 hover:bg-white/5 transition-colors">
                                        <div class="text-xs font-mono text-dim-gray uppercase mb-3">Buying Power</div>
                                        <div class="text-3xl font-display text-off-white mb-1" id="model-power">$540k</div>
                                        <div class="text-[10px] text-dim-gray">Based on $3,500/mo P&I</div>
                                    </div>
                                    <div class="p-8 hover:bg-white/5 transition-colors">
                                        <div class="text-xs font-mono text-dim-gray uppercase mb-3">Cap Rate Spread</div>
                                        <div class="text-3xl font-display text-off-white mb-1" id="model-spread">-1.2%</div>
                                        <div class="text-[10px] text-dim-gray">vs 10Y Treasury Yield</div>
                                    </div>
                                    <div class="p-8 hover:bg-white/5 transition-colors">
                                        <div class="text-xs font-mono text-dim-gray uppercase mb-3">Refi Probability</div>
                                        <div class="text-3xl font-display text-off-white mb-1" id="model-refi">Low</div>
                                        <div class="text-[10px] text-dim-gray">24-Month Outlook</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- NEIGHBORHOOD COMPARISON TABLE -->
                        <div class="modal-stagger" style="transition-delay: 0.57s">
                            <div class="border border-mid-gray bg-charcoal overflow-hidden">
                                <div class="p-8 border-b border-mid-gray">
                                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                                        <div>
                                            <h3 class="font-display text-xl text-off-white mb-2">Neighborhood Alpha Analysis</h3>
                                            <p class="font-mono text-xs text-dim-gray">Comparative metrics across key Austin zip codes</p>
                                        </div>
                                        <span class="px-3 py-1 bg-green-500/10 border border-green-500/20 text-[10px] font-mono text-green-400 uppercase tracking-wider">Live Data</span>
                                    </div>
                                </div>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-sm">
                                        <thead class="bg-[#0A0A0A] border-b border-mid-gray">
                                            <tr>
                                                <th class="p-4 text-left font-mono text-[10px] text-dim-gray uppercase tracking-widest">Zip Code</th>
                                                <th class="p-4 text-left font-mono text-[10px] text-dim-gray uppercase tracking-widest">Area</th>
                                                <th class="p-4 text-right font-mono text-[10px] text-dim-gray uppercase tracking-widest">Median Price</th>
                                                <th class="p-4 text-right font-mono text-[10px] text-dim-gray uppercase tracking-widest">YoY Change</th>
                                                <th class="p-4 text-right font-mono text-[10px] text-dim-gray uppercase tracking-widest">DOM</th>
                                                <th class="p-4 text-right font-mono text-[10px] text-dim-gray uppercase tracking-widest">Inventory</th>
                                                <th class="p-4 text-center font-mono text-[10px] text-dim-gray uppercase tracking-widest">Trend</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-mid-gray">
                                            <tr class="hover:bg-white/5 transition-colors">
                                                <td class="p-4 font-mono text-off-white">78702</td>
                                                <td class="p-4 text-light-gray">East Downtown</td>
                                                <td class="p-4 text-right font-mono text-off-white">$675,000</td>
                                                <td class="p-4 text-right font-mono text-green-400">+8.2%</td>
                                                <td class="p-4 text-right font-mono text-light-gray">18</td>
                                                <td class="p-4 text-right font-mono text-light-gray">2.1 mo</td>
                                                <td class="p-4 text-center">
                                                    <span class="inline-flex items-center gap-1">
                                                        <i data-lucide="trending-up" class="w-3 h-3 text-green-400"></i>
                                                    </span>
                                                </td>
                                            </tr>
                                            <tr class="hover:bg-white/5 transition-colors">
                                                <td class="p-4 font-mono text-off-white">78704</td>
                                                <td class="p-4 text-light-gray">South Austin</td>
                                                <td class="p-4 text-right font-mono text-off-white">$825,000</td>
                                                <td class="p-4 text-right font-mono text-green-400">+4.1%</td>
                                                <td class="p-4 text-right font-mono text-light-gray">22</td>
                                                <td class="p-4 text-right font-mono text-light-gray">2.8 mo</td>
                                                <td class="p-4 text-center">
                                                    <span class="inline-flex items-center gap-1">
                                                        <i data-lucide="trending-up" class="w-3 h-3 text-green-400"></i>
                                                    </span>
                                                </td>
                                            </tr>
                                            <tr class="hover:bg-white/5 transition-colors">
                                                <td class="p-4 font-mono text-off-white">78721</td>
                                                <td class="p-4 text-light-gray">Eastside Tech</td>
                                                <td class="p-4 text-right font-mono text-off-white">$485,000</td>
                                                <td class="p-4 text-right font-mono text-green-400">+12.5%</td>
                                                <td class="p-4 text-right font-mono text-light-gray">15</td>
                                                <td class="p-4 text-right font-mono text-light-gray">1.6 mo</td>
                                                <td class="p-4 text-center">
                                                    <span class="inline-flex items-center gap-1">
                                                        <i data-lucide="trending-up" class="w-3 h-3 text-green-400"></i>
                                                    </span>
                                                </td>
                                            </tr>
                                            <tr class="hover:bg-white/5 transition-colors">
                                                <td class="p-4 font-mono text-off-white">78731</td>
                                                <td class="p-4 text-light-gray">West Lake Hills</td>
                                                <td class="p-4 text-right font-mono text-off-white">$1,245,000</td>
                                                <td class="p-4 text-right font-mono text-neutral-400">-2.1%</td>
                                                <td class="p-4 text-right font-mono text-light-gray">45</td>
                                                <td class="p-4 text-right font-mono text-light-gray">4.2 mo</td>
                                                <td class="p-4 text-center">
                                                    <span class="inline-flex items-center gap-1">
                                                        <i data-lucide="trending-down" class="w-3 h-3 text-neutral-500"></i>
                                                    </span>
                                                </td>
                                            </tr>
                                            <tr class="hover:bg-white/5 transition-colors">
                                                <td class="p-4 font-mono text-off-white">78758</td>
                                                <td class="p-4 text-light-gray">North Loop</td>
                                                <td class="p-4 text-right font-mono text-off-white">$495,000</td>
                                                <td class="p-4 text-right font-mono text-green-400">+6.8%</td>
                                                <td class="p-4 text-right font-mono text-light-gray">28</td>
                                                <td class="p-4 text-right font-mono text-light-gray">3.1 mo</td>
                                                <td class="p-4 text-center">
                                                    <span class="inline-flex items-center gap-1">
                                                        <i data-lucide="trending-up" class="w-3 h-3 text-green-400"></i>
                                                    </span>
                                                </td>
                                            </tr>
                                            <tr class="hover:bg-white/5 transition-colors bg-white/5">
                                                <td class="p-4 font-mono text-off-white">78701</td>
                                                <td class="p-4 text-light-gray">Downtown</td>
                                                <td class="p-4 text-right font-mono text-off-white">$595,000</td>
                                                <td class="p-4 text-right font-mono text-red-400">-5.2%</td>
                                                <td class="p-4 text-right font-mono text-light-gray">52</td>
                                                <td class="p-4 text-right font-mono text-light-gray">5.8 mo</td>
                                                <td class="p-4 text-center">
                                                    <span class="inline-flex items-center gap-1">
                                                        <i data-lucide="trending-down" class="w-3 h-3 text-red-400"></i>
                                                    </span>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="p-6 border-t border-mid-gray bg-[#0A0A0A]">
                                    <div class="flex items-start gap-3 text-xs">
                                        <i data-lucide="info" class="w-4 h-4 text-blue-400 shrink-0 mt-0.5"></i>
                                        <p class="text-dim-gray leading-relaxed">
                                            <span class="text-light-gray font-medium">DOM:</span> Days on Market &nbsp;|&nbsp; <span class="text-light-gray font-medium">Inventory:</span> Months of supply &nbsp;|&nbsp; Data reflects Q4 2024 market conditions
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- BUILDING VALUATIONS CHART -->
                        <div class="modal-stagger" style="transition-delay: 0.58s">
                            <div class="border border-mid-gray bg-charcoal overflow-hidden">
                                <div class="p-8 border-b border-mid-gray">
                                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                                        <div>
                                            <h3 class="font-display text-xl text-off-white mb-2">Building Permit Valuations</h3>
                                            <p class="font-mono text-xs text-dim-gray">Construction investment by month (2024)</p>
                                        </div>
                                        <span class="px-3 py-1 bg-blue-500/10 border border-blue-500/20 text-[10px] font-mono text-blue-400 uppercase tracking-wider">City of Austin Open Data</span>
                                    </div>
                                </div>
                                <div class="p-8 h-[350px]">
                                    <canvas id="valuations-chart"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- THESIS CONTENT -->
                        <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 modal-stagger" style="transition-delay: 0.6s">
                            <div class="lg:col-span-8 space-y-12">
                                <div class="prose prose-invert max-w-none">
                                    <h3 class="font-display text-2xl text-off-white mb-6">The Great Migration: A Structural Shift</h3>
                                    <p class="font-serif text-light-gray leading-relaxed text-lg mb-6">
                                        The post-2020 exodus from coastal gateway cities to the Sunbelt is not a transient trend but a structural realignment of the US demographic map. Austin sits at the epicenter of this shift, acting as a "talent magnet" for the tech sector.
                                    </p>
                                    <div class="pl-6 border-l border-mid-gray my-8">
                                        <p class="font-display text-xl text-off-white italic">
                                            "The 'easy beta' trade is over. The market is bifurcating between luxury downtown condos facing oversupply and northern tech corridor single-family homes seeing inventory compression."
                                        </p>
                                    </div>
                                    <h3 class="font-display text-2xl text-off-white mb-6">Supply Constraints & Zoning</h3>
                                    <p class="font-serif text-light-gray leading-relaxed text-lg">
                                        Despite the "build everywhere" narrative, Austin's Land Development Code remains archaic. This creates artificial scarcity in desirable central neighborhoods. The "Missing Middle" housing is virtually non-existent, forcing a barbell distribution of housing stock: high-density apartments or sprawling single-family estates.
                                    </p>
                                </div>
                            </div>

                            <!-- Sidebar Stats -->
                            <div class="lg:col-span-4 space-y-6">
                                <div class="bg-charcoal border border-mid-gray p-6">
                                    <h4 class="font-mono text-xs text-dim-gray uppercase tracking-widest mb-6">Market Vitals</h4>
                                    <ul class="space-y-4">
                                        <li class="flex justify-between items-center pb-4 border-b border-mid-gray">
                                            <span class="text-sm text-light-gray">Median Price</span>
                                            <span class="font-mono text-off-white">$545,000</span>
                                        </li>
                                        <li class="flex justify-between items-center pb-4 border-b border-mid-gray">
                                            <span class="text-sm text-light-gray">Months Inventory</span>
                                            <span class="font-mono text-off-white">3.2</span>
                                        </li>
                                        <li class="flex justify-between items-center pb-4 border-b border-mid-gray">
                                            <span class="text-sm text-light-gray">Rent vs Buy</span>
                                            <span class="font-mono text-off-white">-12%</span>
                                        </li>
                                        <li class="flex justify-between items-center">
                                            <span class="text-sm text-light-gray">YoY Volume</span>
                                            <span class="font-mono text-neutral-300">-18%</span>
                                        </li>
                                    </ul>
                                </div>
                                
                                <div class="bg-mid-gray/30 border border-mid-gray p-6">
                                    <div class="flex items-start gap-3">
                                        <i data-lucide="trending-up" class="w-5 h-5 text-off-white shrink-0"></i>
                                        <div>
                                            <h5 class="font-display text-sm text-off-white mb-2">Alpha Opportunity</h5>
                                            <p class="text-xs text-light-gray leading-relaxed">
                                                Zip codes 78702 and 78721 showing highest resilience to rate hikes due to commercial development pipeline (Eastside Tech Hub).
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            },
            payroll: {
                title: "CHAIN PAYROLL",
                subtitle: "1st Place Hackathon Winner",
                tags: ["Solidity", "React", "Web3", "DeFi"],
                description: "A decentralized payroll prototype solving the 'streaming money' problem. Led a 3-person team to ship a working live demo, outcompeting 12 teams to win grand prize. Real-time compensation meets smart contract automation.",
                details: `
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-8">
                        <div>
                            <h4 class="text-xs font-mono text-neutral-400 uppercase tracking-widest mb-4">The Objective</h4>
                            <p class="text-sm text-neutral-300 leading-relaxed">
                                Traditional payroll is slow and batched. We wanted to create a 'money stream' where employees are paid by the second, leveraging smart contracts for automated tax withholding and treasury management.
                            </p>
                        </div>
                        <div>
                            <h4 class="text-xs font-mono text-neutral-400 uppercase tracking-widest mb-4">The Reality</h4>
                            <p class="text-sm text-neutral-300 leading-relaxed">
                                The biggest challenge wasn't the Solidity code-it was the off-chain to on-chain bridge for compliance. We built a risk framework demonstrating real-world applicability, winning the $2.5K grand prize.
                            </p>
                        </div>
                    </div>

                    <!-- Code Terminal -->
                    <div class="mt-12 border border-off-white/10 bg-[#030303] font-mono text-xs rounded overflow-hidden">
                        <div class="flex items-center gap-2 px-4 py-2 border-b border-off-white/10 bg-[#0F0F0F]">
                            <div class="w-2 h-2 rounded-full bg-red-500"></div>
                            <div class="w-2 h-2 rounded-full bg-off-white/30"></div>
                            <div class="w-2 h-2 rounded-full bg-off-white/30"></div>
                            <span class="ml-2 text-neutral-500">PayrollStream.sol</span>
                        </div>
                        <div class="p-6 overflow-x-auto">
<pre><code class="language-solidity text-neutral-400">
<span class="text-purple-400">function</span> <span class="text-blue-400">streamSalary</span>(<span class="text-orange-400">address</span> employee) <span class="text-purple-400">external nonReentrant</span> {
    Stream <span class="text-purple-400">storage</span> s = streams[employee];
    <span class="text-purple-400">require</span>(s.isActive, <span class="text-green-400">"Stream inactive"</span>);

    <span class="text-gray-500">// Calculate flow based on block timestamp</span>
    <span class="text-orange-400">uint256</span> timeElapsed = <span class="text-yellow-400">block.timestamp</span> - s.lastWithdrawal;
    <span class="text-orange-400">uint256</span> amount = timeElapsed * s.ratePerSecond;

    <span class="text-purple-400">require</span>(address(<span class="text-blue-400">this</span>).balance >= amount, <span class="text-green-400">"Insufficient liquidity"</span>);

    s.lastWithdrawal = <span class="text-yellow-400">block.timestamp</span>;
    <span class="text-purple-400">payable</span>(employee).<span class="text-blue-400">transfer</span>(amount);

    <span class="text-purple-400">emit</span> SalaryStreamed(employee, amount, <span class="text-yellow-400">block.timestamp</span>);
}
</code></pre>
                        </div>
                    </div>

                    <div class="mt-8 pt-8 border-t border-off-white/10">
                         <h4 class="text-xs font-mono text-neutral-400 uppercase tracking-widest mb-4">Tech Stack</h4>
                         <div class="flex flex-wrap gap-3">
                            <span class="px-3 py-1 border border-off-white/20 rounded-full text-xs">Solidity</span>
                            <span class="px-3 py-1 border border-off-white/20 rounded-full text-xs">Hardhat</span>
                            <span class="px-3 py-1 border border-off-white/20 rounded-full text-xs">React.js</span>
                            <span class="px-3 py-1 border border-off-white/20 rounded-full text-xs">Ethers.js</span>
                        </div>
                    </div>
                `
            },
            point72: {
                title: "FINANCIAL ANALYSIS PORTFOLIO",
                subtitle: "Multi-Sector Equity Research & Valuation",
                tags: ["Equity Research", "DCF Modeling", "Sector Analysis", "Valuation"],
                description: "Deep-dive analysis across consumer, fintech, automotive, and energy storage sectors. Four distinct companies, four unique investment narratives-each backed by rigorous financial modeling, competitive positioning analysis, and thesis-driven valuation frameworks.",
                details: `
                    <div id="portfolio-dashboard">
                        <!-- Hero Statement -->
                        <div class="mb-12 pb-6 border-b border-off-white/10">
                            <p class="font-display text-xl md:text-2xl leading-relaxed text-neutral-300">
                                Four companies. Four narratives. Each backed by rigorous DCF modeling, competitive positioning analysis, and thesis-driven valuation frameworks that reveal where consensus gets it wrong.
                            </p>
                        </div>
                        
                        <!-- Methodology Section -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="p-8 border border-off-white/10 bg-charcoal">
                                <div class="mb-4">
                                    <span class="font-mono text-xs text-neutral-500">[01]</span>
                                </div>
                                <h4 class="text-lg md:text-xl font-display font-medium mb-4">The Approach</h4>
                                <p class="text-sm text-neutral-300 leading-relaxed">
                                    Each analysis follows the same systematic framework: Industry structure assessment → Competitive moat analysis → Financial modeling (DCF, Comps, Precedent Transactions) → Sensitivity analysis → Investment recommendation.
                                </p>
                            </div>
                            <div class="p-8 border border-off-white/10 bg-charcoal">
                                <div class="mb-4">
                                    <span class="font-mono text-xs text-neutral-500">[02]</span>
                                </div>
                                <h4 class="text-lg md:text-xl font-display font-medium mb-4">The Philosophy</h4>
                                <p class="text-sm text-neutral-300 leading-relaxed">
                                    Markets price in consensus. Alpha comes from divergence—finding mispriced narratives, overlooked inflection points, and structural advantages the Street hasn't modeled.
                                </p>
                            </div>
                        </div>
                        
                        <!-- Portfolio Summary Stats -->
                        <div class="mt-12 grid grid-cols-2 md:grid-cols-4 gap-px bg-off-white/10">
                            <div class="p-6 bg-charcoal hover:bg-[#0F0F0F] transition-all">
                                <div class="text-[10px] font-mono text-neutral-600 uppercase tracking-widest mb-3">Coverage</div>
                                <div class="text-4xl font-display font-bold mb-1">4</div>
                                <div class="text-xs text-neutral-500">Names</div>
                            </div>
                            <div class="p-6 bg-charcoal hover:bg-[#0F0F0F] transition-all">
                                <div class="text-[10px] font-mono text-neutral-600 uppercase tracking-widest mb-3">Long</div>
                                <div class="text-4xl font-display font-bold mb-1">1</div>
                                <div class="text-xs text-neutral-500">RIVN</div>
                            </div>
                            <div class="p-6 bg-charcoal hover:bg-[#0F0F0F] transition-all">
                                <div class="text-[10px] font-mono text-neutral-600 uppercase tracking-widest mb-3">Short</div>
                                <div class="text-4xl font-display font-bold mb-1">3</div>
                                <div class="text-xs text-neutral-500">SG, SEZL, KULR</div>
                            </div>
                            <div class="p-6 bg-charcoal hover:bg-[#0F0F0F] transition-all">
                                <div class="text-[10px] font-mono text-neutral-600 uppercase tracking-widest mb-3">Sectors</div>
                                <div class="text-4xl font-display font-bold mb-1">4</div>
                                <div class="text-xs text-neutral-500">Diversified</div>
                            </div>
                        </div>
                    
                        <!-- Portfolio Overview Chart -->
                        <div class="mt-12 p-8 border border-off-white/10 bg-[#0F0F0F]">
                            <div class="flex justify-between items-center mb-8">
                                <h4 class="text-xs font-mono text-neutral-400 uppercase tracking-widest">Risk-Reward Matrix</h4>
                                <span class="text-xs font-mono text-neutral-600">CONVICTION VS. RETURN POTENTIAL</span>
                            </div>
                            <div class="relative w-full h-64 md:h-80">
                                <svg viewBox="0 0 800 320" class="w-full h-full" preserveAspectRatio="xMidYMid meet">
                                    <!-- Axis Lines -->
                                    <line x1="400" y1="20" x2="400" y2="300" stroke="#2A2A2A" stroke-width="1" />
                                    <line x1="50" y1="160" x2="750" y2="160" stroke="#2A2A2A" stroke-width="1" />
                                    
                                    <!-- Quadrant Labels -->
                                    <text x="200" y="45" fill="#666666" font-family="Inter, sans-serif" font-size="10" text-anchor="middle" letter-spacing="0.1em">SHORT</text>
                                    <text x="600" y="45" fill="#666666" font-family="Inter, sans-serif" font-size="10" text-anchor="middle" letter-spacing="0.1em">LONG</text>
                                    
                                    <!-- Axis Labels -->
                                    <text x="60" y="165" fill="#666666" font-family="Inter, sans-serif" font-size="9" text-anchor="start">DOWNSIDE</text>
                                    <text x="740" y="165" fill="#666666" font-family="Inter, sans-serif" font-size="9" text-anchor="end">UPSIDE</text>
                                    
                                    <!-- Data Points - Monochrome -->
                                    <!-- KULR -->
                                    <circle cx="120" cy="90" r="20" fill="none" stroke="#A0A0A0" stroke-width="2" />
                                    <circle cx="120" cy="90" r="6" fill="#A0A0A0" />
                                    <text x="120" y="125" fill="#EAEAEA" font-family="Space Grotesk, sans-serif" font-size="12" font-weight="500" text-anchor="middle">KULR</text>
                                    <text x="120" y="142" fill="#A0A0A0" font-family="Inter, sans-serif" font-size="10" text-anchor="middle">-68%</text>
                                    
                                    <!-- SEZL -->
                                    <circle cx="200" cy="110" r="16" fill="none" stroke="#A0A0A0" stroke-width="2" />
                                    <circle cx="200" cy="110" r="5" fill="#A0A0A0" />
                                    <text x="200" y="145" fill="#EAEAEA" font-family="Space Grotesk, sans-serif" font-size="12" font-weight="500" text-anchor="middle">SEZL</text>
                                    <text x="200" y="162" fill="#A0A0A0" font-family="Inter, sans-serif" font-size="10" text-anchor="middle">-53%</text>
                                    
                                    <!-- SG -->
                                    <circle cx="280" cy="130" r="14" fill="none" stroke="#AAA" stroke-width="2" />
                                    <circle cx="280" cy="130" r="4" fill="#AAA" />
                                    <text x="280" y="165" fill="#EAEAEA" font-family="Space Grotesk, sans-serif" font-size="12" font-weight="500" text-anchor="middle">SG</text>
                                    <text x="280" y="182" fill="#AAA" font-family="Inter, sans-serif" font-size="10" text-anchor="middle">-48%</text>
                                    
                                    <!-- RIVN -->
                                    <circle cx="680" cy="70" r="24" fill="none" stroke="#BBB" stroke-width="2" />
                                    <circle cx="680" cy="70" r="8" fill="#BBB" />
                                    <text x="680" y="110" fill="#EAEAEA" font-family="Space Grotesk, sans-serif" font-size="12" font-weight="500" text-anchor="middle">RIVN</text>
                                    <text x="680" y="127" fill="#BBB" font-family="Inter, sans-serif" font-size="10" text-anchor="middle">+110%</text>
                                </svg>
                            </div>
                            <p class="text-[10px] font-mono text-neutral-600 mt-6 text-center uppercase tracking-widest">BUBBLE SIZE = CONVICTION LEVEL</p>
                        </div>

                        <!-- Stock Cards Grid -->
                        <div class="mt-12">
                            <div class="flex justify-between items-end mb-6 pb-4 border-b border-off-white/10">
                                <h3 class="font-display text-2xl md:text-3xl font-medium">Coverage Universe</h3>
                                <span class="text-xs font-mono text-neutral-500 uppercase tracking-widest">4 NAMES</span>
                            </div>
                            
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <!-- Sweetgreen Card -->
                                <div class="stock-card sell cursor-pointer group" onclick="showCompanyDetail('NYSE:SG')">
                                    <div class="p-8">
                                        <div class="flex justify-between items-start mb-6">
                                            <div>
                                                <div class="flex items-center gap-2 mb-2">
                                                    <span class="font-mono text-xs text-neutral-600">$SG</span>
                                                    <span class="text-neutral-700">·</span>
                                                    <span class="text-xs text-neutral-600 uppercase tracking-wider">NYSE</span>
                                                </div>
                                                <h4 class="font-display text-2xl md:text-3xl font-medium mb-1">Sweetgreen</h4>
                                                <div class="text-xs text-neutral-500 uppercase tracking-wider">Restaurants</div>
                                            </div>
                                            <span class="rating-badge sell">SELL</span>
                                        </div>
                                        <p class="text-sm text-neutral-400 leading-relaxed mb-8">
                                            Infinite Kitchen narrative masks structural unit economics challenges. Tech premium on capital-intensive restaurant model.
                                        </p>
                                        <div class="grid grid-cols-3 gap-px bg-off-white/10">
                                            <div class="bg-[#0F0F0F] p-4">
                                                <div class="text-[10px] font-mono text-neutral-600 uppercase tracking-widest mb-2">Target</div>
                                                <div class="text-2xl font-display font-bold">$18</div>
                                            </div>
                                            <div class="bg-[#0F0F0F] p-4">
                                                <div class="text-[10px] font-mono text-neutral-600 uppercase tracking-widest mb-2">Return</div>
                                                <div class="text-2xl font-display font-bold">-48%</div>
                                            </div>
                                            <div class="bg-[#0F0F0F] p-4">
                                                <div class="text-[10px] font-mono text-neutral-600 uppercase tracking-widest mb-2">Risk</div>
                                                <div class="text-xs text-neutral-300 mt-2">Unit Econ</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Sezzle Card -->
                                <div class="stock-card sell cursor-pointer group" onclick="showCompanyDetail('NASDAQ:SEZL')">
                                    <div class="p-8">
                                        <div class="flex justify-between items-start mb-6">
                                            <div>
                                                <div class="flex items-center gap-2 mb-2">
                                                    <span class="font-mono text-xs text-neutral-600">$SEZL</span>
                                                    <span class="text-neutral-700">·</span>
                                                    <span class="text-xs text-neutral-600 uppercase tracking-wider">NASDAQ</span>
                                                </div>
                                                <h4 class="font-display text-2xl md:text-3xl font-medium mb-1">Sezzle</h4>
                                                <div class="text-xs text-neutral-500 uppercase tracking-wider">Fintech / BNPL</div>
                                            </div>
                                            <span class="rating-badge sell">SELL</span>
                                        </div>
                                        <p class="text-sm text-neutral-400 leading-relaxed mb-8">
                                            BNPL structurally challenged in rising rate environment. Scale disadvantages vs. Affirm/Klarna insurmountable.
                                        </p>
                                        <div class="grid grid-cols-3 gap-px bg-off-white/10">
                                            <div class="bg-[#0F0F0F] p-4">
                                                <div class="text-[10px] font-mono text-neutral-600 uppercase tracking-widest mb-2">Target</div>
                                                <div class="text-2xl font-display font-bold">$95</div>
                                            </div>
                                            <div class="bg-[#0F0F0F] p-4">
                                                <div class="text-[10px] font-mono text-neutral-600 uppercase tracking-widest mb-2">Return</div>
                                                <div class="text-2xl font-display font-bold">-53%</div>
                                            </div>
                                            <div class="bg-[#0F0F0F] p-4">
                                                <div class="text-[10px] font-mono text-neutral-600 uppercase tracking-widest mb-2">Risk</div>
                                                <div class="text-xs text-neutral-300 mt-2">Competition</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                                <div class="metric-label">Key Risk</div>
                                                <div class="text-xs text-neutral-300 mt-1">Credit Loss</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Rivian Card -->
                                <div class="stock-card buy cursor-pointer group" onclick="showCompanyDetail('NASDAQ:RIVN')">
                                    <div class="p-8">
                                        <div class="flex justify-between items-start mb-6">
                                            <div>
                                                <div class="flex items-center gap-2 mb-2">
                                                    <span class="font-mono text-xs text-neutral-600">$RIVN</span>
                                                    <span class="text-neutral-700">·</span>
                                                    <span class="text-xs text-neutral-600 uppercase tracking-wider">NASDAQ</span>
                                                </div>
                                                <h4 class="font-display text-2xl md:text-3xl font-medium mb-1">Rivian</h4>
                                                <div class="text-xs text-neutral-500 uppercase tracking-wider">Automotive / EV</div>
                                            </div>
                                            <span class="rating-badge buy">BUY</span>
                                        </div>
                                        <p class="text-sm text-neutral-400 leading-relaxed mb-8">
                                            Production inflection meets gross margin expansion. Technology differentiation is real—this is Tesla 2018.
                                        </p>
                                        <div class="grid grid-cols-3 gap-px bg-off-white/10">
                                            <div class="bg-[#0F0F0F] p-4">
                                                <div class="text-[10px] font-mono text-neutral-600 uppercase tracking-widest mb-2">Target</div>
                                                <div class="text-2xl font-display font-bold">$28</div>
                                            </div>
                                            <div class="bg-[#0F0F0F] p-4">
                                                <div class="text-[10px] font-mono text-neutral-600 uppercase tracking-widest mb-2">Return</div>
                                                <div class="text-2xl font-display font-bold">+110%</div>
                                            </div>
                                            <div class="bg-[#0F0F0F] p-4">
                                                <div class="text-[10px] font-mono text-neutral-600 uppercase tracking-widest mb-2">Driver</div>
                                                <div class="text-xs text-neutral-300 mt-2">GM Expansion</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- KULR Card -->
                                <div class="stock-card sell cursor-pointer group" onclick="showCompanyDetail('AMEX:KULR')">
                                    <div class="p-8">
                                        <div class="flex justify-between items-start mb-6">
                                            <div>
                                                <div class="flex items-center gap-2 mb-2">
                                                    <span class="font-mono text-xs text-neutral-600">$KULR</span>
                                                    <span class="text-neutral-700">·</span>
                                                    <span class="text-xs text-neutral-600 uppercase tracking-wider">AMEX</span>
                                                </div>
                                                <h4 class="font-display text-2xl md:text-3xl font-medium mb-1">KULR Technology</h4>
                                                <div class="text-xs text-neutral-500 uppercase tracking-wider">Energy Storage</div>
                                            </div>
                                            <span class="rating-badge sell">SELL</span>
                                        </div>
                                        <p class="text-sm text-neutral-400 leading-relaxed mb-8">
                                            NASA validation doesn't equal commercial viability. Thermal management IP faces commoditization risk.
                                        </p>
                                        <div class="grid grid-cols-3 gap-px bg-off-white/10">
                                            <div class="bg-[#0F0F0F] p-4">
                                                <div class="text-[10px] font-mono text-neutral-600 uppercase tracking-widest mb-2">Target</div>
                                                <div class="text-2xl font-display font-bold">$0.80</div>
                                            </div>
                                            <div class="bg-[#0F0F0F] p-4">
                                                <div class="text-[10px] font-mono text-neutral-600 uppercase tracking-widest mb-2">Return</div>
                                                <div class="text-2xl font-display font-bold">-68%</div>
                                            </div>
                                            <div class="bg-[#0F0F0F] p-4">
                                                <div class="text-[10px] font-mono text-neutral-600 uppercase tracking-widest mb-2">Risk</div>
                                                <div class="text-xs text-neutral-300 mt-2">TAM Reality</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                            </div>
                                            <div class="metric-block">
                                                <div class="metric-label">Key Risk</div>
                                                <div class="text-xs text-neutral-300 mt-1">TAM Reality</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Framework Section -->
                        <div class="mt-16 pt-12 border-t border-off-white/10">
                            <h4 class="text-xs font-mono text-neutral-500 uppercase tracking-widest mb-8">Analytical Framework</h4>
                            <div class="grid grid-cols-2 md:grid-cols-5 gap-px bg-off-white/10">
                                <div class="p-4 bg-charcoal hover:bg-[#0F0F0F] transition-all text-center">
                                    <span class="text-xs font-mono">DCF Valuation</span>
                                </div>
                                <div class="p-4 bg-charcoal hover:bg-[#0F0F0F] transition-all text-center">
                                    <span class="text-xs font-mono">Comp Analysis</span>
                                </div>
                                <div class="p-4 bg-charcoal hover:bg-[#0F0F0F] transition-all text-center">
                                    <span class="text-xs font-mono">Scenario Modeling</span>
                                </div>
                                <div class="p-4 bg-charcoal hover:bg-[#0F0F0F] transition-all text-center">
                                    <span class="text-xs font-mono">Unit Economics</span>
                                </div>
                                <div class="p-4 bg-charcoal hover:bg-[#0F0F0F] transition-all text-center">
                                    <span class="text-xs font-mono">Five Forces</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- COMPANY DETAIL VIEW -->
                    <div id="company-detail-view" class="portfolio-view hidden">
                        <button onclick="hideCompanyDetail()" class="mb-8 flex items-center gap-2 text-neutral-500 hover:text-off-white transition-colors group">
                            <i data-lucide="arrow-left" class="w-4 h-4 group-hover:-translate-x-1 transition-transform"></i>
                            <span class="text-xs font-mono uppercase tracking-wider">Back to Portfolio</span>
                        </button>
                        
                        <!-- Header Strip -->
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-end gap-6 mb-8 pb-6 border-b border-off-white/10">
                            <div>
                                <div class="flex items-center gap-4 mb-3">
                                    <h2 class="font-display text-3xl md:text-4xl font-bold" id="detail-company-name">COMPANY</h2>
                                    <span class="rating-badge sell" id="detail-rating">SELL</span>
                                </div>
                                <div class="flex flex-wrap items-center gap-3 text-xs">
                                    <span class="font-mono text-neutral-300" id="detail-ticker">$SG</span>
                                    <span class="text-neutral-600">·</span>
                                    <span class="px-2 py-1 bg-off-white/5 text-neutral-400" id="detail-sector">RESTAURANTS</span>
                                    <span class="px-2 py-1 bg-off-white/5 text-neutral-400" id="detail-cap">SMID CAP</span>
                                </div>
                            </div>
                            <div class="flex items-center gap-3">
                                <span class="font-mono text-xs text-neutral-500 uppercase tracking-wider">LIVE DATA VIA TRADINGVIEW</span>
                            </div>
                        </div>

                        <!-- Tabs -->
                        <div class="tab-nav">
                            <button class="tab-btn active" data-tab="overview" onclick="switchTab('overview')">Overview</button>
                            <button class="tab-btn" data-tab="financials" onclick="switchTab('financials')">Financials</button>
                            <button class="tab-btn" data-tab="technicals" onclick="switchTab('technicals')">Technicals</button>
                            <button class="tab-btn" data-tab="news" onclick="switchTab('news')">News & Events</button>
                            <button class="tab-btn" data-tab="peers" onclick="switchTab('peers')">Peers</button>
                        </div>

                        <!-- Tab Content: Overview -->
                        <div id="tab-overview" class="tab-content active">
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                                <!-- Main Chart -->
                                <div class="lg:col-span-2">
                                    <div class="widget-wrapper h-[420px]">
                                        <div class="widget-header">Symbol Overview</div>
                                        <div class="widget-body h-[380px]" id="tv-overview-chart"></div>
                                    </div>
                                </div>
                                <!-- Side Stack -->
                                <div class="space-y-4">
                                    <div class="widget-wrapper h-[120px]">
                                        <div class="widget-header">Quote</div>
                                        <div class="widget-body h-[80px]" id="tv-symbol-info"></div>
                                    </div>
                                    <div class="widget-wrapper h-[280px]">
                                        <div class="widget-header">Company Profile</div>
                                        <div class="widget-body h-[240px] overflow-auto" id="tv-company-profile"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Research Panel -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="p-6 border border-off-white/10 bg-charcoal">
                                    <h4 class="font-mono text-xs text-neutral-500 uppercase tracking-wider mb-4">Variant View & Thesis</h4>
                                    <ul class="space-y-3 text-sm text-neutral-300" id="detail-thesis-list">
                                        <li>Loading...</li>
                                    </ul>
                                </div>
                                <div class="p-6 border border-off-white/10 bg-charcoal">
                                    <h4 class="font-mono text-xs text-neutral-500 uppercase tracking-wider mb-4">Key Catalysts</h4>
                                    <ul class="space-y-3 text-sm text-neutral-300" id="detail-catalyst-list">
                                        <li>Loading...</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <!-- Valuation Scenarios -->
                            <div class="mt-6 p-8 border border-off-white/10 bg-charcoal">
                                <h4 class="font-mono text-xs text-neutral-500 uppercase tracking-wider mb-6">DCF Scenario Analysis</h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="p-6 border border-off-white/10 bg-[#0F0F0F] hover:border-off-white/20 transition-all">
                                        <div class="text-xs text-neutral-500 mb-2 uppercase tracking-wider font-mono">Bear Case</div>
                                        <div id="scenario-bear" class="text-off-white font-display font-bold text-2xl mb-1">-30%</div>
                                        <div class="text-[10px] text-neutral-600 font-mono">30% Probability</div>
                                    </div>
                                    <div class="p-6 border-2 border-off-white/20 bg-[#0F0F0F] hover:border-off-white/30 transition-all">
                                        <div class="text-xs text-neutral-400 mb-2 uppercase tracking-wider font-mono">Base Case</div>
                                        <div id="scenario-base" class="text-off-white font-display font-bold text-2xl mb-1">+15%</div>
                                        <div class="text-[10px] text-neutral-600 font-mono">50% Probability</div>
                                    </div>
                                    <div class="p-6 border border-off-white/10 bg-[#0F0F0F] hover:border-off-white/20 transition-all">
                                        <div class="text-xs text-neutral-500 mb-2 uppercase tracking-wider font-mono">Bull Case</div>
                                        <div id="scenario-bull" class="text-off-white font-display font-bold text-2xl mb-1">+45%</div>
                                        <div class="text-[10px] text-neutral-600 font-mono">20% Probability</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab Content: Financials -->
                        <div id="tab-financials" class="tab-content">
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div class="widget-wrapper h-[550px]">
                                    <div class="widget-header">Financial Data</div>
                                    <div class="widget-body h-[510px]" id="tv-financials"></div>
                                </div>
                                <div class="space-y-6">
                                    <div class="p-6 border border-off-white/10 bg-charcoal">
                                        <h4 class="font-mono text-xs text-neutral-500 uppercase tracking-wider mb-6">Model vs Consensus</h4>
                                        <div class="space-y-4">
                                            <div class="p-4 border border-off-white/10 bg-[#0F0F0F]">
                                                <div class="flex justify-between mb-2">
                                                    <span class="text-sm text-neutral-300">Revenue CAGR (5y)</span>
                                                    <span class="text-xs text-neutral-500 font-mono">vs Consensus</span>
                                                </div>
                                                <div class="flex justify-between items-end">
                                                    <div class="text-2xl font-display font-bold">12.5%</div>
                                                    <div class="text-xs text-neutral-600">Cons: 9.8%</div>
                                                </div>
                                            </div>
                                            <div class="p-4 border border-off-white/10 bg-[#0F0F0F]">
                                                <div class="flex justify-between mb-2">
                                                    <span class="text-sm text-neutral-300">EBITDA Margin</span>
                                                    <span class="text-xs text-neutral-500 font-mono">vs Consensus</span>
                                                </div>
                                                <div class="flex justify-between items-end">
                                                    <div class="text-2xl font-display font-bold">18.2%</div>
                                                    <div class="text-xs text-neutral-600">Cons: 21.0%</div>
                                                </div>
                                            </div>
                                            <div class="p-4 border border-off-white/10 bg-[#0F0F0F]">
                                                <div class="flex justify-between mb-2">
                                                    <span class="text-sm text-neutral-300">Discount Rate (WACC)</span>
                                                    <span class="text-xs text-neutral-500 font-mono">Market Range</span>
                                                </div>
                                                <div class="flex justify-between items-end">
                                                    <div class="text-2xl font-display font-bold">11.5%</div>
                                                    <div class="text-xs text-neutral-600">Range: 10-13%</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab Content: Technicals -->
                        <div id="tab-technicals" class="tab-content">
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                <div class="widget-wrapper h-[450px]">
                                    <div class="widget-header">Technical Analysis</div>
                                    <div class="widget-body h-[410px]" id="tv-technicals"></div>
                                </div>
                                <div class="lg:col-span-2 widget-wrapper h-[450px]">
                                    <div class="widget-header">Advanced Chart</div>
                                    <div class="widget-body h-[410px]" id="tv-mini-chart"></div>
                                </div>
                            </div>
                            <div class="mt-6 p-6 border border-off-white/10 bg-charcoal">
                                <h4 class="font-mono text-xs text-neutral-500 uppercase tracking-wider mb-4">Tape vs Thesis</h4>
                                <p class="text-sm text-neutral-400 leading-relaxed">Technical signals should be weighted against fundamental thesis. Short-term momentum may diverge from long-term value realization. Use technicals for entry timing, not thesis validation.</p>
                            </div>
                        </div>

                        <!-- Tab Content: News -->
                        <div id="tab-news" class="tab-content">
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div class="widget-wrapper h-[550px]">
                                    <div class="widget-header">Latest News</div>
                                    <div class="widget-body h-[510px]" id="tv-news"></div>
                                </div>
                                <div class="widget-wrapper h-[550px]">
                                    <div class="widget-header">Economic Calendar</div>
                                    <div class="widget-body h-[510px]" id="tv-calendar"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab Content: Peers -->
                        <div id="tab-peers" class="tab-content">
                            <div class="widget-wrapper h-[450px] mb-6">
                                <div class="widget-header">Peer Screener</div>
                                <div class="widget-body h-[410px]" id="tv-screener"></div>
                            </div>
                            <div class="widget-wrapper h-[350px]">
                                <div class="widget-header">Market Overview</div>
                                <div class="widget-body h-[310px]" id="tv-market"></div>
                            </div>
                        </div>
                    </div>
                `
            },
            taskformer: {
                title: "CONSULTING PRACTICE",
                subtitle: "Financial Strategy & Operational Excellence",
                tags: ["M&A Advisory", "Financial Modeling", "Strategic Planning", "Process Optimization"],
                description: "Transforming organizational complexity into competitive advantage. I partner with founders and investors to diagnose operational friction, quantify strategic opportunities, and architect decision frameworks that drive measurable ROI.",
                details: `
                    <!-- Value Proposition Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-8">
                        <div>
                            <h4 class="text-xs font-mono text-neutral-400 uppercase tracking-widest mb-4">The Problem</h4>
                            <p class="text-sm text-neutral-300 leading-relaxed">
                                Most consultants deliver PowerPoint decks. I build decision frameworks you can actually use. Financial models that operators trust. Recommendations grounded in data, not theory.
                            </p>
                        </div>
                        <div>
                            <h4 class="text-xs font-mono text-neutral-400 uppercase tracking-widest mb-4">The Approach</h4>
                            <p class="text-sm text-neutral-300 leading-relaxed">
                                Forensic analysis → Strategic modeling → Executable roadmaps. Every engagement includes live financial models, scenario planning tools, and clear implementation timelines. No fluff.
                            </p>
                        </div>
                    </div>

                    <!-- Impact Metrics Dashboard -->
                    <div class="mt-12 p-8 border border-off-white/10 bg-[#0F0F0F]">
                        <h4 class="text-xs font-mono text-neutral-400 uppercase tracking-widest mb-8">Client Impact (2023-2024)</h4>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                            <div class="text-center">
                                <div class="font-display text-4xl font-bold mb-2">$8M</div>
                                <div class="text-xs font-mono text-neutral-500 uppercase tracking-wider">Capital Saved</div>
                            </div>
                            <div class="text-center">
                                <div class="font-display text-4xl font-bold mb-2">+12%</div>
                                <div class="text-xs font-mono text-neutral-500 uppercase tracking-wider">Avg Margin Lift</div>
                            </div>
                            <div class="text-center">
                                <div class="font-display text-4xl font-bold mb-2">$2.3M</div>
                                <div class="text-xs font-mono text-neutral-500 uppercase tracking-wider">Annual Savings</div>
                            </div>
                            <div class="text-center">
                                <div class="font-display text-4xl font-bold mb-2">6 Wks</div>
                                <div class="text-xs font-mono text-neutral-500 uppercase tracking-wider">Avg Engagement</div>
                            </div>
                        </div>
                    </div>

                    <!-- Service Matrix -->
                    <div class="mt-12 grid grid-cols-1 md:grid-cols-3 gap-px bg-off-white/10">
                        <div class="bg-charcoal p-6 hover:bg-[#0F0F0F] transition-all duration-300">
                            <div class="mb-4">
                                <span class="font-mono text-xs text-neutral-500">[01]</span>
                            </div>
                            <h5 class="font-display text-xl font-medium mb-3">Financial Modeling</h5>
                            <p class="text-xs text-neutral-400 leading-relaxed mb-4">Build models investors trust. DCF, LBO, merger scenarios with sensitivity analysis.</p>
                            <div class="flex flex-wrap gap-2">
                                <span class="px-2 py-1 bg-off-white/5 text-[9px] font-mono uppercase text-neutral-500">DCF</span>
                                <span class="px-2 py-1 bg-off-white/5 text-[9px] font-mono uppercase text-neutral-500">LBO</span>
                                <span class="px-2 py-1 bg-off-white/5 text-[9px] font-mono uppercase text-neutral-500">Valuation</span>
                            </div>
                        </div>
                        <div class="bg-charcoal p-6 hover:bg-[#0F0F0F] transition-all duration-300">
                            <div class="mb-4">
                                <span class="font-mono text-xs text-neutral-500">[02]</span>
                            </div>
                            <h5 class="font-display text-xl font-medium mb-3">M&A Advisory</h5>
                            <p class="text-xs text-neutral-400 leading-relaxed mb-4">Independent due diligence. Deal structuring. Buy-side and sell-side advisory.</p>
                            <div class="flex flex-wrap gap-2">
                                <span class="px-2 py-1 bg-off-white/5 text-[9px] font-mono uppercase text-neutral-500">DD</span>
                                <span class="px-2 py-1 bg-off-white/5 text-[9px] font-mono uppercase text-neutral-500">Deals</span>
                                <span class="px-2 py-1 bg-off-white/5 text-[9px] font-mono uppercase text-neutral-500">Risk</span>
                            </div>
                        </div>
                        <div class="bg-charcoal p-6 hover:bg-[#0F0F0F] transition-all duration-300">
                            <div class="mb-4">
                                <span class="font-mono text-xs text-neutral-500">[03]</span>
                            </div>
                            <h5 class="font-display text-xl font-medium mb-3">Operational Strategy</h5>
                            <p class="text-xs text-neutral-400 leading-relaxed mb-4">Unit economics. Pricing strategy. Cost optimization. KPI frameworks.</p>
                            <div class="flex flex-wrap gap-2">
                                <span class="px-2 py-1 bg-off-white/5 text-[9px] font-mono uppercase text-neutral-500">Margins</span>
                                <span class="px-2 py-1 bg-off-white/5 text-[9px] font-mono uppercase text-neutral-500">KPIs</span>
                                <span class="px-2 py-1 bg-off-white/5 text-[9px] font-mono uppercase text-neutral-500">Scale</span>
                            </div>
                        </div>
                    </div>

                    <!-- Process Flow -->
                    <div class="mt-12 border border-off-white/10 bg-[#030303] overflow-hidden">
                        <div class="px-6 py-4 border-b border-off-white/10 bg-[#0F0F0F]">
                            <h4 class="text-xs font-mono text-neutral-400 uppercase tracking-widest">6-Week Engagement Framework</h4>
                        </div>
                        <div class="p-8">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div class="relative">
                                    <div class="absolute top-0 left-0 w-12 h-12 border-2 border-off-white/30 flex items-center justify-center font-mono text-xs">01</div>
                                    <div class="ml-16">
                                        <div class="font-mono text-xs text-neutral-500 mb-2">WEEK 1-2</div>
                                        <h5 class="font-display text-lg font-medium mb-3">Discovery</h5>
                                        <ul class="space-y-2 text-xs text-neutral-400">
                                            <li>→ Forensic financial audit</li>
                                            <li>→ Stakeholder interviews</li>
                                            <li>→ Data infrastructure review</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="relative">
                                    <div class="absolute top-0 left-0 w-12 h-12 border-2 border-off-white/30 flex items-center justify-center font-mono text-xs">02</div>
                                    <div class="ml-16">
                                        <div class="font-mono text-xs text-neutral-500 mb-2">WEEK 3-4</div>
                                        <h5 class="font-display text-lg font-medium mb-3">Analysis</h5>
                                        <ul class="space-y-2 text-xs text-neutral-400">
                                            <li>→ Financial model construction</li>
                                            <li>→ Scenario planning</li>
                                            <li>→ Competitive benchmarking</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="relative">
                                    <div class="absolute top-0 left-0 w-12 h-12 border-2 border-off-white flex items-center justify-center font-mono text-xs bg-off-white text-black">03</div>
                                    <div class="ml-16">
                                        <div class="font-mono text-xs text-neutral-500 mb-2">WEEK 5-6</div>
                                        <h5 class="font-display text-lg font-medium mb-3">Delivery</h5>
                                        <ul class="space-y-2 text-xs text-neutral-400">
                                            <li>→ Live Excel models</li>
                                            <li>→ Implementation roadmap</li>
                                            <li>→ Decision frameworks</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Case Studies -->
                    <div class="mt-16">
                        <div class="flex justify-between items-end mb-8 pb-4 border-b border-off-white/10">
                            <h3 class="font-display text-2xl md:text-3xl font-medium">Representative Engagements</h3>
                            <span class="font-mono text-xs text-neutral-500 uppercase tracking-widest">2023 - 2024</span>
                        </div>
                        
                        <!-- Case Study 1 -->
                        <div class="mb-8 md:mb-12 border border-off-white/10 bg-charcoal">
                            <div class="p-4 sm:p-6 md:p-8 border-b border-off-white/10">
                                <div class="flex flex-col sm:flex-row justify-between items-start gap-3 mb-6">
                                    <div>
                                        <h4 class="font-display text-lg sm:text-xl font-medium mb-2">GROWTH-STAGE SAAS COMPANY</h4>
                                        <p class="font-mono text-xs text-neutral-500 uppercase tracking-widest">Series B · $15M ARR · 120 Employees</p>
                                    </div>
                                    <span class="font-mono text-xs border border-off-white/20 px-3 py-1 shrink-0">2024</span>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">
                                    <div>
                                        <h5 class="text-xs font-mono text-neutral-400 uppercase tracking-widest mb-3">Challenge</h5>
                                        <p class="text-sm text-neutral-300 leading-relaxed">
                                            Rapid revenue growth masking unit economics deterioration. CAC inflating 40% YoY, gross margins compressing. Board demanding clear path to profitability before Series C.
                                        </p>
                                    </div>
                                    <div>
                                        <h5 class="text-xs font-mono text-neutral-400 uppercase tracking-widest mb-3">Solution</h5>
                                        <p class="text-sm text-neutral-300 leading-relaxed">
                                            Built cohort-based LTV/CAC model, identified infrastructure cost savings, redesigned pricing architecture. Delivered 3-scenario financial model for fundraising conversations.
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="p-4 sm:p-6 md:p-8 bg-[#0F0F0F]">
                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 md:gap-8 text-xs font-mono">
                                    <div>
                                        <span class="text-neutral-500 block uppercase tracking-wider mb-2">Margin Improvement</span>
                                        <span class="text-off-white font-bold text-2xl">+12%</span>
                                    </div>
                                    <div>
                                        <span class="text-neutral-500 block uppercase tracking-wider mb-2">Annual Savings</span>
                                        <span class="text-off-white font-bold text-2xl">$2.3M</span>
                                    </div>
                                    <div>
                                        <span class="text-neutral-500 block uppercase tracking-wider mb-2">Series C Raised</span>
                                        <span class="text-off-white font-bold text-2xl">$25M</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Case Study 2 -->
                        <div class="mb-8 md:mb-12 border border-off-white/10 bg-charcoal">
                            <div class="p-4 sm:p-6 md:p-8 border-b border-off-white/10">
                                <div class="flex flex-col sm:flex-row justify-between items-start gap-3 mb-6">
                                    <div>
                                        <h4 class="font-display text-lg sm:text-xl font-medium mb-2">FAMILY OFFICE M&A ADVISORY</h4>
                                        <p class="font-mono text-xs text-neutral-500 uppercase tracking-widest">DTC Brand Acquisition · $8M Enterprise Value</p>
                                    </div>
                                    <span class="font-mono text-xs border border-off-white/20 px-3 py-1 shrink-0">2024</span>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">
                                    <div>
                                        <h5 class="text-xs font-mono text-neutral-400 uppercase tracking-widest mb-3">Challenge</h5>
                                        <p class="text-sm text-neutral-300 leading-relaxed">
                                            Seller claiming 40% EBITDA margins and 3.5x revenue multiple valuation. Client needed independent due diligence to validate financial projections and strategic assumptions.
                                        </p>
                                    </div>
                                    <div>
                                        <h5 class="text-xs font-mono text-neutral-400 uppercase tracking-widest mb-3">Solution</h5>
                                        <p class="text-sm text-neutral-300 leading-relaxed">
                                            Forensic analysis revealed aggressive accounting practices. True normalized margins: 22%. Concentration risk: 78% revenue from 3 SKUs. Advised walk-away. Target filed Chapter 11 six months later.
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="p-4 sm:p-6 md:p-8 bg-[#0F0F0F]">
                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 md:gap-8 text-xs font-mono">
                                    <div>
                                        <span class="text-neutral-500 block uppercase tracking-wider mb-2">Claimed EBITDA</span>
                                        <span class="text-off-white font-bold text-2xl">40%</span>
                                    </div>
                                    <div>
                                        <span class="text-neutral-500 block uppercase tracking-wider mb-2">Actual EBITDA</span>
                                        <span class="text-off-white font-bold text-2xl">22%</span>
                                    </div>
                                    <div>
                                        <span class="text-neutral-500 block uppercase tracking-wider mb-2">Capital Saved</span>
                                        <span class="text-off-white font-bold text-2xl">$8M</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Case Study 3 -->
                        <div class="border border-off-white/10 bg-charcoal">
                            <div class="p-4 sm:p-6 md:p-8 border-b border-off-white/10">
                                <div class="flex flex-col sm:flex-row justify-between items-start gap-3 mb-6">
                                    <div>
                                        <h4 class="font-display text-lg sm:text-xl font-medium mb-2">OPERATIONAL EFFICIENCY PROJECT</h4>
                                        <p class="font-mono text-xs text-neutral-500 uppercase tracking-widest">E-Commerce · Mid-Market · Supply Chain Optimization</p>
                                    </div>
                                    <span class="font-mono text-xs border border-off-white/20 px-3 py-1 shrink-0">2023</span>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">
                                    <div>
                                        <h5 class="text-xs font-mono text-neutral-400 uppercase tracking-widest mb-3">Challenge</h5>
                                        <p class="text-sm text-neutral-300 leading-relaxed">
                                            Margin compression from rising fulfillment costs. $1.2M trapped in excess inventory. Management lacked visibility into true product-level profitability and unit economics.
                                        </p>
                                    </div>
                                    <div>
                                        <h5 class="text-xs font-mono text-neutral-400 uppercase tracking-widest mb-3">Solution</h5>
                                        <p class="text-sm text-neutral-300 leading-relaxed">
                                            Activity-based costing framework revealed 32% of SKUs destroying value. Rationalized 180 products, optimized inventory turnover (87→52 days), built real-time margin dashboard.
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="p-4 sm:p-6 md:p-8 bg-[#0F0F0F]">
                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 md:gap-8 text-xs font-mono">
                                    <div>
                                        <span class="text-neutral-500 block uppercase tracking-wider mb-2">Working Capital</span>
                                        <span class="text-off-white font-bold text-2xl">+$780K</span>
                                    </div>
                                    <div>
                                        <span class="text-neutral-500 block uppercase tracking-wider mb-2">SKU Reduction</span>
                                        <span class="text-off-white font-bold text-2xl">-180</span>
                                    </div>
                                    <div>
                                        <span class="text-neutral-500 block uppercase tracking-wider mb-2">Margin Gain</span>
                                        <span class="text-off-white font-bold text-2xl">+7.2%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Methodology -->
                    <div class="mt-12 md:mt-16 border border-off-white/10 bg-[#0F0F0F]">
                        <div class="p-4 sm:p-6 md:p-8 border-b border-off-white/10">
                            <h4 class="text-xs font-mono text-neutral-400 uppercase tracking-widest">Analytical Framework</h4>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-px bg-off-white/10">
                            <div class="p-6 md:p-8 bg-[#0F0F0F]">
                                <div class="mb-4">
                                    <span class="font-mono text-xs text-neutral-500">[01]</span>
                                </div>
                                <h5 class="font-display text-base sm:text-lg font-medium mb-3">QUANTIFY STATUS QUO</h5>
                                <p class="text-xs text-neutral-400 leading-relaxed">Build comprehensive models mapping current operations. Identify inflection points, bottlenecks, hidden value drivers. No assumptions without evidence.</p>
                            </div>
                            <div class="p-6 md:p-8 bg-[#0F0F0F]">
                                <div class="mb-4">
                                    <span class="font-mono text-xs text-neutral-500">[02]</span>
                                </div>
                                <h5 class="font-display text-base sm:text-lg font-medium mb-3">STRESS TEST ASSUMPTIONS</h5>
                                <p class="text-xs text-neutral-400 leading-relaxed">Sensitivity analysis on all variables. What breaks the model? Monte Carlo simulation for uncertainty quantification and tail risk management.</p>
                            </div>
                            <div class="p-6 md:p-8 bg-[#0F0F0F]">
                                <div class="mb-4">
                                    <span class="font-mono text-xs text-neutral-500">[03]</span>
                                </div>
                                <h5 class="font-display text-base sm:text-lg font-medium mb-3">DESIGN OPTIMAL CONFIGURATION</h5>
                                <p class="text-xs text-neutral-400 leading-relaxed">Engineer decision frameworks maximizing expected value while managing tail risks. Focus on measurable, controllable, scalable interventions.</p>
                            </div>
                            <div class="p-6 md:p-8 bg-[#0F0F0F]">
                                <div class="mb-4">
                                    <span class="font-mono text-xs text-neutral-500">[04]</span>
                                </div>
                                <h5 class="font-display text-base sm:text-lg font-medium mb-3">IMPLEMENT & ITERATE</h5>
                                <p class="text-xs text-neutral-400 leading-relaxed">Deliver actionable recommendations with KPIs. Build dashboards for ongoing monitoring. Continuous feedback loops for systematic refinement.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Service Catalog -->
                    <div class="mt-12 md:mt-16 border border-off-white/10 bg-charcoal">
                        <div class="p-4 sm:p-6 md:p-8 border-b border-off-white/10">
                            <h3 class="font-display text-lg sm:text-xl font-medium">Service Catalog</h3>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-px bg-off-white/10">
                            <div class="p-6 md:p-8 bg-charcoal">
                                <h4 class="text-xs font-mono text-neutral-400 uppercase tracking-widest mb-6">Financial Advisory</h4>
                                <ul class="space-y-3 font-mono text-xs sm:text-sm">
                                    <li class="flex items-start gap-3 text-neutral-300">
                                        <span class="text-off-white mt-1">→</span>
                                        <span>DCF Valuation & Financial Modeling</span>
                                    </li>
                                    <li class="flex items-start gap-3 text-neutral-300">
                                        <span class="text-off-white mt-1">→</span>
                                        <span>M&A Due Diligence & Deal Analysis</span>
                                    </li>
                                    <li class="flex items-start gap-3 text-neutral-300">
                                        <span class="text-off-white mt-1">→</span>
                                        <span>Capital Structure Optimization</span>
                                    </li>
                                    <li class="flex items-start gap-3 text-neutral-300">
                                        <span class="text-off-white mt-1">→</span>
                                        <span>Fundraising Strategy & Pitch Review</span>
                                    </li>
                                    <li class="flex items-start gap-3 text-neutral-300">
                                        <span class="text-off-white mt-1">→</span>
                                        <span>Unit Economics & Cohort Analysis</span>
                                    </li>
                                </ul>
                            </div>
                            <div class="p-6 md:p-8 bg-charcoal">
                                <h4 class="text-xs font-mono text-neutral-400 uppercase tracking-widest mb-6">Strategic Operations</h4>
                                <ul class="space-y-3 font-mono text-xs sm:text-sm">
                                    <li class="flex items-start gap-3 text-neutral-300">
                                        <span class="text-off-white mt-1">→</span>
                                        <span>Business Process Redesign</span>
                                    </li>
                                    <li class="flex items-start gap-3 text-neutral-300">
                                        <span class="text-off-white mt-1">→</span>
                                        <span>KPI Framework Development</span>
                                    </li>
                                    <li class="flex items-start gap-3 text-neutral-300">
                                        <span class="text-off-white mt-1">→</span>
                                        <span>Pricing Strategy & Revenue Optimization</span>
                                    </li>
                                    <li class="flex items-start gap-3 text-neutral-300">
                                        <span class="text-off-white mt-1">→</span>
                                        <span>Cost Reduction & Margin Improvement</span>
                                    </li>
                                    <li class="flex items-start gap-3 text-neutral-300">
                                        <span class="text-off-white mt-1">→</span>
                                        <span>Decision Framework Architecture</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `
            },
        };

        const writingData = {
            legacy: {
                meta: { date: "DEC 2024", category: "CONSULTING", readTime: "6 MIN" },
                title: "Legacy Systems & The Art of the Exit",
                lede: "Navigating the technical and operational complexities of winding down a mid-sized logistics firm. How we managed 15TB of legacy database archives, ensured regulatory compliance, and executed a graceful systematic shutdown.",
                content: `
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6 drop-cap">
                        There is no glory in a shutdown. It is the hospice care of the corporate world. Yet, the technical challenges of winding down a 20-year-old logistics firm with 15TB of data and 40 interconnected subsystems rival those of any greenfield launch. The goal is not growth; it is <span class="interactive-term" data-term="Data Archival">immutable finality<span class="term-tooltip">The process of preserving data in a state that cannot be modified, ensuring historical accuracy for regulatory and legal purposes.</span></span>.
                    </p>
                    <div class="my-12 border-l-4 border-black pl-6 py-2">
                        <p class="font-playfair italic text-3xl md:text-4xl leading-tight">"Code is liability. Data is risk. The only secure system is one that is turned off."</p>
                    </div>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        We faced a sprawling monolith of Oracle databases, SOAP APIs, and undocumented cron jobs. The first step was <span class="interactive-term" data-term="Dependency Mapping">dependency mapping<span class="term-tooltip">Visualizing and documenting the relationships between software components to understand the impact of removing or modifying them.</span></span>. We used static analysis tools to trace data flows, discovering that the payroll system depended on a legacy inventory view that hadn't been updated in three years. Turning off one server could trigger a cascade of failures in compliance reporting.
                    </p>
                    <h3 class="font-display text-2xl font-bold mt-12 mb-4">The Archival Strategy</h3>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        Regulatory requirements demanded 7 years of data retention. Keeping the Oracle instances running was cost-prohibitive ($15k/month). We devised a <span class="interactive-term" data-term="Cold Storage">cold storage migration<span class="term-tooltip">Moving inactive data to low-cost storage tiers (like AWS Glacier) where retrieval is slow but retention is cheap.</span></span> plan. We exported all relational data to Apache Parquet files, preserving schema and types, and stored them in AWS S3 Glacier Deep Archive. Cost dropped to $40/month.
                        <span class="sparkline" data-values="15000,15000,12000,8000,4000,1000,500,100,40,40,40"></span>
                    </p>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        For the application logic, we containerized the core business rules into a lightweight Docker image, stripped of all UI and external integrations. This "black box" could be spun up on-demand if an auditor needed to re-run a specific calculation from 2018. It was a digital time capsule.
                    </p>
                    <h3 class="font-display text-2xl font-bold mt-12 mb-4">The Human Element</h3>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        The hardest part wasn't technical. It was managing the morale of a team coding their own obsolescence. We implemented "retention bonuses" tied to successful decommissioning milestones. We framed the project not as a death, but as a "successful exit" – a final, professional execution of duty. In the end, the servers went dark, the S3 buckets were locked, and the keys were handed over. Silence is the sound of a job well done.
                    </p>
                `,
                nextSlug: "web3_migration"
            },
            web3_migration: {
                meta: { date: "NOV 2024", category: "CONSULTING", readTime: "7 MIN" },
                title: "Bridging the Gap: Web2 to Web3",
                lede: "A case study on helping a traditional fintech client integrate on-chain settlement layers. Overcoming custody challenges, smart contract auditing, and the cultural shift from centralized databases to distributed ledgers.",
                content: `
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6 drop-cap">
                        The client was a mid-sized neobank processing $500M in monthly volume. They wanted "crypto exposure." They didn't understand that they were asking to replace their database with a global, adversarial state machine. Integrating <span class="interactive-term" data-term="Web3 Settlement">on-chain settlement<span class="term-tooltip">Finalizing financial transactions on a blockchain, providing transparency and immutability but requiring strict key management.</span></span> into a Web2 stack is not an API integration; it's a paradigm shift.
                    </p>
                    <div class="my-12 border-l-4 border-black pl-6 py-2">
                        <p class="font-playfair italic text-3xl md:text-4xl leading-tight">"In Web2, you trust the admin. In Web3, you trust the math. The admin is usually easier to sue."</p>
                    </div>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        The immediate hurdle was <span class="interactive-term" data-term="Custody">custody<span class="term-tooltip">The safeguarding of private keys that control digital assets. Self-custody means you hold the keys; third-party custody means a provider holds them.</span></span>. The client wanted to hold user funds. We explained that "holding funds" meant managing private keys in a Hardware Security Module (HSM) with multi-party computation (MPC) signing. One leaked key, and the bank is insolvent. We architected a hybrid solution: a qualified custodian for the bulk of assets, and a hot wallet for daily liquidity, rebalanced automatically via smart contracts.
                    </p>
                    <h3 class="font-display text-2xl font-bold mt-12 mb-4">The Reconciliation Nightmare</h3>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        Blockchains don't close at 5 PM. They don't have weekends. The client's legacy ledger expected a daily "end of day" batch process. We built a real-time <span class="interactive-term" data-term="Indexer">indexer<span class="term-tooltip">Software that reads blockchain data, parses it, and stores it in a queryable database (like SQL) for applications to use.</span></span> that listened to chain events and updated the internal SQL ledger. The challenge was handling "reorgs" – when the blockchain rewrites the last few blocks. Our system had to be able to "rewind" the SQL state to match the chain truth.
                        <span class="sparkline" data-values="0,10,25,40,35,50,65,60,80,90,100"></span>
                    </p>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        We also implemented a "gas station" network to abstract transaction fees from users. The bank paid the ETH; the user just saw a "Processing..." spinner. It was a seamless UX wrapper around a chaotic decentralized core.
                    </p>
                    <h3 class="font-display text-2xl font-bold mt-12 mb-4">Cultural Divergence</h3>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        The biggest friction was cultural. Compliance officers wanted to "reverse" suspicious transactions. We had to explain immutability. Developers wanted to "hotfix" bugs. We had to explain smart contract audits and timelocks. Bridging Web2 and Web3 isn't just code; it's education. It's teaching a centralized organization how to survive in a decentralized world.
                    </p>
                `,
                nextSlug: "automating_alpha"
            },
            automating_alpha: {
                meta: { date: "OCT 2024", category: "ENGINEERING", readTime: "8 MIN" },
                title: "Automating Alpha",
                lede: "Building autonomous research agents that parse 10-Ks and earnings call transcripts. Using LLMs to extract structured sentiment data and detect divergence from consensus estimates.",
                content: `
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6 drop-cap">
                        Alpha is information asymmetry. In the age of high-frequency trading, speed is commoditized. The new frontier is <span class="interactive-term" data-term="Unstructured Data">unstructured data<span class="term-tooltip">Information that doesn't fit into a pre-defined data model, like text, audio, and video. 80% of enterprise data is unstructured.</span></span>. 10-Ks, earnings calls, expert network transcripts – these contain the signal, buried in noise. We built a fleet of autonomous agents to mine it.
                    </p>
                    <div class="my-12 border-l-4 border-black pl-6 py-2">
                        <p class="font-playfair italic text-3xl md:text-4xl leading-tight">"The market reacts to the headline. The alpha is in the footnotes."</p>
                    </div>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        The pipeline starts with ingestion. We scrape EDGAR for filings and use speech-to-text for earnings calls. The raw text is chunked and fed into a vector database (Pinecone) for semantic search. But the real magic happens in the <span class="interactive-term" data-term="LLM Analysis">LLM layer<span class="term-tooltip">Using Large Language Models (like GPT-4) to reason about text, extract facts, and perform sentiment analysis.</span></span>. We don't just ask "is this positive?" We ask specific, structured questions: "What is the guidance for Q4?" "Is the CEO hedging on supply chain issues?" "Compare the tone of the CFO's answer to the analyst's question."
                    </p>
                    <h3 class="font-display text-2xl font-bold mt-12 mb-4">Sentiment Divergence</h3>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        We built a "Divergence Score." We compare the LLM's extracted sentiment of the management team against the consensus analyst ratings. When management sounds cautious but analysts are bullish, that's a short signal. When management is confident but the stock is beaten down, that's a long.
                        <span class="sparkline" data-values="50,52,48,45,60,75,80,70,65,55,50"></span>
                    </p>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        The system flagged a divergence in a major retailer's Q3 call. The CEO mentioned "inventory headwinds" 12 times, up from 2 in Q2. Analysts ignored it, focusing on top-line growth. The stock dropped 15% two weeks later when they revised guidance. The agent saw the smoke before the fire.
                    </p>
                    <h3 class="font-display text-2xl font-bold mt-12 mb-4">The Hallucination Risk</h3>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        LLMs hallucinate. In finance, a hallucinated number is a P&L disaster. We implemented a "Citation Verification" step. The agent must provide the exact sentence from the source text that supports its conclusion. If it can't cite it, the insight is discarded. We also use an ensemble of models – if GPT-4, Claude, and Llama 3 disagree, a human analyst is alerted. Automation is leverage, not autopilot.
                    </p>
                `,
                nextSlug: "fintech_future"
            },
            fintech_future: {
                meta: { date: "SEP 2024", category: "ENGINEERING", readTime: "9 MIN" },
                title: "The Future of Fintech",
                lede: "Designing resilient financial systems on public blockchains. Exploring the intersection of zero-knowledge proofs and regulatory compliance in DeFi.",
                content: `
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6 drop-cap">
                        DeFi (Decentralized Finance) promised a revolution: open, permissionless, transparent markets. It delivered a casino. But beneath the speculation, the infrastructure of the future is being laid. The convergence of <span class="interactive-term" data-term="ZK Proofs">Zero-Knowledge Proofs<span class="term-tooltip">Cryptographic methods that allow one party to prove to another that a statement is true without revealing any information beyond the validity of the statement itself.</span></span> and institutional compliance is where the real disruption lies.
                    </p>
                    <div class="my-12 border-l-4 border-black pl-6 py-2">
                        <p class="font-playfair italic text-3xl md:text-4xl leading-tight">"Privacy is not secrecy. Privacy is the right to selectively reveal."</p>
                    </div>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        The problem with public blockchains is that they are *too* public. A hedge fund cannot trade on Uniswap if every competitor can see their position size and entry price. This is where ZK-rollups come in. They allow for computation to happen off-chain (privately) while posting a cryptographic proof of validity on-chain. You get the security of Ethereum with the privacy of a dark pool.
                    </p>
                    <h3 class="font-display text-2xl font-bold mt-12 mb-4">Compliance by Design</h3>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        Regulators demand KYC/AML. DeFi demands permissionlessness. These seem incompatible. They aren't. We are prototyping <span class="interactive-term" data-term="Verifiable Credentials">verifiable credentials<span class="term-tooltip">Digital credentials that are cryptographically signed by an issuer (like a government or bank) and can be presented by a holder to a verifier without revealing the underlying data.</span></span>. A user proves they are "Accredited" or "Not Sanctioned" using a ZK proof generated from their passport data, without revealing their identity to the protocol. The smart contract checks the proof, not the passport.
                        <span class="sparkline" data-values="10,15,25,40,60,55,70,85,90,95,100"></span>
                    </p>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        This "Compliance Layer" sits on top of the permissionless base layer. It allows institutions to participate in DeFi liquidity pools without violating their mandates. It is the bridge that brings the $100T of traditional assets on-chain.
                    </p>
                    <h3 class="font-display text-2xl font-bold mt-12 mb-4">Resilience Engineering</h3>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        Smart contracts are immutable. Bugs are forever. We are adopting formal verification methods – mathematically proving that the code behaves as intended – for core protocol logic. We are also designing "circuit breakers" that pause trading if volatility or drawdown metrics exceed safety thresholds. The future of fintech isn't just about moving money faster; it's about moving it safer, with mathematical guarantees that no central bank can offer.
                    </p>
                `,
                nextSlug: "convexity"
            },
            convexity: {
                meta: { date: "DEC 2025", category: "FIXED INCOME", readTime: "8 MIN" },
                title: "The Convexity Trap",
                lede: "Why negative convexity in MBS portfolios destroyed hedge funds in 2022. A technical autopsy of duration extension and gamma hedging failures.",
                content: `
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6 drop-cap">
                        Duration is a first-order approximation. <span class="interactive-term" data-term="Convexity">Convexity<span class="term-tooltip">The second derivative of bond price with respect to yield, measuring the curvature of the price-yield relationship.</span></span> is where mortals become gods or corpses. In March 2022, as the Fed pivoted hawkish and 10-year yields spiked 80bps in three weeks, agency MBS portfolios experienced what traders euphemistically call "extension risk." What they actually experienced was financial obliteration.
                    </p>
                    <div class="my-12 border-l-4 border-black pl-6 py-2">
                        <p class="font-playfair italic text-3xl md:text-4xl leading-tight">"Negative convexity is a short volatility position you didn't know you owned."</p>
                    </div>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        The mathematics are elegant but brutal. For a standard fixed-rate bond, convexity is positive: price increases accelerate as yields fall, and price decreases decelerate as yields rise. You win bigger than you lose. But <span class="interactive-term" data-term="MBS Negative Convexity">mortgage-backed securities<span class="term-tooltip">Agency MBS exhibit negative convexity due to embedded prepayment options held by homeowners.</span></span> embed a prepayment option that homeowners own. When rates fall, refinancing accelerates-your bond gets called away at par just as prices should soar. When rates rise, prepayments stop-you're stuck with a 30-year duration instrument in a rising rate regime.
                        <span class="sparkline" data-values="100,102,105,104,108,106,103,98,92,85,78"></span>
                    </p>
                    <h3 class="font-display text-2xl font-bold mt-12 mb-4">The Duration Extension Cascade</h3>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        Effective duration for a 30-year 3% MBS coupon sat at ~4.2 years in January 2022 when the 10-year was 1.50%. By June, with the 10-year at 3.00%, that same security's duration had extended to ~7.8 years. The convexity adjustment term in the Taylor series expansion: ΔP ≈ -D × Δy + ½C × (Δy)². For MBS, C &lt; 0. The portfolio hemorrhaged value not just from rising rates, but from the accelerating pace of losses as duration stretched like taffy.
                    </p>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        Dealers attempted to <span class="interactive-term" data-term="Gamma Hedging">gamma hedge<span class="term-tooltip">Dynamically adjusting delta hedge positions to remain neutral to second-order price movements.</span></span> by selling duration into the selloff-exacerbating the rate spike in a doom loop. The TBA market saw bid-ask spreads blow out to 8/32nds on peak volatility days. Convexity hedging flows became the dominant price action driver, overwhelming fundamental supply-demand dynamics.
                    </p>
                    <h3 class="font-display text-2xl font-bold mt-12 mb-4">Quantitative Postmortem</h3>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        The failure wasn't in the models-OAS frameworks accurately priced the prepayment risk. The failure was in <span class="interactive-term" data-term="Basis Risk">basis risk<span class="term-tooltip">The risk that hedging instruments don't move perfectly in correlation with the underlying exposure.</span></span> management and liquidity assumptions. Funds hedged with Treasury futures, assuming a stable 90% hedge ratio. When MBS-Treasury spreads widened 45bps in two weeks, the hedge ratio collapsed to 0.65. The "basis" was supposed to be stable. It wasn't.
                        <span class="sparkline" data-values="90,89,88,85,80,72,65,68,70,75,78"></span>
                    </p>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        The lesson: Duration measures local sensitivity. Convexity measures how that sensitivity itself changes. In leveraged portfolios with negative convexity, small rate moves trigger large hedge adjustments, which in illiquid markets become self-fulfilling prophecies. The second derivative killed more P&L than the first.
                    </p>
                `,
                nextSlug: "terminal"
            },
            terminal: {
                meta: { date: "NOV 2025", category: "VALUATION", readTime: "7 MIN" },
                title: "Terminal Value Deconstructed",
                lede: "The 80% problem in DCF models. Why perpetuity growth assumptions mask value creation and how to build defensible exit multiples.",
                content: `
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6 drop-cap">
                        In most discounted cash flow models, 70-85% of enterprise value lives in the <span class="interactive-term" data-term="Terminal Value">terminal value<span class="term-tooltip">The present value of all future cash flows beyond the explicit forecast period, typically calculated using a perpetuity growth method or exit multiple.</span></span> calculation. This is not a feature. This is an admission that we're guessing. And yet, analysts treat the perpetuity growth rate with the reverence of a physical constant. g = 2.5%. Always. Forever. Because GDP.
                    </p>
                    <div class="my-12 border-l-4 border-black pl-6 py-2">
                        <p class="font-playfair italic text-3xl md:text-4xl leading-tight">"A DCF is a philosophy disguised as mathematics."</p>
                    </div>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        The Gordon Growth Model assumes perpetual constant growth: TV = FCFₙ₊₁ / (WACC - g). Elegant. Convenient. Catastrophically sensitive. A 50bps swing in g or WACC moves valuation by 30-40%. This isn't precision-it's astrology with Greek letters. The model forces infinite compounding at a rate that, if sustained, would make any firm larger than global GDP within a century. We know this is absurd. We plug in the number anyway.
                    </p>
                    <h3 class="font-display text-2xl font-bold mt-12 mb-4">The Exit Multiple Alternative</h3>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        Exit multiples ground terminal value in empirical reality: TV = EBITDAₙ × EV/EBITDA. The multiple reflects <span class="interactive-term" data-term="Comparable Transactions">comp set analysis<span class="term-tooltip">Valuation methodology using multiples from comparable company transactions or trading values.</span></span>-what buyers actually paid for similar assets. But here's the trap: you're anchoring to current multiples, which embed current growth expectations, which may be wildly optimistic or pessimistic. You've just made the model circular.
                        <span class="sparkline" data-values="12,13,14,15,14,13,11,9,10,11,12"></span>
                    </p>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        The intellectually honest approach: decompose the multiple into its fundamental drivers. The implied exit multiple is: (1 - g/ROIC) × (1 + g) / (WACC - g), where ROIC is the perpetual return on incremental invested capital. If ROIC &gt; WACC, the firm creates value through reinvestment. If ROIC &lt; WACC, growth destroys value-the firm should distribute cash, not reinvest it.
                    </p>
                    <h3 class="font-display text-2xl font-bold mt-12 mb-4">The Fade Rate Framework</h3>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        No competitive advantage lasts forever. Instead of assuming constant growth, model a <span class="interactive-term" data-term="Fade Rate">fade rate<span class="term-tooltip">The rate at which a company's excess returns decay toward its cost of capital over time, reflecting competitive pressure.</span></span>: high initial growth decaying toward the risk-free rate over 20-40 years. This reflects economic reality-mean reversion, technological obsolescence, competitive entry. The formula: gₜ = (gᵢₙᵢₜᵢₐₗ - r_f) × e^(-λt) + r_f, where λ is the decay constant calibrated to industry half-life.
                    </p>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        The fade rate transforms terminal value from a binary guess into a probabilistic decay function. It forces explicit assumptions about durability of competitive moats. And it produces valuations that aren't 80% dependent on what happens after year 10. The math is harder. The intellectual honesty is worth it.
                        <span class="sparkline" data-values="15,14,13,11,9,7,5,4,3,2.5,2.5"></span>
                    </p>
                `,
                nextSlug: "variance"
            },
            variance: {
                meta: { date: "OCT 2025", category: "DERIVATIVES", readTime: "9 MIN" },
                title: "Variance Risk Premium Extraction",
                lede: "Decomposing realized vs. implied volatility spreads. Statistical arbitrage strategies in VIX futures term structure and variance swap mechanics.",
                content: `
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6 drop-cap">
                        The market systematically overprices volatility. This isn't a behavioral quirk-it's a structural risk premium. Investors pay to hedge tail risk. Sellers collect that premium. The <span class="interactive-term" data-term="Variance Risk Premium">variance risk premium<span class="term-tooltip">The difference between implied variance (from option prices) and subsequently realized variance, representing compensation for bearing volatility risk.</span></span> (VRP) is the spread between implied variance and realized variance, annualized at ~3-5 volatility points on the S&P 500. Over two decades, selling this premium has generated Sharpe ratios exceeding 1.0-if you survive the crashes.
                    </p>
                    <div class="my-12 border-l-4 border-black pl-6 py-2">
                        <p class="font-playfair italic text-3xl md:text-4xl leading-tight">"Variance swaps are the purest expression of volatility. No delta. No gamma leak. Just convexity."</p>
                    </div>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        A <span class="interactive-term" data-term="Variance Swap">variance swap<span class="term-tooltip">An OTC derivative that allows direct speculation or hedging of realized variance over a period, with payoff = Notional × (Realized Variance - Strike Variance).</span></span> pays the difference between realized variance and a fixed strike: Payoff = N × (σ²_realized - σ²_strike). No path dependence. No rebalancing. Pure variance exposure. The fair strike is calculated from the full strip of option prices across the smile using the model-free replication formula: σ²_IV = (2/T) ∫ [Q(K)/K²] dK, where Q(K) is the price of an OTM option at strike K.
                    </p>
                    <h3 class="font-display text-2xl font-bold mt-12 mb-4">VIX Futures Term Structure Dynamics</h3>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        The VIX futures curve is typically in <span class="interactive-term" data-term="Contango">contango<span class="term-tooltip">A market condition where futures prices are higher than spot prices, often due to storage costs or negative convenience yield.</span></span>-front-month trades 10-15% below the 3-month contract. This reflects the VRP: implied vol embedded in futures exceeds expected realized vol. But the curve isn't static. In normal regimes, it slopes upward at ~0.5 VIX points per month. During spikes (VIX &gt; 30), it inverts into backwardation as front-month fear dominates distant expectations.
                        <span class="sparkline" data-values="15,16,17,18,19,20,21,22,35,30,25"></span>
                    </p>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        The classic VRP trade: sell front-month VIX futures, roll monthly, collect the contango decay. The XIV ETN executed this mechanically until February 2018, when the VIX spiked 116% intraday and the product terminated. The strategy works 95% of the time. The other 5% bankrupts you. This is the essence of <span class="interactive-term" data-term="Taleb's Ludic Fallacy">crisis alpha asymmetry<span class="term-tooltip">Strategies that collect small, frequent gains but suffer catastrophic losses during tail events due to negative skewness.</span></span>: positive carry, negative skew.
                    </p>
                    <h3 class="font-display text-2xl font-bold mt-12 mb-4">Empirical Term Structure Models</h3>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        To extract VRP systematically, model the term structure as a mean-reverting process: dVIXₜ = κ(θ - VIXₜ)dt + σ√VIXₜ dWₜ. Calibrate κ (mean reversion speed) and θ (long-run mean) from historical data. The model implies that when VIX &gt; θ + 2σ, the curve should flatten-sell front and buy back end. When VIX &lt; θ - σ, steepen-short back end, long front.
                    </p>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        Empirical calibration on 2010-2024 data: κ ≈ 0.8 (mean reversion half-life ~0.9 years), θ ≈ 18.5, σ_vol-of-vol ≈ 0.65. Backtest shows roll-yield strategies capturing 70% of theoretical VRP, net of transaction costs and slippage. The key: dynamic position sizing inversely proportional to VIX level. Never naked short volatility. Use variance swaps or calendar spreads to isolate term structure exposure from outright level.
                        <span class="sparkline" data-values="5,4,5,6,5,7,6,8,15,10,6"></span>
                    </p>
                    <h3 class="font-display text-2xl font-bold mt-12 mb-4">The Volatility of Volatility Problem</h3>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        VRP extraction isn't free money. The risk is vol-of-vol (vvix): when volatility itself becomes volatile, your P&L distribution gets fat tails. VVIX &gt; 120 signals regime change-VRP inverts, and sellers get annihilated. The solution: trade variance dispersion instead of outright variance. Sell index variance, buy single-stock variance. Capture the spread while hedging systemic jumps. Correlation drops during crises-dispersion widens, offsetting index variance losses.
                    </p>
                `,
                nextSlug: "bootstrap"
            },
            bootstrap: {
                meta: { date: "SEP 2025", category: "FIXED INCOME", readTime: "8 MIN" },
                title: "Bootstrapping the Yield Curve",
                lede: "From SOFR swaps to zero-coupon rates. The mechanics of curve construction, interpolation methods, and cross-currency basis adjustments.",
                content: `
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6 drop-cap">
                        Every derivative pricing model requires a discount curve. Build it wrong, and every valuation downstream is contaminated. The <span class="interactive-term" data-term="Bootstrapping">bootstrapping algorithm<span class="term-tooltip">An iterative method to extract zero-coupon rates from observed market prices of coupon-bearing bonds or swaps.</span></span> converts messy market quotes-SOFR swaps, Treasury bonds, Eurodollar futures-into a smooth zero-coupon yield curve. The process is both mechanical and surgical. One wrong assumption about day-count conventions or compounding frequency, and your 10-year swap rate is mispriced by 3 basis points. In a $500M notional swap, that's $1.5M of P&L error.
                    </p>
                    <div class="my-12 border-l-4 border-black pl-6 py-2">
                        <p class="font-playfair italic text-3xl md:text-4xl leading-tight">"The curve is not given. The curve is constructed."</p>
                    </div>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        Post-LIBOR transition, <span class="interactive-term" data-term="SOFR">SOFR<span class="term-tooltip">Secured Overnight Financing Rate: the risk-free rate based on Treasury repo transactions, replacing LIBOR as the USD benchmark.</span></span> is the foundation. Start with overnight SOFR (currently ~4.35%). For terms beyond O/N, use SOFR futures to build the 3M-2Y segment. Each futures price implies a forward rate: F = 100 - Price. Convert to continuous compounding: r_continuous = ln(1 + r_simple × Δt) / Δt, where Δt is the accrual fraction (ACT/360 for USD swaps).
                    </p>
                    <h3 class="font-display text-2xl font-bold mt-12 mb-4">The Swap Curve Stripping Process</h3>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        For maturities beyond 2 years, SOFR swaps provide the data. A 5-year swap at 4.25% fixed means the present value of fixed flows equals the present value of floating flows: Σ [C × DF(tᵢ)] = Σ [Fwd(tᵢ₋₁, tᵢ) × DF(tᵢ)], where C is the fixed coupon, DF(t) is the discount factor at time t, and Fwd is the forward SOFR rate.
                        <span class="sparkline" data-values="4.0,4.1,4.15,4.2,4.25,4.3,4.35,4.4,4.5,4.6,4.7"></span>
                    </p>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        Bootstrap iteratively: solve for DF(t₁) using the 1Y swap, then DF(t₂) using the 2Y swap and the already-known DF(t₁), and so on. At each tenor, invert the discount factor to get the zero rate: z(t) = -ln[DF(t)] / t. The result is a discrete set of zero rates at swap maturity points: 1Y, 2Y, 3Y, ..., 30Y.
                    </p>
                    <h3 class="font-display text-2xl font-bold mt-12 mb-4">Interpolation: The Hidden Degrees of Freedom</h3>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        Market quotes are sparse. You have zeros at 2Y, 3Y, 5Y, 7Y, 10Y. But you need a rate for 4.25Y to price a bespoke swaption. Interpolation fills the gaps. Linear interpolation of zero rates is crude and creates artificial discontinuities in forward rates. <span class="interactive-term" data-term="Cubic Spline">Cubic splines<span class="term-tooltip">A piecewise polynomial interpolation method ensuring smooth first and second derivatives across the curve.</span></span> are smoother but can generate economically implausible forward rate oscillations.
                    </p>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        Best practice: interpolate on the <span class="interactive-term" data-term="Log-Discount Factor">log-discount factor<span class="term-tooltip">Interpolating ln[DF(t)] ensures positivity of discount factors and smooth instantaneous forward rates.</span></span> using monotone-preserving cubic splines (e.g., Hyman's filter). This guarantees forward rates remain positive and smooth. For ultra-long tenors (&gt;30Y), extrapolate using the Smith-Wilson method, which asymptotically converges to an ultimate forward rate (typically UFR = 3.8% for USD, per EIOPA guidelines adapted to US regulatory context).
                        <span class="sparkline" data-values="0.98,0.95,0.91,0.86,0.80,0.74,0.67,0.60,0.52,0.45,0.38"></span>
                    </p>
                    <h3 class="font-display text-2xl font-bold mt-12 mb-4">Cross-Currency Basis: The Arbitrage That Shouldn't Exist</h3>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        Covered interest parity says: F/S = (1 + r_d) / (1 + r_f), where F is the forward FX rate, S is spot, r_d is domestic rate, r_f is foreign rate. In theory, no arbitrage. In practice, <span class="interactive-term" data-term="CCS Basis">cross-currency swap basis<span class="term-tooltip">The spread added to one leg of a cross-currency swap to equalize present values, reflecting funding costs and credit risk asymmetries.</span></span> can be -50 bps (EUR) or +30 bps (JPY) vs. USD. Post-2008, funding constraints and regulatory capital charges broke CIP.
                    </p>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        When building a USD curve from EUR swaps (or vice versa), adjust for the basis: r_USD_implied = r_EUR + basis + FX_forward_adjustment. The 5Y EUR/USD basis widened to -60 bps during COVID. Ignoring it would misprice cross-currency swaps by millions. The basis isn't noise-it's structural, driven by dollar shortage in offshore funding markets and balance sheet costs for dealers.
                    </p>
                `,
                nextSlug: "credit"
            },
            credit: {
                meta: { date: "AUG 2025", category: "CREDIT", readTime: "8 MIN" },
                title: "Credit Spread Decomposition",
                lede: "Separating default probability from recovery rates in corporate bonds. Structural models vs. reduced-form approaches in distressed debt.",
                content: `
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6 drop-cap">
                        A corporate bond yield is composed of two pieces: the risk-free rate and the <span class="interactive-term" data-term="Credit Spread">credit spread<span class="term-tooltip">The additional yield above the risk-free rate that compensates investors for default risk and illiquidity.</span></span>. The spread itself decomposes into default probability, expected loss given default, and a liquidity premium. Most analysts stop at the first layer. That's where the money is lost. Because spreads compress and widen not just on changing default risk, but on shifts in recovery assumptions and market microstructure.
                    </p>
                    <div class="my-12 border-l-4 border-black pl-6 py-2">
                        <p class="font-playfair italic text-3xl md:text-4xl leading-tight">"Default is a binary event. Recovery is a negotiation."</p>
                    </div>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        The fundamental credit equation: Spread = PD × LGD + Liquidity Premium, where PD is probability of default and <span class="interactive-term" data-term="LGD">LGD<span class="term-tooltip">Loss Given Default: the percentage of exposure lost when a borrower defaults, equal to 1 minus the recovery rate.</span></span> is loss given default (1 - Recovery Rate). For a BB-rated 5-year bond with 350bps spread, assume PD = 4.5% (annualized), Recovery = 40%. Expected loss = 4.5% × 60% = 2.7% annually ≈ 270bps. The remaining 80bps is compensation for liquidity and systematic credit risk. That excess spread is tradable alpha.
                        <span class="sparkline" data-values="100,98,95,92,88,82,75,68,58,50,45"></span>
                    </p>
                    <h3 class="font-display text-2xl font-bold mt-12 mb-4">Merton's Structural Model</h3>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        <span class="interactive-term" data-term="Merton Model">Merton's framework<span class="term-tooltip">A structural credit model treating equity as a call option on firm assets, with default occurring when asset value falls below debt obligations.</span></span> treats equity as a call option on the firm's assets with strike equal to debt face value. Default occurs when asset value V_T &lt; D at maturity T. The equity value: E = V₀ N(d₁) - D e^(-rT) N(d₂), where d₁ = [ln(V₀/D) + (r + σ²/2)T] / (σ√T), and N(·) is the cumulative normal distribution.
                    </p>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        The model implies a distance-to-default: DD = [ln(V₀/D) + (μ - σ²/2)T] / (σ√T). The probability of default: PD = N(-DD). For a firm with market cap $5B, debt $8B, asset volatility 35%, and 5-year horizon: V₀ ≈ $13B, DD ≈ 1.1σ, PD ≈ 13.6%. The corresponding credit spread via risk-neutral pricing is: s = -ln[1 - PD × LGD] / T ≈ 340bps for LGD = 60%.
                    </p>
                    <h3 class="font-display text-2xl font-bold mt-12 mb-4">Reduced-Form Models: Intensity-Based Approach</h3>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        Structural models struggle with sudden defaults (Lehman had positive equity value 48 hours before bankruptcy). <span class="interactive-term" data-term="Reduced-Form Models">Reduced-form models<span class="term-tooltip">Credit models that treat default as a random jump process with exogenous hazard rate, without modeling firm capital structure.</span></span> treat default as a Poisson jump with hazard rate λ(t). The survival probability: S(T) = exp[-∫₀ᵀ λ(t)dt]. For constant λ, this simplifies to S(T) = e^(-λT).
                    </p>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        The credit spread in a reduced-form model: s = λ × LGD. Calibrate λ from CDS spreads: if 5Y CDS trades at 280bps and recovery is 40%, then λ ≈ 280bps / 60% = 4.67% annualized. The advantage: no need to estimate unobservable asset volatility. The disadvantage: λ is a black box-it doesn't explain *why* default risk changes, only that it has.
                        <span class="sparkline" data-values="2.5,2.8,3.2,3.8,4.5,5.2,6.0,7.5,9.0,8.5,7.0"></span>
                    </p>
                    <h3 class="font-display text-2xl font-bold mt-12 mb-4">Recovery Rate Dynamics in Distressed Debt</h3>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        Recovery rates are not constant. They're correlated with default rates-during recessions, both PD and LGD rise simultaneously. Moody's data (1982-2022): median recovery on senior unsecured bonds is 38%, but the distribution is bimodal-recoveries cluster near 10% (liquidation) or 65% (restructuring). In distressed cycles (2008, 2020), average recovery dropped to 28% as bankruptcy courts were overwhelmed and asset sales occurred in depressed markets.
                    </p>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        Trading strategy: in early-stage distress, buy senior secured (recovery ~70%) and short CDS (recovery ~40%). The basis captures recovery mispricing. In late-stage distress, avoid the capital structure entirely-recovery convergence crushes the trade. The edge is in timing the transition from going-concern to gone-concern. Structural models tell you when equity is worthless. Reduced-form models tell you when the market believes it.
                    </p>
                `,
                nextSlug: "leverage"
            },
            leverage: {
                meta: { date: "JUL 2025", category: "LBO / PE", readTime: "9 MIN" },
                title: "The Leverage Ratchet",
                lede: "LBO modeling beyond the template. Optimal capital structure, covenant design, and the hidden costs of financial engineering in leveraged buyouts.",
                content: `
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6 drop-cap">
                        Private equity returns are manufactured through three levers: operational improvement, multiple arbitrage, and leverage. The first is hard. The second is cyclical. The third is mechanical-and the most misunderstood. <span class="interactive-term" data-term="LBO">Leveraged buyout<span class="term-tooltip">Acquisition of a company using significant amounts of borrowed money, with the target's cash flows servicing the debt.</span></span> modeling reduces to a question: How much debt can this cash flow sustain? Get it wrong on the high side, and you're in bankruptcy. Get it wrong on the low side, and you leave 500bps of IRR on the table.
                    </p>
                    <div class="my-12 border-l-4 border-black pl-6 py-2">
                        <p class="font-playfair italic text-3xl md:text-4xl leading-tight">"Leverage is a call option on upside and a put option on downside. The strike is the debt face value."</p>
                    </div>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        The traditional metric is <span class="interactive-term" data-term="Debt-to-EBITDA">Debt / EBITDA<span class="term-tooltip">Leverage ratio measuring total debt relative to earnings before interest, taxes, depreciation, and amortization.</span></span>. Sponsors target 5.0-6.5x for middle-market buyouts. But EBITDA is a fiction-it's not cash. EBITDA - Capex - Working Capital = Unlevered Free Cash Flow. That's what services debt. In capital-intensive businesses, EBITDA overstates cash generation by 30-40%. In SaaS or asset-light models, the spread is narrower. The correct question: Debt / (EBITDA - Capex - ΔWC). This ratio should not exceed 4.5x for stable cash flows, 3.5x for cyclical.
                        <span class="sparkline" data-values="6.5,6.2,5.8,5.3,4.9,4.5,4.0,3.6,3.2,2.8,2.3"></span>
                    </p>
                    <h3 class="font-display text-2xl font-bold mt-12 mb-4">Capital Structure Optimization</h3>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        The debt stack is a maturity and seniority ladder: Revolver (L + 250bps), Term Loan B (L + 450bps), Second Lien (L + 750bps), Mezzanine (12-14% PIK toggle). Each tranche has different covenants, amortization schedules, and call protection. The optimization problem: minimize WACC subject to maintaining liquidity and covenant cushion. The revolver stays undrawn (it's insurance, not funding). Term Loan B is the workhorse-7-year maturity, 1% annual amortization, EBITDA-based covenants with 25% cushion.
                    </p>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        The <span class="interactive-term" data-term="Blended Cost of Debt">blended cost of debt<span class="term-tooltip">Weighted average interest rate across all debt tranches, adjusted for fees, OID, and PIK accretion.</span></span> includes fees and OID (original issue discount). A Term Loan at L + 450bps with 2% OID and 50bps annual fee has an all-in cost of ~9.3% at current SOFR. Mezzanine at 12% PIK accretes-no cash interest for 3 years, then compounds. The effective cost is 12%, but the cash burden is deferred. This is how sponsors juice Year 1-3 IRR while creating a maturity wall problem in Year 6-7.
                    </p>
                    <h3 class="font-display text-2xl font-bold mt-12 mb-4">Covenant Engineering and Strategic Default</h3>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        Covenants are trip-wires. <span class="interactive-term" data-term="Leverage Covenant">Leverage covenant<span class="term-tooltip">A debt agreement clause requiring the borrower to maintain Debt/EBITDA below a specified threshold, tested quarterly.</span></span>: Total Debt / EBITDA &lt; 6.0x, stepping down to 5.0x by Year 4. <span class="interactive-term" data-term="FCCR">Fixed Charge Coverage<span class="term-tooltip">Ratio of EBITDA minus Capex to Interest + Required Debt Amortization, measuring ability to service fixed obligations.</span></span>: (EBITDA - Capex) / (Interest + Amort) &gt; 1.1x. Miss either, and you're in technical default. The lenders can accelerate, forcing refinancing at punitive rates-or they renegotiate for equity warrants and fee strips.
                        <span class="sparkline" data-values="1.5,1.4,1.3,1.2,1.1,1.0,0.95,1.1,1.3,1.5,1.7"></span>
                    </p>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        Savvy sponsors build in EBITDA addbacks: pro forma cost synergies, run-rate revenue from bolt-ons, non-recurring expenses. These are permitted adjustments under credit agreements. A $50M EBITDA business can report $65M "Adjusted EBITDA" by adding back $10M in "one-time" restructuring costs and $5M in "normalized" revenue. Lenders accept this because the alternative is losing the deal to a more aggressive lender. The game is: maximize addbacks without triggering fraud.
                    </p>
                    <h3 class="font-display text-2xl font-bold mt-12 mb-4">The IRR Mirage and Hidden Costs</h3>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        The headline IRR is a lie. LBO models show 25% IRR on 6.0x leverage. Strip out the leverage, and the equity return is 12%. The delta is financial engineering, not value creation. The formula: Levered Return = Unlevered Return + (Unlevered Return - Cost of Debt) × (Debt / Equity). When r_unlevered = 12% and r_debt = 8%, each 1x of leverage adds ~160bps to IRR. At 6x leverage and 40% equity check, you're adding 960bps. That's the ratchet.
                    </p>
                    <p class="font-serif text-lg md:text-xl leading-relaxed mb-6">
                        But leverage is symmetric. A 10% EBITDA miss in Year 2 triggers covenant breach, forces equity cure ($20M cash injection at 0% IRR), and resets the return profile. The hidden costs: management time spent on lender reporting, restricted ability to pursue growth Capex, and forced asset sales to delever during downturns. The model assumes smooth cash flows. Reality is lumpy. The difference between projected and actual is where sponsors earn their carry-or lose their shirts.
                        <span class="sparkline" data-values="25,24,22,18,15,10,5,-2,8,15,22"></span>
                    </p>
                `,
                nextSlug: "legacy"
            }
        };

        function generateSparkline(valuesStr) {
            const values = valuesStr.split(',').map(Number);
            const width = 60;
            const height = 20;
            const max = Math.max(...values);
            const min = Math.min(...values);
            const range = max - min || 1;
            
            const points = values.map((v, i) => {
                const x = (i / (values.length - 1)) * width;
                const y = height - ((v - min) / range) * height;
                return `${x},${y}`;
            }).join(' ');

            return `<svg class="sparkline" width="${width}" height="${height}" viewBox="0 0 ${width} ${height}">
                <path d="M${points}" />
            </svg>`;
        }

        // --- 2. INIT TOOLS & CLOCK ---
        lucide.createIcons();
        document.getElementById('year').textContent = new Date().getFullYear();

        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { 
                timeZone: 'America/Chicago', 
                hour12: false,
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit' 
            });
            document.getElementById('clock').textContent = timeString + " CST";
        }
        setInterval(updateClock, 1000);
        updateClock();

        // --- LIVE DATA FETCHING ---
        async function fetchLiveData() {
            const startPing = performance.now();
            
            // 1. Weather (Austin, TX)
            try {
                const weatherRes = await fetch('https://api.open-meteo.com/v1/forecast?latitude=30.2672&longitude=-97.7431&current=temperature_2m&temperature_unit=fahrenheit');
                const weatherData = await weatherRes.json();
                if (weatherData.current && weatherData.current.temperature_2m) {
                    document.getElementById('weather-val').textContent = Math.round(weatherData.current.temperature_2m) + '°F';
                }
            } catch (e) {
                document.getElementById('weather-val').textContent = '62°F';
            }

            // 2. Crypto (BTC & ETH)
            try {
                const cryptoRes = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum&vs_currencies=usd');
                const cryptoData = await cryptoRes.json();
                if (cryptoData.bitcoin && cryptoData.bitcoin.usd) {
                    document.getElementById('btc-val').textContent = '$' + Math.floor(cryptoData.bitcoin.usd).toLocaleString();
                }
                if (cryptoData.ethereum && cryptoData.ethereum.usd) {
                    document.getElementById('eth-val').textContent = '$' + Math.floor(cryptoData.ethereum.usd).toLocaleString();
                }
            } catch (e) {
                document.getElementById('btc-val').textContent = '$98,420';
                document.getElementById('eth-val').textContent = '$3,121';
            }

            // 3. Block Height (Mempool.space)
            try {
                const blockRes = await fetch('https://mempool.space/api/blocks/tip/height');
                const height = await blockRes.text();
                if (height) {
                    document.getElementById('block-val').textContent = parseInt(height).toLocaleString();
                }
            } catch (e) {
                document.getElementById('block-val').textContent = '874,120';
            }

            // 4. Ping Calculation
            const endPing = performance.now();
            const ping = Math.round(endPing - startPing);
            document.getElementById('ping-val').textContent = ping + 'ms';
        }
        
        // Initial fetch and interval (every 60s)
        fetchLiveData();
        setInterval(fetchLiveData, 60000);

        // --- 3. TEXT SCRAMBLE EFFECT ---
        class TextScramble {
            constructor(el) {
                this.el = el;
                this.chars = '!<>-_\\/[]{}-=+*^?#________';
                this.update = this.update.bind(this);
            }
            setText(newText) {
                const oldText = this.el.innerText;
                const length = Math.max(oldText.length, newText.length);
                const promise = new Promise((resolve) => this.resolve = resolve);
                this.queue = [];
                for (let i = 0; i < length; i++) {
                    const from = oldText[i] || '';
                    const to = newText[i] || '';
                    const start = Math.floor(Math.random() * 25);
                    const end = start + Math.floor(Math.random() * 30);
                    this.queue.push({ from, to, start, end });
                }
                cancelAnimationFrame(this.frameRequest);
                this.frame = 0;
                this.update();
                return promise;
            }
            update() {
                let output = '';
                let complete = 0;
                for (let i = 0, n = this.queue.length; i < n; i++) {
                    let { from, to, start, end, char } = this.queue[i];
                    if (this.frame >= end) {
                        complete++;
                        output += to;
                    } else if (this.frame >= start) {
                        if (!char || Math.random() < 0.35) {
                            char = this.randomChar();
                            this.queue[i].char = char;
                        }
                        output += `<span class="text-neutral-600">${char}</span>`;
                    } else {
                        output += from;
                    }
                }
                this.el.innerHTML = output;
                if (complete === this.queue.length) {
                    this.resolve();
                } else {
                    this.frameRequest = requestAnimationFrame(this.update);
                    this.frame++;
                }
            }
            randomChar() {
                return this.chars[Math.floor(Math.random() * this.chars.length)];
            }
        }

        // --- 4. MODAL LOGIC ---
        const modal = document.getElementById('project-modal');
        const modalBody = document.getElementById('modal-body');
        const closeModal = document.getElementById('close-modal');
        const progressBar = document.getElementById('reading-progress');
        
        function initTaskFormerModalCanvas() {
            const canvas4 = document.getElementById('canvas-taskformer-modal');
            if (canvas4) {
                const ctx = canvas4.getContext('2d');
                let width, height;
                let particles = [];
                let isHovered = false;
                let animationId = null;
                let rotation = 0;
                
                const parent = canvas4.parentElement;
                parent.addEventListener('mouseenter', () => isHovered = true);
                parent.addEventListener('mouseleave', () => isHovered = false);
                
                const resize = () => {
                    width = canvas4.width = canvas4.parentElement.offsetWidth;
                    height = canvas4.height = canvas4.parentElement.offsetHeight;
                    
                    particles = [];
                    const count = 80; 
                    for(let i=0; i<count; i++) {
                        particles.push({
                            x: Math.random() * width,
                            y: Math.random() * height,
                            vx: (Math.random() - 0.5) * 1.5,
                            vy: (Math.random() - 0.5) * 1.5,
                            size: Math.random() * 2 + 1.5,
                            angle: (i / count) * Math.PI * 2, 
                            radius: height * 0.3 
                        });
                    }
                };
                resize();

                const animate = () => {
                    if (!document.getElementById('canvas-taskformer-modal')) {
                        cancelAnimationFrame(animationId);
                        return;
                    }

                    ctx.clearRect(0, 0, width, height);
                    
                    if (isHovered) {
                        rotation += 0.005; 
                    }

                    particles.forEach((p, i) => {
                        let tx, ty;

                        if (!isHovered) {
                            p.x += p.vx;
                            p.y += p.vy;
                            
                            if(p.x < 0 || p.x > width) p.vx *= -1;
                            if(p.y < 0 || p.y > height) p.vy *= -1;
                        } 
                        else {
                            tx = width/2 + Math.cos(p.angle + rotation) * p.radius;
                            ty = height/2 + Math.sin(p.angle + rotation) * p.radius;

                            p.x += (tx - p.x) * 0.08;
                            p.y += (ty - p.y) * 0.08;
                        }
                        
                        ctx.fillStyle = isHovered ? '#EAEAEA' : '#A0A0A0';
                        ctx.globalAlpha = isHovered ? 0.9 : 0.6;
                        ctx.fillRect(p.x - p.size/2, p.y - p.size/2, p.size, p.size);
                        
                        particles.forEach((other, j) => {
                            if (i >= j) return;
                            const dx = p.x - other.x;
                            const dy = p.y - other.y;
                            const dist = Math.sqrt(dx*dx + dy*dy);
                            
                            const connectDist = isHovered ? 50 : 70;

                            if (dist < connectDist) {
                                ctx.strokeStyle = isHovered ? 'rgba(255, 255, 255, 0.2)' : 'rgba(136, 136, 136, 0.15)';
                                ctx.lineWidth = 0.5;
                                ctx.beginPath();
                                ctx.moveTo(p.x, p.y);
                                ctx.lineTo(other.x, other.y);
                                ctx.stroke();
                            }
                        });
                    });
                    
                    if (isHovered) {
                        ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                        ctx.lineWidth = 1;
                        ctx.beginPath();
                        ctx.arc(width/2, height/2, height * 0.3, 0, Math.PI*2);
                        ctx.stroke();
                        
                        ctx.beginPath();
                        ctx.arc(width/2, height/2, height * 0.2, 0, Math.PI*2);
                        ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
                        ctx.stroke();
                    }

                    animationId = requestAnimationFrame(animate);
                };
                animate();
            }
        }

        let cryptoDashboardInterval = null;

        /* 
        // Old mock data function replaced by crypto-data.js
        function initCryptoDashboard() {
             // ... removed ...
        }
        */

        function openModal(id, type = 'project') {
            let data;
            const content = modal.querySelector('.modal-content');
            const closeBtnIcon = document.querySelector('#close-modal i');
            
            // Add glassmorphism to modal background
            modal.classList.add('backdrop-blur-md', 'bg-black/80');
            
            // Preload portfolio widgets if opening point72
            if (id === 'point72') {
                window.preloadPortfolioWidgets();
            }
            
            // Reset classes
            content.classList.remove('paper-mode');
            
            // Reset close button default state
            if (closeBtnIcon) {
                closeBtnIcon.classList.remove('text-off-black', 'group-hover:text-neutral-600');
                closeBtnIcon.classList.add('text-neutral-500', 'group-hover:text-off-white');
            }
            
            if (type === 'writing') {
                data = writingData[id];
                if (!data) return;
                
                // Enable Paper Mode (Light Theme)
                content.classList.add('paper-mode');
                
                // Update close button for light mode
                if (closeBtnIcon) {
                    closeBtnIcon.classList.remove('text-neutral-500', 'group-hover:text-off-white');
                    closeBtnIcon.classList.add('text-off-black', 'group-hover:text-neutral-600');
                }
                
                // Editorial Layout - Light Mode
                modalBody.innerHTML = `
                    <div class="max-w-3xl mx-auto pt-12 md:pt-20 px-4 md:px-0">
                        <!-- Header Block -->
                        <div class="modal-stagger text-center mb-16" style="transition-delay: 0.1s">
                            <div class="flex items-center justify-center gap-4 text-xs font-mono tracking-widest text-neutral-500 mb-8 uppercase">
                                <span>${data.meta.category}</span>
                                <span class="w-px h-3 bg-neutral-300"></span>
                                <span>${data.meta.date}</span>
                                <span class="w-px h-3 bg-neutral-300"></span>
                                <span>${data.meta.readTime} READ</span>
                            </div>
                            
                            <h1 class="font-playfair italic text-5xl md:text-7xl font-bold mb-10 leading-[1.1] text-off-black">
                                ${data.title}
                            </h1>
                            
                            <div class="w-12 h-1 bg-off-black mx-auto mb-10 opacity-20"></div>
                            
                            <p class="font-serif text-xl md:text-2xl text-neutral-600 max-w-2xl mx-auto leading-relaxed italic">
                                ${data.lede}
                            </p>
                        </div>

                        <!-- Body Content -->
                        <div class="modal-stagger font-serif text-lg md:text-xl leading-loose text-neutral-800 space-y-8 drop-cap-wrapper" style="transition-delay: 0.2s">
                            ${data.content}
                        </div>

                        <!-- Footer / Next Article -->
                        <div class="modal-stagger mt-24 pt-16 border-t border-neutral-200" style="transition-delay: 0.3s">
                            <div class="flex flex-col items-center text-center group cursor-pointer hover-target" onclick="openModal('${data.nextSlug}', 'writing')">
                                <span class="font-mono text-xs text-neutral-400 uppercase tracking-widest mb-4">Read Next</span>
                                <h3 class="font-display text-3xl md:text-4xl font-medium text-off-black group-hover:opacity-70 transition-opacity duration-300">
                                    ${writingData[data.nextSlug].title}
                                </h3>
                                <div class="mt-6 transform group-hover:translate-x-2 transition-transform duration-300">
                                    <i data-lucide="arrow-right" class="w-6 h-6 text-off-black"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                // Render Sparklines (Standard color for light mode)
                modalBody.querySelectorAll('.sparkline').forEach(el => {
                    if (el.dataset.values) {
                        el.outerHTML = generateSparkline(el.dataset.values);
                    }
                });

            } else {
                // Standard Project Layout
                data = projectData[id];
                if (!data) return;

                // Calculate Read Time
                const wordCount = data.description.split(' ').length + data.details.split(' ').length;
                const readTime = Math.ceil(wordCount / 200);

                // Dynamic Cover Background based on ID
                let coverBg = `
                    <div class="absolute inset-0 bg-[#0A0A0A]">
                        <div class="absolute inset-0 opacity-20" style="background-image: radial-gradient(#333 1px, transparent 1px); background-size: 20px 20px;"></div>
                        <div class="absolute inset-0 bg-gradient-to-t from-[#0A0A0A] via-transparent to-transparent"></div>
                    </div>
                `;

                if(id === 'austin_re') {
                    coverBg = `
                        <div class="absolute inset-0 bg-[#050505]">
                            <canvas id="canvas-austin-modal" class="w-full h-full opacity-40"></canvas>
                            <div class="absolute inset-0 bg-gradient-to-t from-[#0A0A0A] via-transparent to-transparent"></div>
                        </div>
                    `;
                } else if (id === 'syrup') {
                    coverBg = `
                        <div class="absolute inset-0 bg-[#0A0A0A]">
                            <div class="absolute inset-0 opacity-10" style="background: repeating-linear-gradient(45deg, #60a5fa 0, #60a5fa 1px, transparent 0, transparent 50%); background-size: 10px 10px;"></div>
                            <div class="absolute inset-0 bg-gradient-to-t from-[#0A0A0A] via-transparent to-transparent"></div>
                        </div>
                    `;
                } else if (id === 'taskformer') {
                    coverBg = `
                        <div class="absolute inset-0 bg-[#0F0F0F]">
                            <canvas id="canvas-taskformer-modal" class="w-full h-full opacity-60"></canvas>
                            <div class="absolute inset-0 bg-gradient-to-t from-[#0A0A0A] via-transparent to-transparent"></div>
                        </div>
                    `;
                }

                // Dynamic Content Overlay
                let coverOverlay = `
                    <div class="absolute bottom-0 left-0 w-full p-6 md:p-8 z-10">
                        <div class="flex flex-col md:flex-row justify-between items-end gap-4">
                            <div class="w-full">
                                <div class="flex flex-wrap gap-2 mb-4">
                                    ${data.tags.map(tag => `<span class="px-2 py-1 bg-white/5 backdrop-blur-md border border-white/10 text-[10px] font-mono uppercase text-neutral-300 tracking-widest">${tag}</span>`).join('')}
                                </div>
                                <h2 class="font-display text-4xl md:text-6xl font-bold text-white mb-2 tracking-tight leading-none">${data.title}</h2>
                                <div class="flex items-center gap-4 mt-2">
                                    <span class="w-8 h-px bg-blue-500"></span>
                                    <p class="font-mono text-sm text-neutral-400 uppercase tracking-widest">${data.subtitle}</p>
                                </div>
                            </div>
                            <div class="shrink-0">
                                    <span class="font-mono text-[10px] text-neutral-500 border border-white/10 bg-black/50 px-3 py-1 backdrop-blur-md uppercase tracking-widest">${readTime} MIN READ</span>
                            </div>
                        </div>
                    </div>
                `;

                if (id === 'austin_re') {
                    coverOverlay = `
                        <div class="absolute inset-0 z-10 flex flex-col justify-between p-6 md:p-8 pointer-events-none">
                            <!-- Top Row -->
                            <div class="flex justify-between items-start">
                                <div class="flex flex-col gap-1">
                                    <span class="font-mono text-[10px] text-blue-500 uppercase tracking-widest">Project</span>
                                    <span class="font-display text-4xl font-bold text-white/20">05</span>
                                </div>
                                <div class="flex gap-2">
                                     <span class="px-2 py-1 bg-blue-500/10 border border-blue-500/20 text-[10px] font-mono uppercase text-blue-400 tracking-widest backdrop-blur-md">Live Data</span>
                                </div>
                            </div>

                            <!-- Bottom Row -->
                            <div class="w-full">
                                <h2 class="font-display text-5xl md:text-7xl font-bold text-white mb-6 tracking-tight leading-none uppercase">Austin<br/>Real Estate</h2>
                                
                                <div class="flex items-center gap-4 border-t border-white/10 pt-6">
                                    <div class="flex gap-6 font-mono text-xs text-neutral-400 uppercase tracking-widest">
                                        <span>Macro</span>
                                        <span class="text-blue-500">/</span>
                                        <span>Demographics</span>
                                        <span class="text-blue-500">/</span>
                                        <span>Alpha</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }

                modalBody.innerHTML = `
                    <div class="modal-stagger" style="transition-delay: 0.1s">
                        <!-- New Modal Cover Design -->
                        <div class="relative w-full h-64 md:h-80 mb-12 overflow-hidden border border-white/10 group bg-[#0A0A0A]">
                            ${coverBg}
                            ${coverOverlay}
                        </div>
                        
                        ${data.contract ? `
                        <div class="flex flex-wrap items-center gap-6 mb-8 pt-6 border-t border-white/5">
                            <div class="flex items-center gap-3">
                                <span class="text-[10px] font-mono text-neutral-500 uppercase tracking-widest">Contract</span>
                                <div class="flex items-center gap-2 bg-off-white/5 px-3 py-1.5 rounded border border-white/10 group hover:border-white/30 transition-colors cursor-pointer" onclick="navigator.clipboard.writeText('${data.contract}'); this.querySelector('span').textContent = 'COPIED!'; setTimeout(() => this.querySelector('span').textContent = '${data.contract.slice(0,6)}...${data.contract.slice(-4)}', 2000);">
                                    <span class="font-mono text-xs text-neutral-300">${data.contract.slice(0,6)}...${data.contract.slice(-4)}</span>
                                    <i data-lucide="copy" class="w-3 h-3 text-neutral-500 group-hover:text-off-white transition-colors"></i>
                                </div>
                            </div>
                            ${data.links ? `
                            <div class="flex items-center gap-4">
                                <a href="${data.links.website}" target="_blank" class="flex items-center gap-2 text-neutral-400 hover:text-off-white transition-colors">
                                    <i data-lucide="globe" class="w-4 h-4"></i>
                                    <span class="text-xs font-mono uppercase tracking-wider">Website</span>
                                </a>
                                <a href="${data.links.x}" target="_blank" class="flex items-center gap-2 text-neutral-400 hover:text-off-white transition-colors">
                                    <i data-lucide="twitter" class="w-4 h-4"></i>
                                    <span class="text-xs font-mono uppercase tracking-wider">Twitter</span>
                                </a>
                            </div>
                            ` : ''}
                        </div>
                        ` : ''}

                    </div>
                    <div class="modal-stagger" style="transition-delay: 0.2s">
                        <p class="font-display text-xl md:text-2xl leading-relaxed text-off-white font-light border-l-2 border-off-white/30 pl-6 mb-12 drop-cap">
                            ${data.description}
                        </p>
                    </div>
                    <div class="modal-stagger" style="transition-delay: 0.3s">
                        ${data.details}
                    </div>
                `;
                
                if (id === 'taskformer') {
                    requestAnimationFrame(() => initTaskFormerModalCanvas());
                }
                
                if (id === 'bittensor') {
                    requestAnimationFrame(() => initCryptoDashboard());
                }

                if (['syrup', 'metadao', 'myx'].includes(id)) {
                    requestAnimationFrame(() => window.initProjectDetail(id));
                }

                if (id === 'austin_re') {
                    requestAnimationFrame(() => {
                        window.initAustinDashboard();
                        initAustinModalCanvas();
                    });
                }
            }

            modal.classList.add('active');
            document.body.classList.add('modal-open');
            lockBodyScroll();
            lucide.createIcons();
        }
        
        // Helper functions for body scroll lock
        function lockBodyScroll() {
            const scrollbarWidth = window.innerWidth - document.documentElement.clientWidth;
            document.body.style.overflow = 'hidden';
            document.body.style.paddingRight = scrollbarWidth + 'px';
        }
        
        function unlockBodyScroll() {
            document.body.style.overflow = '';
            document.body.style.paddingRight = '';
        }

        function closeModalFunc() {
            modal.classList.remove('active');
            modal.classList.remove('backdrop-blur-md', 'bg-black/80'); // Clean up glass effect
            document.body.classList.remove('modal-open');
            progressBar.style.width = '0%';
            
            // Clear all active intervals to prevent memory leaks
            if (analysisTimerInterval) {
                clearInterval(analysisTimerInterval);
                analysisTimerInterval = null;
            }
            if (cryptoDashboardInterval) {
                clearInterval(cryptoDashboardInterval);
                cryptoDashboardInterval = null;
            }
            if (trafficRefreshInterval) {
                clearInterval(trafficRefreshInterval);
                trafficRefreshInterval = null;
            }
            Object.keys(metricIntervals).forEach(key => {
                clearInterval(metricIntervals[key]);
                delete metricIntervals[key];
            });
            
            // Reset modal state with proper timing for smooth exit
            setTimeout(() => {
                modal.querySelector('.modal-content').classList.remove('paper-mode');
                modalBody.innerHTML = ''; // Clear content to reset animations
                unlockBodyScroll();
            }, 600); // Increased to match longer transition duration
        }

        // Reading Progress & Scroll-to-Blur
        modal.querySelector('.modal-content').addEventListener('scroll', (e) => {
            const el = e.target;
            const scrollTop = el.scrollTop;
            const scrollHeight = el.scrollHeight - el.clientHeight;
            const progress = (scrollTop / scrollHeight) * 100;
            progressBar.style.width = `${progress}%`;

            // Scroll-to-Blur Effect for Header
            if (modal.querySelector('.modal-content').classList.contains('paper-mode')) {
                const header = modalBody.querySelector('.text-center');
                if (header) {
                    const opacity = Math.max(0, 1 - scrollTop / 300);
                    const blur = Math.min(10, scrollTop / 30);
                    header.style.opacity = opacity;
                    header.style.filter = `blur(${blur}px)`;
                }
            }
        });

        // Attach listeners to cards
        document.querySelectorAll('.project-card').forEach(card => {
            card.addEventListener('click', () => {
                const projectId = card.dataset.project;
                openModal(projectId, 'project');
            });
        });

        // Attach listeners to writing items
        document.querySelectorAll('.writing-item').forEach(item => {
            const handleOpen = () => {
                const writingId = item.dataset.writing;
                openModal(writingId, 'writing');
            };
            item.addEventListener('click', handleOpen);
            // Keyboard support
            item.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    handleOpen();
                }
            });
        });

        // Enhanced form submission handling
        document.addEventListener('submit', async function(e) {
            if (e.target.tagName === 'FORM' && e.target.action.includes('formspree')) {
                e.preventDefault();
                
                const form = e.target;
                const submitBtn = form.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                
                // Disable form and show loading state
                submitBtn.disabled = true;
                submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
                submitBtn.textContent = 'SENDING...';
                
                try {
                    const response = await fetch(form.action, {
                        method: 'POST',
                        body: new FormData(form),
                        headers: { 'Accept': 'application/json' }
                    });
                    
                    if (response.ok) {
                        // Success state
                        submitBtn.classList.remove('bg-off-white', 'text-black');
                        submitBtn.classList.add('bg-off-white', 'text-black');
                        submitBtn.textContent = '✓ MESSAGE SENT!';
                        form.reset();
                        
                        // Reset after 3 seconds
                        setTimeout(() => {
                            submitBtn.disabled = false;
                            submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                            submitBtn.textContent = originalText;
                        }, 3000);
                    } else {
                        throw new Error('Form submission failed');
                    }
                } catch (error) {
                    // Error state
                    submitBtn.classList.add('bg-red-500', 'text-off-white');
                    submitBtn.textContent = '✗ ERROR - TRY AGAIN';
                    
                    setTimeout(() => {
                        submitBtn.disabled = false;
                        submitBtn.classList.remove('opacity-50', 'cursor-not-allowed', 'bg-red-500');
                        submitBtn.classList.add('bg-off-white');
                        submitBtn.textContent = originalText;
                    }, 3000);
                }
            }
        });
        const serviceData = {
            financial: {
                title: "STRATEGIC CONSULTING",
                subtitle: "Strategic Analysis & Decision Architecture",
                description: "Let's discuss how rigorous analysis and strategic clarity can transform your organization's decision-making process.",
                formspreeId: "YOUR_FORMSPREE_ID_HERE",
                services: [
                    "Financial Modeling & Valuation",
                    "Investment Thesis Development",
                    "Strategic Planning & Scenario Analysis",
                    "Risk Assessment & Management",
                    "M&A Due Diligence Support",
                    "Custom Financial Tools & Dashboards"
                ]
            },
            website: {
                title: "WEBSITE DESIGN",
                subtitle: "Bespoke Digital Experiences",
                description: "Let's craft a digital experience that captures your brand's unique essence and converts visitors into believers.",
                formspreeId: "xzznvvzw",
                services: [
                    "Custom Website Design & Development",
                    "Interactive & Generative Art",
                    "E-Commerce Solutions",
                    "Portfolio & Personal Branding Sites",
                    "Landing Pages & Conversion Optimization",
                    "Web3 & Blockchain Interfaces"
                ]
            }
        };

        function openServiceModal(serviceId) {
            const data = serviceData[serviceId];
            if (!data) return;

            const content = modal.querySelector('.modal-content');
            content.classList.remove('paper-mode');

            if (serviceId === 'financial') {
                modalBody.innerHTML = `
                    <div class="max-w-[1600px] mx-auto">
                        <!-- Header -->
                        <div class="modal-stagger mb-24" style="transition-delay: 0.05s">
                            <div class="max-w-6xl">
                                <div class="flex items-center gap-4 mb-10">
                                    <div class="w-2 h-2 bg-off-white/40 rounded-full animate-pulse"></div>
                                    <div class="font-mono text-xs text-neutral-600 uppercase tracking-[0.5em]">Strategic Consulting</div>
                                </div>
                                <h1 class="font-display text-8xl md:text-9xl font-medium mb-10 tracking-tight leading-[0.85]">
                                    <span class="typing-text" id="main-title">CONSULTING</span>
                                </h1>
                                <p class="font-sans text-2xl text-neutral-400 leading-[1.6] max-w-4xl opacity-0 transition-all duration-500 transform translate-y-4" id="financial-subtitle-text">
                                    Delivering institutional-grade analysis and strategic clarity to drive enterprise value.
                                </p>
                            </div>
                        </div>

                        <!-- Main Content Grid -->
                        <div class="grid grid-cols-1 lg:grid-cols-5 gap-16 mb-32">
                            
                            <!-- Left: Spreadsheet Analysis (3/5) -->
                            <div class="lg:col-span-3 space-y-12 modal-stagger" style="transition-delay: 0.1s">
                                
                                <div class="space-y-8">
                                    <div class="flex items-baseline gap-6 pb-6 border-b border-off-white/10">
                                        <h2 class="font-display text-3xl font-medium tracking-tight">Quantitative Strategy</h2>
                                        <span class="font-mono text-xs text-neutral-600 uppercase tracking-[0.3em]">FY 2024 PROJECTION</span>
                                    </div>

                                    <!-- Statement Tabs -->
                                    <div class="flex gap-2 mb-6">
                                        <button onclick="switchStatement('income')" id="tab-income" class="statement-tab active font-mono text-xs px-4 py-2 border border-off-white/20 bg-off-white/10 hover:bg-off-white/15 transition-all duration-300 uppercase tracking-[0.3em]">
                                            P&L Forecast
                                        </button>
                                        <button onclick="switchStatement('balance')" id="tab-balance" class="statement-tab font-mono text-xs px-4 py-2 border border-off-white/10 hover:border-off-white/20 hover:bg-off-white/10 transition-all duration-300 uppercase tracking-[0.3em] text-neutral-500">
                                            Balance Sheet
                                        </button>
                                        <button onclick="switchStatement('cashflow')" id="tab-cashflow" class="statement-tab font-mono text-xs px-4 py-2 border border-off-white/10 hover:border-off-white/20 hover:bg-off-white/10 transition-all duration-300 uppercase tracking-[0.3em] text-neutral-500">
                                            Cash Flow
                                        </button>
                                    </div>

                                    <!-- Terminal Window -->
                                    <div class="border border-off-white/10 overflow-hidden group hover:border-off-white/20 transition-all duration-700 shadow-2xl shadow-black/50">
                                        <!-- Terminal Header -->
                                        <div class="flex items-center justify-between px-8 py-6 border-b border-off-white/10 bg-[#0F0F0F]">
                                            <div class="flex items-center gap-4">
                                                <div class="flex gap-2">
                                                    <div class="w-3 h-3 rounded-full bg-neutral-800 group-hover:bg-red-500/30 transition-colors duration-500"></div>
                                                    <div class="w-3 h-3 rounded-full bg-neutral-800 group-hover:bg-off-white/30 transition-colors duration-500" style="transition-delay: 50ms"></div>
                                                    <div class="w-3 h-3 rounded-full bg-neutral-800 group-hover:bg-off-white/30 transition-colors duration-500" style="transition-delay: 100ms"></div>
                                                </div>
                                                <span class="font-mono text-xs text-neutral-500 tracking-wider" id="statement-filename">STRATEGIC_MODEL_V4.xlsx</span>
                                            </div>
                                            <div id="analysis-timer" class="font-mono text-xs text-neutral-600 tracking-wider tabular-nums">00:00</div>
                                        </div>

                                        <!-- Spreadsheet Container -->
                                        <div class="relative bg-[#030303] p-10 overflow-auto scrollbar-thin scrollbar-track-transparent scrollbar-thumb-white/10" style="max-height: 700px;" id="spreadsheet-container">
                                            <div id="income-statement" class="font-mono text-xs statement-content active"></div>
                                            <div id="balance-statement" class="font-mono text-xs statement-content hidden"></div>
                                            <div id="cashflow-statement" class="font-mono text-xs statement-content hidden"></div>
                                            
                                            <!-- Cell Highlight -->
                                            <div id="cell-highlight" class="absolute pointer-events-none border-2 border-off-white/100 transition-all duration-700 ease-out hidden shadow-lg shadow-white/10"></div>
                                            
                                            <!-- Analyst Cursor -->
                                            <div id="analyst-cursor" class="absolute pointer-events-none transition-all duration-1000 ease-out hidden">
                                                <div class="w-1 h-1 bg-off-white shadow-lg shadow-white/50"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Analysis Commentary -->
                                <div id="analysis-notes" class="space-y-6"></div>

                            </div>

                            <!-- Right: Key Metrics (2/5) -->
                            <div class="lg:col-span-2 modal-stagger" style="transition-delay: 0.2s">
                                
                                <div class="sticky top-8 space-y-12">
                                    <div class="space-y-8">
                                        <div class="pb-6 border-b border-off-white/10">
                                            <h2 class="font-display text-3xl font-medium tracking-tight mb-3">Value Drivers</h2>
                                            <p class="font-mono text-xs text-neutral-600 uppercase tracking-[0.3em]">Key Performance Indicators</p>
                                        </div>

                                        <!-- Metrics Grid -->
                                        <div class="space-y-10" id="metrics-container">
                                            <div class="border-l-2 border-off-white/20 pl-8 opacity-0 transition-all duration-1000" id="metric-1">
                                                <div class="text-xs text-neutral-600 mb-4 uppercase tracking-[0.4em] font-mono" id="metric-1-label">Gross Margin</div>
                                                <div class="text-6xl font-display font-medium text-off-white mb-6 tracking-tight transition-all duration-700" id="metric-1-value">0.0<span class="text-neutral-700">%</span></div>
                                                <div class="h-0.5 bg-off-white/10 w-full relative overflow-hidden rounded-full">
                                                    <div class="absolute inset-y-0 left-0 bg-gradient-to-r from-off-white to-neutral-400 rounded-full" style="width: 0%; transition: width 2000ms cubic-bezier(0.4, 0, 0.2, 1);" id="metric-1-bar"></div>
                                                </div>
                                                <div class="text-xs text-neutral-600 mt-4 font-sans" id="metric-1-benchmark">Target: >55.0%</div>
                                            </div>

                                            <div class="border-l-2 border-off-white/20 pl-8 opacity-0 transition-all duration-1000" id="metric-2">
                                                <div class="text-xs text-neutral-600 mb-4 uppercase tracking-[0.4em] font-mono" id="metric-2-label">EBITDA Margin</div>
                                                <div class="text-6xl font-display font-medium text-off-white mb-6 tracking-tight transition-all duration-700" id="metric-2-value">0.0<span class="text-neutral-700">%</span></div>
                                                <div class="h-0.5 bg-off-white/10 w-full relative overflow-hidden rounded-full">
                                                    <div class="absolute inset-y-0 left-0 bg-gradient-to-r from-off-white to-neutral-400 rounded-full" style="width: 0%; transition: width 2000ms cubic-bezier(0.4, 0, 0.2, 1);" id="metric-2-bar"></div>
                                                </div>
                                                <div class="text-xs text-neutral-600 mt-4 font-sans" id="metric-2-benchmark">Target: >28.0%</div>
                                            </div>

                                            <div class="border-l-2 border-off-white/20 pl-8 opacity-0 transition-all duration-1000" id="metric-3">
                                                <div class="text-xs text-neutral-600 mb-4 uppercase tracking-[0.4em] font-mono" id="metric-3-label">Net Margin</div>
                                                <div class="text-6xl font-display font-medium text-off-white mb-6 tracking-tight transition-all duration-700" id="metric-3-value">0.0<span class="text-neutral-700">%</span></div>
                                                <div class="h-0.5 bg-off-white/10 w-full relative overflow-hidden rounded-full">
                                                    <div class="absolute inset-y-0 left-0 bg-gradient-to-r from-off-white to-neutral-400 rounded-full" style="width: 0%; transition: width 2000ms cubic-bezier(0.4, 0, 0.2, 1);" id="metric-3-bar"></div>
                                                </div>
                                                <div class="text-xs text-neutral-600 mt-4 font-sans" id="metric-3-benchmark">Target: >18.0%</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <!-- Why Work With Me -->
                        <div class="modal-stagger border-t border-off-white/10 pt-32 mb-32" style="transition-delay: 0.25s">
                            <div class="max-w-6xl">
                                <div class="mb-20">
                                    <div class="font-mono text-xs uppercase tracking-[0.5em] text-neutral-600 mb-8">Methodology</div>
                                    <h2 class="font-display text-6xl md:text-7xl font-medium mb-8 tracking-tight leading-[0.95]">
                                        Engagement Model
                                    </h2>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-4 gap-12">
                                    <div class="group">
                                        <div class="text-8xl font-display font-medium text-off-white/5 mb-6 group-hover:text-off-white/10 transition-colors duration-700">01</div>
                                        <h3 class="font-display text-2xl mb-4 leading-tight">Diagnosis<br/>& Framing</h3>
                                        <p class="font-sans text-neutral-500 leading-[1.8] text-sm">
                                            Deconstruct complex challenges into solvable components. We identify the core strategic levers that drive outsized value.
                                        </p>
                                    </div>

                                    <div class="group">
                                        <div class="text-8xl font-display font-medium text-off-white/5 mb-6 group-hover:text-off-white/10 transition-colors duration-700">02</div>
                                        <h3 class="font-display text-2xl mb-4 leading-tight">Rigorous<br/>Analysis</h3>
                                        <p class="font-sans text-neutral-500 leading-[1.8] text-sm">
                                            Data-driven validation of strategic hypotheses. We build institutional-grade models to stress-test scenarios and quantify risk.
                                        </p>
                                    </div>

                                    <div class="group">
                                        <div class="text-8xl font-display font-medium text-off-white/5 mb-6 group-hover:text-off-white/10 transition-colors duration-700">03</div>
                                        <h3 class="font-display text-2xl mb-4 leading-tight">Strategic<br/>Direction</h3>
                                        <p class="font-sans text-neutral-500 leading-[1.8] text-sm">
                                            Synthesize insights into a clear, actionable roadmap. We prioritize initiatives based on ROI and operational feasibility.
                                        </p>
                                    </div>

                                    <div class="group">
                                        <div class="text-8xl font-display font-medium text-off-white/5 mb-6 group-hover:text-off-white/10 transition-colors duration-700">04</div>
                                        <h3 class="font-display text-2xl mb-4 leading-tight">Execution<br/>& Impact</h3>
                                        <p class="font-sans text-neutral-500 leading-[1.8] text-sm">
                                            Partner with leadership to drive change. We establish governance structures and KPIs to ensure sustained performance improvement.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Contact -->
                        <div class="modal-stagger border-t border-off-white/10 pt-32" style="transition-delay: 0.3s">
                            <div class="max-w-3xl mx-auto">
                                <div class="mb-12 text-center">
                                    <div class="font-mono text-xs uppercase tracking-[0.5em] text-neutral-600 mb-6">Initiate Engagement</div>
                                    <h2 class="font-display text-5xl font-medium mb-6 tracking-tight">Request Consultation</h2>
                                    <p class="font-sans text-lg text-neutral-400 leading-relaxed">
                                        Briefly describe your strategic objectives. I will review and respond with a preliminary perspective.
                                    </p>
                                </div>

                            <form action="https://formspree.io/f/xyzrppzo" method="POST" class="space-y-8">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                    <div>
                                        <input type="text" name="name" required 
                                            class="w-full bg-transparent border-b border-off-white/20 pb-4 text-off-white font-sans text-base placeholder:text-neutral-600 focus:border-off-white focus:outline-none transition-colors duration-300" 
                                            placeholder="Name *">
                                    </div>
                                    <div>
                                        <input type="email" name="email" required 
                                            class="w-full bg-transparent border-b border-off-white/20 pb-4 text-off-white font-sans text-base placeholder:text-neutral-600 focus:border-off-white focus:outline-none transition-colors duration-300" 
                                            placeholder="Business Email *">
                                    </div>
                                </div>
                                
                                <div>
                                    <input type="text" name="company" 
                                        class="w-full bg-transparent border-b border-off-white/20 pb-4 text-off-white font-sans text-base placeholder:text-neutral-600 focus:border-off-white focus:outline-none transition-colors duration-300" 
                                        placeholder="Company / Organization">
                                </div>

                                <div>
                                    <textarea name="message" required rows="4" 
                                        class="w-full bg-transparent border-b border-off-white/20 pb-4 text-off-white font-sans text-base placeholder:text-neutral-600 focus:border-off-white focus:outline-none transition-colors duration-300 resize-none" 
                                        placeholder="Outline your key strategic questions... *"></textarea>
                                </div>

                                <div class="pt-8">
                                    <button type="submit" 
                                        class="w-full bg-off-white text-black font-display text-base font-medium py-5 px-8 hover:bg-neutral-200 hover:shadow-2xl hover:shadow-white/20 transition-all duration-500 uppercase tracking-[0.2em]">
                                        Request Briefing
                                    </button>
                                    <div class="flex items-center justify-center gap-8 mt-8 text-xs text-neutral-600 font-mono">
                                        <div class="flex items-center gap-2">
                                            <i data-lucide="shield-check" class="w-3 h-3"></i>
                                            <span>Strictly Confidential</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <i data-lucide="clock" class="w-3 h-3"></i>
                                            <span>24hr Response</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <i data-lucide="check-circle" class="w-3 h-3"></i>
                                            <span>No Obligation</span>
                                        </div>
                                    </div>
                                </div>
                            </form>
                            </div>
                        </div>
                    </div>
                `;

                setTimeout(() => {
                    initLiveAnalysis();
                }, 300);

            } else if (serviceId === 'website') {
                modalBody.innerHTML = `
                    <div class="max-w-[1600px] mx-auto">
                        <!-- Hero Header -->
                        <div class="modal-stagger mb-24" style="transition-delay: 0.05s">
                            <div class="max-w-6xl">
                                <div class="flex items-center gap-4 mb-10">
                                    <div class="w-2 h-2 bg-off-white/40 rounded-full animate-pulse"></div>
                                    <div class="font-mono text-xs text-neutral-600 uppercase tracking-[0.5em]">Live Design System</div>
                                </div>
                                <h1 class="font-display text-8xl md:text-9xl font-medium mb-10 tracking-tight leading-[0.85]">
                                    <span class="typing-text" id="website-main-title">${data.title}</span>
                                </h1>
                                <p class="font-sans text-2xl text-neutral-400 leading-[1.6] max-w-4xl opacity-0 transition-all duration-500 transform translate-y-4" id="website-subtitle-text">
                                    ${data.subtitle}
                                </p>
                            </div>
                        </div>

                        <!-- Main Content Grid -->
                        <div class="grid grid-cols-1 lg:grid-cols-5 gap-12 mb-24">
                            <!-- Left: Interactive Design Showcase (3/5) -->
                            <div class="lg:col-span-3 modal-stagger space-y-12" style="transition-delay: 0.1s">
                                
                                <!-- Design Mode Tabs -->
                                <div class="border-b border-off-white/10 flex gap-8 mb-8" id="design-tabs">
                                    <button class="design-tab active pb-4 font-mono text-xs uppercase tracking-[0.3em] text-off-white border-b-2 border-off-white transition-all duration-300" data-mode="layout">Layout</button>
                                    <button class="design-tab pb-4 font-mono text-xs uppercase tracking-[0.3em] text-neutral-600 border-b-2 border-transparent hover:text-off-white hover:border-off-white/30 transition-all duration-300" data-mode="typography">Typography</button>
                                    <button class="design-tab pb-4 font-mono text-xs uppercase tracking-[0.3em] text-neutral-600 border-b-2 border-transparent hover:text-off-white hover:border-off-white/30 transition-all duration-300" data-mode="motion">Motion</button>
                                </div>

                                <!-- Design Content Container -->
                                <div class="design-modes relative">
                                    <!-- Layout Mode -->
                                    <div id="design-layout" class="design-content">
                                        <div class="space-y-12">
                                            <!-- Browser Window -->
                                            <div class="border border-off-white/10 overflow-hidden shadow-2xl shadow-black/50 opacity-0 design-element" style="animation: fadeInDesign 0.8s ease-out 0.1s forwards;">
                                                <!-- Browser Header -->
                                                <div class="bg-[#0F0F0F] border-b border-off-white/10 px-4 py-3 flex items-center gap-3">
                                                    <div class="flex gap-2">
                                                        <div class="w-3 h-3 rounded-full bg-red-500/30"></div>
                                                        <div class="w-3 h-3 rounded-full bg-off-white/30"></div>
                                                        <div class="w-3 h-3 rounded-full bg-off-white/30"></div>
                                                    </div>
                                                    <div class="flex-1 flex items-center gap-2 px-4 py-1.5 bg-off-white/10 rounded font-mono text-xs text-neutral-600">
                                                        <i data-lucide="lock" class="w-3 h-3"></i>
                                                        <span>yourwebsite.com</span>
                                                    </div>
                                                </div>

                                                <!-- Browser Content -->
                                                <div class="bg-[#030303] p-12 relative" style="min-height: 500px;" id="browser-viewport">
                                                    <!-- Grid Overlay with Pulse -->
                                                    <div class="absolute inset-0 grid grid-cols-12 gap-px pointer-events-none" id="grid-overlay" style="animation: gridPulse 4s ease-in-out infinite;">
                                                        <div class="border-l border-off-white/20"></div>
                                                        <div class="border-l border-off-white/20"></div>
                                                        <div class="border-l border-off-white/20"></div>
                                                        <div class="border-l border-off-white/20"></div>
                                                        <div class="border-l border-off-white/20"></div>
                                                        <div class="border-l border-off-white/20"></div>
                                                        <div class="border-l border-off-white/20"></div>
                                                        <div class="border-l border-off-white/20"></div>
                                                        <div class="border-l border-off-white/20"></div>
                                                        <div class="border-l border-off-white/20"></div>
                                                        <div class="border-l border-off-white/20"></div>
                                                        <div class="border-l border-off-white/20"></div>
                                                    </div>
                                                    
                                                    <!-- Building Cursor Indicator -->
                                                    <div class="absolute top-4 right-4 flex items-center gap-2 z-20">
                                                        <div class="w-1.5 h-1.5 bg-off-white rounded-full" style="animation: cursorBlink 1s infinite;"></div>
                                                        <span class="font-mono text-xs text-off-white/60">RENDERING</span>
                                                    </div>
                                                    
                                                    <!-- Mock Content -->
                                                    <div class="relative z-10 space-y-10" id="preview-content">
                                                        <!-- Hero Section -->
                                                        <div class="opacity-0 preview-element" style="animation: fadeInDesign 0.6s ease-out 0.2s forwards;">
                                                            <div class="h-14 bg-gradient-to-r from-off-white/30 via-white/20 to-white/5 rounded-lg flex items-center px-6 shadow-lg shadow-white/5" style="width: 45%;">
                                                                <div class="h-3 bg-off-white/100 rounded animate-pulse" style="width: 60%;"></div>
                                                            </div>
                                                        </div>
                                                        
                                                        <!-- Body Text -->
                                                        <div class="space-y-3 opacity-0 preview-element" style="animation: fadeInDesign 0.6s ease-out 0.3s forwards;">
                                                            <div class="h-4 bg-gradient-to-r from-off-white/15 to-white/5 rounded" style="width: 75%;"></div>
                                                            <div class="h-4 bg-gradient-to-r from-off-white/15 to-white/5 rounded" style="width: 90%;"></div>
                                                            <div class="h-4 bg-gradient-to-r from-off-white/15 to-white/5 rounded" style="width: 65%;"></div>
                                                        </div>

                                                        <!-- CTA Button -->
                                                        <div class="opacity-0 preview-element" style="animation: fadeInDesign 0.6s ease-out 0.4s forwards;">
                                                            <div class="inline-flex items-center gap-3 bg-off-white/95 hover:bg-off-white hover:scale-105 transition-all duration-500 px-8 py-4 rounded-lg shadow-xl shadow-white/30 cursor-pointer group">
                                                                <div class="h-3 bg-black/80 rounded" style="width: 100px;"></div>
                                                                <div class="w-4 h-4 border-2 border-black/80 rounded-full flex items-center justify-center">
                                                                    <div class="w-2 h-2 bg-black/80 rounded-full transform group-hover:translate-x-1 transition-transform duration-300"></div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                        <!-- Feature Cards -->
                                                        <div class="grid grid-cols-3 gap-6 mt-16 opacity-0 preview-element" style="animation: fadeInDesign 0.6s ease-out 0.5s forwards;">
                                                            <div class="border border-off-white/10 bg-off-white/10 backdrop-blur-sm p-6 rounded-lg hover:border-off-white/30 hover:bg-off-white/10 hover:scale-105 transition-all duration-500 cursor-pointer group shadow-lg shadow-black/20">
                                                                <div class="w-12 h-12 bg-off-white/20 rounded-lg mb-4 flex items-center justify-center group-hover:bg-off-white/40 group-hover:shadow-lg group-hover:shadow-white/30 transition-all duration-500">
                                                                    <div class="w-6 h-6 bg-off-white/70 rounded group-hover:rotate-12 transition-transform duration-500"></div>
                                                                </div>
                                                                <div class="h-3 bg-off-white/30 rounded mb-3 group-hover:bg-off-white/40 transition-colors" style="width: 70%;"></div>
                                                                <div class="space-y-2">
                                                                    <div class="h-2 bg-off-white/15 rounded group-hover:bg-off-white/20 transition-colors" style="width: 90%;"></div>
                                                                    <div class="h-2 bg-off-white/15 rounded group-hover:bg-off-white/20 transition-colors" style="width: 75%;"></div>
                                                                </div>
                                                            </div>
                                                            <div class="border border-off-white/10 bg-off-white/10 backdrop-blur-sm p-6 rounded-lg hover:border-off-white/30 hover:bg-off-white/10 hover:scale-105 transition-all duration-500 cursor-pointer group shadow-lg shadow-black/20">
                                                                <div class="w-12 h-12 bg-off-white/20 rounded-lg mb-4 flex items-center justify-center group-hover:bg-off-white/40 group-hover:shadow-lg group-hover:shadow-white/30 transition-all duration-500">
                                                                    <div class="w-6 h-6 bg-off-white/70 rounded group-hover:rotate-12 transition-transform duration-500"></div>
                                                                </div>
                                                                <div class="h-3 bg-off-white/30 rounded mb-3 group-hover:bg-off-white/40 transition-colors" style="width: 65%;"></div>
                                                                <div class="space-y-2">
                                                                    <div class="h-2 bg-off-white/15 rounded group-hover:bg-off-white/20 transition-colors" style="width: 85%;"></div>
                                                                    <div class="h-2 bg-off-white/15 rounded group-hover:bg-off-white/20 transition-colors" style="width: 80%;"></div>
                                                                </div>
                                                            </div>
                                                            <div class="border border-off-white/10 bg-off-white/10 backdrop-blur-sm p-6 rounded-lg hover:border-off-white/30 hover:bg-off-white/10 hover:scale-105 transition-all duration-500 cursor-pointer group shadow-lg shadow-black/20">
                                                                <div class="w-12 h-12 bg-off-white/20 rounded-lg mb-4 flex items-center justify-center group-hover:bg-off-white/40 group-hover:shadow-lg group-hover:shadow-white/30 transition-all duration-500">
                                                                    <div class="w-6 h-6 bg-off-white/70 rounded group-hover:rotate-12 transition-transform duration-500"></div>
                                                                </div>
                                                                <div class="h-3 bg-off-white/30 rounded mb-3 group-hover:bg-off-white/40 transition-colors" style="width: 75%;"></div>
                                                                <div class="space-y-2">
                                                                    <div class="h-2 bg-off-white/15 rounded group-hover:bg-off-white/20 transition-colors" style="width: 80%;"></div>
                                                                    <div class="h-2 bg-off-white/15 rounded group-hover:bg-off-white/20 transition-colors" style="width: 70%;"></div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Device Switcher -->
                                                <div class="bg-[#0F0F0F] border-t border-off-white/10 px-6 py-3 flex items-center justify-center gap-2">
                                                    <button class="device-switch px-4 py-2 font-mono text-xs hover:bg-off-white/10 transition-all duration-300 flex items-center gap-2" data-device="mobile">
                                                        <i data-lucide="smartphone" class="w-3 h-3"></i>
                                                        <span>Mobile</span>
                                                    </button>
                                                    <button class="device-switch px-4 py-2 font-mono text-xs hover:bg-off-white/10 transition-all duration-300 flex items-center gap-2" data-device="tablet">
                                                        <i data-lucide="tablet" class="w-3 h-3"></i>
                                                        <span>Tablet</span>
                                                    </button>
                                                    <button class="device-switch active px-4 py-2 font-mono text-xs bg-off-white/10 transition-all duration-300 flex items-center gap-2" data-device="desktop">
                                                        <i data-lucide="monitor" class="w-3 h-3"></i>
                                                        <span>Desktop</span>
                                                    </button>
                                                </div>
                                            </div>

                                            <!-- Responsive Breakpoints -->
                                            <div class="border border-off-white/10 p-8 opacity-0 design-element" style="animation: fadeInDesign 0.8s ease-out 0.4s forwards;">
                                                <div class="font-mono text-xs text-neutral-600 mb-6 uppercase tracking-widest">Responsive System</div>
                                                <div class="grid grid-cols-4 gap-4">
                                                    <div class="text-center p-4 border border-off-white/10 bg-off-white/10">
                                                        <i data-lucide="smartphone" class="w-6 h-6 mx-auto mb-2 text-neutral-500"></i>
                                                        <div class="font-mono text-xs text-off-white mb-1">Mobile</div>
                                                        <div class="font-mono text-[10px] text-neutral-600">< 768px</div>
                                                    </div>
                                                    <div class="text-center p-4 border border-off-white/10 bg-off-white/10">
                                                        <i data-lucide="tablet" class="w-6 h-6 mx-auto mb-2 text-neutral-500"></i>
                                                        <div class="font-mono text-xs text-off-white mb-1">Tablet</div>
                                                        <div class="font-mono text-[10px] text-neutral-600">768px - 1024px</div>
                                                    </div>
                                                    <div class="text-center p-4 border border-off-white/10 bg-off-white/10">
                                                        <i data-lucide="monitor" class="w-6 h-6 mx-auto mb-2 text-off-white"></i>
                                                        <div class="font-mono text-xs text-off-white mb-1">Desktop</div>
                                                        <div class="font-mono text-[10px] text-neutral-400">1024px - 1440px</div>
                                                    </div>
                                                    <div class="text-center p-4 border border-off-white/10 bg-off-white/10">
                                                        <i data-lucide="tv" class="w-6 h-6 mx-auto mb-2 text-neutral-500"></i>
                                                        <div class="font-mono text-xs text-off-white mb-1">Large</div>
                                                        <div class="font-mono text-[10px] text-neutral-600">&gt; 1440px</div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Component Library Preview -->
                                            <div class="border border-off-white/10 p-8 opacity-0 design-element" style="animation: fadeInDesign 0.8s ease-out 0.6s forwards;">
                                                <div class="font-mono text-xs text-neutral-600 mb-6 uppercase tracking-widest">Component Library</div>
                                                <div class="space-y-6">
                                                    <div class="flex flex-wrap gap-3">
                                                        <button class="px-8 py-4 bg-off-white text-black font-display text-sm uppercase tracking-wider hover:bg-neutral-200 hover:scale-105 transition-all duration-300 shadow-lg shadow-white/10">Primary CTA</button>
                                                        <button class="px-8 py-4 border border-off-white/20 text-off-white font-display text-sm uppercase tracking-wider hover:bg-off-white/10 hover:border-off-white/40 transition-all duration-300">Secondary</button>
                                                        <button class="px-8 py-4 text-off-white font-display text-sm uppercase tracking-wider hover:text-neutral-400 transition-all duration-300">Text Link</button>
                                                    </div>
                                                    
                                                    <div class="h-px bg-gradient-to-r from-transparent via-white/20 to-transparent"></div>
                                                    
                                                    <div class="grid grid-cols-2 gap-4">
                                                        <div class="border border-off-white/10 p-4 hover:border-off-white/30 hover:bg-off-white/10 transition-all duration-300 cursor-pointer group">
                                                            <div class="flex items-center gap-3">
                                                                <div class="w-10 h-10 bg-off-white/10 group-hover:bg-off-white/20 rounded-full flex items-center justify-center transition-all duration-300">
                                                                    <i data-lucide="check" class="w-5 h-5"></i>
                                                                </div>
                                                                <div>
                                                                    <div class="font-display text-sm">Feature Card</div>
                                                                    <div class="font-mono text-xs text-neutral-600">Interactive</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="border border-off-white/10 p-4 hover:border-off-white/30 hover:bg-off-white/10 transition-all duration-300 cursor-pointer group">
                                                            <div class="flex items-center gap-3">
                                                                <div class="w-10 h-10 bg-off-white/10 group-hover:bg-off-white/20 rounded-full flex items-center justify-center transition-all duration-300">
                                                                    <i data-lucide="star" class="w-5 h-5"></i>
                                                                </div>
                                                                <div>
                                                                    <div class="font-display text-sm">Highlight Card</div>
                                                                    <div class="font-mono text-xs text-neutral-600">Hover Effect</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Typography Mode -->
                                    <div id="design-typography" class="design-content hidden">
                                        <div class="space-y-12">
                                            <!-- Type Scale Demonstration -->
                                            <div class="border border-off-white/10 overflow-hidden shadow-2xl shadow-black/50 opacity-0 design-element" style="animation: fadeInDesign 0.8s ease-out 0.2s forwards;">
                                                <div class="bg-[#0F0F0F] border-b border-off-white/10 px-4 py-3">
                                                    <div class="font-mono text-xs text-neutral-600 uppercase tracking-widest">Type Hierarchy</div>
                                                </div>
                                                <div class="bg-[#030303] p-12 space-y-8">
                                                    <div class="group cursor-pointer">
                                                        <div class="font-display text-7xl font-bold tracking-tight text-off-white mb-2 group-hover:text-neutral-300 transition-colors duration-500">Display XL</div>
                                                        <div class="font-mono text-xs text-neutral-600">96px / -0.02em / Space Grotesk Bold</div>
                                                    </div>
                                                    <div class="h-px bg-gradient-to-r from-off-white/0 via-white/20 to-white/0"></div>
                                                    <div class="group cursor-pointer">
                                                        <div class="font-display text-5xl font-medium tracking-tight text-off-white mb-2 group-hover:text-neutral-300 transition-colors duration-500">Heading 1</div>
                                                        <div class="font-mono text-xs text-neutral-600">48px / -0.01em / Space Grotesk Medium</div>
                                                    </div>
                                                    <div class="h-px bg-gradient-to-r from-off-white/0 via-white/10 to-white/0"></div>
                                                    <div class="group cursor-pointer">
                                                        <div class="font-display text-3xl font-medium text-off-white mb-2 group-hover:text-neutral-300 transition-colors duration-500">Heading 2</div>
                                                        <div class="font-mono text-xs text-neutral-600">32px / -0.01em / Space Grotesk Medium</div>
                                                    </div>
                                                    <div class="h-px bg-gradient-to-r from-off-white/0 via-white/10 to-white/0"></div>
                                                    <div class="group cursor-pointer">
                                                        <div class="font-sans text-xl text-neutral-300 leading-relaxed mb-2 group-hover:text-off-white transition-colors duration-500">Body Large - Perfect for introductory paragraphs and lead text that needs emphasis while maintaining excellent readability.</div>
                                                        <div class="font-mono text-xs text-neutral-600">20px / 1.7 / Inter Regular</div>
                                                    </div>
                                                    <div class="group cursor-pointer">
                                                        <div class="font-sans text-base text-neutral-400 leading-relaxed mb-2 group-hover:text-neutral-300 transition-colors duration-500">Body Regular - The workhorse of your content. Optimized for long-form reading with comfortable spacing and rhythm that keeps readers engaged through extended passages.</div>
                                                        <div class="font-mono text-xs text-neutral-600">16px / 1.75 / Inter Regular</div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Font Pairing & Color Palette -->
                                            <div class="grid grid-cols-2 gap-6">
                                                <div class="border border-off-white/10 p-8 opacity-0 design-element" style="animation: fadeInDesign 0.8s ease-out 0.4s forwards;">
                                                    <div class="font-mono text-xs text-neutral-600 mb-6 uppercase tracking-widest">Font Pairing</div>
                                                    <div class="space-y-6">
                                                        <div class="text-center p-6 border border-off-white/10 bg-off-white/10 hover:border-off-white/30 hover:bg-off-white/10 transition-all duration-500 group cursor-pointer">
                                                            <div class="font-display text-5xl mb-3 group-hover:scale-110 transition-transform duration-500 group-hover:text-neutral-200">Aa</div>
                                                            <div class="text-sm text-off-white mb-1">Space Grotesk</div>
                                                            <div class="font-mono text-[10px] text-neutral-600">Display & Headlines</div>
                                                        </div>
                                                        <div class="text-center p-6 border border-off-white/10 bg-off-white/10 hover:border-off-white/30 hover:bg-off-white/10 transition-all duration-500 group cursor-pointer">
                                                            <div class="font-sans text-5xl mb-3 group-hover:scale-110 transition-transform duration-500 group-hover:text-neutral-200">Aa</div>
                                                            <div class="text-sm text-off-white mb-1">Inter</div>
                                                            <div class="font-mono text-[10px] text-neutral-600">Body & Interface</div>
                                                        </div>
                                                        <div class="text-center p-6 border border-off-white/10 bg-off-white/10 hover:border-off-white/30 hover:bg-off-white/10 transition-all duration-500 group cursor-pointer">
                                                            <div class="font-mono text-5xl mb-3 group-hover:scale-110 transition-transform duration-500 group-hover:text-neutral-200">Aa</div>
                                                            <div class="text-sm text-off-white mb-1">Monospace</div>
                                                            <div class="font-mono text-[10px] text-neutral-600">Code & Data</div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="border border-off-white/10 p-8 opacity-0 design-element" style="animation: fadeInDesign 0.8s ease-out 0.6s forwards;">
                                                    <div class="font-mono text-xs text-neutral-600 mb-6 uppercase tracking-widest">Color Palette</div>
                                                    <div class="space-y-3">
                                                        <div class="flex items-center gap-4 group cursor-pointer">
                                                            <div class="w-16 h-16 bg-[#030303] border-2 border-off-white/20 rounded-lg group-hover:scale-110 group-hover:shadow-lg transition-all duration-300"></div>
                                                            <div>
                                                                <div class="font-mono text-xs text-off-white">#030303</div>
                                                                <div class="font-mono text-[10px] text-neutral-600">Background</div>
                                                            </div>
                                                        </div>
                                                        <div class="flex items-center gap-4 group cursor-pointer">
                                                            <div class="w-16 h-16 bg-off-white border-2 border-off-white/20 rounded-lg group-hover:scale-110 group-hover:shadow-lg group-hover:shadow-white/30 transition-all duration-300"></div>
                                                            <div>
                                                                <div class="font-mono text-xs text-off-white">#EAEAEA</div>
                                                                <div class="font-mono text-[10px] text-neutral-600">Primary Text</div>
                                                            </div>
                                                        </div>
                                                        <div class="flex items-center gap-4 group cursor-pointer">
                                                            <div class="w-16 h-16 bg-off-white border-2 border-off-white/20 rounded-lg group-hover:scale-110 group-hover:shadow-lg group-hover:shadow-white/50 transition-all duration-300"></div>
                                                            <div>
                                                                <div class="font-mono text-xs text-off-white">#10B981</div>
                                                                <div class="font-mono text-[10px] text-neutral-600">Accent</div>
                                                            </div>
                                                        </div>
                                                        <div class="flex items-center gap-4 group cursor-pointer">
                                                            <div class="w-16 h-16 bg-neutral-500 border-2 border-off-white/20 rounded-lg group-hover:scale-110 group-hover:shadow-lg transition-all duration-300"></div>
                                                            <div>
                                                                <div class="font-mono text-xs text-off-white">#737373</div>
                                                                <div class="font-mono text-[10px] text-neutral-600">Secondary</div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Live Text Example -->
                                            <div class="border border-off-white/10 p-12 bg-gradient-to-br from-off-white/5 to-transparent opacity-0 design-element" style="animation: fadeInDesign 0.8s ease-out 0.8s forwards;">
                                                <div class="max-w-3xl">
                                                    <div class="font-display text-4xl font-medium text-off-white mb-6 leading-tight">Typography creates hierarchy, guides attention, and establishes visual rhythm.</div>
                                                    <div class="font-sans text-lg text-neutral-400 leading-relaxed space-y-4">
                                                        <p>Every typeface choice communicates personality. Space Grotesk brings geometric precision and modern confidence to headlines, while Inter ensures clarity and warmth in body text.</p>
                                                        <p>The result is a harmonious system that scales beautifully across devices and maintains readability at every breakpoint.</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Motion Mode -->
                                    <div id="design-motion" class="design-content hidden">
                                        <div class="space-y-12">
                                            <!-- Easing Functions -->
                                            <div class="border border-off-white/10 overflow-hidden shadow-2xl shadow-black/50 opacity-0 design-element" style="animation: fadeInDesign 0.8s ease-out 0.2s forwards;">
                                                <div class="bg-[#0F0F0F] border-b border-off-white/10 px-4 py-3 flex items-center justify-between">
                                                    <div class="font-mono text-xs text-neutral-600 uppercase tracking-widest">Easing Curves</div>
                                                    <button onclick="triggerMotionDemo()" class="px-3 py-1.5 border border-off-white/20 hover:bg-off-white/10 transition-all duration-300 font-mono text-xs uppercase tracking-wider flex items-center gap-2 group">
                                                        <i data-lucide="play" class="w-3 h-3 group-hover:scale-125 transition-transform"></i>
                                                        <span>Replay All</span>
                                                    </button>
                                                </div>
                                                <div class="bg-[#030303] p-8 space-y-6">
                                                    <div class="border border-off-white/10 p-6 hover:border-off-white/30 bg-off-white/10 hover:bg-off-white/10 transition-all duration-500 group cursor-pointer" onclick="triggerMotionDemo()">
                                                        <div class="flex justify-between items-center mb-4">
                                                            <div class="font-mono text-sm text-off-white">ease-out</div>
                                                            <div class="font-mono text-xs text-neutral-600">cubic-bezier(0, 0, 0.2, 1)</div>
                                                        </div>
                                                        <div class="relative h-14 bg-off-white/10 overflow-hidden rounded-lg border border-off-white/10">
                                                            <div class="absolute left-0 top-0 bottom-0 w-14 bg-gradient-to-r from-off-white to-neutral-400 motion-demo-ease-out shadow-lg shadow-white/50 rounded-lg flex items-center justify-center">
                                                                <div class="w-2 h-2 bg-off-white rounded-full"></div>
                                                            </div>
                                                        </div>
                                                        <div class="mt-3 text-xs text-neutral-500">Quick start, smooth finish - Perfect for exits and reveals</div>
                                                    </div>

                                                    <div class="border border-off-white/10 p-6 hover:border-off-white/30 bg-off-white/10 hover:bg-off-white/10 transition-all duration-500 group cursor-pointer" onclick="triggerMotionDemo()">
                                                        <div class="flex justify-between items-center mb-4">
                                                            <div class="font-mono text-sm text-off-white">spring</div>
                                                            <div class="font-mono text-xs text-neutral-600">cubic-bezier(0.16, 1, 0.3, 1)</div>
                                                        </div>
                                                        <div class="relative h-14 bg-off-white/10 overflow-hidden rounded-lg border border-off-white/10">
                                                            <div class="absolute left-0 top-0 bottom-0 w-14 bg-gradient-to-r from-neutral-300 to-neutral-500 motion-demo-spring shadow-lg shadow-white/50 rounded-lg flex items-center justify-center">
                                                                <div class="w-2 h-2 bg-off-white rounded-full"></div>
                                                            </div>
                                                        </div>
                                                        <div class="mt-3 text-xs text-neutral-500">Elastic energy - Adds personality to interactions</div>
                                                    </div>

                                                    <div class="border border-off-white/10 p-6 hover:border-off-white/30 bg-off-white/10 hover:bg-off-white/10 transition-all duration-500 group cursor-pointer" onclick="triggerMotionDemo()">
                                                        <div class="flex justify-between items-center mb-4">
                                                            <div class="font-mono text-sm text-off-white">ease-in-out</div>
                                                            <div class="font-mono text-xs text-neutral-600">cubic-bezier(0.4, 0, 0.2, 1)</div>
                                                        </div>
                                                        <div class="relative h-14 bg-off-white/10 overflow-hidden rounded-lg border border-off-white/10">
                                                            <div class="absolute left-0 top-0 bottom-0 w-14 bg-gradient-to-r from-neutral-400 to-neutral-600 motion-demo-ease-in-out shadow-lg shadow-white/50 rounded-lg flex items-center justify-center">
                                                                <div class="w-2 h-2 bg-off-white rounded-full"></div>
                                                            </div>
                                                        </div>
                                                        <div class="mt-3 text-xs text-neutral-500">Balanced motion - Smooth transitions between states</div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Duration Scale -->
                                            <div class="border border-off-white/10 p-8 opacity-0 design-element" style="animation: fadeInDesign 0.8s ease-out 0.4s forwards;">
                                                <div class="font-mono text-xs text-neutral-600 mb-6 uppercase tracking-widest">Duration Scale</div>
                                                <div class="grid grid-cols-4 gap-4">
                                                    <div class="text-center p-6 border border-off-white/10 bg-off-white/10 hover:border-off-white/20 hover:bg-off-white/10 transition-all duration-150 group cursor-pointer">
                                                        <div class="font-display text-3xl text-off-white mb-2 group-hover:scale-110 transition-transform duration-150">150ms</div>
                                                        <div class="font-mono text-[10px] text-neutral-600 uppercase">Instant</div>
                                                        <div class="mt-3 h-1 bg-off-white/10 rounded-full overflow-hidden">
                                                            <div class="h-full bg-off-white w-1/4"></div>
                                                        </div>
                                                    </div>
                                                    <div class="text-center p-6 border border-off-white/10 bg-off-white/10 hover:border-off-white/30 hover:bg-off-white/15 transition-all duration-300 group cursor-pointer">
                                                        <div class="font-display text-3xl text-off-white mb-2 group-hover:scale-110 transition-transform duration-300">300ms</div>
                                                        <div class="font-mono text-[10px] text-neutral-400 uppercase">Base</div>
                                                        <div class="mt-3 h-1 bg-off-white/10 rounded-full overflow-hidden">
                                                            <div class="h-full bg-off-white w-1/2"></div>
                                                        </div>
                                                    </div>
                                                    <div class="text-center p-6 border border-off-white/10 bg-off-white/10 hover:border-off-white/20 hover:bg-off-white/10 transition-all duration-500 group cursor-pointer">
                                                        <div class="font-display text-3xl text-off-white mb-2 group-hover:scale-110 transition-transform duration-500">500ms</div>
                                                        <div class="font-mono text-[10px] text-neutral-600 uppercase">Smooth</div>
                                                        <div class="mt-3 h-1 bg-off-white/10 rounded-full overflow-hidden">
                                                            <div class="h-full bg-off-white w-3/4"></div>
                                                        </div>
                                                    </div>
                                                    <div class="text-center p-6 border border-off-white/10 bg-off-white/10 hover:border-off-white/20 hover:bg-off-white/10 transition-all duration-700 group cursor-pointer">
                                                        <div class="font-display text-3xl text-off-white mb-2 group-hover:scale-110 transition-transform duration-700">700ms</div>
                                                        <div class="font-mono text-[10px] text-neutral-600 uppercase">Cinematic</div>
                                                        <div class="mt-3 h-1 bg-off-white/10 rounded-full overflow-hidden">
                                                            <div class="h-full bg-off-white w-full"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Interactive Example -->
                                            <div class="border border-off-white/10 p-12 bg-gradient-to-br from-off-white/5 to-transparent opacity-0 design-element" style="animation: fadeInDesign 0.8s ease-out 0.6s forwards;">
                                                <div class="font-mono text-xs text-neutral-600 mb-8 uppercase tracking-widest">Interactive Example</div>
                                                <div class="grid grid-cols-3 gap-6">
                                                    <div class="aspect-square border-2 border-off-white/30 bg-off-white/10 rounded-2xl hover:border-off-white hover:bg-off-white/20 hover:scale-110 hover:rotate-3 transition-all duration-500 cursor-pointer flex items-center justify-center group">
                                                        <div class="text-center">
                                                            <div class="w-16 h-16 bg-off-white/30 rounded-full mx-auto mb-3 group-hover:bg-off-white/60 transition-all duration-500"></div>
                                                            <div class="font-mono text-xs text-off-white">Hover me</div>
                                                        </div>
                                                    </div>
                                                    <div class="aspect-square border-2 border-off-white/30 bg-off-white/10 rounded-2xl hover:border-off-white hover:bg-off-white/20 hover:scale-110 hover:-rotate-3 transition-all duration-500 cursor-pointer flex items-center justify-center group">
                                                        <div class="text-center">
                                                            <div class="w-16 h-16 bg-off-white/30 rounded-full mx-auto mb-3 group-hover:bg-off-white/60 transition-all duration-500"></div>
                                                            <div class="font-mono text-xs text-off-white">And me</div>
                                                        </div>
                                                    </div>
                                                    <div class="aspect-square border-2 border-off-white/30 bg-off-white/10 rounded-2xl hover:border-off-white hover:bg-off-white/20 hover:scale-110 hover:rotate-6 transition-all duration-500 cursor-pointer flex items-center justify-center group">
                                                        <div class="text-center">
                                                            <div class="w-16 h-16 bg-off-white/30 rounded-full mx-auto mb-3 group-hover:bg-off-white/60 transition-all duration-500"></div>
                                                            <div class="font-mono text-xs text-off-white">Try me</div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="mt-8 text-center">
                                                    <div class="font-sans text-sm text-neutral-500">Motion breathes life into interfaces - Use it purposefully to guide, delight, and inform.</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>

                            <!-- Right: Build Metrics & Deliverables (2/5) -->
                            <div class="lg:col-span-2 modal-stagger" style="transition-delay: 0.15s">
                                
                                <div class="sticky top-8 space-y-12">
                                    <!-- Build Metrics -->
                                    <div class="space-y-10">
                                        <div class="pb-6 border-b border-off-white/10">
                                            <h2 class="font-display text-3xl font-medium tracking-tight mb-3">Build Metrics</h2>
                                            <p class="font-mono text-xs text-neutral-600 uppercase tracking-[0.3em]">Performance Target</p>
                                        </div>

                                        <div class="space-y-12" id="build-metrics-container">
                                            <div class="border-l-2 border-off-white/20 pl-8 opacity-0 transition-all duration-1000" id="build-metric-1">
                                                <div class="text-xs text-neutral-600 mb-5 uppercase tracking-[0.4em] font-mono">Lines of Code</div>
                                                <div class="text-6xl font-display font-medium text-off-white mb-8 tracking-tight">
                                                    <span id="build-1-value">0</span>
                                                </div>
                                                <div class="h-0.5 bg-off-white/10 w-full relative overflow-hidden rounded-full">
                                                    <div class="absolute inset-y-0 left-0 bg-gradient-to-r from-off-white to-neutral-400 rounded-full" style="width: 0%; transition: width 2000ms cubic-bezier(0.4, 0, 0.2, 1);" id="build-1-bar"></div>
                                                </div>
                                                <div class="text-xs text-neutral-600 mt-5 font-sans">Clean, maintainable code</div>
                                            </div>

                                            <div class="border-l-2 border-off-white/20 pl-8 opacity-0 transition-all duration-1000" id="build-metric-2">
                                                <div class="text-xs text-neutral-600 mb-5 uppercase tracking-[0.4em] font-mono">Components</div>
                                                <div class="text-6xl font-display font-medium text-off-white mb-8 tracking-tight">
                                                    <span id="build-2-value">0</span>
                                                </div>
                                                <div class="h-0.5 bg-off-white/10 w-full relative overflow-hidden rounded-full">
                                                    <div class="absolute inset-y-0 left-0 bg-gradient-to-r from-off-white to-neutral-400 rounded-full" style="width: 0%; transition: width 2000ms cubic-bezier(0.4, 0, 0.2, 1);" id="build-2-bar"></div>
                                                </div>
                                                <div class="text-xs text-neutral-600 mt-5 font-sans">Reusable system</div>
                                            </div>

                                            <div class="border-l-2 border-off-white/20 pl-8 opacity-0 transition-all duration-1000" id="build-metric-3">
                                                <div class="text-xs text-neutral-600 mb-5 uppercase tracking-[0.4em] font-mono">Build Time</div>
                                                <div class="text-6xl font-display font-medium text-off-white mb-8 tracking-tight">
                                                    <span id="build-3-value">0.0</span><span class="text-neutral-700 text-4xl">s</span>
                                                </div>
                                                <div class="h-0.5 bg-off-white/10 w-full relative overflow-hidden rounded-full">
                                                    <div class="absolute inset-y-0 left-0 bg-gradient-to-r from-off-white to-neutral-400 rounded-full" style="width: 0%; transition: width 2000ms cubic-bezier(0.4, 0, 0.2, 1);" id="build-3-bar"></div>
                                                </div>
                                                <div class="text-xs text-neutral-600 mt-5 font-sans">Lightning fast builds</div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Deliverables -->
                                    <div class="border border-off-white/10 p-8">
                                        <div class="font-mono text-xs text-neutral-600 mb-6 uppercase tracking-widest">Deliverables</div>
                                        <div class="space-y-4">
                                            <div class="flex items-center gap-3 text-sm text-neutral-400">
                                                <div class="w-1.5 h-1.5 bg-off-white rounded-full"></div>
                                                <span>Figma Design Files</span>
                                            </div>
                                            <div class="flex items-center gap-3 text-sm text-neutral-400">
                                                <div class="w-1.5 h-1.5 bg-off-white rounded-full"></div>
                                                <span>Production Code</span>
                                            </div>
                                            <div class="flex items-center gap-3 text-sm text-neutral-400">
                                                <div class="w-1.5 h-1.5 bg-off-white rounded-full"></div>
                                                <span>Design System</span>
                                            </div>
                                            <div class="flex items-center gap-3 text-sm text-neutral-400">
                                                <div class="w-1.5 h-1.5 bg-off-white rounded-full"></div>
                                                <span>Performance Optimization</span>
                                            </div>
                                            <div class="flex items-center gap-3 text-sm text-neutral-400">
                                                <div class="w-1.5 h-1.5 bg-off-white rounded-full"></div>
                                                <span>SEO & Accessibility</span>
                                            </div>
                                            <div class="flex items-center gap-3 text-sm text-neutral-400">
                                                <div class="w-1.5 h-1.5 bg-off-white rounded-full"></div>
                                                <span>Documentation</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <!-- Process Overview -->
                        <div class="modal-stagger border-t border-off-white/10 pt-32 mb-32" style="transition-delay: 0.2s">
                            <div class="max-w-6xl">
                                <div class="mb-20">
                                    <div class="font-mono text-xs uppercase tracking-[0.5em] text-neutral-600 mb-8">Process</div>
                                    <h2 class="font-display text-6xl md:text-7xl font-medium mb-8 tracking-tight leading-[0.95]">
                                        How We Build Together
                                    </h2>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-4 gap-12">
                                    <div class="group">
                                        <div class="text-8xl font-display font-medium text-off-white/5 mb-6 group-hover:text-off-white/10 transition-colors duration-700">01</div>
                                        <h3 class="font-display text-2xl mb-4 leading-tight">Discovery &<br/>Strategy</h3>
                                        <p class="font-sans text-neutral-500 leading-[1.8] text-sm">
                                            Deep dive into your brand, audience, and goals. Competitive analysis and user research to inform design decisions.
                                        </p>
                                    </div>

                                    <div class="group">
                                        <div class="text-8xl font-display font-medium text-off-white/5 mb-6 group-hover:text-off-white/10 transition-colors duration-700">02</div>
                                        <h3 class="font-display text-2xl mb-4 leading-tight">Design &<br/>Prototype</h3>
                                        <p class="font-sans text-neutral-500 leading-[1.8] text-sm">
                                            High-fidelity designs in Figma with interactive prototypes. Design system creation for consistency and scalability.
                                        </p>
                                    </div>

                                    <div class="group">
                                        <div class="text-8xl font-display font-medium text-off-white/5 mb-6 group-hover:text-off-white/10 transition-colors duration-700">03</div>
                                        <h3 class="font-display text-2xl mb-4 leading-tight">Development &<br/>Testing</h3>
                                        <p class="font-sans text-neutral-500 leading-[1.8] text-sm">
                                            Production-grade code with performance optimization. Cross-browser testing and accessibility compliance.
                                        </p>
                                    </div>

                                    <div class="group">
                                        <div class="text-8xl font-display font-medium text-off-white/5 mb-6 group-hover:text-off-white/10 transition-colors duration-700">04</div>
                                        <h3 class="font-display text-2xl mb-4 leading-tight">Launch &<br/>Support</h3>
                                        <p class="font-sans text-neutral-500 leading-[1.8] text-sm">
                                            Deployment with monitoring setup. Post-launch support and iterative improvements based on real data.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Contact Form -->
                        <div class="modal-stagger border-t border-off-white/10 pt-32" style="transition-delay: 0.25s">
                            <div class="max-w-3xl mx-auto">
                                <div class="mb-12 text-center">
                                    <div class="font-mono text-xs uppercase tracking-[0.5em] text-neutral-600 mb-6">Let's Build</div>
                                    <h2 class="font-display text-5xl font-medium mb-6 tracking-tight">Start Your Project</h2>
                                    <p class="font-sans text-lg text-neutral-400 leading-relaxed">
                                        ${data.description}
                                    </p>
                                </div>

                                <form action="https://formspree.io/f/${data.formspreeId}" method="POST" class="space-y-8">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                        <div>
                                            <input type="text" name="name" required 
                                                class="w-full bg-transparent border-b border-off-white/20 pb-4 text-off-white font-sans text-base placeholder:text-neutral-600 focus:border-off-white focus:outline-none transition-colors duration-300" 
                                                placeholder="Your Name *">
                                        </div>
                                        <div>
                                            <input type="email" name="email" required 
                                                class="w-full bg-transparent border-b border-off-white/20 pb-4 text-off-white font-sans text-base placeholder:text-neutral-600 focus:border-off-white focus:outline-none transition-colors duration-300" 
                                                placeholder="Email Address *">
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <input type="text" name="company" 
                                            class="w-full bg-transparent border-b border-off-white/20 pb-4 text-off-white font-sans text-base placeholder:text-neutral-600 focus:border-off-white focus:outline-none transition-colors duration-300" 
                                            placeholder="Company / Brand">
                                    </div>

                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                        <div>
                                            <select name="budget" 
                                                class="w-full bg-transparent border-b border-off-white/20 pb-4 text-off-white font-sans text-base focus:border-off-white focus:outline-none transition-colors duration-300 appearance-none cursor-pointer">
                                                <option value="" class="bg-[#030303]">Project Budget</option>
                                                <option value="<5k" class="bg-[#030303]">$5,000 - $15,000</option>
                                                <option value="15k-30k" class="bg-[#030303]">$15,000 - $30,000</option>
                                                <option value="30k-50k" class="bg-[#030303]">$30,000 - $50,000</option>
                                                <option value="50k+" class="bg-[#030303]">$50,000+</option>
                                                <option value="retainer" class="bg-[#030303]">Monthly Retainer</option>
                                            </select>
                                        </div>
                                        <div>
                                            <select name="timeline" 
                                                class="w-full bg-transparent border-b border-off-white/20 pb-4 text-off-white font-sans text-base focus:border-off-white focus:outline-none transition-colors duration-300 appearance-none cursor-pointer">
                                                <option value="" class="bg-[#030303]">Timeline</option>
                                                <option value="urgent" class="bg-[#030303]">ASAP (< 2 weeks)</option>
                                                <option value="1month" class="bg-[#030303]">Within 1 month</option>
                                                <option value="2-3months" class="bg-[#030303]">2-3 months</option>
                                                <option value="flexible" class="bg-[#030303]">Flexible</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div>
                                        <textarea name="message" required rows="4" 
                                            class="w-full bg-transparent border-b border-off-white/20 pb-4 text-off-white font-sans text-base placeholder:text-neutral-600 focus:border-off-white focus:outline-none transition-colors duration-300 resize-none" 
                                            placeholder="Tell me about your vision, target audience, key features, and any design references you love... *"></textarea>
                                    </div>

                                    <div class="pt-8">
                                        <button type="submit" 
                                            class="w-full bg-off-white text-black font-display text-base font-medium py-5 px-8 hover:bg-neutral-200 hover:shadow-2xl hover:shadow-white/20 transition-all duration-500 uppercase tracking-[0.2em]">
                                            Submit Project Inquiry
                                        </button>
                                        <div class="flex items-center justify-center gap-8 mt-8 text-xs text-neutral-600 font-mono">
                                            <div class="flex items-center gap-2">
                                                <i data-lucide="shield-check" class="w-3 h-3"></i>
                                                <span>Confidential</span>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <i data-lucide="clock" class="w-3 h-3"></i>
                                                <span>24-48hr Response</span>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <i data-lucide="check-circle" class="w-3 h-3"></i>
                                                <span>No Obligation</span>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                `;

                // Start design system animation
                // Reduced delay for snappier feel
                setTimeout(() => {
                    initDesignSystem();
                }, 100);
            }

            modal.classList.add('active');
            document.body.classList.add('modal-open');
            lockBodyScroll();
            lucide.createIcons();
        }

        // Fluid Live Analysis Animation System
        function initLiveAnalysis() {
            // Start timer immediately
            startAnalysisTimer();
            
            // Sequence 1: Title typing (0-2s)
            setTimeout(() => {
                const titleEl = document.getElementById('main-title');
                const subtitleEl = document.getElementById('financial-subtitle-text');
                
                if (titleEl) {
                    const text = titleEl.textContent;
                    titleEl.textContent = '';
                    let i = 0;
                    
                    // Fast typing effect
                    const typeInterval = setInterval(() => {
                        if (i < text.length) {
                            titleEl.textContent += text.charAt(i);
                            i++;
                        } else {
                            clearInterval(typeInterval);
                            titleEl.classList.add('complete');
                            
                            // Fade in subtitle immediately
                            if (subtitleEl) {
                                subtitleEl.style.opacity = '1';
                                subtitleEl.style.transform = 'translateY(0)';
                            }
                        }
                    }, 30);
                }
            }, 100);
            
            // Sequence 2: Populate spreadsheet (much faster)
            setTimeout(() => {
                populateIncomeStatement();
            }, 400);
            
            // Sequence 3: Fade in metrics sidebar (overlapping with spreadsheet)
            setTimeout(() => {
                const metric1 = document.getElementById('metric-1');
                const metric2 = document.getElementById('metric-2');
                const metric3 = document.getElementById('metric-3');
                
                if (metric1) metric1.style.opacity = '1';
                setTimeout(() => { if (metric2) metric2.style.opacity = '1'; }, 200);
                setTimeout(() => { if (metric3) metric3.style.opacity = '1'; }, 400);
            }, 800);
            
            // Sequence 4: Animate metric values
            setTimeout(() => {
                animateLiveMetrics('income');
            }, 1200);
            
            // Sequence 5: Start cell scanning
            setTimeout(() => {
                startCellScanning();
            }, 1800);
        }

        // Store timer interval globally to clear on modal close
        let analysisTimerInterval = null;
        
        function startAnalysisTimer() {
            const timerEl = document.getElementById('analysis-timer');
            if (!timerEl) return;
            
            // Clear existing timer if any
            if (analysisTimerInterval) {
                clearInterval(analysisTimerInterval);
            }
            
            let seconds = 0;
            analysisTimerInterval = setInterval(() => {
                seconds++;
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                timerEl.textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }, 1000);
        }

        function populateIncomeStatement() {
            const container = document.getElementById('income-statement');
            if (!container) return;
            
            // Header row (always visible)
            const headerRow = `
                <div class="grid grid-cols-12 gap-px border-b border-off-white/20 sticky top-0 z-30" style="background-color: #030303;">
                    <div class="col-span-1 p-3 text-neutral-600 text-center text-xs font-mono" style="background-color: #030303;">#</div>
                    <div class="col-span-7 p-3 text-neutral-400 text-xs font-mono uppercase tracking-wider" style="background-color: #030303;">Line Item</div>
                    <div class="col-span-2 p-3 text-neutral-400 text-xs font-mono uppercase tracking-wider text-right" style="background-color: #030303;">FY 2024</div>
                    <div class="col-span-2 p-3 text-neutral-400 text-xs font-mono uppercase tracking-wider text-right" style="background-color: #030303;">% Rev</div>
                </div>
            `;
            
            // Data rows for landscaping company
            const dataRows = [
                { num: '01', label: 'Total Revenue', value: '$169,000', pct: '100.0%', bold: true, cell: 1, sublevel: false },
                { num: '02', label: 'Direct Labor & Materials', value: '($64,200)', pct: '38.0%', bold: false, cell: 2, sublevel: true },
                { num: '03', label: 'Gross Profit', value: '$104,800', pct: '62.0%', bold: true, cell: 3, sublevel: false, border: true },
                { num: '04', label: 'Sales & Marketing', value: '($16,900)', pct: '10.0%', bold: false, cell: 4, sublevel: true },
                { num: '05', label: 'Equipment & Fleet', value: '($13,500)', pct: '8.0%', bold: false, cell: 5, sublevel: true },
                { num: '06', label: 'General & Administrative', value: '($10,100)', pct: '6.0%', bold: false, cell: 6, sublevel: true },
                { num: '07', label: 'EBITDA', value: '$64,300', pct: '38.0%', bold: true, cell: 7, sublevel: false, border: true },
                { num: '08', label: 'Depreciation & Amortization', value: '($7,600)', pct: '4.5%', bold: false, cell: 8, sublevel: true },
                { num: '09', label: 'Operating Income', value: '$56,700', pct: '33.5%', bold: true, cell: 9, sublevel: false, border: true },
                { num: '10', label: 'Interest Income', value: '$500', pct: '0.3%', bold: false, cell: 10, sublevel: true },
                { num: '11', label: 'Interest Expense', value: '($3,400)', pct: '2.0%', bold: false, cell: 11, sublevel: true },
                { num: '12', label: 'Pre-Tax Income', value: '$53,800', pct: '31.8%', bold: true, cell: 12, sublevel: false, border: true },
                { num: '13', label: 'Income Tax (21%)', value: '($11,300)', pct: '6.7%', bold: false, cell: 13, sublevel: true },
                { num: '14', label: 'Net Income', value: '$42,500', pct: '25.1%', bold: true, cell: 14, sublevel: false, border: true, final: true }
            ];
            
            container.innerHTML = headerRow;
            
            // Animate rows appearing one by one
            dataRows.forEach((row, index) => {
                setTimeout(() => {
                    const rowBg = row.border ? 'bg-off-white/10 hover:bg-off-white/15' : 'bg-off-white/10 hover:bg-off-white/10';
                    const borderClass = row.border ? 'border-t border-off-white/20' : '';
                    const finalBorder = row.final ? 'border-t-2 border-off-white/40' : '';
                    const textColor = row.bold ? 'text-off-white' : 'text-neutral-400';
                    const labelWeight = row.bold ? 'font-bold' : '';
                    const valueWeight = row.bold ? 'font-bold' : '';
                    const numWeight = row.bold ? 'font-bold' : '';
                    const padding = row.final ? 'p-4' : 'p-3';
                    const fontSize = row.final ? 'text-base' : 'text-sm';
                    const indent = row.sublevel ? 'pl-6' : '';
                    
                    const rowHTML = `
                        <div class="grid grid-cols-12 gap-px ${rowBg} transition-all duration-300 ease-out ${borderClass} ${finalBorder} opacity-0 translate-y-2" data-cell="${row.cell}" style="animation: fadeInRow 0.3s cubic-bezier(0.16, 1, 0.3, 1) ${index * 0.02}s forwards;">
                            <div class="col-span-1 ${padding} text-neutral-700 text-center text-xs font-mono ${numWeight}">${row.num}</div>
                            <div class="col-span-7 ${padding} ${textColor} ${fontSize} ${labelWeight} ${indent}">${row.label}</div>
                            <div class="col-span-2 ${padding} ${textColor} ${fontSize} ${valueWeight} text-right font-mono">${row.value}</div>
                            <div class="col-span-2 ${padding} ${row.bold ? 'text-off-white' : 'text-neutral-600'} ${fontSize} text-right font-mono">${row.pct}</div>
                        </div>
                    `;
                    
                    container.insertAdjacentHTML('beforeend', rowHTML);
                }, index * 20);
            });
        }

        function populateBalanceSheet() {
            const container = document.getElementById('balance-statement');
            if (!container) return;
            
            const headerRow = `
                <div class="grid grid-cols-12 gap-px border-b border-off-white/20 sticky top-0 z-30" style="background-color: #030303;">
                    <div class="col-span-1 p-3 text-neutral-600 text-center text-xs font-mono" style="background-color: #030303;">#</div>
                    <div class="col-span-7 p-3 text-neutral-400 text-xs font-mono uppercase tracking-wider" style="background-color: #030303;">Account</div>
                    <div class="col-span-2 p-3 text-neutral-400 text-xs font-mono uppercase tracking-wider text-right" style="background-color: #030303;">Amount</div>
                    <div class="col-span-2 p-3 text-neutral-400 text-xs font-mono uppercase tracking-wider text-right" style="background-color: #030303;">% Total</div>
                </div>
            `;
            
            const dataRows = [
                { num: '01', label: 'ASSETS', value: '', pct: '', bold: true, cell: 1, sublevel: false, header: true },
                { num: '02', label: 'Cash & Equivalents', value: '$37,000', pct: '23.7%', bold: false, cell: 2, sublevel: true },
                { num: '03', label: 'Accounts Receivable', value: '$19,000', pct: '12.2%', bold: false, cell: 3, sublevel: true },
                { num: '04', label: 'Inventory (Materials)', value: '$6,400', pct: '4.1%', bold: false, cell: 4, sublevel: true },
                { num: '05', label: 'Total Current Assets', value: '$62,400', pct: '40.0%', bold: true, cell: 5, sublevel: false, border: true },
                { num: '06', label: 'Equipment & Vehicles', value: '$116,000', pct: '74.4%', bold: false, cell: 6, sublevel: true },
                { num: '07', label: 'Accumulated Depreciation', value: '($38,400)', pct: '(24.6%)', bold: false, cell: 7, sublevel: true },
                { num: '08', label: 'Net PP&E', value: '$77,600', pct: '49.7%', bold: true, cell: 8, sublevel: false, border: true },
                { num: '09', label: 'Other Assets', value: '$16,000', pct: '10.3%', bold: false, cell: 9, sublevel: true },
                { num: '10', label: 'Total Assets', value: '$156,000', pct: '100.0%', bold: true, cell: 10, sublevel: false, border: true, final: true, equation: 'assets' },
                { num: '11', label: 'LIABILITIES & EQUITY', value: '', pct: '', bold: true, cell: 11, sublevel: false, header: true },
                { num: '12', label: 'Accounts Payable', value: '$8,400', pct: '5.4%', bold: false, cell: 12, sublevel: true },
                { num: '13', label: 'Accrued Expenses', value: '$5,600', pct: '3.6%', bold: false, cell: 13, sublevel: true },
                { num: '14', label: 'Current Portion of Debt', value: '$10,000', pct: '6.4%', bold: false, cell: 14, sublevel: true },
                { num: '15', label: 'Total Current Liabilities', value: '$24,000', pct: '15.4%', bold: true, cell: 15, sublevel: false, border: true },
                { num: '16', label: 'Long-Term Debt', value: '$46,000', pct: '29.5%', bold: false, cell: 16, sublevel: true },
                { num: '17', label: 'Total Liabilities', value: '$70,000', pct: '44.9%', bold: true, cell: 17, sublevel: false, border: true },
                { num: '18', label: 'Shareholder Equity', value: '$86,000', pct: '55.1%', bold: true, cell: 18, sublevel: false },
                { num: '19', label: 'Total Liabilities & Equity', value: '$156,000', pct: '100.0%', bold: true, cell: 19, sublevel: false, border: true, final: true, equation: 'liabilities_equity' }
            ];
            
            container.innerHTML = headerRow;
            
            dataRows.forEach((row, index) => {
                setTimeout(() => {
                    const rowBg = row.border ? 'bg-off-white/10 hover:bg-off-white/15' : row.header ? 'bg-off-white/10' : 'bg-off-white/10 hover:bg-off-white/10';
                    const borderClass = row.border ? 'border-t border-off-white/20' : '';
                    const finalBorder = row.final ? 'border-t-2 border-off-white/40' : '';
                    const textColor = row.bold || row.header ? 'text-off-white' : 'text-neutral-400';
                    const labelWeight = row.bold || row.header ? 'font-bold' : '';
                    const valueWeight = row.bold ? 'font-bold' : '';
                    const numWeight = row.bold || row.header ? 'font-bold' : '';
                    const padding = row.final ? 'p-4' : 'p-3';
                    const fontSize = row.final || row.header ? 'text-base' : 'text-sm';
                    const indent = row.sublevel ? 'pl-6' : '';
                    
                    const rowHTML = `
                        <div class="grid grid-cols-12 gap-px ${rowBg} transition-all duration-300 ease-out ${borderClass} ${finalBorder} opacity-0 translate-y-2" data-cell="${row.cell}" style="animation: fadeInRow 0.3s cubic-bezier(0.16, 1, 0.3, 1) ${index * 0.02}s forwards;">
                            <div class="col-span-1 ${padding} text-neutral-700 text-center text-xs font-mono ${numWeight}">${row.num}</div>
                            <div class="col-span-7 ${padding} ${textColor} ${fontSize} ${labelWeight} ${indent}">${row.label}</div>
                            <div class="col-span-2 ${padding} ${textColor} ${fontSize} ${valueWeight} text-right font-mono">${row.value}</div>
                            <div class="col-span-2 ${padding} ${row.bold ? 'text-off-white' : 'text-neutral-600'} ${fontSize} text-right font-mono">${row.pct}</div>
                        </div>
                    `;
                    
                    container.insertAdjacentHTML('beforeend', rowHTML);
                }, index * 20);
            });
        }

        function populateCashFlow() {
            const container = document.getElementById('cashflow-statement');
            if (!container) return;
            
            const headerRow = `
                <div class="grid grid-cols-12 gap-px border-b border-off-white/20 sticky top-0 z-30" style="background-color: #030303;">
                    <div class="col-span-1 p-3 text-neutral-600 text-center text-xs font-mono" style="background-color: #030303;">#</div>
                    <div class="col-span-7 p-3 text-neutral-400 text-xs font-mono uppercase tracking-wider" style="background-color: #030303;">Cash Flow Activity</div>
                    <div class="col-span-2 p-3 text-neutral-400 text-xs font-mono uppercase tracking-wider text-right" style="background-color: #030303;">FY 2024</div>
                    <div class="col-span-2 p-3 text-neutral-400 text-xs font-mono uppercase tracking-wider text-right" style="background-color: #030303;">% Rev</div>
                </div>
            `;
            
            const dataRows = [
                { num: '01', label: 'OPERATING ACTIVITIES', value: '', pct: '', bold: true, cell: 1, sublevel: false, header: true },
                { num: '02', label: 'Net Income', value: '$42,500', pct: '25.1%', bold: false, cell: 2, sublevel: true },
                { num: '03', label: 'Depreciation & Amortization', value: '$7,600', pct: '4.5%', bold: false, cell: 3, sublevel: true },
                { num: '04', label: 'Changes in Working Capital', value: '($5,700)', pct: '(3.4%)', bold: false, cell: 4, sublevel: true },
                { num: '05', label: 'Net Cash from Operations', value: '$44,400', pct: '26.3%', bold: true, cell: 5, sublevel: false, border: true },
                { num: '06', label: 'INVESTING ACTIVITIES', value: '', pct: '', bold: true, cell: 6, sublevel: false, header: true },
                { num: '07', label: 'Equipment Purchases', value: '($18,400)', pct: '(10.9%)', bold: false, cell: 7, sublevel: true },
                { num: '08', label: 'Vehicle Acquisitions', value: '($7,600)', pct: '(4.5%)', bold: false, cell: 8, sublevel: true },
                { num: '09', label: 'Net Cash from Investing', value: '($26,000)', pct: '(15.4%)', bold: true, cell: 9, sublevel: false, border: true },
                { num: '10', label: 'FINANCING ACTIVITIES', value: '', pct: '', bold: true, cell: 10, sublevel: false, header: true },
                { num: '11', label: 'Debt Proceeds', value: '$10,000', pct: '5.9%', bold: false, cell: 11, sublevel: true },
                { num: '12', label: 'Debt Repayments', value: '($12,400)', pct: '(7.3%)', bold: false, cell: 12, sublevel: true },
                { num: '13', label: 'Owner Distributions', value: '($9,000)', pct: '(5.3%)', bold: false, cell: 13, sublevel: true },
                { num: '14', label: 'Net Cash from Financing', value: '($11,400)', pct: '(6.7%)', bold: true, cell: 14, sublevel: false, border: true },
                { num: '15', label: 'Net Change in Cash', value: '$7,000', pct: '4.1%', bold: true, cell: 15, sublevel: false, border: true, final: true }
            ];
            
            container.innerHTML = headerRow;
            
            dataRows.forEach((row, index) => {
                setTimeout(() => {
                    const rowBg = row.border ? 'bg-off-white/10 hover:bg-off-white/15' : row.header ? 'bg-off-white/10' : 'bg-off-white/10 hover:bg-off-white/10';
                    const borderClass = row.border ? 'border-t border-off-white/20' : '';
                    const finalBorder = row.final ? 'border-t-2 border-off-white/40' : '';
                    const textColor = row.bold || row.header ? 'text-off-white' : 'text-neutral-400';
                    const labelWeight = row.bold || row.header ? 'font-bold' : '';
                    const valueWeight = row.bold ? 'font-bold' : '';
                    const numWeight = row.bold || row.header ? 'font-bold' : '';
                    const padding = row.final ? 'p-4' : 'p-3';
                    const fontSize = row.final || row.header ? 'text-base' : 'text-sm';
                    const indent = row.sublevel ? 'pl-6' : '';
                    
                    const rowHTML = `
                        <div class="grid grid-cols-12 gap-px ${rowBg} transition-all duration-300 ease-out ${borderClass} ${finalBorder} opacity-0 translate-y-2" data-cell="${row.cell}" style="animation: fadeInRow 0.3s cubic-bezier(0.16, 1, 0.3, 1) ${index * 0.02}s forwards;">
                            <div class="col-span-1 ${padding} text-neutral-700 text-center text-xs font-mono ${numWeight}">${row.num}</div>
                            <div class="col-span-7 ${padding} ${textColor} ${fontSize} ${labelWeight} ${indent}">${row.label}</div>
                            <div class="col-span-2 ${padding} ${textColor} ${fontSize} ${valueWeight} text-right font-mono">${row.value}</div>
                            <div class="col-span-2 ${padding} ${row.bold ? 'text-off-white' : 'text-neutral-600'} ${fontSize} text-right font-mono">${row.pct}</div>
                        </div>
                    `;
                    
                    container.insertAdjacentHTML('beforeend', rowHTML);
                }, index * 20);
            });
        }

        let currentStatementType = 'income';
        let isTransitioning = false;

        function switchStatement(type) {
            if (isTransitioning || type === currentStatementType) return;
            isTransitioning = true;
            
            // Update tabs immediately - clear all states first
            document.querySelectorAll('.statement-tab').forEach(tab => {
                tab.classList.remove('active', 'text-neutral-500');
            });
            
            // Set inactive tabs
            document.querySelectorAll('.statement-tab').forEach(tab => {
                if (tab.id !== `tab-${type}`) {
                    tab.classList.add('text-neutral-500');
                }
            });
            
            // Set active tab
            const activeTab = document.getElementById(`tab-${type}`);
            if (activeTab) {
                activeTab.classList.add('active');
            }
            
            // Update filename
            const filenameEl = document.getElementById('statement-filename');
            const filenames = {
                income: 'GREENSCAPE_INCOME_FY2024.xlsx',
                balance: 'GREENSCAPE_BALANCE_FY2024.xlsx',
                cashflow: 'GREENSCAPE_CASHFLOW_FY2024.xlsx'
            };
            if (filenameEl) filenameEl.textContent = filenames[type];
            
            // Fade out current statement
            const currentStatement = document.querySelector('.statement-content.active');
            if (currentStatement) {
                currentStatement.classList.remove('active');
                currentStatement.classList.add('hidden');
            }
            
            // Fade in new statement and update metrics
            setTimeout(() => {
                const newStatement = document.getElementById(`${type}-statement`);
                if (newStatement) {
                    // Populate if empty
                    if (newStatement.children.length === 0) {
                        if (type === 'balance') populateBalanceSheet();
                        if (type === 'cashflow') populateCashFlow();
                    }
                    
                    newStatement.classList.remove('hidden');
                    newStatement.classList.add('active');
                }
                
                // Update metrics for new statement type
                animateLiveMetrics(type);
                
                currentStatementType = type;
                
                setTimeout(() => {
                    isTransitioning = false;
                }, 600);
            }, 300);
        }

        function animateLiveMetrics(statementType = 'income') {
            const metricsConfig = {
                income: [
                    { id: 'metric-1', label: 'Gross Margin', value: 62.0, benchmark: '55.0%', delay: 600 },
                    { id: 'metric-2', label: 'EBITDA Margin', value: 38.0, benchmark: '28.0%', delay: 1400 },
                    { id: 'metric-3', label: 'Net Margin', value: 25.1, benchmark: '18.0%', delay: 2200 }
                ],
                balance: [
                    { id: 'metric-1', label: 'Current Ratio', value: 2.6, benchmark: '1.5', delay: 600, suffix: 'x' },
                    { id: 'metric-2', label: 'Debt to Equity', value: 0.81, benchmark: '1.0', delay: 1400, suffix: 'x', invert: true },
                    { id: 'metric-3', label: 'Asset Turnover', value: 1.08, benchmark: '0.85', delay: 2200, suffix: 'x' }
                ],
                cashflow: [
                    { id: 'metric-1', label: 'Operating Cash %', value: 26.3, benchmark: '20.0%', delay: 600 },
                    { id: 'metric-2', label: 'Free Cash Flow %', value: 10.9, benchmark: '8.0%', delay: 1400 },
                    { id: 'metric-3', label: 'Cash Conversion', value: 104.5, benchmark: '95.0%', delay: 2200 }
                ]
            };
            
            const metrics = metricsConfig[statementType];
            
            // Clear all existing intervals first to prevent glitches
            Object.keys(metricIntervals).forEach(key => {
                clearInterval(metricIntervals[key]);
                delete metricIntervals[key];
            });
            
            // Reset all bars immediately without transition
            metrics.forEach(metric => {
                const bar = document.getElementById(`${metric.id}-bar`);
                if (bar) {
                    // Disable transitions
                    bar.style.transition = 'none';
                    bar.style.width = '0%';
                    // Force browser reflow to apply changes
                    void bar.offsetHeight;
                    // Re-enable smooth transition
                    bar.style.transition = 'width 2000ms cubic-bezier(0.4, 0, 0.2, 1)';
                }
            });
            
            metrics.forEach((metric, index) => {
                // Update label and benchmark
                const labelEl = document.getElementById(`${metric.id}-label`);
                const benchmarkEl = document.getElementById(`${metric.id}-benchmark`);
                const valueEl = document.getElementById(`${metric.id}-value`);
                
                if (labelEl) labelEl.textContent = metric.label;
                if (benchmarkEl) {
                    benchmarkEl.textContent = `Industry benchmark: ${metric.benchmark}`;
                }
                
                // Reset value immediately
                const suffix = metric.suffix || '%';
                if (valueEl) {
                    valueEl.innerHTML = `0.0<span class="text-neutral-700">${suffix}</span>`;
                }
                
                // Animate value
                setTimeout(() => {
                    animateMetricValue(
                        `${metric.id}-value`,
                        metric.value,
                        `${metric.id}-bar`,
                        suffix,
                        metric.invert || false
                    );
                }, metric.delay);
            });
        }

        // Store active intervals to clear them
        const metricIntervals = {};

        function animateMetricValue(id, target, barId, suffix = '%', invert = false) {
            const el = document.getElementById(id);
            const bar = document.getElementById(barId);
            if (!el) return;
            
            let current = 0;
            const duration = 2200;
            const steps = 60;
            const interval = duration / steps;
            
            let step = 0;
            metricIntervals[id] = setInterval(() => {
                step++;
                // Ease out cubic for smooth deceleration
                const progress = 1 - Math.pow(1 - (step / steps), 3);
                current = target * progress;
                
                if (step >= steps) {
                    current = target;
                    clearInterval(metricIntervals[id]);
                    delete metricIntervals[id];
                }
                
                const displayValue = suffix === '%' ? current.toFixed(1) : current.toFixed(2);
                el.innerHTML = displayValue + `<span class="text-neutral-700">${suffix}</span>`;
            }, interval);
            
            // Animate bar using CSS transition (already reset in animateLiveMetrics)
            if (bar) {
                // Small delay to ensure transition is ready
                requestAnimationFrame(() => {
                    let barWidth;
                    if (suffix === '%') {
                        barWidth = target * 1.6;
                    } else if (suffix === 'x') {
                        barWidth = invert ? (1 / target) * 100 : target * 40;
                    }
                    bar.style.width = Math.min(barWidth, 100) + '%';
                });
            }
        }

        function startCellScanning() {
            const cells = [3, 5, 7, 9, 12, 14];
            const cursor = document.getElementById('analyst-cursor');
            const highlight = document.getElementById('cell-highlight');
            const notesContainer = document.getElementById('analysis-notes');
            const spreadsheetContainer = document.getElementById('spreadsheet-container');
            
            if (!cursor || !highlight || !spreadsheetContainer) return;
            
            let index = 0;
            
            const analysisNotes = [
                { cell: 3, title: 'Gross Margin Analysis', content: 'Exceptional gross margin of 62.0% significantly exceeds industry median (50-55%), indicating premium service positioning and operational efficiency. Gross profit of $104.8M provides substantial operating leverage for growth initiatives while maintaining market-leading profitability across service lines.' },
                { cell: 5, title: 'Equipment Investment Strategy', content: 'Equipment and fleet expenses at 8.0% of revenue ($13.5M annually) demonstrate balanced capital allocation between modern machinery and profitability. Strategic equipment investments support service quality and crew productivity while controlling long-term maintenance costs. Investment ratio aligns with best-in-class landscape service providers.' },
                { cell: 7, title: 'Operational Excellence', content: 'EBITDA of $64.3M (38.0% margin) reflects exceptional operational leverage and business model efficiency. Performance substantially exceeds industry benchmark (28.0%), indicating superior route optimization, crew management, and customer acquisition cost efficiency. This margin supports reinvestment capacity and strong shareholder returns.' },
                { cell: 9, title: 'Operating Profitability', content: 'Operating income of $56.7M (33.5% margin) post-depreciation demonstrates sustainable economic profitability. Margin stability suggests effective pricing strategies, customer mix optimization, and limited competitive pressure. Strong operating performance supports strategic growth initiatives and maintains financial resilience through seasonal fluctuations.' },
                { cell: 12, title: 'Capital Structure Health', content: 'Pre-tax income of $53.8M (31.8% margin) with conservative leverage demonstrates robust financial health. Low interest expense (2.0% of revenue) indicates minimal debt burden and strong cash generation. Financial flexibility supports equipment upgrades, geographic expansion, or bolt-on acquisition opportunities without material refinancing risk.' },
                { cell: 14, title: 'Bottom-Line Performance', content: 'Net income of $42.5M (25.1% margin) places GreenScape Landscaping in the top decile of comparable firms. Exceptional profitability combined with recurring revenue base (maintenance contracts) creates highly attractive unit economics. Strong cash conversion supports multiple value-creation pathways: organic growth, add-on services, or enhanced distributions to ownership.' }
            ];
            
            function scanNextCell() {
                if (index >= cells.length) {
                    cursor.classList.add('hidden');
                    highlight.classList.add('hidden');
                    return;
                }
                
                const cellNum = cells[index];
                const row = document.querySelector(`[data-cell="${cellNum}"]`);
                if (!row) {
                    index++;
                    scanNextCell();
                    return;
                }
                
                const rect = row.getBoundingClientRect();
                const container = document.getElementById('spreadsheet-container');
                const containerRect = container.getBoundingClientRect();
                
                // Move cursor first
                cursor.classList.remove('hidden');
                cursor.style.left = (rect.right - containerRect.left - 40) + 'px';
                cursor.style.top = (rect.top - containerRect.top + rect.height / 2) + 'px';
                
                // Then highlight after cursor arrives
                setTimeout(() => {
                    highlight.classList.remove('hidden');
                    highlight.style.left = (rect.left - containerRect.left) + 'px';
                    highlight.style.top = (rect.top - containerRect.top) + 'px';
                    highlight.style.width = rect.width + 'px';
                    highlight.style.height = rect.height + 'px';
                    
                    // Add analysis note after highlight appears
                    setTimeout(() => {
                        if (notesContainer) {
                            const note = analysisNotes[index];
                            const noteDiv = document.createElement('div');
                            noteDiv.className = 'border-l-2 border-off-white/20 pl-8 py-6 opacity-0 transition-all duration-1000';
                            noteDiv.innerHTML = `
                                <div class="font-mono text-xs text-neutral-600 mb-4 uppercase tracking-[0.4em]">${note.title}</div>
                                <p class="font-sans text-base text-neutral-400 leading-[1.9]">${note.content}</p>
                            `;
                            notesContainer.appendChild(noteDiv);
                            setTimeout(() => noteDiv.classList.remove('opacity-0'), 100);
                        }
                    }, 300);
                }, 500);
                
                // Move to next cell
                setTimeout(() => {
                    highlight.classList.add('hidden');
                    index++;
                    scanNextCell();
                }, 4000);
            }
            
            scanNextCell();
        }

        function populateInsightsFeed() {
            const feed = document.getElementById('insights-feed');
            if (!feed) return;
            
            const insights = [
                { time: '00:02', text: 'Gross margin expansion detected: +310 bps YoY', icon: '📈' },
                { time: '00:04', text: 'R&D efficiency ratio: 1.4x revenue per dollar invested', icon: '🔬' },
                { time: '00:07', text: 'Operating leverage improving: +5% EBITDA vs +3% opex', icon: '⚡' },
                { time: '00:09', text: 'Interest coverage comfortable at 5.9x EBIT', icon: '💼' },
                { time: '00:12', text: 'Tax rate optimized within regulatory guidelines', icon: '📊' },
                { time: '00:14', text: 'Net margin in top quartile vs industry peers', icon: '🎯' }
            ];
            
            insights.forEach((insight, index) => {
                setTimeout(() => {
                    const item = document.createElement('div');
                    item.className = 'flex items-start gap-3 p-3 bg-neutral-900/50 border border-off-white/10 rounded text-sm opacity-0 translate-y-2 transition-all duration-300';
                    item.innerHTML = `
                        <span class="text-lg">${insight.icon}</span>
                        <div class="flex-1">
                            <div class="text-neutral-600 text-xs font-mono mb-1">${insight.time}</div>
                            <div class="text-neutral-300">${insight.text}</div>
                        </div>
                    `;
                    feed.appendChild(item);
                    setTimeout(() => {
                        item.classList.remove('opacity-0', 'translate-y-2');
                    }, 50);
                }, index * 2000);
            });
        }

        // Financial Statement Animation
        function animateFinancialStatement() {
            const virtualCursor = document.getElementById('virtual-cursor');
            const cellSelection = document.getElementById('cell-selection');
            const incomeStatement = document.getElementById('income-statement');
            
            // Cell selection sequence with analyst notes
            const cellSequence = [
                { 
                    cell: 3, 
                    note: 'Gross margin of 61.5% indicates strong pricing power and operational efficiency. Industry average: 55-60%. This premium suggests competitive moat through brand equity or technological advantage.',
                    delay: 1200 
                },
                { 
                    cell: 5, 
                    note: 'R&D investment at 14.7% of revenue demonstrates commitment to innovation while maintaining profitability. Benchmark range: 12-18% for sustainable growth companies. Allocation supports product pipeline development.',
                    delay: 3000 
                },
                { 
                    cell: 6, 
                    note: 'EBITDA margin of 21.2% reflects robust operational leverage. Peer median: 18-22%. Strong EBITDA generation provides capital for strategic investments and shareholder returns.',
                    delay: 4800 
                },
                { 
                    cell: 8, 
                    note: 'Operating margin (EBIT) at 17.9% shows efficient cost management post-depreciation. Typical range for mature tech firms: 15-20%. Margin stability indicates pricing discipline and scalable business model.',
                    delay: 6600 
                },
                { 
                    cell: 13, 
                    note: 'Pre-tax margin of 15.8% with favorable debt structure (interest coverage ratio: 5.9x). Conservative leverage supports financial flexibility for M&A or organic expansion.',
                    delay: 8400 
                },
                { 
                    cell: 15, 
                    note: 'Net margin of 12.5% translates to strong return on equity. With effective tax rate at 21%, the company demonstrates efficient tax planning within regulatory frameworks. Earnings quality is supported by cash flow conversion.',
                    delay: 10200 
                }
            ];

            let currentCell = 0;
            const highlightContainer = document.getElementById('analyst-highlights');
            
            function moveCursorToCell(cellNumber) {
                const targetRow = document.querySelector(`[data-cell="${cellNumber}"]`);
                if (!targetRow) return;
                
                const rect = targetRow.getBoundingClientRect();
                const statementRect = incomeStatement.getBoundingClientRect();
                
                // Show virtual cursor
                virtualCursor.classList.remove('hidden');
                virtualCursor.style.left = `${rect.left + rect.width * 0.7}px`;
                virtualCursor.style.top = `${rect.top + rect.height / 2}px`;
                
                // Animate cursor movement (simulated)
                setTimeout(() => {
                    // Show selection overlay
                    cellSelection.classList.remove('hidden');
                    cellSelection.style.left = `${rect.left - statementRect.left}px`;
                    cellSelection.style.top = `${rect.top - statementRect.top + incomeStatement.scrollTop}px`;
                    cellSelection.style.width = `${rect.width}px`;
                    cellSelection.style.height = `${rect.height}px`;
                    
                    // Highlight the row
                    targetRow.style.backgroundColor = 'rgba(255, 255, 255, 0.15)';
                }, 400);
            }
            
            function showNextHighlight() {
                if (currentCell < cellSequence.length) {
                    const sequence = cellSequence[currentCell];
                    
                    // Move cursor and select cell
                    moveCursorToCell(sequence.cell);
                    
                    // Add analyst note after selection
                    setTimeout(() => {
                        const highlightDiv = document.createElement('div');
                        highlightDiv.className = `p-4 bg-neutral-900 border-l-4 border-off-white mb-4 opacity-0 transition-opacity duration-500`;
                        highlightDiv.innerHTML = `
                            <div class="flex items-start gap-3">
                                <div class="flex-shrink-0 w-6 h-6 rounded-full bg-off-white text-black flex items-center justify-center text-xs font-bold mt-1">
                                    ${currentCell + 1}
                                </div>
                                <div class="flex-1">
                                    <div class="text-neutral-400 text-xs mb-1 uppercase tracking-wider">Cell ${sequence.cell} Analysis</div>
                                    <div class="text-off-white text-sm leading-relaxed">${sequence.note}</div>
                                </div>
                            </div>
                        `;
                        
                        highlightContainer.appendChild(highlightDiv);
                        setTimeout(() => highlightDiv.classList.remove('opacity-0'), 100);
                    }, 600);
                    
                    currentCell++;
                    if (currentCell < cellSequence.length) {
                        const nextDelay = cellSequence[currentCell].delay - cellSequence[currentCell - 1].delay;
                        setTimeout(showNextHighlight, nextDelay);
                    }
                }
            }
            
            // Start animation
            setTimeout(showNextHighlight, cellSequence[0].delay);

            // Animate metrics with proper net margin
            setTimeout(() => {
                animateMetric('gross-margin', 61.5);
                animateMetric('ebitda-margin', 21.2);
                animateMetric('op-margin', 17.9);
                animateMetric('net-margin', 12.5);
                
                // Animate ratio bars
                setTimeout(() => {
                    const rdBar = document.getElementById('rd-bar');
                    const smBar = document.getElementById('sm-bar');
                    const taxBar = document.getElementById('tax-bar');
                    
                    if (rdBar) {
                        rdBar.style.transition = 'width 1.5s cubic-bezier(0.4, 0, 0.2, 1)';
                        rdBar.style.width = '73.5%';
                    }
                    if (smBar) {
                        smBar.style.transition = 'width 1.5s cubic-bezier(0.4, 0, 0.2, 1)';
                        smBar.style.width = '51.2%';
                    }
                    if (taxBar) {
                        taxBar.style.transition = 'width 1.5s cubic-bezier(0.4, 0, 0.2, 1)';
                        taxBar.style.width = '84%';
                    }
                }, 500);
            }, 600);

            // Start highlighting with initial delay
            setTimeout(showNextHighlight, 1200);
        }

        function animateMetric(id, targetValue) {
            const el = document.getElementById(id);
            if (!el) return;

            let current = 0;
            const increment = targetValue / 50;
            const interval = setInterval(() => {
                current += increment;
                if (current >= targetValue) {
                    current = targetValue;
                    clearInterval(interval);
                }
                el.textContent = current.toFixed(1) + '%';
            }, 30);
        }

        // Website Creation Animation
        function animateWebsiteCreation() {
            const codeSteps = [
                { code: '<span class="text-purple-400">const</span> <span class="text-blue-400">Hero</span> = () => {', delay: 0 },
                { code: '  <span class="text-purple-400">return</span> (', delay: 400 },
                { code: '    &lt;<span class="text-green-400">section</span>&gt;', delay: 800 },
                { code: '      &lt;<span class="text-green-400">h1</span>&gt;', delay: 1200 },
                { code: '        <span class="text-yellow-400">"Innovation Starts Here"</span>', delay: 1600 },
                { code: '      &lt;/<span class="text-green-400">h1</span>&gt;', delay: 2000 },
                { code: '      &lt;<span class="text-green-400">button</span>&gt;', delay: 2400 },
                { code: '        <span class="text-yellow-400">"Get Started"</span>', delay: 2800 },
                { code: '      &lt;/<span class="text-green-400">button</span>&gt;', delay: 3200 },
                { code: '    &lt;/<span class="text-green-400">section</span>&gt;', delay: 3600 },
                { code: '  )', delay: 4000 },
                { code: '}', delay: 4400 }
            ];

            const visualSteps = [
                { html: '<div class="text-4xl font-bold text-gray-900 opacity-0 transition-opacity duration-500">Innovation Starts Here</div>', delay: 1600 },
                { html: '<button class="mt-4 bg-black text-off-white px-6 py-3 rounded opacity-0 transition-opacity duration-500 hover:bg-gray-800">Get Started</button>', delay: 2800 },
                { html: '<div class="mt-6 w-full h-32 bg-gradient-to-r from-off-white to-neutral-500 rounded-lg opacity-0 transition-opacity duration-500"></div>', delay: 4800 }
            ];

            const codeContainer = document.getElementById('code-lines');
            const previewContainer = document.getElementById('preview-container');

            if (!codeContainer || !previewContainer) return;

            // Animate code
            codeSteps.forEach((step, index) => {
                setTimeout(() => {
                    const line = document.createElement('div');
                    line.innerHTML = `<span class="text-neutral-600 mr-2">${index + 1}</span>${step.code}`;
                    line.className = 'opacity-0 transition-opacity duration-300';
                    codeContainer.appendChild(line);
                    setTimeout(() => line.classList.remove('opacity-0'), 50);
                }, step.delay);
            });

            // Animate visual output
            visualSteps.forEach((step, index) => {
                setTimeout(() => {
                    const el = document.createElement('div');
                    el.innerHTML = step.html;
                    const child = el.firstElementChild;
                    previewContainer.appendChild(child);
                    setTimeout(() => child.classList.remove('opacity-0'), 50);
                }, step.delay);
            });
        }

        // --- WEBSITE DESIGN MODAL FUNCTIONS ---

        // --- WEBSITE CODE ANIMATION ---
        // --- WEBSITE DESIGN SYSTEM ANIMATION ---
        function initDesignSystem() {
            // 1. Title typing animation
            const titleEl = document.getElementById('website-main-title');
            if (titleEl) {
                const text = titleEl.textContent;
                titleEl.textContent = '';
                let i = 0;
                // Faster typing for modern feel
                const typeInterval = setInterval(() => {
                    if (i < text.length) {
                        titleEl.textContent += text.charAt(i);
                        i++;
                    } else {
                        clearInterval(typeInterval);
                        titleEl.classList.add('complete');
                        
                        // 2. Fade in subtitle immediately after typing
                        setTimeout(() => {
                            const subtitleEl = document.getElementById('website-subtitle-text');
                            if (subtitleEl) {
                                subtitleEl.style.opacity = '1';
                                subtitleEl.style.transform = 'translateY(0)'; // Ensure it moves up if needed
                            }
                        }, 50);
                    }
                }, 30); // Speed up from 60ms to 30ms
            }

            // 3. Animate build metrics much sooner
            setTimeout(() => {
                animateBuildMetrics();
            }, 800); // Reduced from 2000ms

            // 4. Initialize design mode tabs
            setTimeout(() => {
                initDesignTabs();
            }, 300); // Reduced from 500ms
        }

        function animateBuildMetrics() {
            const metrics = [
                { id: 'build-metric-1', valueId: 'build-1-value', barId: 'build-1-bar', value: 2847, max: 3000, unit: '' },
                { id: 'build-metric-2', valueId: 'build-2-value', barId: 'build-2-bar', value: 42, max: 50, unit: '' },
                { id: 'build-metric-3', valueId: 'build-3-value', barId: 'build-3-bar', value: 1.8, max: 3.0, unit: 's' }
            ];

            metrics.forEach((metric, index) => {
                setTimeout(() => {
                    const metricEl = document.getElementById(metric.id);
                    const valueEl = document.getElementById(metric.valueId);
                    const barEl = document.getElementById(metric.barId);

                    if (!metricEl || !valueEl || !barEl) {
                        console.error('Missing element:', metric.id, metric.valueId, metric.barId);
                        return;
                    }

                    // Fade in the metric
                    metricEl.style.opacity = '1';

                    // Calculate bar width percentage
                    const widthPercent = (metric.value / metric.max) * 100;

                    // Animate bar width
                    requestAnimationFrame(() => {
                        barEl.style.width = widthPercent + '%';
                    });

                    // Animate value from 0 to target
                    let currentValue = 0;
                    const targetValue = metric.value;
                    const steps = 60;
                    const increment = targetValue / steps;
                    const duration = 2200;
                    const intervalTime = duration / steps;

                    const valueInterval = setInterval(() => {
                        currentValue += increment;
                        if (currentValue >= targetValue) {
                            currentValue = targetValue;
                            clearInterval(valueInterval);
                        }
                        
                        // Format value based on unit
                        if (metric.unit === 's') {
                            valueEl.textContent = currentValue.toFixed(1);
                        } else {
                            // Add comma formatting for large numbers
                            valueEl.textContent = Math.round(currentValue).toLocaleString();
                        }
                    }, intervalTime);

                }, index * 400);
            });
        }

        function initDesignTabs() {
            const tabs = document.querySelectorAll('.design-tab');
            const contents = document.querySelectorAll('.design-content');
            
            console.log('Initializing design tabs:', tabs.length, 'tabs found');
            console.log('Content sections:', contents.length, 'found');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const mode = tab.dataset.mode;
                    
                    // Update active tab
                    tabs.forEach(t => {
                        t.classList.remove('active', 'text-off-white', 'border-off-white');
                        t.classList.add('text-neutral-600', 'border-transparent');
                    });
                    tab.classList.add('active', 'text-off-white', 'border-off-white');
                    tab.classList.remove('text-neutral-600', 'border-transparent');
                    
                    // Show corresponding content
                    contents.forEach(content => {
                        if (content.id === `design-${mode}`) {
                            content.classList.remove('hidden');
                            // Trigger animation
                            content.classList.remove('show-animate');
                            void content.offsetWidth; // Force reflow
                            content.classList.add('show-animate');
                        } else {
                            content.classList.add('hidden');
                            content.classList.remove('show-animate');
                        }
                    });
                    
                    // Re-trigger animations
                    triggerDesignAnimations(mode);
                });
            });

            // Initialize device switches
            const deviceSwitches = document.querySelectorAll('.device-switch');
            deviceSwitches.forEach(btn => {
                btn.addEventListener('click', () => {
                    const device = btn.dataset.device;
                    switchDevice(device);
                });
            });
        }

        function triggerDesignAnimations(mode) {
            // Get only the design elements in the active content
            const activeContent = document.getElementById(`design-${mode}`);
            if (!activeContent) return;
            
            const elements = activeContent.querySelectorAll('.design-element');
            
            // Reset each element's animation
            elements.forEach((el, index) => {
                // Store the original inline style
                const originalStyle = el.getAttribute('style') || '';
                
                // Extract animation value from original style if it exists
                const animMatch = originalStyle.match(/animation:\s*([^;]+)/);
                const originalAnimation = animMatch ? animMatch[1] : 'fadeInDesign 0.8s ease-out 0.2s forwards';
                
                // Reset to invisible
                el.style.opacity = '0';
                el.style.animation = 'none';
                
                // Force reflow
                void el.offsetHeight;
                
                // Restore animation after a brief delay
                setTimeout(() => {
                    el.style.animation = originalAnimation;
                }, 50);
            });
        }

        function switchDevice(device) {
            // Update active device button
            const deviceBtns = document.querySelectorAll('.device-switch');
            deviceBtns.forEach(btn => {
                btn.classList.remove('active', 'bg-off-white/10');
            });
            
            const activeBtn = document.querySelector(`.device-switch[data-device="${device}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active', 'bg-off-white/10');
            }

            // Update browser viewport size with smooth transition
            const viewport = document.getElementById('browser-viewport');
            if (!viewport) return;
            
            const container = viewport.parentElement;
            container.style.transition = 'all 500ms cubic-bezier(0.4, 0, 0.2, 1)';
            
            if (device === 'mobile') {
                container.style.maxWidth = '400px';
                container.style.margin = '0 auto';
            } else if (device === 'tablet') {
                container.style.maxWidth = '800px';
                container.style.margin = '0 auto';
            } else {
                container.style.maxWidth = '100%';
                container.style.margin = '0';
            }
        }

        function triggerMotionDemo() {
            // Re-trigger motion demo animations
            const motionDemos = document.querySelectorAll('[class*="motion-demo-"]');
            motionDemos.forEach(demo => {
                // Remove and re-add animation class to restart
                const animClass = Array.from(demo.classList).find(c => c.startsWith('motion-demo-'));
                if (animClass) {
                    demo.classList.remove(animClass);
                    setTimeout(() => {
                        demo.classList.add(animClass);
                    }, 50);
                }
            });
        }

        // --- END WEBSITE DESIGN SYSTEM ANIMATION ---

        let currentDesignMode = 'layout';
        let isDesignTransitioning = false;

        function switchDesignMode(mode) {
            if (isDesignTransitioning || mode === currentDesignMode) return;
            
            isDesignTransitioning = true;
            currentDesignMode = mode;

            // 1. Remove all active classes from tabs
            const allTabs = document.querySelectorAll('.design-tab');
            allTabs.forEach(tab => {
                tab.classList.remove('active');
                tab.classList.add('text-neutral-500');
            });

            // 2. Set active tab
            const activeTab = document.querySelector(`.design-tab[onclick*="${mode}"]`);
            if (activeTab) {
                activeTab.classList.add('active');
                activeTab.classList.remove('text-neutral-500');
            }

            // 3. Hide all content sections
            const allContent = document.querySelectorAll('.design-content');
            allContent.forEach(content => {
                content.classList.remove('active');
                content.classList.add('hidden');
            });

            // 4. Show selected content
            const activeContent = document.getElementById(`design-${mode}`);
            if (activeContent) {
                setTimeout(() => {
                    activeContent.classList.remove('hidden');
                    activeContent.classList.add('active');
                }, 50);
            }

            // 5. Unlock transition after duration
            setTimeout(() => {
                isDesignTransitioning = false;
            }, 600);
        }

        const perfMetricIntervals = {};

        function animatePerfMetrics() {
            const metrics = [
                { 
                    id: 'perf-metric-1', 
                    value: 1.2, 
                    target: 2.5, 
                    unit: 's',
                    label: 'LCP',
                    inverse: false 
                },
                { 
                    id: 'perf-metric-2', 
                    value: 45, 
                    target: 100, 
                    unit: 'ms',
                    label: 'FID',
                    inverse: false 
                },
                { 
                    id: 'perf-metric-3', 
                    value: 0.05, 
                    target: 0.1, 
                    unit: '',
                    label: 'CLS',
                    inverse: false 
                }
            ];

            // Clear any existing intervals
            Object.values(perfMetricIntervals).forEach(interval => clearInterval(interval));
            
            metrics.forEach((metric, index) => {
                setTimeout(() => {
                    const container = document.getElementById(metric.id);
                    if (!container) return;

                    // Fade in container
                    container.style.opacity = '1';

                    const valueEl = document.getElementById(`perf-${index + 1}-value`);
                    const barEl = document.getElementById(`perf-${index + 1}-bar`);

                    if (!valueEl || !barEl) return;

                    // Calculate bar width percentage (value/target * 100, capped at 100)
                    const widthPercent = Math.min((metric.value / metric.target) * 100, 100);

                    // Reset bar without transition
                    barEl.style.transition = 'none';
                    barEl.style.width = '0%';
                    barEl.offsetHeight; // Force reflow

                    // Re-enable transition
                    barEl.style.transition = 'width 2000ms cubic-bezier(0.4, 0, 0.2, 1)';

                    // Animate value from 0 to target
                    let currentValue = 0;
                    const targetValue = metric.value;
                    const steps = 60;
                    const increment = targetValue / steps;
                    const duration = 2200;
                    const intervalTime = duration / steps;

                    perfMetricIntervals[metric.id] = setInterval(() => {
                        currentValue += increment;
                        if (currentValue >= targetValue) {
                            currentValue = targetValue;
                            clearInterval(perfMetricIntervals[metric.id]);
                        }
                        
                        // Format value based on unit
                        if (metric.unit === 's') {
                            valueEl.textContent = currentValue.toFixed(1) + 's';
                        } else if (metric.unit === 'ms') {
                            valueEl.textContent = Math.round(currentValue) + 'ms';
                        } else {
                            valueEl.textContent = currentValue.toFixed(2);
                        }
                    }, intervalTime);

                    // Animate bar width
                    requestAnimationFrame(() => {
                        barEl.style.width = widthPercent + '%';
                    });

                }, index * 400);
            });
        }

        function switchDevice(device) {
            // Update active device button
            const deviceBtns = document.querySelectorAll('.device-btn');
            deviceBtns.forEach(btn => {
                btn.classList.remove('bg-off-white/10');
                btn.querySelector('i').classList.remove('text-off-white');
                btn.querySelector('i').classList.add('text-neutral-600');
            });
            
            const activeBtn = document.querySelector(`.device-btn[data-device="${device}"]`);
            if (activeBtn) {
                activeBtn.classList.add('bg-off-white/10');
                activeBtn.querySelector('i').classList.remove('text-neutral-600');
                activeBtn.querySelector('i').classList.add('text-off-white');
            }

            // Update preview container size with smooth transition
            const previewContainer = document.getElementById('design-preview-container');
            if (!previewContainer) return;
            
            previewContainer.style.transition = 'all 500ms cubic-bezier(0.4, 0, 0.2, 1)';
            
            if (device === 'mobile') {
                previewContainer.style.maxWidth = '375px';
                previewContainer.style.margin = '0 auto';
            } else if (device === 'tablet') {
                previewContainer.style.maxWidth = '768px';
                previewContainer.style.margin = '0 auto';
            } else {
                previewContainer.style.maxWidth = '100%';
                previewContainer.style.margin = '0';
            }
        }

        function triggerMotionDemo() {
            // Re-trigger motion demo animations
            const motionDemos = document.querySelectorAll('[class*="motion-demo-"]');
            motionDemos.forEach(demo => {
                // Remove and re-add animation class to restart
                const animClass = Array.from(demo.classList).find(c => c.startsWith('motion-demo-'));
                if (animClass) {
                    demo.classList.remove(animClass);
                    setTimeout(() => {
                        demo.classList.add(animClass);
                    }, 50);
                }
            });
        }

        // --- END WEBSITE DESIGN MODAL FUNCTIONS ---

        // Attach listeners to service cards
        document.querySelectorAll('.service-card').forEach(card => {
            card.addEventListener('click', () => {
                const serviceId = card.dataset.service;
                openServiceModal(serviceId);
            });
        });

        closeModal.addEventListener('click', closeModalFunc);
        
        // Helper functions for body scroll lock
        function lockBodyScroll() {
            const scrollbarWidth = window.innerWidth - document.documentElement.clientWidth;
            document.body.style.overflow = 'hidden';
            document.body.style.paddingRight = scrollbarWidth + 'px';
        }
        
        function unlockBodyScroll() {
            document.body.style.overflow = '';
            document.body.style.paddingRight = '';
        }
        
        // Prevent body scroll when modal is open
        function lockBodyScroll() {
            const scrollbarWidth = window.innerWidth - document.documentElement.clientWidth;
            document.body.style.overflow = 'hidden';
            document.body.style.paddingRight = scrollbarWidth + 'px';
        }
        
        function unlockBodyScroll() {
            document.body.style.overflow = '';
            document.body.style.paddingRight = '';
        }
        
        // Close on backdrop click
        modal.addEventListener('click', (e) => {
            if (e.target === modal) closeModalFunc();
        });

        // Esc key to close
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modal.classList.contains('active')) {
                closeModalFunc();
            }
        });



        // --- 5. LOAD SEQUENCE ---
        window.addEventListener('load', () => {
            const loader = document.getElementById('loader');
            const scrambleEls = document.querySelectorAll('.scramble-text');
            
            scrambleEls.forEach(el => {
                const fx = new TextScramble(el);
                fx.setText(el.dataset.final);
            });

            setTimeout(() => {
                loader.classList.add('loader-hidden');
                initScrollReveal();
                initGenerativeCovers(); // Start Generative Art
                initLiveTicker();       // Start Live Data
                
                setTimeout(() => {
                    document.querySelectorAll('.scramble-hover').forEach(el => {
                        const fx = new TextScramble(el);
                        fx.setText(el.dataset.final);
                        el.addEventListener('mouseenter', () => fx.setText(el.dataset.final));
                    });
                }, 400);

            }, 800);
        });

        // --- 10. GENERATIVE COVERS ---
        // Debounce utility for resize handlers
        function debounce(fn, delay) {
            let timeoutId;
            return function(...args) {
                clearTimeout(timeoutId);
                timeoutId = setTimeout(() => fn.apply(this, args), delay);
            };
        }
        
        function initGenerativeCovers() {
            // 1. Bittensor (Network Graph)
            const canvas1 = document.getElementById('canvas-bittensor');
            if (canvas1) {
                const ctx = canvas1.getContext('2d');
                let width, height;
                let nodes = [];
                let isHovered = false;
                let isVisible = false;
                let animationId = null;
                let mouseX = 0;
                let mouseY = 0;
                
                const parent = canvas1.parentElement;
                parent.addEventListener('mouseenter', () => isHovered = true);
                parent.addEventListener('mouseleave', () => isHovered = false);
                parent.addEventListener('mousemove', (e) => {
                    const rect = canvas1.getBoundingClientRect();
                    mouseX = e.clientX - rect.left;
                    mouseY = e.clientY - rect.top;
                });
                
                // Visibility detection
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        isVisible = entry.isIntersecting;
                        if (isVisible && !animationId) {
                            animate();
                        }
                    });
                }, { threshold: 0.1 });
                observer.observe(canvas1);

                const createNode = () => ({
                    x: Math.random() * width,
                    y: Math.random() * height,
                    vx: (Math.random() - 0.5) * 0.5,
                    vy: (Math.random() - 0.5) * 0.5,
                    life: Math.random() * 100 + 100, // Longer life
                    age: 0,
                    opacity: 0
                });

                const resize = () => {
                    width = canvas1.width = canvas1.parentElement.offsetWidth;
                    height = canvas1.height = canvas1.parentElement.offsetHeight;
                    nodes = [];
                    for(let i=0; i<60; i++) { // Increased node count
                        nodes.push(createNode());
                        nodes[i].opacity = 1; // Start visible
                        nodes[i].age = 50;
                    }
                };
                resize();
                window.addEventListener('resize', debounce(resize, 150));

                const animate = () => {
                    ctx.clearRect(0, 0, width, height);
                    
                    // Churn: Spawn new nodes
                    if (nodes.length < 60 && Math.random() < 0.1) {
                        nodes.push(createNode());
                    }

                    // Mouse Connections (Draw first to be behind nodes)
                    if (isHovered) {
                        nodes.forEach(node => {
                            const dx = mouseX - node.x;
                            const dy = mouseY - node.y;
                            const dist = Math.sqrt(dx*dx + dy*dy);
                            
                            if (dist < 200) {
                                ctx.beginPath();
                                ctx.moveTo(mouseX, mouseY);
                                ctx.lineTo(node.x, node.y);
                                ctx.strokeStyle = '#EAEAEA';
                                ctx.globalAlpha = (1 - dist/200) * 0.4;
                                ctx.stroke();
                            }
                        });
                    }

                    nodes.forEach((node, index) => {
                        // Lifecycle
                        node.age++;
                        if (node.age < 20) node.opacity = node.age / 20;
                        else if (node.age > node.life - 20) node.opacity = (node.life - node.age) / 20;
                        else node.opacity = 1;
                        
                        if (node.age >= node.life) {
                            nodes.splice(index, 1);
                            return;
                        }

                        // Mouse Interaction (Attraction)
                        if (isHovered) {
                            const dx = mouseX - node.x;
                            const dy = mouseY - node.y;
                            const dist = Math.sqrt(dx*dx + dy*dy);
                            
                            if (dist < 250) {
                                node.vx += dx * 0.0003;
                                node.vy += dy * 0.0003;
                            }
                        }

                        // Friction and Speed Limit
                        node.vx *= 0.99;
                        node.vy *= 0.99;
                        
                        const speed = Math.sqrt(node.vx*node.vx + node.vy*node.vy);
                        const maxSpeed = isHovered ? 3 : 1;
                        if (speed > maxSpeed) {
                            node.vx = (node.vx / speed) * maxSpeed;
                            node.vy = (node.vy / speed) * maxSpeed;
                        }

                        // Movement
                        node.x += node.vx;
                        node.y += node.vy;
                        
                        // Bounce off walls
                        if(node.x < 0 || node.x > width) node.vx *= -1;
                        if(node.y < 0 || node.y > height) node.vy *= -1;
                        
                        const drawX = node.x;
                        const drawY = node.y;

                        // Draw Node
                        ctx.fillStyle = isHovered ? '#EAEAEA' : '#AAAAAA'; 
                        ctx.globalAlpha = node.opacity;
                        ctx.beginPath();
                        ctx.arc(drawX, drawY, isHovered ? 2 : 2.5, 0, Math.PI * 2);
                        ctx.fill();

                        // Connections
                        nodes.forEach((other, otherIndex) => {
                            if (index >= otherIndex) return; // Avoid double drawing

                            const dx = node.x - other.x;
                            const dy = node.y - other.y;
                            const dist = Math.sqrt(dx*dx + dy*dy);
                            
                            const maxDist = isHovered ? 150 : 140; 
                            
                            if(dist < maxDist) {
                                ctx.beginPath();
                                ctx.moveTo(drawX, drawY);
                                ctx.lineTo(other.x, other.y);
                                
                                ctx.strokeStyle = isHovered ? '#EAEAEA' : '#666666';
                                ctx.globalAlpha = (1 - dist/maxDist) * Math.min(node.opacity, other.opacity) * (isHovered ? 0.5 : 0.4);
                                ctx.stroke();

                                // Data Packets on Hover
                                if (isHovered) {
                                    const time = Date.now() / 1000;
                                    const speed = 1.5;
                                    // Create a unique offset for each connection so packets don't move in sync
                                    const offset = (time * speed + (index * otherIndex * 0.1)) % 1; 
                                    
                                    const px = node.x + (other.x - node.x) * offset;
                                    const py = node.y + (other.y - node.y) * offset;
                                    
                                    ctx.fillStyle = '#EAEAEA';
                                    ctx.globalAlpha = Math.min(node.opacity, other.opacity);
                                    ctx.fillRect(px - 1.5, py - 1.5, 3, 3);
                                }
                            }
                        });
                    });
                    ctx.globalAlpha = 1;
                    if (isVisible) {
                        animationId = requestAnimationFrame(animate);
                    } else {
                        animationId = null;
                    }
                };
                // Don't start immediately, let Intersection Observer trigger it
            }

            // 2. Payroll (Data Stream)
            const canvas2 = document.getElementById('canvas-payroll');
            if (canvas2) {
                const ctx = canvas2.getContext('2d');
                let width, height;
                let drops = [];
                let isVisible = false;
                let animationId = null;
                let isHovered = false;
                
                const parent = canvas2.parentElement;
                parent.addEventListener('mouseenter', () => isHovered = true);
                parent.addEventListener('mouseleave', () => isHovered = false);

                const resize = () => {
                    width = canvas2.width = canvas2.parentElement.offsetWidth;
                    height = canvas2.height = canvas2.parentElement.offsetHeight;
                    drops = [];
                    for(let i=0; i<width/20; i++) {
                        drops.push({
                            x: i * 20,
                            y: Math.random() * height,
                            speed: 1 + Math.random() * 2,
                            chars: "010101"
                        });
                    }
                };
                resize();
                window.addEventListener('resize', debounce(resize, 150));
                
                // Visibility detection
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        isVisible = entry.isIntersecting;
                        if (isVisible && !animationId) {
                            animate();
                        }
                    });
                }, { threshold: 0.1 });
                observer.observe(canvas2);

                const animate = () => {
                    ctx.fillStyle = 'rgba(3, 3, 3, 0.1)'; // Trail effect (Consistent with bg)
                    ctx.fillRect(0, 0, width, height);
                    
                    ctx.font = '10px monospace';

                    drops.forEach(drop => {
                        // Brighter on hover
                        ctx.fillStyle = isHovered ? '#EAEAEA' : '#666666';
                        ctx.fillText(drop.chars[Math.floor(Math.random()*drop.chars.length)], drop.x, drop.y);
                        
                        // Speed up slightly on hover
                        drop.y += isHovered ? drop.speed * 1.5 : drop.speed;
                        if(drop.y > height) drop.y = 0;
                    });
                    if (isVisible) {
                        animationId = requestAnimationFrame(animate);
                    } else {
                        animationId = null;
                    }
                };
            }

            // 3. Point72 (Candlesticks)
            const canvas3 = document.getElementById('canvas-point72');
            if (canvas3) {
                const ctx = canvas3.getContext('2d');
                let width, height;
                let candles = [];
                let isHovered = false;
                let isVisible = false;
                let animationId = null;

                const parent = canvas3.parentElement;
                parent.addEventListener('mouseenter', () => isHovered = true);
                parent.addEventListener('mouseleave', () => isHovered = false);
                
                // Visibility detection
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        isVisible = entry.isIntersecting;
                        if (isVisible && !animationId) {
                            animate();
                        }
                    });
                }, { threshold: 0.1 });
                observer.observe(canvas3);
                
                const resize = () => {
                    width = canvas3.width = canvas3.parentElement.offsetWidth;
                    height = canvas3.height = canvas3.parentElement.offsetHeight;
                    initCandles();
                };
                
                function initCandles() {
                    candles = [];
                    let price = 100;
                    const candleWidth = 10;
                    for(let x = 0; x < width; x += candleWidth + 2) {
                        const change = (Math.random() - 0.5) * 10;
                        const open = price;
                        const close = price + change;
                        const high = Math.max(open, close) + Math.random() * 5;
                        const low = Math.min(open, close) - Math.random() * 5;
                        candles.push({ x, open, close, high, low });
                        price = close;
                    }
                }
                
                resize();
                window.addEventListener('resize', debounce(resize, 150));

                const animate = () => {
                    if (!isVisible) {
                        animationId = null;
                        return;
                    }
                    // Volatility Multiplier
                    const volMult = isHovered ? 4 : 1;

                    // Shift candles left
                    candles.shift();
                    const last = candles[candles.length-1];
                    const change = (Math.random() - 0.5) * 10 * volMult;
                    const open = last.close;
                    const close = open + change;
                    const high = Math.max(open, close) + Math.random() * 5 * volMult;
                    const low = Math.min(open, close) - Math.random() * 5 * volMult;
                    candles.push({ 
                        x: last.x + 12, // 10 width + 2 gap
                        open, close, high, low 
                    });

                    // Redraw
                    ctx.clearRect(0, 0, width, height);
                    
                    ctx.save();
                    if (isHovered) {
                        // Shake Effect
                        const shake = 2;
                        ctx.translate((Math.random() - 0.5) * shake, (Math.random() - 0.5) * shake);
                    }

                    // Center vertically based on last price
                    const offsetY = height/2 - last.close;

                    candles.forEach((c, i) => {
                        // Recalculate X to keep them moving
                        const drawX = width - ((candles.length - i) * 12);
                        
                        ctx.strokeStyle = c.close > c.open ? '#444' : '#222';
                        ctx.fillStyle = c.close > c.open ? '#444' : '#222';
                        
                        // Wick
                        ctx.beginPath();
                        ctx.moveTo(drawX + 5, c.high + offsetY);
                        ctx.lineTo(drawX + 5, c.low + offsetY);
                        ctx.stroke();
                        
                        // Body
                        ctx.fillRect(drawX, Math.min(c.open, c.close) + offsetY, 10, Math.abs(c.close - c.open));
                    });
                    
                    ctx.restore();
                    
                    // Continue animation loop
                    setTimeout(() => {
                        if (isVisible) {
                            animationId = requestAnimationFrame(animate);
                        } else {
                            animationId = null;
                        }
                    }, 100);
                };
            }
            // 4. TaskFormer (Strategy / Operations)
            // Concept: "Swarm Alignment". Particles (tasks/agents) start in a chaotic swarm.
            // On interaction, they align into a structured geometric formation (The Plan).
            const canvas4 = document.getElementById('canvas-taskformer');
            if (canvas4) {
                const ctx = canvas4.getContext('2d');
                let width, height;
                let particles = [];
                let isHovered = false;
                let isVisible = false;
                let animationId = null;
                let rotation = 0;
                
                const parent = canvas4.parentElement;
                parent.addEventListener('mouseenter', () => isHovered = true);
                parent.addEventListener('mouseleave', () => isHovered = false);
                
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        isVisible = entry.isIntersecting;
                        if (isVisible && !animationId) animate();
                    });
                }, { threshold: 0.1 });
                observer.observe(canvas4);
                
                const resize = () => {
                    width = canvas4.width = canvas4.parentElement.offsetWidth;
                    height = canvas4.height = canvas4.parentElement.offsetHeight;
                    
                    particles = [];
                    const count = 80; // More particles
                    for(let i=0; i<count; i++) {
                        particles.push({
                            x: Math.random() * width,
                            y: Math.random() * height,
                            vx: (Math.random() - 0.5) * 1.5,
                            vy: (Math.random() - 0.5) * 1.5,
                            size: Math.random() * 2 + 1.5,
                            angle: (i / count) * Math.PI * 2, // Assigned angle in formation
                            radius: height * 0.3 // Target radius
                        });
                    }
                };
                resize();
                window.addEventListener('resize', debounce(resize, 150));

                const animate = () => {
                    ctx.clearRect(0, 0, width, height);
                    
                    if (isHovered) {
                        rotation += 0.005; // Rotate the formation
                    }

                    // Physics Loop
                    particles.forEach((p, i) => {
                        let tx, ty;

                        // 1. Chaos Force (Brownian Motion)
                        if (!isHovered) {
                            p.x += p.vx;
                            p.y += p.vy;
                            
                            // Bounce
                            if(p.x < 0 || p.x > width) p.vx *= -1;
                            if(p.y < 0 || p.y > height) p.vy *= -1;
                        } 
                        // 2. Order Force (Spring to Target)
                        else {
                            // Calculate target position based on rotation
                            tx = width/2 + Math.cos(p.angle + rotation) * p.radius;
                            ty = height/2 + Math.sin(p.angle + rotation) * p.radius;

                            // Lerp to target (smooth transition)
                            p.x += (tx - p.x) * 0.08;
                            p.y += (ty - p.y) * 0.08;
                        }
                        
                        // Draw Particle (Square for "Task/Block")
                        ctx.fillStyle = isHovered ? '#EAEAEA' : '#A0A0A0';
                        ctx.globalAlpha = isHovered ? 0.9 : 0.6;
                        ctx.fillRect(p.x - p.size/2, p.y - p.size/2, p.size, p.size);
                        
                        // Draw Connections (Nearest Neighbors)
                        // Only connect if close enough
                        particles.forEach((other, j) => {
                            if (i >= j) return;
                            const dx = p.x - other.x;
                            const dy = p.y - other.y;
                            const dist = Math.sqrt(dx*dx + dy*dy);
                            
                            const connectDist = isHovered ? 50 : 70;

                            if (dist < connectDist) {
                                ctx.strokeStyle = isHovered ? 'rgba(255, 255, 255, 0.2)' : 'rgba(136, 136, 136, 0.15)';
                                ctx.lineWidth = 0.5;
                                ctx.beginPath();
                                ctx.moveTo(p.x, p.y);
                                ctx.lineTo(other.x, other.y);
                                ctx.stroke();
                            }
                        });
                    });
                    
                    // Draw "The Plan" (Target Geometry Ghost)
                    if (isHovered) {
                        ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                        ctx.lineWidth = 1;
                        ctx.beginPath();
                        ctx.arc(width/2, height/2, height * 0.3, 0, Math.PI*2);
                        ctx.stroke();
                        
                        // Inner ring
                        ctx.beginPath();
                        ctx.arc(width/2, height/2, height * 0.2, 0, Math.PI*2);
                        ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
                        ctx.stroke();
                    }

                    if (isVisible) animationId = requestAnimationFrame(animate);
                    else animationId = null;
                };
            }

            // 5. Financial Service (Volatility Surface)
            // Concept: "The Landscape of Risk". A 3D wireframe surface representing 
            // the shifting terrain of market volatility (Implied Volatility Surface).
            const canvas5 = document.getElementById('canvas-financial');
            if (canvas5) {
                const ctx = canvas5.getContext('2d', { alpha: false });
                let width, height;
                let isVisible = false;
                let animationId = null;
                
                // Grid Parameters
                let cols = 24; // Higher density for more detail
                let rows = 24;
                let points = [];
                let projected = [];
                
                // Camera / Interaction
                let rotation = 0.7; 
                let tilt = 0.5;
                let targetRotation = 0.7;
                let targetTilt = 0.5;
                let mouseX = 0;
                let mouseY = 0;
                
                // Wave Physics
                let timeOffset = 0;
                
                const handleMove = (x, y) => {
                    mouseX = x;
                    mouseY = y;
                    
                    const nx = mouseX / width;
                    const ny = mouseY / height;
                    targetRotation = 0.7 + (nx - 0.5) * 0.8; // More rotation range
                    targetTilt = 0.5 + (ny - 0.5) * 0.4;
                };

                canvas5.parentElement.addEventListener('mousemove', (e) => {
                    const rect = canvas5.getBoundingClientRect();
                    handleMove(e.clientX - rect.left, e.clientY - rect.top);
                });
                
                canvas5.parentElement.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    const rect = canvas5.getBoundingClientRect();
                    const touch = e.touches[0];
                    handleMove(touch.clientX - rect.left, touch.clientY - rect.top);
                }, { passive: false });
                
                const handleLeave = () => {
                    targetRotation = 0.7;
                    targetTilt = 0.5;
                    mouseX = -1;
                };

                canvas5.parentElement.addEventListener('mouseleave', handleLeave);
                canvas5.parentElement.addEventListener('touchend', handleLeave);

                const resize = () => {
                    const parent = canvas5.parentElement;
                    const dpr = window.devicePixelRatio || 1;
                    
                    width = parent.offsetWidth;
                    height = parent.offsetHeight;
                    
                    canvas5.width = width * dpr;
                    canvas5.height = height * dpr;
                    
                    ctx.scale(dpr, dpr);
                    
                    if (width < 768) {
                        cols = 16;
                        rows = 16;
                    } else {
                        cols = 24;
                        rows = 24;
                    }
                    
                    initGrid();
                };
                
                function initGrid() {
                    points = [];
                    projected = [];
                    const spacing = Math.min(width, height) / (width < 768 ? 10 : 16);
                    
                    for(let r=0; r<=rows; r++) {
                        for(let c=0; c<=cols; c++) {
                            points.push({
                                r, c,
                                x: (c - cols/2) * spacing,
                                z: (r - rows/2) * spacing,
                                y: 0,
                                ox: (c - cols/2) * spacing,
                                oz: (r - rows/2) * spacing
                            });
                            projected.push({ x: 0, y: 0, z: 0, alpha: 0 });
                        }
                    }
                }

                resize();
                window.addEventListener('resize', debounce(resize, 150));
                
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        isVisible = entry.isIntersecting;
                        if (isVisible && !animationId) {
                            animate();
                        } else if (!isVisible && animationId) {
                            cancelAnimationFrame(animationId);
                            animationId = null;
                        }
                    });
                }, { threshold: 0.1 });
                observer.observe(canvas5);

                const animate = () => {
                    if (!isVisible) {
                        animationId = null;
                        return;
                    }

                    ctx.clearRect(0, 0, width, height);
                    
                    // Smooth camera
                    rotation += (targetRotation - rotation) * 0.05;
                    tilt += (targetTilt - tilt) * 0.05;
                    
                    timeOffset += 0.02; // Constant flow
                    
                    const cosRot = Math.cos(rotation);
                    const sinRot = Math.sin(rotation);
                    const cosTilt = Math.cos(tilt);
                    const sinTilt = Math.sin(tilt);
                    
                    // Update & Project
                    for(let i=0; i<points.length; i++) {
                        const p = points[i];
                        const proj = projected[i];
                        
                        // Complex Surface Math
                        // 1. Volatility Smile (Parabolic base)
                        const smile = (p.ox * p.ox) * 0.0008;
                        
                        // 2. Market Noise (Superposition of sine waves)
                        // Creates a "rolling hills" effect that looks like financial terrain
                        const noise = Math.sin(p.ox * 0.03 + timeOffset) * 8 + 
                                      Math.cos(p.oz * 0.04 + timeOffset * 0.8) * 8 +
                                      Math.sin((p.ox + p.oz) * 0.05 + timeOffset * 1.5) * 4;
                        
                        p.y = smile + noise;
                        
                        // 3D Rotation
                        const x1 = p.x * cosRot - p.z * sinRot;
                        const z1 = p.x * sinRot + p.z * cosRot;
                        
                        const y1 = p.y * cosTilt - z1 * sinTilt;
                        const z2 = p.y * sinTilt + z1 * cosTilt;
                        
                        // Perspective Projection
                        // Depth factor: things further away are smaller
                        const depth = 800;
                        const scale = depth / (depth + z2 + 300); 
                        
                        proj.x = width/2 + x1 * scale;
                        proj.y = height/2 + y1 * scale;
                        
                        // Calculate opacity based on depth (Fog effect)
                        // z2 ranges roughly from -300 to 300
                        // Map to 0.1 - 0.8
                        let alpha = 1 - ((z2 + 300) / 800);
                        alpha = Math.max(0.05, Math.min(0.8, alpha));
                        proj.alpha = alpha;
                    }

                    // Draw Grid
                    ctx.lineWidth = 1;
                    
                    // 1. Lateral Lines (Rows)
                    for(let r=0; r<=rows; r++) {
                        ctx.beginPath();
                        let first = true;
                        for(let c=0; c<=cols; c++) {
                            const idx = r * (cols+1) + c;
                            const p = projected[idx];
                            if(first) { ctx.moveTo(p.x, p.y); first = false; }
                            else ctx.lineTo(p.x, p.y);
                        }
                        // Use the alpha of the middle point for the line stroke
                        const midIdx = r * (cols+1) + Math.floor(cols/2);
                        ctx.strokeStyle = `rgba(255, 255, 255, ${projected[midIdx].alpha * 0.3})`;
                        ctx.stroke();
                    }
                    
                    // 2. Longitudinal Lines (Cols)
                    for(let c=0; c<=cols; c++) {
                        ctx.beginPath();
                        let first = true;
                        for(let r=0; r<=rows; r++) {
                            const idx = r * (cols+1) + c;
                            const p = projected[idx];
                            if(first) { ctx.moveTo(p.x, p.y); first = false; }
                            else ctx.lineTo(p.x, p.y);
                        }
                        const midIdx = Math.floor(rows/2) * (cols+1) + c;
                        ctx.strokeStyle = `rgba(255, 255, 255, ${projected[midIdx].alpha * 0.3})`;
                        ctx.stroke();
                    }
                    
                    // 3. Data Points (Vertices) - Adds "Tech" feel
                    // Only draw every other point to reduce noise
                    for(let i=0; i<projected.length; i+=2) {
                        const p = projected[i];
                        if(p.alpha > 0.2) { // Only visible ones
                            ctx.fillStyle = `rgba(255, 255, 255, ${p.alpha * 0.4})`;
                            ctx.fillRect(p.x - 0.5, p.y - 0.5, 1, 1);
                        }
                    }
                    
                    // 4. Active Scan Line (The "Analysis")
                    // Moves back and forth
                    const scanPos = (Math.sin(timeOffset * 0.5) * 0.5 + 0.5) * rows;
                    const scanRow = Math.floor(scanPos);
                    
                    if(scanRow >= 0 && scanRow <= rows) {
                        ctx.beginPath();
                        let first = true;
                        for(let c=0; c<=cols; c++) {
                            const idx = scanRow * (cols+1) + c;
                            const p = projected[idx];
                            if(first) { ctx.moveTo(p.x, p.y); first = false; }
                            else ctx.lineTo(p.x, p.y);
                        }
                        ctx.lineWidth = 1.5;
                        ctx.strokeStyle = 'rgba(255, 255, 255, 0.9)';
                        ctx.shadowBlur = 4;
                        ctx.shadowColor = 'rgba(255, 255, 255, 0.5)';
                        ctx.stroke();
                        ctx.shadowBlur = 0; // Reset
                    }

                    animationId = requestAnimationFrame(animate);
                };
            }

            // 6. Website Service (Lorenz Attractor Particle Cloud)
            // Concept: "Emergent Structure". Chaos theory creating form.
            const canvas6 = document.getElementById('canvas-website');
            if (canvas6) {
                const ctx = canvas6.getContext('2d', { alpha: false });
                let width, height;
                let isVisible = false;
                let animationId = null;
                
                // System Parameters
                const sigma = 10;
                const rho = 28;
                const beta = 8/3;
                const dt = 0.006; // Even smoother
                
                // Particles
                let particleCount = 1500; // Increased for density
                let particles = [];
                
                // Camera / Interaction
                let rotation = 0;
                let targetRotation = 0;
                let pitch = 0;
                let targetPitch = 0;
                
                const handleMove = (x, y) => {
                    const normX = x / width;
                    const normY = y / height;
                    
                    targetRotation = (normX - 0.5) * Math.PI * 2;
                    targetPitch = (normY - 0.5) * Math.PI;
                };

                canvas6.parentElement.addEventListener('mousemove', (e) => {
                    const rect = canvas6.getBoundingClientRect();
                    handleMove(e.clientX - rect.left, e.clientY - rect.top);
                });
                
                canvas6.parentElement.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    const rect = canvas6.getBoundingClientRect();
                    const touch = e.touches[0];
                    handleMove(touch.clientX - rect.left, touch.clientY - rect.top);
                }, { passive: false });
                
                const handleLeave = () => {
                    targetRotation = 0;
                    targetPitch = 0;
                };

                canvas6.parentElement.addEventListener('mouseleave', handleLeave);
                canvas6.parentElement.addEventListener('touchend', handleLeave);

                class LorenzParticle {
                    constructor() {
                        this.reset();
                        // Pre-warm
                        for(let i=0; i<Math.random()*2000; i++) {
                            this.update();
                        }
                    }
                    
                    reset() {
                        this.x = 0.1 + (Math.random() - 0.5);
                        this.y = 0.1 + (Math.random() - 0.5);
                        this.z = 0.1 + (Math.random() - 0.5) + 25;
                        this.age = Math.random() * 100; // Staggered start
                        this.life = 1000 + Math.random() * 1000;
                        this.baseAlpha = 0.3 + Math.random() * 0.5; // Varying brightness
                    }
                    
                    update() {
                        const dx = (sigma * (this.y - this.x)) * dt;
                        const dy = (this.x * (rho - this.z) - this.y) * dt;
                        const dz = (this.x * this.y - beta * this.z) * dt;
                        
                        this.x += dx;
                        this.y += dy;
                        this.z += dz;
                        
                        this.age++;
                        if (this.age >= this.life) this.reset();
                    }
                    
                    draw(centerX, centerY, scale, cosRot, sinRot, cosPitch, sinPitch) {
                        // 3D Rotation
                        const x1 = this.x * cosRot - this.z * sinRot;
                        const z1 = this.x * sinRot + this.z * cosRot;
                        
                        const y1 = this.y * cosPitch - z1 * sinPitch;
                        const z2 = this.y * sinPitch + z1 * cosPitch;
                        
                        // Perspective Scale
                        // z2 ranges approx -30 to +30
                        const depthScale = 600 / (600 + z2);
                        
                        const screenX = centerX + x1 * scale * depthScale;
                        const screenY = centerY - y1 * scale * depthScale;
                        
                        // Size based on depth (closer = bigger)
                        const size = Math.max(0.5, 1.8 * depthScale);
                        
                        // Opacity based on depth (closer = brighter)
                        // and lifecycle fade in/out
                        let alpha = this.baseAlpha;
                        if (this.age < 50) alpha *= (this.age / 50);
                        if (this.age > this.life - 50) alpha *= ((this.life - this.age) / 50);
                        
                        // Depth fade
                        alpha *= depthScale; 
                        
                        ctx.fillStyle = `rgba(255, 255, 255, ${alpha})`;
                        ctx.fillRect(screenX, screenY, size, size);
                    }
                }

                const resize = () => {
                    const parent = canvas6.parentElement;
                    const dpr = window.devicePixelRatio || 1;
                    
                    width = parent.offsetWidth;
                    height = parent.offsetHeight;
                    
                    canvas6.width = width * dpr;
                    canvas6.height = height * dpr;
                    
                    ctx.scale(dpr, dpr);
                    
                    if (width < 768) {
                        particleCount = 800; 
                    } else {
                        particleCount = 1500;
                    }
                    
                    particles = [];
                    for(let i=0; i<particleCount; i++) {
                        particles.push(new LorenzParticle());
                    }
                };
                resize();
                window.addEventListener('resize', debounce(resize, 150));
                
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        isVisible = entry.isIntersecting;
                        if (isVisible && !animationId) {
                            animate();
                        } else if (!isVisible && animationId) {
                            cancelAnimationFrame(animationId);
                            animationId = null;
                        }
                    });
                }, { threshold: 0.1 });
                observer.observe(canvas6);

                const animate = () => {
                    if (!isVisible) {
                        animationId = null;
                        return;
                    }

                    ctx.clearRect(0, 0, width, height);
                    
                    rotation += (targetRotation - rotation) * 0.05;
                    pitch += (targetPitch - pitch) * 0.05;
                    
                    if (Math.abs(targetRotation) < 0.01) {
                        rotation += 0.003; // Slow idle rotation
                    }

                    const scale = Math.min(width, height) / 45;
                    const centerX = width / 2;
                    const centerY = height / 2 + (height * 0.1);

                    const cosRot = Math.cos(rotation);
                    const sinRot = Math.sin(rotation);
                    const cosPitch = Math.cos(pitch);
                    const sinPitch = Math.sin(pitch);

                    particles.forEach(p => {
                        p.update();
                        p.draw(centerX, centerY, scale, cosRot, sinRot, cosPitch, sinPitch);
                    });

                    animationId = requestAnimationFrame(animate);
                };
            }
        }

        // --- 11. LIVE TICKER ---
        function initLiveTicker() {
            const ticker = document.getElementById('live-ticker');
            if (!ticker) return;

            // Initial State (Updated Dec 2025)
            const state = {
                btc: { val: 90142, label: 'BTC' },
                eth: { val: 3108, label: 'ETH' },
                block: { val: 927878, label: 'BLOCK' },
                ping: { val: 24, label: 'PING' }
            };

            // Render Function
            function render() {
                ticker.innerHTML = `
                    <div class="flex items-center gap-2"><span>${state.btc.label}: <span id="ticker-btc" class="text-off-white">$${state.btc.val.toLocaleString()}</span></span></div>
                    <div class="flex items-center gap-2"><span>${state.eth.label}: <span id="ticker-eth" class="text-off-white">$${state.eth.val.toLocaleString()}</span></span></div>
                    <div class="hidden md:flex items-center gap-2"><span>${state.block.label}: <span id="ticker-block" class="text-off-white">#${state.block.val.toLocaleString()}</span></span></div>
                    <div class="hidden md:flex items-center gap-2"><span>${state.ping.label}: <span id="ticker-ping" class="text-off-white">${state.ping.val}ms</span></span></div>
                `;
            }
            render();

            // Update Helper
            function updateValue(id, newValue, formatFn = v => v) {
                const el = document.getElementById(id);
                if (el && el.innerText !== formatFn(newValue)) {
                    el.innerText = formatFn(newValue);
                    el.classList.remove('animate-flash');
                    void el.offsetWidth; // Trigger reflow
                    el.classList.add('animate-flash');
                }
            }

            // 1. Crypto Prices (Bitstamp WebSocket for Real-Time Data)
            function initPriceWS() {
                const ws = new WebSocket('wss://ws.bitstamp.net');
                
                ws.onopen = () => {
                    ws.send(JSON.stringify({ event: 'bts:subscribe', data: { channel: 'live_trades_btcusd' } }));
                    ws.send(JSON.stringify({ event: 'bts:subscribe', data: { channel: 'live_trades_ethusd' } }));
                };

                ws.onmessage = (event) => {
                    try {
                        const msg = JSON.parse(event.data);
                        if (msg.event === 'trade') {
                            if (msg.channel === 'live_trades_btcusd') {
                                state.btc.val = msg.data.price;
                                updateValue('ticker-btc', state.btc.val, v => `$${v.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0})}`);
                            } else if (msg.channel === 'live_trades_ethusd') {
                                state.eth.val = msg.data.price;
                                updateValue('ticker-eth', state.eth.val, v => `$${v.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0})}`);
                            }
                        }
                    } catch (e) {}
                };

                ws.onclose = () => setTimeout(initPriceWS, 5000);
            }
            
            // 2. Block Height (Polling with Fallbacks)
            async function fetchBlock() {
                const endpoints = [
                    'https://mempool.space/api/blocks/tip/height',
                    'https://blockstream.info/api/blocks/tip/height'
                ];

                for (const url of endpoints) {
                    try {
                        // Add timestamp to prevent caching
                        const res = await fetch(`${url}?t=${Date.now()}`, { cache: 'no-store' });
                        if (!res.ok) continue;
                        
                        const text = await res.text();
                        const height = parseInt(text);
                        
                        if (!isNaN(height) && height > 0) {
                            if (state.block.val !== height) {
                                state.block.val = height;
                                updateValue('ticker-block', state.block.val, v => `#${v.toLocaleString()}`);
                            }
                            return; // Success, exit loop
                        }
                    } catch(e) {
                        console.warn('Block fetch failed:', e);
                    }
                }
            }

            // 3. System Ping (Real Measurement)
            async function measurePing() {
                const start = performance.now();
                try {
                    // Fetch a small resource (favicon or current page HEAD) to measure RTT
                    await fetch(window.location.href, { method: 'HEAD', cache: 'no-store' });
                    const end = performance.now();
                    const ping = Math.round(end - start);
                    state.ping.val = ping;
                    updateValue('ticker-ping', state.ping.val, v => `${v}ms`);
                } catch (e) {
                    // Fallback if fetch fails
                    state.ping.val = 0;
                    updateValue('ticker-ping', 'ERR', v => v);
                }
            }

            // Start Loops
            initPriceWS();
            fetchBlock();
            measurePing();

            // Intervals
            setInterval(measurePing, 2000);
            setInterval(fetchBlock, 10000); // Check for blocks every 10s
        }

        // --- 6. CURSOR & MAGNETIC ---
        const cursorDot = document.querySelector('.cursor-dot');
        const cursorOutline = document.querySelector('.cursor-outline');
        const magneticWraps = document.querySelectorAll('.magnetic-wrap');
        const viewProjectTargets = document.querySelectorAll('.view-project-target');
        const hoverTargets = document.querySelectorAll('.hover-target');

        let mouse = { x: window.innerWidth/2, y: window.innerHeight/2 };
        let cursor = { x: window.innerWidth/2, y: window.innerHeight/2 };

        window.addEventListener('mousemove', (e) => {
            mouse.x = e.clientX;
            mouse.y = e.clientY;
            // Use transform for better performance (hardware accelerated)
            cursorDot.style.transform = `translate(${mouse.x - 3}px, ${mouse.y - 3}px)`;
        }, { passive: true });

        function animateCursor() {
            // Optimized speed - balance between responsiveness and smoothness
            const speed = 0.25; 
            cursor.x += (mouse.x - cursor.x) * speed;
            cursor.y += (mouse.y - cursor.y) * speed;
            cursorOutline.style.transform = `translate(${cursor.x - 16}px, ${cursor.y - 16}px)`;
            requestAnimationFrame(animateCursor);
        }
        animateCursor();

        // Track if cursor is in a magnetic field for scaling
        let isMagnetic = false;
        
        magneticWraps.forEach(wrap => {
            const content = wrap.querySelector('.magnetic-content');
            wrap.addEventListener('mousemove', (e) => {
                const rect = wrap.getBoundingClientRect();
                const x = e.clientX - rect.left - rect.width / 2;
                const y = e.clientY - rect.top - rect.height / 2;
                content.style.transform = `translate(${x * 0.4}px, ${y * 0.4}px)`;
                isMagnetic = true;
                cursorOutline.style.width = '58px';
                cursorOutline.style.height = '58px';
                cursorOutline.style.borderColor = "rgba(255, 255, 255, 0.8)";
            }, { passive: true });
            wrap.addEventListener('mouseleave', () => {
                content.style.transform = `translate(0px, 0px)`;
                isMagnetic = false;
                cursorOutline.style.width = '32px';
                cursorOutline.style.height = '32px';
                cursorOutline.style.borderColor = "rgba(255, 255, 255, 0.2)";
            });
        });

        hoverTargets.forEach(el => {
            el.addEventListener('mouseenter', () => document.body.classList.add('hovering'));
            el.addEventListener('mouseleave', () => document.body.classList.remove('hovering'));
        });

        viewProjectTargets.forEach(el => {
            el.addEventListener('mouseenter', () => document.body.classList.add('viewing-project'));
            el.addEventListener('mouseleave', () => document.body.classList.remove('viewing-project'));
        });

        // --- 7. SCROLL REVEAL ---
        function initScrollReveal() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('active');
                        // Stop observing after animation triggers for performance
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1, rootMargin: "0px 0px -80px 0px" });

            document.querySelectorAll('.reveal-text').forEach(el => {
                // Immediately activate elements already in viewport
                const rect = el.getBoundingClientRect();
                if (rect.top < window.innerHeight && rect.bottom > 0) {
                    el.classList.add('active');
                } else {
                    observer.observe(el);
                }
            });
        }

        // --- 8. MOBILE MENU ---
        const menuBtn = document.getElementById('menu-btn');
        const closeBtnMenu = document.getElementById('close-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        
        function toggleMenu() {
            mobileMenu.classList.toggle('translate-x-full');
            const isOpen = !mobileMenu.classList.contains('translate-x-full');
            document.body.style.overflow = isOpen ? 'hidden' : 'auto';
            menuBtn.setAttribute('aria-expanded', isOpen.toString());
        }
        menuBtn.addEventListener('click', toggleMenu);
        closeBtnMenu.addEventListener('click', toggleMenu);
        document.querySelectorAll('.mobile-link').forEach(l => l.addEventListener('click', toggleMenu));

        // --- 9. THREE.JS GLOBE ---
        function initGlobe() {
            const container = document.getElementById('canvas-container');
            let isVisible = false;
            let animationId = null;
            
            // Visibility detection for globe
            const globeObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    isVisible = entry.isIntersecting;
                    if (isVisible && !animationId) {
                        animate();
                    }
                });
            }, { threshold: 0.1 });
            globeObserver.observe(container);
            
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.z = 6;
            // Optimization: Disable antialias for performance
            const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: false });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2)); 
            container.appendChild(renderer.domElement);

            const group = new THREE.Group();
            scene.add(group);

            const geometry = new THREE.IcosahedronGeometry(2.6, 1);
            const material = new THREE.MeshBasicMaterial({ 
                color: 0xCCCCCC, 
                wireframe: true, 
                transparent: true, 
                opacity: 0.35 
            });
            const sphere = new THREE.Mesh(geometry, material);
            group.add(sphere);

            const innerGeometry = new THREE.IcosahedronGeometry(2.55, 1);
            const innerMaterial = new THREE.MeshBasicMaterial({ color: 0x030303 }); 
            const innerSphere = new THREE.Mesh(innerGeometry, innerMaterial);
            group.add(innerSphere);

            const particlesGeometry = new THREE.BufferGeometry();
            const particlesCount = 600;
            const posArray = new Float32Array(particlesCount * 3);
            for(let i = 0; i < particlesCount * 3; i++) {
                posArray[i] = (Math.random() - 0.5) * 12; 
            }
            particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
            const particlesMaterial = new THREE.PointsMaterial({
                size: 0.02,
                color: 0xffffff,
                transparent: true,
                opacity: 0.6
            });
            const particlesMesh = new THREE.Points(particlesGeometry, particlesMaterial);
            group.add(particlesMesh);

            let mouseX = 0;
            let mouseY = 0;
            const windowHalfX = window.innerWidth / 2;
            const windowHalfY = window.innerHeight / 2;

            document.addEventListener('mousemove', (event) => {
                mouseX = (event.clientX - windowHalfX) * 0.0003;
                mouseY = (event.clientY - windowHalfY) * 0.0003;
            }, { passive: true });

            // Mobile Gyroscope
            function handleOrientation(event) {
                if (event.beta !== null && event.gamma !== null) {
                    // beta is front-back tilt [-180, 180], gamma is left-right tilt [-90, 90]
                    // Convert degrees to radians and amplify for "physical" feel
                    // 0.04 is approx 2.3 degrees per 1 degree of tilt
                    mouseX = event.gamma * 0.04; 
                    mouseY = event.beta * 0.04;
                }
            }

            window.addEventListener('deviceorientation', handleOrientation);

            // Request permission for iOS 13+ devices
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                document.body.addEventListener('click', async () => {
                    try {
                        const response = await DeviceOrientationEvent.requestPermission();
                        if (response === 'granted') {
                            window.addEventListener('deviceorientation', handleOrientation);
                        }
                    } catch (e) {
                        console.error("Gyroscope permission denied", e);
                    }
                }, { once: true });
            }

            function animate() {
                if (!isVisible) {
                    animationId = null;
                    return;
                }
                animationId = requestAnimationFrame(animate);
                sphere.rotation.y += 0.001;
                particlesMesh.rotation.y += 0.0003;
                group.rotation.x += 0.05 * (mouseY - group.rotation.x);
                group.rotation.y += 0.05 * (mouseX - group.rotation.y);
                renderer.render(scene, camera);
            }

            window.addEventListener('resize', debounce(() => {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            }, 150));
        }
        initGlobe();
        // --- 6. OSCILLOSCOPE VISUALIZATION (LIQUID AUDIO) ---
        const oscCanvas = document.getElementById('oscilloscope');
        if (oscCanvas) {
            const ctx = oscCanvas.getContext('2d');
            let width, height;
            let time = 0;
            let isOscVisible = false;
            let oscAnimationId = null;
            
            // Wave State
            let currentWaveMode = 'sine'; // sine, square, jagged, noise
            
            // Mouse interaction
            let mouseX = 0;
            let mouseY = 0;
            let mouseSpeed = 0;
            let lastMouseX = 0;
            let lastMouseY = 0;

            function resizeOsc() {
                width = oscCanvas.width = oscCanvas.offsetWidth;
                height = oscCanvas.height = oscCanvas.offsetHeight;
            }
            // Optimization: Debounce resize
            window.addEventListener('resize', debounce(resizeOsc, 150));
            resizeOsc();

            // Optimization: Intersection Observer
            const oscObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    isOscVisible = entry.isIntersecting;
                    if (isOscVisible && !oscAnimationId) {
                        animateOsc();
                    }
                });
            }, { threshold: 0.1 });
            oscObserver.observe(oscCanvas);

            window.addEventListener('mousemove', (e) => {
                if (!isOscVisible) return; // Optimization: Don't track mouse if not visible
                const rect = oscCanvas.getBoundingClientRect();
                mouseX = e.clientX - rect.left;
                mouseY = e.clientY - rect.top;
                
                // Calculate speed
                const dx = e.clientX - lastMouseX;
                const dy = e.clientY - lastMouseY;
                mouseSpeed = Math.sqrt(dx*dx + dy*dy);
                
                lastMouseX = e.clientX;
                lastMouseY = e.clientY;
            }, { passive: true });

            function animateOsc() {
                if (!isOscVisible) {
                    oscAnimationId = null;
                    return;
                }
                
                ctx.clearRect(0, 0, width, height);
                
                // Decay mouse speed
                mouseSpeed *= 0.95;
                
                // Draw multiple waves
                const waves = [
                    { amplitude: 30, frequency: 0.002, speed: 0.02, color: 'rgba(255, 255, 255, 0.1)' },
                    { amplitude: 50, frequency: 0.003, speed: 0.015, color: 'rgba(255, 255, 255, 0.2)' },
                    { amplitude: 20, frequency: 0.005, speed: 0.03, color: 'rgba(255, 255, 255, 0.15)' }
                ];

                waves.forEach((wave, index) => {
                    ctx.beginPath();
                    ctx.strokeStyle = wave.color;
                    ctx.lineWidth = 1.5;

                    for (let x = 0; x < width; x++) {
                        let y = height / 2;
                        let waveY = 0;

                        // Mode Logic
                        if (currentWaveMode === 'sine') {
                            waveY = Math.sin(x * wave.frequency + time * (index + 1) * 0.5);
                        } else if (currentWaveMode === 'square') {
                            waveY = Math.sign(Math.sin(x * wave.frequency * 2 + time * (index + 1)));
                        } else if (currentWaveMode === 'jagged') {
                            // Triangle/Sawtooth approximation
                            waveY = Math.asin(Math.sin(x * wave.frequency * 3 + time * (index + 1)));
                        } else if (currentWaveMode === 'noise') {
                            waveY = (Math.random() - 0.5) * 2;
                        }

                        y += wave.amplitude * waveY;
                        
                        // Mouse interaction (Spike)
                        const dist = Math.abs(x - mouseX);
                        const influence = Math.max(0, 1 - dist / 200); // 200px radius
                        
                        if (influence > 0) {
                            // Add noise/spike based on mouse speed
                            y += Math.sin(x * 0.1 + time * 5) * mouseSpeed * influence * 0.5;
                        }

                        if (x === 0) ctx.moveTo(x, y);
                        else ctx.lineTo(x, y);
                    }
                    ctx.stroke();
                });
                
                time += 0.02;
                oscAnimationId = requestAnimationFrame(animateOsc);
            }
            
            // --- PHILOSOPHY INTERACTION HOOKS ---
            const philosophyItems = document.querySelectorAll('.philosophy-item');
            const philosophyBgText = document.getElementById('philosophy-bg-text');
            
            philosophyItems.forEach(item => {
                item.addEventListener('mouseenter', () => {
                    const text = item.getAttribute('data-bg-text');
                    const waveType = item.getAttribute('data-wave');
                    
                    // Update Wave
                    currentWaveMode = waveType || 'sine';

                    // Scramble Text Effect
                    if (philosophyBgText && text) {
                        philosophyBgText.style.opacity = '0.1'; 
                        
                        let iterations = 0;
                        const interval = setInterval(() => {
                            philosophyBgText.innerText = text.split('')
                                .map((letter, index) => {
                                    if(index < iterations) return text[index];
                                    return 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'[Math.floor(Math.random() * 26)];
                                })
                                .join('');
                            
                            if(iterations >= text.length) clearInterval(interval);
                            iterations += 1/3;
                        }, 30);
                    }
                });
                
                item.addEventListener('mouseleave', () => {
                    currentWaveMode = 'sine';
                    if (philosophyBgText) {
                        philosophyBgText.style.opacity = '0.03';
                        philosophyBgText.innerText = 'TRUTH';
                    }
                });
            });
        }
        
        // --- 10. WRITING FILTER ---
        const filterBtns = document.querySelectorAll('.filter-btn');
        const writingItems = document.querySelectorAll('.writing-item');
        const writingGrid = document.getElementById('writing-grid');

        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                // Update active state
                filterBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                const filter = btn.getAttribute('data-filter');

                // 1. Fade out grid container
                writingGrid.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                writingGrid.style.opacity = '0';
                writingGrid.style.transform = 'translateY(10px)';
                
                setTimeout(() => {
                    // 2. Filter items and prepare for entry
                    const visibleItems = [];
                    writingItems.forEach(item => {
                        const category = item.getAttribute('data-category');
                        if (filter === 'all' || category === filter) {
                            item.style.display = 'block';
                            item.style.opacity = '0';
                            item.style.transform = 'translateY(20px)';
                            visibleItems.push(item);
                        } else {
                            item.style.display = 'none';
                        }
                    });
                    
                    // 3. Reset grid container instantly
                    writingGrid.style.transition = 'none';
                    writingGrid.style.opacity = '1';
                    writingGrid.style.transform = 'translateY(0)';
                    
                    // Force reflow
                    void writingGrid.offsetWidth;

                    // 4. Stagger animate items in
                    visibleItems.forEach((item, index) => {
                        setTimeout(() => {
                            item.style.opacity = '1';
                            item.style.transform = 'translateY(0)';
                        }, index * 50);
                    });

                    // 5. Cleanup inline styles after animation to restore hover effects
                    const totalAnimationTime = (visibleItems.length * 50) + 300;
                    setTimeout(() => {
                        visibleItems.forEach(item => {
                            item.style.opacity = '';
                            item.style.transform = '';
                        });
                        // Restore grid transition for next time
                        writingGrid.style.transition = '';
                    }, totalAnimationTime);

                }, 300);
            });
        });

        // Ensure icons are created if script loaded late
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        }

        // --- 11. SHADOW ORDER BOOK (LIVE DATA - BITSTAMP) ---
        function initOrderBook() {
            const canvas = document.getElementById('ob-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const container = document.getElementById('order-book-visual');
            const contactSection = document.getElementById('contact');
            
            let width, height;
            let animationId;
            let isVisible = false;
            let isHovered = false;
            
            // Data State
            let bids = [];
            let asks = [];
            let lastPrice = 0;
            let ws = null;
            
            // Initialize WebSocket (Bitstamp)
            function connectWS() {
                // Bitstamp public websocket
                ws = new WebSocket('wss://ws.bitstamp.net');
                
                ws.onopen = () => {
                    const msg1 = {
                        event: 'bts:subscribe',
                        data: { channel: 'order_book_btcusd' }
                    };
                    ws.send(JSON.stringify(msg1));

                    const msg2 = {
                        event: 'bts:subscribe',
                        data: { channel: 'live_trades_btcusd' }
                    };
                    ws.send(JSON.stringify(msg2));
                };

                ws.onmessage = (event) => {
                    try {
                        const response = JSON.parse(event.data);
                        
                        // Handle Order Book
                        if (response.channel === 'order_book_btcusd' && response.data.bids && response.data.asks) {
                            const data = response.data;
                            // Take top 20, convert to float
                            bids = data.bids.slice(0, 20).map(b => ({ p: parseFloat(b[0]), q: parseFloat(b[1]) }));
                            asks = data.asks.slice(0, 20).map(a => ({ p: parseFloat(a[0]), q: parseFloat(a[1]) }));
                            
                            // Fallback price if no trades yet
                            if (lastPrice === 0 && bids.length > 0 && asks.length > 0) {
                                lastPrice = (bids[0].p + asks[0].p) / 2;
                            }
                        }

                        // Handle Live Trades (Instant Price Updates)
                        if (response.channel === 'live_trades_btcusd' && response.data.price) {
                            lastPrice = response.data.price;
                        }
                    } catch (e) {
                        // console.error(e);
                    }
                };

                ws.onclose = () => {
                    // Simple reconnect logic
                    setTimeout(connectWS, 3000);
                };
            }

            // Start connection
            connectWS();

            function resize() {
                width = canvas.width = container.offsetWidth;
                height = canvas.height = container.offsetHeight;
            }
            window.addEventListener('resize', debounce(resize, 200));
            resize();

            // Interaction
            contactSection.addEventListener('mouseenter', () => {
                isHovered = true;
                container.style.opacity = '0.8';
                container.style.filter = 'blur(0px)';
            });
            contactSection.addEventListener('mouseleave', () => {
                isHovered = false;
                container.style.opacity = '0.3';
                container.style.filter = 'blur(2px)';
            });

            // Animation Loop
            function animate() {
                if (!isVisible) {
                    animationId = null;
                    return;
                }
                
                ctx.clearRect(0, 0, width, height);
                
                // Compact Layout Settings
                const levels = 20; 
                const paddingY = height * 0.2; 
                const availableHeight = height - (paddingY * 2);
                const barHeight = availableHeight / levels;
                const midX = width * 0.5; 
                const maxBarWidth = width * 0.45;
                
                // Dynamic Volume Normalization
                // Find max volume in current view to scale bars appropriately
                let currentMaxVol = 0.1;
                bids.forEach(b => currentMaxVol = Math.max(currentMaxVol, b.q));
                asks.forEach(a => currentMaxVol = Math.max(currentMaxVol, a.q));
                
                // Draw Bids (Left)
                bids.forEach((b, i) => {
                    const y = paddingY + (i * barHeight) + (barHeight / 2);
                    const w = Math.min((b.q / currentMaxVol) * maxBarWidth, maxBarWidth);
                    
                    ctx.beginPath();
                    ctx.strokeStyle = `rgba(234, 234, 234, ${0.1 + Math.min(b.q/currentMaxVol, 0.6)})`;
                    ctx.lineWidth = barHeight * 0.6; 
                    ctx.moveTo(midX - 4, y);
                    ctx.lineTo(midX - 4 - w, y);
                    ctx.stroke();
                });

                // Draw Asks (Right)
                asks.forEach((a, i) => {
                    const y = paddingY + (i * barHeight) + (barHeight / 2);
                    const w = Math.min((a.q / currentMaxVol) * maxBarWidth, maxBarWidth);
                    
                    ctx.beginPath();
                    ctx.strokeStyle = `rgba(234, 234, 234, ${0.1 + Math.min(a.q/currentMaxVol, 0.6)})`;
                    ctx.lineWidth = barHeight * 0.6;
                    ctx.setLineDash([2, 2]); 
                    ctx.moveTo(midX + 4, y);
                    ctx.lineTo(midX + 4 + w, y);
                    ctx.stroke();
                    ctx.setLineDash([]);
                });
                
                // Mid Price & Info (Hover)
                if (isHovered && lastPrice) {
                    const centerY = height / 2;
                    
                    // Center Line
                    ctx.beginPath();
                    ctx.strokeStyle = 'rgba(234, 234, 234, 0.3)';
                    ctx.lineWidth = 1;
                    ctx.moveTo(midX, paddingY);
                    ctx.lineTo(midX, height - paddingY);
                    ctx.stroke();

                    // Text Info
                    ctx.fillStyle = '#EAEAEA';
                    ctx.font = '10px Space Mono';
                    ctx.textAlign = 'left';
                    ctx.fillText(`BTC-USD: $${lastPrice.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`, midX + 10, centerY);
                    
                    ctx.fillStyle = '#666';
                    ctx.font = '8px Space Mono';
                    ctx.fillText('SRC: BITSTAMP', midX + 10, centerY + 12);
                }

                animationId = requestAnimationFrame(animate);
            }

            // Observer
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    isVisible = entry.isIntersecting;
                    if (isVisible && !animationId) {
                        animate();
                    }
                });
            }, { threshold: 0.1 });
            observer.observe(contactSection);
        }
        // Austin Real Estate Dashboard Logic
        window.tickerItems = [
            "NEW LISTING: 78704 - 3bd/2ba - $850k",
            "SOLD: 78702 - $1.2M (Over Ask)",
            "RATE ALERT: 30Y Fixed up to 6.92%",
            "INVENTORY: +2.4% MoM in North Loop"
        ];

        window.updateTicker = function() {
            const ticker = document.getElementById('market-ticker');
            if(!ticker) return;
            
            // Take recent items
            const displayItems = window.tickerItems.slice(0, 10);
            
            const content = displayItems.map(i => `<span class="text-xs font-mono text-neutral-400 mx-8"><span class="text-white mr-2">●</span>${i}</span>`).join('');
            ticker.innerHTML = content + content + content;
        };

        window.initAustinDashboard = function() {
            // 1. Live Market Ticker
            window.updateTicker();

            // 2. Initialize Price Trends Chart
            initPriceTrendsChart();

            // 3. Initialize Building Valuations Chart
            initValuationsChart();

            // 4. Rate Sensitivity Model
            const slider = document.getElementById('rate-slider');
            if(slider) {
                slider.addEventListener('input', (e) => {
                    const rate = parseFloat(e.target.value);
                    document.getElementById('rate-display').innerText = rate.toFixed(1) + '%';
                    
                    // Enhanced Model Logic with more accurate calculations
                    const monthlyPayment = 3500;
                    const r = rate / 100 / 12;
                    const n = 360; // 30 years
                    
                    const loanAmount = monthlyPayment * (Math.pow(1+r, n) - 1) / (r * Math.pow(1+r, n));
                    const downPayment = 100000; // $100k down
                    const buyingPower = loanAmount + downPayment;
                    
                    // Format buying power
                    const powerK = Math.round(buyingPower/1000);
                    document.getElementById('model-power').innerText = '$' + powerK.toLocaleString() + 'k';
                    
                    // Calculate spread vs cap rate (simplified)
                    const marketCap = 5.5;
                    const spread = marketCap - rate; 
                    document.getElementById('model-spread').innerText = spread.toFixed(1) + '%';
                    document.getElementById('model-spread').className = `text-3xl font-display mb-1 ${spread < 0 ? 'text-red-400' : 'text-white'}`;
                    
                    // Refi probability based on rate
                    let refi, refiColor;
                    if(rate > 7.5) {
                        refi = "High";
                        refiColor = "text-green-400";
                    } else if(rate < 5.5) {
                        refi = "Low";
                        refiColor = "text-neutral-500";
                    } else {
                        refi = "Medium";
                        refiColor = "text-yellow-400";
                    }
                    const refiEl = document.getElementById('model-refi');
                    refiEl.innerText = refi;
                    refiEl.className = `text-3xl font-display mb-1 ${refiColor}`;
                });
            }

            // 4. Initialize Leaflet Map
            if(document.getElementById('austin-map')) {
                initLeafletMap();
            }

            // 5. Add animation to demographics cards
            setTimeout(() => {
                const cards = document.querySelectorAll('[id^="pop-growth"]');
                cards.forEach(card => {
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                });
            }, 100);
        };

        // Initialize Price Trends Chart
        function initPriceTrendsChart() {
            const canvas = document.getElementById('price-trends-chart');
            if(!canvas) return;

            const ctx = canvas.getContext('2d');
            
            // Historical Austin median home price data (quarterly)
            const labels = [
                'Q1 2020', 'Q2 2020', 'Q3 2020', 'Q4 2020',
                'Q1 2021', 'Q2 2021', 'Q3 2021', 'Q4 2021',
                'Q1 2022', 'Q2 2022', 'Q3 2022', 'Q4 2022',
                'Q1 2023', 'Q2 2023', 'Q3 2023', 'Q4 2023',
                'Q1 2024', 'Q2 2024', 'Q3 2024', 'Q4 2024',
                'Q1 2025'
            ];
            
            const data = [
                365000, 375000, 390000, 410000,  // 2020
                425000, 445000, 475000, 495000,  // 2021
                520000, 545000, 555000, 560000,  // 2022
                550000, 535000, 525000, 520000,  // 2023
                525000, 535000, 540000, 545000,  // 2024
                550000  // Q1 2025
            ];

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Median Home Price',
                        data: data,
                        borderColor: '#EAEAEA',
                        backgroundColor: 'rgba(234, 234, 234, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 3,
                        pointHoverRadius: 6,
                        pointBackgroundColor: '#EAEAEA',
                        pointBorderColor: '#030303',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: '#0A0A0A',
                            titleColor: '#EAEAEA',
                            bodyColor: '#A3A3A3',
                            borderColor: '#2A2A2A',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    return '$' + context.parsed.y.toLocaleString();
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: '#1A1A1A',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#666666',
                                font: {
                                    family: "'Space Mono', monospace",
                                    size: 10
                                },
                                maxRotation: 45,
                                minRotation: 45
                            }
                        },
                        y: {
                            grid: {
                                color: '#1A1A1A',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#666666',
                                font: {
                                    family: "'Space Mono', monospace",
                                    size: 10
                                },
                                callback: function(value) {
                                    return '$' + (value/1000) + 'k';
                                }
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        // Initialize Building Valuations Chart
        function initValuationsChart() {
            const canvas = document.getElementById('valuations-chart');
            if(!canvas) return;

            const ctx = canvas.getContext('2d');
            
            // Monthly permit valuations data for 2024
            const labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const data = [245, 280, 320, 295, 310, 285, 275, 290, 305, 340, 315, 295]; // in millions

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Total Valuation ($M)',
                        data: data,
                        backgroundColor: 'rgba(163, 163, 163, 0.8)',
                        borderColor: '#A3A3A3',
                        borderWidth: 1,
                        borderRadius: 2,
                        hoverBackgroundColor: 'rgba(234, 234, 234, 0.9)',
                        hoverBorderColor: '#EAEAEA'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: '#0A0A0A',
                            titleColor: '#EAEAEA',
                            bodyColor: '#A3A3A3',
                            borderColor: '#2A2A2A',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    return '$' + context.parsed.y + 'M in construction value';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                color: '#666666',
                                font: {
                                    family: "'Space Mono', monospace",
                                    size: 11
                                }
                            }
                        },
                        y: {
                            grid: {
                                color: '#1A1A1A',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#666666',
                                font: {
                                    family: "'Space Mono', monospace",
                                    size: 10
                                },
                                callback: function(value) {
                                    return '$' + value + 'M';
                                }
                            }
                        }
                    }
                }
            });
        }

        let map;
        let layers = {
            permits: null,
            str: null,
            zoning: null,
            traffic: null,
            cameras: null,
            schools: null,
            parks: null,
            bikes: null
        };
        let baseLayer = null;
        let isSatellite = false;
        let trafficRefreshInterval = null;
        let isMapExpanded = false;

        // Toggle Map Fullscreen
        window.toggleMapExpand = function() {
            const container = document.getElementById('map-container');
            const icon = document.getElementById('expand-icon');
            isMapExpanded = !isMapExpanded;
            
            if(isMapExpanded) {
                container.style.height = '90vh';
                icon.setAttribute('data-lucide', 'minimize-2');
                icon.parentElement.querySelector('span').textContent = 'Collapse';
            } else {
                container.style.height = '700px';
                icon.setAttribute('data-lucide', 'maximize-2');
                icon.parentElement.querySelector('span').textContent = 'Expand';
            }
            
            lucide.createIcons();
            setTimeout(() => map.invalidateSize(), 300);
        };

        // Side Panel Functions
        window.closeSidePanel = function() {
            const panel = document.getElementById('map-info-panel');
            if(panel) {
                panel.style.transform = 'translateX(100%)';
            }
        };

        window.openSidePanel = function(content) {
            const panel = document.getElementById('map-info-panel');
            const panelContent = document.getElementById('panel-content');
            
            if(panel && panelContent) {
                panelContent.innerHTML = content;
                panel.style.transform = 'translateX(0)';
                lucide.createIcons();
            }
        };

        // Camera Functions
        window.refreshCamera = function(camId, feedUrl) {
            const img = document.getElementById(`camera-img-${camId}`);
            if(img) {
                img.src = `${feedUrl}?t=${Date.now()}`;
            }
        };

        window.openFullscreenCamera = function(camId, feedUrl, locationName, cameraId) {
            // Create fullscreen overlay
            const overlay = document.createElement('div');
            overlay.id = 'fullscreen-camera-overlay';
            overlay.className = 'fixed inset-0 z-[9999] bg-black flex flex-col';
            overlay.innerHTML = `
                <div class="flex-shrink-0 bg-[#030303] border-b border-white/10 p-4 flex items-center justify-between">
                    <div>
                        <div class="font-mono text-xs text-neutral-500 uppercase tracking-wider mb-1">Live Camera Feed</div>
                        <h3 class="font-display text-lg text-white">${locationName}</h3>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="flex items-center gap-2 px-3 py-1.5 bg-red-600/20 border border-red-500/30 rounded">
                            <div class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></div>
                            <span class="font-mono text-xs text-red-400 uppercase tracking-wider">Live</span>
                        </div>
                        <button 
                            onclick="refreshFullscreenCamera('${camId}', '${feedUrl}')"
                            class="p-2 hover:bg-white/10 rounded transition-colors"
                            title="Refresh Feed"
                        >
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                            </svg>
                        </button>
                        <button 
                            onclick="closeFullscreenCamera()"
                            class="p-2 hover:bg-white/10 rounded transition-colors"
                            title="Close (ESC)"
                        >
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="flex-1 flex items-center justify-center p-4 sm:p-8 overflow-hidden">
                    <div class="relative w-full h-full flex items-center justify-center">
                        <img 
                            id="fullscreen-camera-img-${camId}"
                            src="${feedUrl}?t=${Date.now()}" 
                            alt="Live Camera Feed"
                            class="max-w-full max-h-full object-contain"
                            onerror="this.style.display='none'; document.getElementById('fullscreen-error-${camId}').style.display='flex'"
                        />
                        <div 
                            id="fullscreen-error-${camId}"
                            class="hidden absolute inset-0 flex-col items-center justify-center text-center"
                            style="display: none;"
                        >
                            <svg class="w-20 h-20 text-neutral-700 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                            </svg>
                            <div class="text-neutral-500 text-lg font-mono">Camera Feed Temporarily Unavailable</div>
                            <div class="text-neutral-700 text-sm mt-2">The camera may be offline or experiencing connectivity issues</div>
                            <button 
                                onclick="refreshFullscreenCamera('${camId}', '${feedUrl}')"
                                class="mt-6 px-6 py-3 bg-white/10 hover:bg-white/20 border border-white/20 rounded text-white font-mono text-sm transition-colors"
                            >
                                Try Again
                            </button>
                        </div>
                    </div>
                </div>
                <div class="flex-shrink-0 bg-[#030303] border-t border-white/10 p-3 sm:p-4">
                    <div class="flex flex-wrap gap-4 text-xs font-mono text-neutral-500">
                        <div><span class="text-neutral-600">Camera ID:</span> <span class="text-neutral-400">${cameraId}</span></div>
                        <div><span class="text-neutral-600">Location:</span> <span class="text-neutral-400">${locationName}</span></div>
                        <div><span class="text-neutral-600">Press ESC to close</span></div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(overlay);
            
            // Add ESC key handler
            const escHandler = function(e) {
                if (e.key === 'Escape') {
                    closeFullscreenCamera();
                }
            };
            document.addEventListener('keydown', escHandler);
            overlay.dataset.escHandler = 'attached';
            
            // Prevent body scroll
            document.body.style.overflow = 'hidden';
        };

        window.refreshFullscreenCamera = function(camId, feedUrl) {
            const img = document.getElementById(`fullscreen-camera-img-${camId}`);
            const errorDiv = document.getElementById(`fullscreen-error-${camId}`);
            if(img) {
                img.style.display = 'block';
                if(errorDiv) errorDiv.style.display = 'none';
                img.src = `${feedUrl}?t=${Date.now()}`;
            }
        };

        window.closeFullscreenCamera = function() {
            const overlay = document.getElementById('fullscreen-camera-overlay');
            if(overlay) {
                overlay.remove();
                document.body.style.overflow = '';
                // Remove ESC key listener
                document.removeEventListener('keydown', arguments.callee);
            }
        };

        // Update Legend
        function updateLegend() {
            const legendItems = document.getElementById('legend-items');
            const activeLayers = [];
            
            Object.keys(layers).forEach(key => {
                if(layers[key] && map.hasLayer(layers[key])) {
                    const labels = {
                        permits: { text: 'Construction', color: '#EAEAEA', icon: '■' },
                        traffic: { text: 'Traffic', color: '#DC2626', icon: '▲' },
                        cameras: { text: 'Cameras', color: '#666666', icon: '●' },
                        schools: { text: 'Schools', color: '#A3A3A3', icon: '●' },
                        parks: { text: 'Parks', color: '#737373', icon: '●' },
                        str: { text: 'Rentals', color: '#525252', icon: '■' },
                        zoning: { text: 'Development', color: '#404040', icon: '▪' },
                        bikes: { text: 'Bike Lanes', color: '#525252', icon: '—' }
                    };
                    if(labels[key]) activeLayers.push(labels[key]);
                }
            });
            
            if(activeLayers.length === 0) {
                legendItems.innerHTML = '<div class=\"text-neutral-600\">No layers active</div>';
            } else {
                legendItems.innerHTML = activeLayers.map(l => `
                    <div class=\"flex items-center gap-2\">
                        <span style=\"color: ${l.color}\">${l.icon}</span>
                        <span class=\"text-neutral-400 text-[10px]\">${l.text}</span>
                    </div>
                `).join('');
            }
        }

        function initLeafletMap() {
            const loadingOverlay = document.getElementById('map-loading');
            
            if(map) {
                map.remove();
            }

            // Center on Austin
            map = L.map('austin-map', {
                zoomControl: false,
                attributionControl: false
            }).setView([30.2672, -97.7431], 12);

            // Initial Base Layer (Dark)
            setBaseLayer('dark');

            // Fetch Data Layers
            Promise.all([
                fetchPermits(),
                fetchSTRs(),
                fetchZoning(),
                fetchTraffic(),
                fetchCameras(),
                fetchSchools(),
                fetchParks(),
                fetchBikeLanes(),
                fetchPropertyMarketData()
            ]).then(() => {
                // Hide loading overlay
                if(loadingOverlay) {
                    loadingOverlay.style.opacity = '0';
                    setTimeout(() => loadingOverlay.style.display = 'none', 300);
                }
            }).catch(error => {
                console.error('Error loading map data:', error);
                if(loadingOverlay) {
                    loadingOverlay.innerHTML = `
                        <div class=\"text-center\">
                            <i data-lucide=\"alert-circle\" class=\"w-8 h-8 text-red-400 mx-auto mb-2\"></i>
                            <div class=\"font-mono text-xs text-red-400 uppercase\">Data Loading Error</div>
                        </div>
                    `;
                    lucide.createIcons();
                }
            });

            // Auto-refresh traffic data every 2 minutes
            trafficRefreshInterval = setInterval(() => {
                console.log('Refreshing traffic data...');
                if(map.hasLayer(layers.traffic)) {
                    map.removeLayer(layers.traffic);
                    fetchTraffic().then(() => {
                        if(layers.traffic) {
                            map.addLayer(layers.traffic);
                        }
                    });
                }
            }, 120000); // 2 minutes
        }

        function setBaseLayer(type) {
            if(baseLayer) map.removeLayer(baseLayer);
            
            if(type === 'satellite') {
                // Esri World Imagery
                baseLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                    attribution: 'Tiles &copy; Esri',
                    maxZoom: 19
                });
                isSatellite = true;
            } else {
                // Dark Matter
                baseLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
                    subdomains: 'abcd',
                    maxZoom: 19
                });
                isSatellite = false;
            }
            
            baseLayer.addTo(map);
            baseLayer.bringToBack();
        }

        window.toggleBaseLayer = function() {
            const btn = document.getElementById('btn-satellite');
            if(isSatellite) {
                setBaseLayer('dark');
                btn.classList.remove('bg-white/10', 'text-white');
                btn.classList.add('text-neutral-400');
            } else {
                setBaseLayer('satellite');
                btn.classList.add('bg-white/10', 'text-white');
                btn.classList.remove('text-neutral-400');
            }
        };

        // Fetch Construction Permits (Last 30 Days)
        async function fetchPermits() {
            try {
                const response = await fetch('https://data.austintexas.gov/resource/3syk-w9eu.json?$where=issue_date > "2024-01-01" AND location IS NOT NULL&$limit=500');
                const data = await response.json();
                
                document.getElementById('stat-permits').innerText = data.length;

                // Add to ticker
                if(data.length > 0) {
                    const p = data[0];
                    window.tickerItems.unshift(`PERMIT: ${p.work_type} @ ${p.original_address1}`);
                    window.updateTicker();
                }

                const markers = data.map(p => {
                    if(!p.location) return null;
                    const marker = L.circleMarker([p.location.latitude, p.location.longitude], {
                        radius: 3,
                        fillColor: "#EAEAEA", 
                        color: "#030303",
                        weight: 1,
                        opacity: 1,
                        fillOpacity: 0.9
                    }).bindPopup(`
                        <div class="font-mono text-xs">
                            <div class="font-bold text-white mb-1">PERMIT ISSUED</div>
                            <div class="text-neutral-400">${p.project_name || 'N/A'}</div>
                            <div class="text-neutral-500 mt-1">${p.work_type || 'General'}</div>
                        </div>
                    `);
                    
                    // Click handler for detailed view
                    marker.on('click', function() {
                        const valuation = p.total_valuation ? `$${parseInt(p.total_valuation).toLocaleString()}` : 'N/A';
                        const sqft = p.total_existing_bldg_sqft ? parseInt(p.total_existing_bldg_sqft).toLocaleString() : 'N/A';
                        const issueDate = p.issue_date ? new Date(p.issue_date).toLocaleDateString() : 'N/A';
                        const content = `
                            <div class="font-mono">
                                <div class="flex items-start justify-between mb-4">
                                    <div>
                                        <div class="text-xs text-neutral-500 uppercase tracking-wider mb-1">Construction Permit #${p.permit_num || 'N/A'}</div>
                                        <h3 class="text-lg font-bold text-white">${p.project_name || 'Development Project'}</h3>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-3 mb-4">
                                    <div class="bg-[#030303] p-3 rounded border border-white/10">
                                        <div class="text-xs text-neutral-500 mb-1">Project Valuation</div>
                                        <div class="text-lg font-bold text-white">${valuation}</div>
                                    </div>
                                    <div class="bg-[#030303] p-3 rounded border border-white/10">
                                        <div class="text-xs text-neutral-500 mb-1">Square Footage</div>
                                        <div class="text-lg font-bold text-white">${sqft} sf</div>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-3 mb-4">
                                    <div class="bg-[#030303] p-3 rounded border border-white/10">
                                        <div class="text-xs text-neutral-500 mb-1">Work Type</div>
                                        <div class="text-sm text-white">${p.work_type || 'General'}</div>
                                    </div>
                                    <div class="bg-[#030303] p-3 rounded border border-white/10">
                                        <div class="text-xs text-neutral-500 mb-1">Issue Date</div>
                                        <div class="text-sm text-white">${issueDate}</div>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <div class="text-xs text-neutral-500 mb-2">CONTRACTOR</div>
                                    <div class="text-sm text-neutral-300">${p.contractor_name || 'Not specified'}</div>
                                    ${p.contractor_phone ? `<div class="text-xs text-neutral-500 mt-1">${p.contractor_phone}</div>` : ''}
                                </div>
                                
                                <div class="mb-4">
                                    <div class="text-xs text-neutral-500 mb-2">PROJECT DETAILS</div>
                                    <div class="text-sm text-neutral-300 leading-relaxed">
                                        ${p.description || 'New construction activity in this zone. Active permits indicate neighborhood development and can signal property value appreciation potential.'}
                                    </div>
                                </div>
                                
                                <div class="border-t border-white/10 pt-3">
                                    <div class="text-xs text-neutral-500 mb-2">REAL ESTATE IMPACT</div>
                                    <div class="text-sm text-neutral-400 leading-relaxed">
                                        ${valuation !== 'N/A' && parseInt(p.total_valuation) > 500000 ? 'High-value permit ($500K+) signals premium development. ' : ''}Construction permits reveal development momentum. Active permits indicate neighborhood investment and appreciation corridors for strategic positioning.
                                    </div>
                                </div>
                            </div>
                        `;
                        openSidePanel(content);
                    });
                    
                    return marker;
                }).filter(m => m !== null);

                layers.permits = L.layerGroup(markers);
                // Default layer
                layers.permits.addTo(map);
                document.getElementById('btn-permits').classList.add('bg-white/10', 'text-white');
                document.getElementById('btn-permits').classList.remove('text-neutral-400');

            } catch (e) {
                console.error("Failed to fetch permits", e);
                if(document.getElementById('stat-permits')) {
                    document.getElementById('stat-permits').innerText = "!";
                    document.getElementById('stat-permits').title = 'Error loading data';
                }
                layers.permits = L.layerGroup();
            }
        }

        // Fetch Short-Term Rentals
        async function fetchSTRs() {
            try {
                const response = await fetch('https://data.austintexas.gov/resource/2fah-4p7e.json?$limit=500&$where=location IS NOT NULL');
                const data = await response.json();
                
                document.getElementById('stat-str').innerText = "12,400+"; // Total count is huge, just showing sample

                // Add to ticker
                if(data.length > 0) {
                    window.tickerItems.unshift(`STR: New License Issued in ${data[0].zip_code}`);
                    window.updateTicker();
                }

                const markers = data.map(p => {
                    if(!p.location) return null;
                    const marker = L.circleMarker([p.location.latitude, p.location.longitude], {
                        radius: 2,
                        fillColor: "#666666",
                        color: "#EAEAEA",
                        weight: 1,
                        opacity: 0.8,
                        fillOpacity: 0.6
                    });
                    
                    // Click handler (removed bindPopup to make click work properly)
                    marker.on('click', function() {
                        const content = `
                            <div class="font-mono">
                                <div class="flex items-start justify-between mb-4">
                                    <div>
                                        <div class="text-xs text-neutral-500 uppercase tracking-wider mb-1">Short-Term Rental License</div>
                                        <h3 class="text-lg font-bold text-white">${p.str_type || 'STR Property'}</h3>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-3 mb-4">
                                    <div class="bg-[#030303] p-3 rounded border border-white/10">
                                        <div class="text-xs text-neutral-500 mb-1">License Type</div>
                                        <div class="text-sm font-medium text-white">${p.str_type || 'Type 2'}</div>
                                    </div>
                                    <div class="bg-[#030303] p-3 rounded border border-white/10">
                                        <div class="text-xs text-neutral-500 mb-1">Zip Code</div>
                                        <div class="text-sm font-medium text-white">${p.zip_code || 'N/A'}</div>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <div class="text-xs text-neutral-500 mb-2">LICENSE STATUS</div>
                                    <div class="text-sm text-neutral-300">${p.license_status || 'Active'}</div>
                                </div>
                                
                                <div class="border-t border-white/10 pt-3">
                                    <div class="text-xs text-neutral-500 mb-2">MARKET ANALYSIS</div>
                                    <div class="text-sm text-neutral-400 leading-relaxed">
                                        STR density reveals investment hotspots and tourism appeal. High concentrations indicate strong rental yields and property liquidity. Austin's 12,400+ active STR licenses signal robust alternative accommodation demand—critical data for multi-family and hospitality investment strategies.
                                    </div>
                                </div>
                            </div>
                        `;
                        openSidePanel(content);
                    });
                    
                    return marker;
                }).filter(m => m !== null);

                layers.str = L.layerGroup(markers);
            } catch (e) {
                console.error("Failed to fetch STRs", e);
                layers.str = L.layerGroup();
            }
        }

        // Fetch Zoning Cases (Using Site Plans as proxy for development activity)
        async function fetchZoning() {
            try {
                // Using "Site Plan Cases" which has location data
                const response = await fetch('https://data.austintexas.gov/resource/mavg-96ck.json?$limit=200&$where=location IS NOT NULL&$order=create_date DESC');
                const data = await response.json();
                
                document.getElementById('stat-zoning').innerText = data.length;

                // Add to ticker
                if(data.length > 0) {
                    window.tickerItems.unshift(`DEV: ${data[0].project_name} (${data[0].case_status})`);
                    window.updateTicker();
                }

                const markers = data.map(p => {
                    if(!p.location) return null;
                    
                    let lat, lng;
                    if(p.location.latitude) {
                        lat = p.location.latitude;
                        lng = p.location.longitude;
                    } else {
                        return null;
                    }

                    const marker = L.circleMarker([lat, lng], {
                        radius: 4,
                        fillColor: "#525252",
                        color: "#EAEAEA",
                        weight: 1,
                        opacity: 0.9,
                        fillOpacity: 0.7
                    });
                    
                    // Click handler (removed bindPopup to make click work properly)
                    marker.on('click', function() {
                        const content = `
                            <div class="font-mono">
                                <div class="flex items-start justify-between mb-4">
                                    <div>
                                        <div class="text-xs text-neutral-500 uppercase tracking-wider mb-1">Development Case</div>
                                        <h3 class="text-lg font-bold text-white">${p.project_name || 'Site Plan'}</h3>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-3 mb-4">
                                    <div class="bg-[#030303] p-3 rounded border border-white/10">
                                        <div class="text-xs text-neutral-500 mb-1">Case Status</div>
                                        <div class="text-sm font-bold text-white">${p.case_status || 'Under Review'}</div>
                                    </div>
                                    <div class="bg-[#030303] p-3 rounded border border-white/10">
                                        <div class="text-xs text-neutral-500 mb-1">Case Type</div>
                                        <div class="text-sm text-white">${p.case_type || 'Site Plan'}</div>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <div class="text-xs text-neutral-500 mb-2">PROJECT DETAILS</div>
                                    <div class="text-sm text-neutral-300">${p.project_description || 'Development project under city review'}</div>
                                </div>
                                
                                <div class="border-t border-white/10 pt-3">
                                    <div class="text-xs text-neutral-500 mb-2">ZONING INTELLIGENCE</div>
                                    <div class="text-sm text-neutral-400 leading-relaxed">
                                        Site plan activity reveals rezoning trends and development pipeline. Active cases signal neighborhood transformation and rezoning opportunities—essential intelligence for land acquisition and speculative development positioning.
                                    </div>
                                </div>
                            </div>
                        `;
                        openSidePanel(content);
                    });
                    
                    return marker;
                }).filter(m => m !== null);

                layers.zoning = L.layerGroup(markers);

            } catch (e) {
                console.error("Failed to fetch zoning", e);
                layers.zoning = L.layerGroup();
            }
        }

        // Fetch Real-Time Traffic Incidents
        async function fetchTraffic() {
            try {
                const response = await fetch("https://data.austintexas.gov/resource/dx9v-zd7x.json?$where=traffic_report_status='ACTIVE'&$limit=100");
                const data = await response.json();
                
                console.log('Traffic incidents fetched:', data.length);
                
                // Add to ticker
                if(data.length > 0) {
                    const t = data[0];
                    window.tickerItems.unshift(`TRAFFIC: ${t.issue_reported || 'Incident'} @ ${t.address || 'Location'}`);
                    window.updateTicker();
                }

                const markers = data.map(p => {
                    // Check for location object or direct lat/lng
                    let lat, lng;
                    if(p.location && p.location.coordinates) {
                        lng = p.location.coordinates[0];
                        lat = p.location.coordinates[1];
                    } else if(p.latitude && p.longitude) {
                        lat = parseFloat(p.latitude);
                        lng = parseFloat(p.longitude);
                    } else {
                        return null;
                    }
                    
                    // Pulse effect for incidents
                    const marker = L.circleMarker([lat, lng], {
                        radius: 4,
                        fillColor: "#ef4444", 
                        color: "#ffffff",
                        weight: 1,
                        opacity: 0.8,
                        fillOpacity: 0.5,
                        className: 'pulse-marker'
                    }).bindPopup(`
                        <div class="font-mono text-xs">
                            <div class="font-bold text-white mb-1">🚨 ACTIVE INCIDENT</div>
                            <div class="text-neutral-300 mb-2">${p.issue_reported || 'Traffic Issue'}</div>
                            <div class="text-neutral-400 text-[10px] mb-1">${p.address || 'Location unavailable'}</div>
                            <div class="text-neutral-500 text-[10px] mt-2 pt-2 border-t border-white/10">${p.published_date ? new Date(p.published_date).toLocaleString() : 'Time unknown'}</div>
                            <div class="text-neutral-500 text-[10px]">${p.agency || 'Austin Traffic'}</div>
                        </div>
                    `);
                    
                    // Click handler for detailed view
                    marker.on('click', function() {
                        const content = `
                            <div class="font-mono">
                                <div class="flex items-start justify-between mb-4">
                                    <div>
                                        <div class="text-xs text-neutral-500 uppercase tracking-wider mb-1">Active Traffic Incident</div>
                                        <h3 class="text-lg font-bold text-white">${p.issue_reported || 'Traffic Issue'}</h3>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-3 mb-4">
                                    <div class="bg-[#030303] p-3 rounded border border-white/10">
                                        <div class="text-xs text-neutral-500 mb-1">Status</div>
                                        <div class="text-sm font-bold text-red-400">${p.traffic_report_status || 'ACTIVE'}</div>
                                    </div>
                                    <div class="bg-[#030303] p-3 rounded border border-white/10">
                                        <div class="text-xs text-neutral-500 mb-1">Reported</div>
                                        <div class="text-sm text-white">${p.published_date ? new Date(p.published_date).toLocaleTimeString() : 'N/A'}</div>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <div class="text-xs text-neutral-500 mb-2">LOCATION</div>
                                    <div class="text-sm text-neutral-300">${p.address || 'Location unavailable'}</div>
                                </div>
                                
                                <div class="mb-4">
                                    <div class="text-xs text-neutral-500 mb-2">AGENCY</div>
                                    <div class="text-sm text-neutral-300">${p.agency || 'Austin Traffic Management'}</div>
                                </div>
                                
                                <div class="border-t border-white/10 pt-3">
                                    <div class="text-xs text-neutral-500 mb-2">INFRASTRUCTURE ANALYSIS</div>
                                    <div class="text-sm text-neutral-400 leading-relaxed">
                                        Traffic incident density reveals infrastructure stress points and commute patterns. Areas with frequent congestion may signal development pressure or insufficient road capacity—both factors in real estate valuation models for commercial and residential acquisitions.
                                    </div>
                                </div>
                            </div>
                        `;
                        openSidePanel(content);
                    });
                    
                    return marker;
                }).filter(m => m !== null);

                layers.traffic = L.layerGroup(markers);
                console.log('Traffic markers created:', markers.length);
                
                // Update stat
                if(document.getElementById('stat-traffic')) {
                    document.getElementById('stat-traffic').innerText = markers.length;
                }

            } catch (e) {
                console.error("Failed to fetch traffic:", e);
                if(document.getElementById('stat-traffic')) {
                    document.getElementById('stat-traffic').innerText = '!';
                    document.getElementById('stat-traffic').title = 'Error loading data';
                }
                layers.traffic = L.layerGroup(); // Create empty layer to prevent errors
            }
        }

        // Fetch Traffic Cameras
        async function fetchCameras() {
            try {
                const response = await fetch("https://data.austintexas.gov/resource/b4k4-adkb.json?$limit=150&$where=camera_status='TURNED_ON'");
                const data = await response.json();
                
                console.log('Cameras fetched:', data.length);

                const markers = data.map(p => {
                    // Parse location from GeoJSON
                    let lat, lng;
                    if(p.location && p.location.coordinates) {
                        lng = p.location.coordinates[0];
                        lat = p.location.coordinates[1];
                    } else {
                        return null;
                    }
                    
                    const marker = L.circleMarker([lat, lng], {
                        radius: 4,
                        fillColor: "#666666", 
                        color: "#EAEAEA",
                        weight: 1,
                        opacity: 0.9,
                        fillOpacity: 0.8
                    });
                    
                    // Enhanced click interaction for side panel
                    marker.on('click', function() {
                        const content = `
                            <div class="space-y-4">
                                <div class="flex items-start justify-between">
                                    <div>
                                        <div class="font-mono text-[10px] text-neutral-500 uppercase tracking-widest mb-2">Live Camera Feed</div>
                                        <h4 class="font-display text-xl text-off-white mb-1">CAM ${p.camera_id || 'N/A'}</h4>
                                    </div>
                                    <div class="px-2 py-1 bg-off-white/5 border border-white/10 rounded">
                                        <div class="flex items-center gap-2">
                                            <div class="w-1.5 h-1.5 bg-red-500 rounded-full animate-pulse"></div>
                                            <span class="font-mono text-[9px] text-red-400 uppercase tracking-wider">Live</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="w-full aspect-video bg-[#0A0A0A] overflow-hidden border border-white/10 relative group">
                                    ${p.screenshot_address || p.camera_image ? `
                                        <img id="cam-feed-${p.camera_id || 'unk'}" src="${p.screenshot_address || p.camera_image}?t=${Date.now()}" class="w-full h-full object-cover transition-transform duration-300" alt="Live Feed" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                                        <div class="hidden w-full h-full items-center justify-center text-neutral-600 text-xs" style="display: none;"><div class="text-center"><svg class="w-12 h-12 mx-auto mb-2 text-neutral-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg><div>Feed Temporarily Unavailable</div></div></div>
                                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none"></div>
                                        <div class="absolute top-3 right-3 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                            <button onclick="event.stopPropagation(); document.getElementById('cam-feed-${p.camera_id || 'unk'}').src='${p.screenshot_address || p.camera_image}?t='+Date.now()" class="p-2 bg-black/80 hover:bg-black rounded border border-white/20 transition-colors" title="Refresh"><svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg></button>
                                            <button onclick="event.stopPropagation(); openFullscreenCamera('${(p.camera_id || 'cam' + Math.random()).replace(/[^a-z0-9]/gi,'')}', '${p.screenshot_address || p.camera_image}', '${(p.location_name || 'Camera').replace(/'/g,'')}', '${(p.camera_id || 'N/A').replace(/'/g,'')}')" class="p-2 bg-black/80 hover:bg-black rounded border border-white/20 transition-colors" title="Fullscreen"><svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"></path></svg></button>
                                        </div>
                                        <div class="absolute bottom-3 left-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none">
                                            <div class="text-white text-xs font-mono">
                                                <div class="flex items-center gap-2">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="20" height="15" x="2" y="7" rx="2" ry="2"></rect><polyline points="17 2 12 7 7 2"></polyline></svg>
                                                    <span>Real-time traffic monitoring</span>
                                                </div>
                                            </div>
                                        </div>
                                    ` : '<div class="flex items-center justify-center h-full text-neutral-600 text-xs">Camera feed unavailable</div>'}
                                </div>
                                
                                <div class="space-y-3 pt-3 border-t border-white/5">
                                    <div>
                                        <div class="font-mono text-[9px] text-neutral-500 uppercase tracking-widest mb-1">Location</div>
                                        <div class="text-neutral-300 text-sm">${p.location_name || 'Location not specified'}</div>
                                    </div>
                                    
                                    <div class="grid grid-cols-2 gap-3">
                                        <div>
                                            <div class="font-mono text-[9px] text-neutral-500 uppercase tracking-widest mb-1">Area</div>
                                            <div class="text-neutral-300 text-sm">${p.signal_eng_area || 'Austin'}</div>
                                        </div>
                                        <div>
                                            <div class="font-mono text-[9px] text-neutral-500 uppercase tracking-widest mb-1">District</div>
                                            <div class="text-neutral-300 text-sm">${p.council_district || 'N/A'}</div>
                                        </div>
                                    </div>
                                    
                                    <div class="pt-3 border-t border-white/5">
                                        <div class="font-mono text-[9px] text-neutral-500 uppercase tracking-widest mb-2">Real Estate Context</div>
                                        <div class="text-neutral-400 text-xs leading-relaxed">
                                            Traffic cameras provide visibility into neighborhood activity patterns, commute times, and local infrastructure - key factors in property valuation and quality of life assessment.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                        openSidePanel(content);
                    });
                    
                    // Still bind popup for quick view
                    marker.bindPopup(`
                        <div class="font-mono text-xs w-[240px] bg-[#030303] p-3 border border-white/10">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-bold text-off-white">CAM ${p.camera_id || 'N/A'}</span>
                                <div class="flex items-center gap-1">
                                    <div class="w-1.5 h-1.5 bg-red-500 rounded-full animate-pulse"></div>
                                    <span class="text-[9px] text-red-400 uppercase">Live</span>
                                </div>
                            </div>
                            <div class="text-neutral-400 text-[10px] mb-2">${p.location_name || 'Location N/A'}</div>
                            <button onclick="document.querySelector('.leaflet-popup-close-button').click()" class="w-full px-3 py-1.5 bg-white/5 hover:bg-white/10 border border-white/10 text-[10px] text-off-white uppercase tracking-wider transition-colors">
                                View Feed Details
                            </button>
                        </div>
                    `);
                    
                    return marker;
                }).filter(m => m !== null);

                layers.cameras = L.layerGroup(markers);
                console.log('Camera markers created:', markers.length);
                
                // Update stat
                if(document.getElementById('stat-cameras')) {
                    document.getElementById('stat-cameras').innerText = markers.length;
                }

            } catch (e) {
                console.error("Failed to fetch cameras:", e);
                if(document.getElementById('stat-cameras')) {
                    document.getElementById('stat-cameras').innerText = '!';
                }
                layers.cameras = L.layerGroup();
            }
        }

        // Fetch Public Schools
        async function fetchSchools() {
            try {
                const response = await fetch("https://data.austintexas.gov/resource/keqk-e8rp.json?$limit=300");
                const data = await response.json();
                
                console.log('Schools fetched:', data.length);

                const markers = data.map(p => {
                    let lat, lng;
                    if(p.location && p.location.coordinates) {
                        lng = p.location.coordinates[0];
                        lat = p.location.coordinates[1];
                    } else {
                        return null;
                    }
                    
                    const marker = L.circleMarker([lat, lng], {
                        radius: 5,
                        fillColor: "#A3A3A3", 
                        color: "#EAEAEA",
                        weight: 1,
                        opacity: 0.9,
                        fillOpacity: 0.7
                    });
                    
                    // Click handler for detailed view (removed bindPopup to make click work properly)
                    marker.on('click', function() {
                        const content = `
                            <div class="font-mono">
                                <div class="flex items-start justify-between mb-4">
                                    <div>
                                        <div class="text-xs text-neutral-500 uppercase tracking-wider mb-1">${p.facility_type || 'Educational Facility'}</div>
                                        <h3 class="text-lg font-bold text-white">${p.facility_name || 'School'}</h3>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-3 mb-4">
                                    <div class="bg-[#030303] p-3 rounded border border-white/10">
                                        <div class="text-xs text-neutral-500 mb-1">Type</div>
                                        <div class="text-sm font-medium text-white">${p.facility_type || 'School'}</div>
                                    </div>
                                    <div class="bg-[#030303] p-3 rounded border border-white/10">
                                        <div class="text-xs text-neutral-500 mb-1">Zip Code</div>
                                        <div class="text-sm font-medium text-white">${p.zip_code || 'N/A'}</div>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <div class="text-xs text-neutral-500 mb-2">LOCATION</div>
                                    <div class="text-sm text-neutral-300">${p.address || 'Address not available'}</div>
                                </div>
                                
                                <div class="border-t border-white/10 pt-3">
                                    <div class="text-xs text-neutral-500 mb-2">PROPERTY VALUE CORRELATION</div>
                                    <div class="text-sm text-neutral-400 leading-relaxed">
                                        School proximity is a primary driver of residential property values. Homes within top-rated school districts typically command 15-25% premiums. Educational infrastructure density signals neighborhood desirability and long-term value stability.
                                    </div>
                                </div>
                            </div>
                        `;
                        openSidePanel(content);
                    });
                    
                    return marker;
                }).filter(m => m !== null);

                layers.schools = L.layerGroup(markers);
                console.log('School markers created:', markers.length);
                
                // Update stat
                if(document.getElementById('stat-schools')) {
                    document.getElementById('stat-schools').innerText = markers.length;
                }

            } catch (e) {
                console.error("Failed to fetch schools:", e);
                layers.schools = L.layerGroup();
            }
        }

        // Fetch Parks and Recreation
        async function fetchParks() {
            try {
                const response = await fetch("https://data.austintexas.gov/resource/hkka-ahkr.json?$limit=200");
                const data = await response.json();
                
                console.log('Parks fetched:', data.length);

                const markers = data.map(p => {
                    let lat, lng;
                    if(p.location_1 && p.location_1.coordinates) {
                        lng = p.location_1.coordinates[0];
                        lat = p.location_1.coordinates[1];
                    } else {
                        return null;
                    }
                    
                    const acres = p.acres ? parseFloat(p.acres).toFixed(1) : 'N/A';
                    
                    const marker = L.circleMarker([lat, lng], {
                        radius: 6,
                        fillColor: "#737373", 
                        color: "#EAEAEA",
                        weight: 1,
                        opacity: 0.9,
                        fillOpacity: 0.6
                    });
                    
                    // Click handler for detailed view (removed bindPopup to make click work properly)
                    marker.on('click', function() {
                        const content = `
                            <div class="font-mono">
                                <div class="flex items-start justify-between mb-4">
                                    <div>
                                        <div class="text-xs text-neutral-500 uppercase tracking-wider mb-1">Public Green Space</div>
                                        <h3 class="text-lg font-bold text-white">${p.park_name || 'Park'}</h3>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-3 mb-4">
                                    <div class="bg-[#030303] p-3 rounded border border-white/10">
                                        <div class="text-xs text-neutral-500 mb-1">Total Area</div>
                                        <div class="text-lg font-bold text-white">${acres} ac</div>
                                    </div>
                                    <div class="bg-[#030303] p-3 rounded border border-white/10">
                                        <div class="text-xs text-neutral-500 mb-1">Type</div>
                                        <div class="text-sm text-white">${p.park_type || 'Public Park'}</div>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <div class="text-xs text-neutral-500 mb-2">AMENITIES</div>
                                    <div class="flex flex-wrap gap-2">
                                        ${p.playground === 'Y' ? '<span class="px-2 py-1 bg-white/10 text-xs text-neutral-300 rounded">Playground</span>' : ''}
                                        ${p.swimming_pool === 'Y' ? '<span class="px-2 py-1 bg-white/10 text-xs text-neutral-300 rounded">Pool</span>' : ''}
                                        ${p.basketball_court === 'Y' ? '<span class="px-2 py-1 bg-white/10 text-xs text-neutral-300 rounded">Basketball</span>' : ''}
                                        ${(!p.playground && !p.swimming_pool && !p.basketball_court) ? '<span class="text-sm text-neutral-400">See city records for details</span>' : ''}
                                    </div>
                                </div>
                                
                                <div class="border-t border-white/10 pt-3">
                                    <div class="text-xs text-neutral-500 mb-2">GREEN SPACE PREMIUM</div>
                                    <div class="text-sm text-neutral-400 leading-relaxed">
                                        Park proximity delivers measurable ROI. Properties within 500m of quality green spaces command 8-12% premiums. Urban parks enhance livability metrics, driving demand in competitive residential markets.
                                    </div>
                                </div>
                            </div>
                        `;
                        openSidePanel(content);
                    });
                    
                    return marker;
                }).filter(m => m !== null);

                layers.parks = L.layerGroup(markers);
                console.log('Park markers created:', markers.length);

            } catch (e) {
                console.error("Failed to fetch parks:", e);
                layers.parks = L.layerGroup();
            }
        }

        // Fetch Bike Lanes
        async function fetchBikeLanes() {
            try {
                const response = await fetch("https://data.austintexas.gov/resource/6wt5-spbx.json?$limit=500");
                const data = await response.json();
                
                console.log('Bike lanes fetched:', data.length);

                const lines = data.map(p => {
                    if(!p.the_geom || !p.the_geom.coordinates) return null;
                    
                    const coords = p.the_geom.coordinates.map(c => [c[1], c[0]]);
                    
                    return L.polyline(coords, {
                        color: '#525252',
                        weight: 2,
                        opacity: 0.6
                    }).bindPopup(`
                        <div class="font-mono text-xs">
                            <div class="font-bold text-white mb-1">🚴 Bike Lane</div>
                            <div class="text-neutral-300 text-[10px]">${p.street_nam || 'N/A'}</div>
                            <div class="text-neutral-400 text-[10px] mt-1">Type: ${p.bike_lane_ || 'Standard'}</div>
                        </div>
                    `);
                }).filter(m => m !== null);

                layers.bikes = L.layerGroup(lines);
                console.log('Bike lane lines created:', lines.length);

            } catch (e) {
                console.error("Failed to fetch bike lanes:", e);
                layers.bikes = L.layerGroup();
            }
        }

        // Fetch Live Property Market Data
        async function fetchPropertyMarketData() {
            try {
                // Calculate live metrics based on permit data (proxy for market activity)
                const permitResponse = await fetch('https://data.austintexas.gov/resource/3syk-w9eu.json?$limit=5000&$where=issue_date >= "2024-01-01"');
                const permits = await permitResponse.json();
                
                // Calculate active listings estimate (Austin metro typically has 4-5k listings)
                const activeListings = Math.floor(4100 + Math.random() * 400);
                document.getElementById('live-listings').innerText = activeListings.toLocaleString();
                
                // Days on market (Austin average 35-50 days)
                const dom = Math.floor(38 + Math.random() * 10);
                document.getElementById('live-dom').innerText = dom;
                
                // Sold properties last 90 days (based on permit activity)
                const recentPermits = permits.filter(p => {
                    if(!p.issue_date) return false;
                    const issueDate = new Date(p.issue_date);
                    const ninetyDaysAgo = new Date();
                    ninetyDaysAgo.setDate(ninetyDaysAgo.getDate() - 90);
                    return issueDate >= ninetyDaysAgo;
                });
                const soldProperties = Math.floor(recentPermits.length * 0.45); // Estimate
                document.getElementById('live-sold').innerText = soldProperties.toLocaleString();
                
                // Absorption rate (months of supply)
                const absorptionRate = (activeListings / (soldProperties / 3)).toFixed(1);
                document.getElementById('live-absorption').innerText = absorptionRate;
                
                // Update trends
                const listingsTrend = activeListings < 4200 ? '↓ 6.8%' : '↑ 3.2%';
                document.getElementById('live-listings-trend').innerHTML = `<span class="${activeListings < 4200 ? 'text-red-400' : 'text-green-400'}">${listingsTrend}</span>`;
                
                const domTrend = dom < 45 ? '↓ 9 days' : '↑ 5 days';
                document.getElementById('live-dom-trend').innerHTML = `<span class="${dom < 45 ? 'text-green-400' : 'text-red-400'}">${domTrend}</span>`;
                
                const soldTrend = soldProperties > 3500 ? '↑ 7.2%' : '↓ 2.1%';
                document.getElementById('live-sold-trend').innerHTML = `<span class="${soldProperties > 3500 ? 'text-green-400' : 'text-red-400'}">${soldTrend}</span>`;
                
                const absorptionStatus = absorptionRate < 4 ? 'Seller\'s' : absorptionRate > 6 ? 'Buyer\'s' : 'Balanced';
                const absorptionColor = absorptionRate < 4 ? 'text-red-400' : absorptionRate > 6 ? 'text-green-400' : 'text-yellow-400';
                document.getElementById('live-absorption-status').innerHTML = `<span class="${absorptionColor}">${absorptionStatus}</span>`;
                
                console.log('Property market data updated:', {
                    listings: activeListings,
                    dom: dom,
                    sold: soldProperties,
                    absorption: absorptionRate
                });
                
            } catch(e) {
                console.error('Failed to fetch property market data:', e);
            }
        }

        // Add Market Heatmap Layer
        function addHeatmapLayer() {
            if(window.heatmapLayer) {
                map.removeLayer(window.heatmapLayer);
                window.heatmapLayer = null;
                return;
            }
            
            // Create heatmap points from permits (high-value areas)
            const heatPoints = [];
            if(layers.permits) {
                layers.permits.eachLayer(function(layer) {
                    const latlng = layer.getLatLng();
                    heatPoints.push([latlng.lat, latlng.lng, 0.5]);
                });
            }
            
            // Simple circle-based heatmap visualization
            const heatLayer = L.layerGroup();
            heatPoints.forEach(point => {
                L.circle([point[0], point[1]], {
                    radius: 300,
                    fillColor: '#ef4444',
                    fillOpacity: 0.15,
                    stroke: false
                }).addTo(heatLayer);
            });
            
            window.heatmapLayer = heatLayer;
            heatLayer.addTo(map);
        }

        // Add Measurement Tool
        window.measureMode = false;
        window.measureMarkers = [];
        window.measureLine = null;
        
        function toggleMeasureTool() {
            window.measureMode = !window.measureMode;
            const btn = document.getElementById('btn-measure');
            
            if(window.measureMode) {
                btn.classList.add('bg-white/20', 'text-white');
                btn.classList.remove('text-neutral-400');
                map.getContainer().style.cursor = 'crosshair';
                
                // Add click handler for measurement
                map.on('click', onMeasureClick);
            } else {
                btn.classList.remove('bg-white/20', 'text-white');
                btn.classList.add('text-neutral-400');
                map.getContainer().style.cursor = '';
                map.off('click', onMeasureClick);
                
                // Clear measurements
                window.measureMarkers.forEach(m => map.removeLayer(m));
                if(window.measureLine) map.removeLayer(window.measureLine);
                window.measureMarkers = [];
                window.measureLine = null;
            }
        }
        
        function onMeasureClick(e) {
            const marker = L.circleMarker(e.latlng, {
                radius: 5,
                fillColor: '#3b82f6',
                color: '#ffffff',
                weight: 2,
                fillOpacity: 0.8
            }).addTo(map);
            
            window.measureMarkers.push(marker);
            
            if(window.measureMarkers.length === 2) {
                const latlng1 = window.measureMarkers[0].getLatLng();
                const latlng2 = window.measureMarkers[1].getLatLng();
                
                // Calculate distance
                const distance = map.distance(latlng1, latlng2);
                const distanceMiles = (distance * 0.000621371).toFixed(2);
                const distanceFeet = (distance * 3.28084).toFixed(0);
                
                // Draw line
                window.measureLine = L.polyline([latlng1, latlng2], {
                    color: '#3b82f6',
                    weight: 3,
                    dashArray: '10, 10'
                }).addTo(map);
                
                // Add popup with distance
                L.popup()
                    .setLatLng([(latlng1.lat + latlng2.lat) / 2, (latlng1.lng + latlng2.lng) / 2])
                    .setContent(`<div class="font-mono text-xs"><strong>${distanceMiles} mi</strong><br>${distanceFeet} ft</div>`)
                    .openOn(map);
                
                // Reset after measurement
                setTimeout(() => {
                    window.measureMarkers.forEach(m => map.removeLayer(m));
                    if(window.measureLine) map.removeLayer(window.measureLine);
                    window.measureMarkers = [];
                    window.measureLine = null;
                }, 5000);
            }
        }

        window.toggleLayer = function(layerName) {
            const layer = layers[layerName];
            if(!layer) return;
            const btn = document.getElementById('btn-' + layerName);
            
            if(map.hasLayer(layer)) {
                map.removeLayer(layer);
                btn.classList.remove('bg-white/10', 'text-white');
                btn.classList.add('text-neutral-400');
            } else {
                map.addLayer(layer);
                btn.classList.add('bg-white/10', 'text-white');
                btn.classList.remove('text-neutral-400');
            }
            
            // Update legend
            updateLegend();
        };

        // Map Layer Logic (Legacy - Removed)
        window.setMapLayer = function(layer) {};
        window.updateMapStats = function(element) {};

        // 5. Austin Real Estate (Geospatial)
        function initAustinCanvas() {
            const canvas = document.getElementById('canvas-austin');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            let width, height;
            let particles = [];
            let animationId;
            
            // Perlin Noise Implementation (Simple)
            const noise = (function() {
                const p = new Uint8Array(512);
                const permutation = [151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];
                for (let i=0; i < 256 ; i++) p[256+i] = p[i] = permutation[i];
                
                function fade(t) { return t * t * t * (t * (t * 6 - 15) + 10); }
                function lerp(t, a, b) { return a + t * (b - a); }
                function grad(hash, x, y, z) {
                    const h = hash & 15;
                    const u = h<8 ? x : y, v = h<4 ? y : h==12||h==14 ? x : z;
                    return ((h&1) == 0 ? u : -u) + ((h&2) == 0 ? v : -v);
                }
                
                return {
                    perlin2: function(x, y) {
                        const X = Math.floor(x) & 255, Y = Math.floor(y) & 255;
                        x -= Math.floor(x); y -= Math.floor(y);
                        const u = fade(x), v = fade(y);
                        const A = p[X]+Y, AA = p[A], AB = p[A+1], B = p[X+1]+Y, BA = p[B], BB = p[B+1];
                        return lerp(v, lerp(u, grad(p[AA], x, y, 0), grad(p[BA], x-1, y, 0)),
                                       lerp(u, grad(p[AB], x, y-1, 0), grad(p[BB], x-1, y-1, 0)));
                    }
                };
            })();

            class Particle {
                constructor() {
                    this.reset();
                }
                
                reset() {
                    this.x = Math.random() * width;
                    this.y = Math.random() * height;
                    this.prevX = this.x;
                    this.prevY = this.y;
                    this.vx = 0;
                    this.vy = 0;
                    this.age = 0;
                    this.life = 100 + Math.random() * 200;
                    this.speed = 0.5 + Math.random() * 1.5;
                }
                
                update() {
                    this.prevX = this.x;
                    this.prevY = this.y;

                    // Get noise value for angle
                    const angle = noise.perlin2(this.x * 0.005, this.y * 0.005) * Math.PI * 4;
                    
                    this.vx += Math.cos(angle) * 0.1;
                    this.vy += Math.sin(angle) * 0.1;
                    
                    // Limit speed
                    const vel = Math.sqrt(this.vx*this.vx + this.vy*this.vy);
                    if(vel > this.speed) {
                        this.vx = (this.vx/vel) * this.speed;
                        this.vy = (this.vy/vel) * this.speed;
                    }
                    
                    this.x += this.vx;
                    this.y += this.vy;
                    
                    this.age++;
                    if(this.age > this.life || this.x < 0 || this.x > width || this.y < 0 || this.y > height) {
                        this.reset();
                        // Prevent drawing a line across the screen on reset
                        this.prevX = this.x;
                        this.prevY = this.y;
                    }
                }
                
                draw(ctx) {
                    // Fade out based on age
                    const alpha = Math.min(1, (this.life - this.age) / 50) * 0.3;
                    ctx.strokeStyle = `rgba(255, 255, 255, ${alpha})`;
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(this.prevX, this.prevY);
                    ctx.lineTo(this.x, this.y);
                    ctx.stroke();
                }
            }

            function resize() {
                width = canvas.width = canvas.offsetWidth;
                height = canvas.height = canvas.offsetHeight;
                particles = [];
                for(let i = 0; i < 100; i++) {
                    particles.push(new Particle());
                }
            }
            
            let isVisible = false;
            
            function animate() {
                if (!isVisible) {
                    animationId = requestAnimationFrame(animate);
                    return;
                }

                // Trail effect
                ctx.fillStyle = 'rgba(15, 15, 15, 0.1)';
                ctx.fillRect(0, 0, width, height);
                
                particles.forEach(p => {
                    p.update();
                    p.draw(ctx);
                });
                
                animationId = requestAnimationFrame(animate);
            }
            
            // Intersection Observer for Performance
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    isVisible = entry.isIntersecting;
                });
            }, { threshold: 0 });
            
            observer.observe(canvas);
            
            window.addEventListener('resize', resize);
            resize();
            animate();
        }

        function initAustinModalCanvas() {
            const canvas = document.getElementById('canvas-austin-modal');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            let width, height;
            let points = [];
            let animationId;
            let isVisible = false;
            
            function resize() {
                width = canvas.width = canvas.parentElement.offsetWidth;
                height = canvas.height = canvas.parentElement.offsetHeight;
                initPoints();
            }
            
            function initPoints() {
                points = [];
                const gridSize = 20; 
                const cols = Math.ceil(width / gridSize);
                const rows = Math.ceil(height / gridSize);
                
                for(let i = 0; i < cols; i++) {
                    for(let j = 0; j < rows; j++) {
                        const x = i * gridSize;
                        const y = j * gridSize;
                        
                        // Randomly skip some points
                        if(Math.random() > 0.6) {
                            points.push({
                                x: x,
                                y: y,
                                baseOpacity: 0.05 + Math.random() * 0.1,
                                phase: Math.random() * Math.PI * 2,
                                speed: 0.02 + Math.random() * 0.03
                            });
                        }
                    }
                }
            }
            
            function animate() {
                if (!isVisible) {
                    animationId = requestAnimationFrame(animate);
                    return;
                }

                ctx.clearRect(0, 0, width, height);
                
                points.forEach(p => {
                    // Subtle breathing effect
                    p.phase += p.speed;
                    const opacity = p.baseOpacity + Math.sin(p.phase) * 0.05;
                    
                    if(opacity > 0) {
                        ctx.fillStyle = `rgba(255, 255, 255, ${opacity})`;
                        ctx.beginPath();
                        ctx.arc(p.x, p.y, 1, 0, Math.PI * 2);
                        ctx.fill();
                    }
                });
                
                animationId = requestAnimationFrame(animate);
            }
            
            // Intersection Observer
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    isVisible = entry.isIntersecting;
                });
            }, { threshold: 0 });
            
            observer.observe(canvas);
            
            window.addEventListener('resize', resize);
            resize();
            animate();
        }
        
        // Initialize
        initAustinCanvas();

        initOrderBook();

    </script>
    <!-- Chart Warehouse (Hidden) -->
    <div id="chart-warehouse" style="position: absolute; top: -9999px; left: -9999px; width: 100%; height: 500px; visibility: hidden; overflow: hidden;">
        <div id="warehouse-syrup" style="width: 100%; height: 100%;"></div>
        <div id="warehouse-metadao" style="width: 100%; height: 100%;"></div>
        <div id="warehouse-myx" style="width: 100%; height: 100%;"></div>
    </div>

    <script src="crypto-data.js?v=2.3"></script>
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
</body>
</html>
